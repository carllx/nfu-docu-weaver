# Story 1.2: Initialize New Year

## Status

Done 

## Story

**As a** 导师,
**I want** 执行一个初始化命令（如 `*po initialize-new-year`），
**so that** 我能在新学年开始时安全地清空上一届学生的所有注册信息。

## Acceptance Criteria

1. 该命令能清空 `docs/cohort_registry.md` 的内容。
2. 执行前应有备份或确认提示。

## Tasks / Subtasks

- [ ] Task 1 (AC: 1, 2)
  - [ ] Subtask 1.1: 实现 `*po initialize-new-year` 命令，包含确认提示机制
  - [ ] Subtask 1.2: 创建备份功能，在清空前自动备份当前 cohort_registry.md 文件
  - [ ] Subtask 1.3: 实现清空 cohort_registry.md 内容的逻辑，保留文件结构但移除所有学生、项目和论文数据
  - [ ] Subtask 1.4: 验证清空后的文件格式正确，包含必要的标题和表格结构
  - [ ] Subtask 1.5: 添加成功消息和操作日志记录
  - [ ] Subtask 1.6: 测试命令的完整工作流程，包括确认、备份和清空功能

## Dev Notes

### Previous Story Insights

从故事 1.1 中获得的关键见解：
- 成功创建了 `config/system_config.md` 文件作为系统引擎
- AI agents 能够正确解析配置文件中的所有模块
- 建立了清晰的项目结构，包括中央索引机制
- 验证了系统的配置驱动架构原则

### Data Models

**中央索引结构** [Source: architecture/architecture-03-data-model-entities.md#3.2]
- `docs/cohort_registry.md` 是系统的"数据库索引"，维护三项关键信息：
  - 实体注册：记录所有实体的存在及其唯一ID
  - 核心元数据：存储最常查询的核心信息（姓名、标题、状态）
  - 关系链接：定义实体之间的关系

**实体ID格式** [Source: architecture/architecture-03-data-model-entities.md#3.1]
- 学生 ID: `S_YYYY_##` (例如: `S_2026_01`)
- 毕业创作 ID: `CP_YYYY_A##` (例如: `CP_2026_A01`)
- 毕业论文 ID: `T_YYYY_##` (例如: `T_2026_01`)

### API Specifications

此故事不需要外部 API，但需要实现内部命令接口：
- 命令格式：`*po initialize-new-year`
- 确认机制：需要用户确认才能执行清空操作
- 备份机制：自动创建带时间戳的备份文件

### Component Specifications

此故事不涉及 UI 组件，主要是命令行交互和文件操作。

### File Locations

**主要操作文件** [Source: architecture/architecture-05-directory-structure.md#5.1]
- 目标文件：`docs/cohort_registry.md` - 中央索引文件
- 备份位置：建议使用 `docs/backups/cohort_registry_backup_YYYYMMDD_HHMMSS.md` 格式
- 配置文件：`config/system_config.md` - 系统配置引擎

**目录结构影响** [Source: architecture/architecture-05-directory-structure.md#5.1]
- 清空操作不应影响 `cohort_data/` 目录结构
- 保持 `docs/cohort_registry.md` 的基本表格结构
- 确保文件格式符合 AI agents 解析要求

### Testing Requirements

- 验证命令能正确识别和解析
- 测试确认提示机制的用户交互
- 验证备份文件创建成功且内容完整
- 测试清空后文件结构的完整性
- 确认 AI agents 仍能正确解析清空后的文件
- 验证操作日志记录功能

### Technical Constraints

**系统设计原则** [Source: architecture/architecture-02-high-level-architecture.md#2.2]
- 必须遵循"配置驱动"原则
- 保持"中央索引"的完整性
- 确保"命令驱动接口"的一致性

**文件格式要求**
- 必须保持 Markdown 格式
- 保留表格结构以供 AI agents 解析
- 维护文档头部信息（版本、负责人、说明）
- 确保清空后文件仍符合中央索引的设计规范

**安全要求**
- 执行前必须有用户确认
- 自动创建备份以防数据丢失
- 操作应当是可逆的（通过备份恢复）

### Testing

**测试文件位置**: 基于项目结构，测试应放在适当位置（架构文档中未明确指定具体测试目录）

**测试标准**:
- 单元测试：测试命令解析和执行逻辑
- 集成测试：测试整个工作流程（确认 -> 备份 -> 清空）
- 验收测试：确保满足所有验收标准

**测试框架**: 架构文档中未指定具体测试框架，应使用项目标准

**具体测试要求**:
- 测试用户确认机制
- 验证备份文件创建
- 测试文件清空功能
- 验证清空后文件格式
- 测试错误处理和回滚机制

## Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-01-12 | 1.0 | Initial story creation | sm |

## Dev Agent Record

### Agent Model Used

*待开发代理填写*

### Debug Log References

*待开发代理填写*

### Completion Notes List

*待开发代理填写*

### File List

*待开发代理填写*

## QA Results

*待QA代理填写*
