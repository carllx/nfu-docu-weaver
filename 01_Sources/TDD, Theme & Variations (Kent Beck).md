

![|200](https://i.ytimg.com/vi/C5IH0ABmyc0/hqdefault.jpg)
(Source: [youtube.com: Introduction/ (321) TDD: Theme & Variations (Kent Beck) - YouTube](https://youtu.be/C5IH0ABmyc0?t=4))

### 第一人称重点整理 (以 Kent Beck 的视角)

大家好，我是 Kent Beck。在这次的 Tech Excellence 大会上，我想和大家聊聊 TDD 的“主题与变奏”（Theme & Variations），分享一下它的历史、核心思想以及这些年来我看到的一些演变。

#### TDD 的起源：一个童年故事

TDD 最早的灵感可以追溯到我十岁的时候。我父亲是名工程师，他会带回很多编程书籍。我记得读到关于古老的磁带到磁带（tape-to-tape）编程方法。它的流程是，在写程序之前，程序员会先手动创建一张“期望的输出磁带”。这种“先有结果，再有过程”的思维，在我心里埋下了一颗种子。

#### 历史演变：从工作区到全球化的框架

*   **80年代 (Self-testing Code):** 我在用 Smalltalk 编程时，和 Ward Cunningham 一起在“工作区”（workspace）里写一些代码片段来验证我们的想法。当团队合作变得普遍，这种个人化的验证方式不够用了，我们需要一种能持久化的、与代码本身结合的测试方式。我做了一个关键决定：用目标语言本身（而不是独立的脚本）来写测试。
*   **1994-1995 (SUnit & TDD):** 我把“工作区”的风格“对象化”，创造了 SUnit 框架。不久后，我突然意识到，如果我把童年故事里的那个想法应用到现在，就应该“先写测试，再写代码”。这就是 TDD 诞生的时刻。我当时觉得这个想法很傻，但尝试了一下后，发现它极大地降低了我的编程焦虑。
*   **1997 (JUnit):** 在一次飞往 OOPSLA 大会的航班上，我和 Erich Gamma 一起，将 SUnit 的思想移植到了当时新兴的 Java 语言上，创造了 JUnit。这个小工具在会议上一经分享，便像病毒一样传播开来，人们争相索要拷贝。
*   **2002 (《TDD By Example》):** 为了系统地解释这个方法，我写了这本书。我用沙特尔大教堂（Chartres Cathedral）作为封面，因为它完美地诠释了 TDD 的精神：通过一系列深思熟虑的局部决策，最终涌现出一个宏伟、和谐的整体。

#### 核心原则与常见误解

*   **Canon TDD:** TDD 的核心循环很简单：列出场景清单 -> 写一个失败的测试 -> 让它通过 -> 重构。这不是教条，而是一个起点，你可以根据情境进行变奏。
*   **TDD 是什么技术？** 有人说 TDD 不是测试技术，也不是设计技术。我的回答是：“当然是！” 它是一种将测试、设计和编程融为一体的、与众不同的技术。
*   **自上而下 vs. 自下而上？** TDD 都不是。它是一种“从已知到未知”的探索过程，每次只迈出一小步，确保脚下坚实。

#### 为什么会有这么多争论？

TDD 引起激烈讨论，我认为有几个深层原因：
1.  **责任 (Responsibility):** TDD 让你对代码的行为负全责，无处可藏。
2.  **设计技能 (Design Skills):** 它要求你具备增量设计、将大问题分解为小步骤的能力。
3.  **社会地位 (Social Status):** 过去“测试”被认为是次等工作，这种偏见依然存在。
4.  **羞辱 (Shame):** 有些人把 TDD 当作衡量“专业”与否的标尺来羞辱他人，这是完全错误且无益的。

#### 给开发者的建议

*   **关于单元测试和 Mock:** “单元”这个词限制了我们的思维。我们应该从更广阔的视角（我称之为 Test Desiderata）来看待测试，根据具体需求在多个维度（如速度、可读性、隔离性）上做权衡。如果你的测试对你有用，你就没有“做错”。
*   **如何推广 TDD:** 对于不愿尝试的同事，特别是年轻人，最好的方法不是说教，而是创造一个让他们能亲身体验到 TDD 好处的环境。让他们感受一次“做了一个大重构，但所有测试依然通过”的安心与喜悦，比任何理论都有效。
*   **与 AI 的关系:** AI 可以成为很好的设计反馈工具，但 TDD 中“费脑筋”的过程本身就是学习和成长的过程。我们应该为学习而优化，而不是为了省事。

总而言之，TDD 是一套旨在降低焦虑、提升信心、促进学习和协作的实践。它不仅仅是关于代码，更是关于我们作为开发者如何思考和工作。谢谢大家。

### 视频逐字稿

**讲者：Daniel Moka, Kent Beck**

[00:00] **Daniel Moka:** 我们上线了。欢迎大家。让我们继续 Tech Excellence 大会。我们将开始 USA 的环节。第一个环节是 Kent Beck 带来的 "TDD Theme & Variations"。

[00:15] **Daniel Moka:** 嗯，我在想我是否需要介绍，或者说 Kent Beck 是否需要介绍。但我们还是简单介绍一下吧。

[00:21] **Daniel Moka:** Kent 是 Mechanical Orchard 的首席科学家。他是测试驱动开发（Test-Driven Development）的重新发现者，也是九本编程书籍的作者，其中包括《Test-Driven Development by Example》。这本书在软件工匠中掀起了一场全面的运动，旨在构建更好的软件。我想说，剩下的就是历史了。我想我们都同意 Kent 是有史以来最伟大的人物之一。所以我们非常高兴你能来到这里，Kent，欢迎。

[00:46] **Daniel Moka:** 在我把麦克风交给你之前，我想告诉观众，如果在 Kent 的演讲期间有任何问题，请不要犹豫，在 YouTube 的聊天区提问。最后我们会有一个问答环节，Kent 会回答其中一些问题。所以，Kent，欢迎你，很高兴你能来，麦克风是你的了，祝你演讲顺利。

[01:08] **Kent Beck:** 谢谢你，Daniel，感谢你热情的介绍。

[01:13] **Kent Beck:** 谢谢大家出席。很高兴在这里看不到你们，但我很高兴你们在这里。

[01:22] **Kent Beck:** 我真的很想感谢 Tech Excellence 大会幕后的每一个人，为我提供了这次演讲的机会。准备这次演讲真的给了我一个机会，反思我职业生涯中的各个阶段，所以，我在这里，你们也在这里。

[01:46] **Kent Beck:** TDD 的故事始于我大约十岁的时候。

[01:54] **Kent Beck:** 我在 Silicon Valley 出生成长，那时候它还不是 Silicon Valley。我父亲是一名工程师。他会带回家各种编程书籍。我至今还记得 Burroughs 6700 指令集架构的一些细节，不知道为什么。

[02:13] **Kent Beck:** 他会带这些书回家，而我是一个奇怪的孩子。所以我会仔细研读这些技术书籍，尽管我当时什么都不懂。那时我还没写过一行代码。但我就是对其中的机制着迷。

[02:28] **Kent Beck:** 其中一个故事，我真希望我能找到它，是一个关于如何进行磁带到磁带（tape-to-tape）系统编程的故事。所以，在过去，你会加载一个程序，加载输入磁带，运行程序，它会读取磁带并写入一个输出磁带。然后你把那个磁带喂给下一个程序，再下一个，再下一个。

[02:56] **Kent Beck:** 今天我们称之为纯函数（pure functions）。但那时候，那是唯一的编程方式。这本书说，这是你编程的方式。你拿一个输入磁带，一个实际的输入磁带，在开始编程之前，你手动输入你期望得到的输出磁带。

[03:17] **Kent Beck:** 然后你有一个小的测试框架（harness），它会比较实际的输出磁带和你手动输入的参考输出磁带。好的，那是我十岁的时候，很久很久以前了。这就是最开始的根源，这个故事等一下还会再次出现。

[03:41] **Kent Beck:** 我所做的是准备了一个时间线，关于 TDD 中我所经历的事件。

[05:08] **Kent Beck:** 在过去，当我们用 Smalltalk 开发时，Ward Cunningham 和我会在一个我们称之为工作区（workspace）的地方进行开发。工作区有局部变量，但更重要的是，它有可以持久化并执行的文本块。

[05:27] **Kent Beck:** 所以这是一个伪 Smalltalk，只是为了让你们感受一下古老的拉丁语。我们会有一个表达式，对象 a 是什么，对象 b 是什么，我们给 a 发送一个带有参数 b 的消息，然后我们得到 17。所以我们会打印出来，我们觉得代码能用了，我们会输入这个例子，然后我们会说，17，这是我们期望看到的吗？不，好吧，出什么问题了，然后我们就去调试、调试、调试。我们一直这样做，直到我们得到我们期望看到的值。

[06:06] **Kent Beck:** 然后我们会想，好吧，我们还没完，还有另一个变体，其中 b 是不同的东西，现在答案应该是 36。我们会继续编程。通常这些工作区会随着这些代码片段和它们产生的值而不断增长。

[06:30] **Kent Beck:** 所以，那是 1984 年左右，我大学毕业开始用 Smalltalk 编程的时候。

[06:43] **Kent Beck:** 在 '87 年，当我离开 Tektronix Labs 时，就在我离开之前，Smalltalk 一直在发展壮大。Smalltalk 的初衷是作为一个个人计算环境。所以这是我的计算环境，我可以随心所欲地改变它。它有一种西海岸的氛围，就像在热水浴缸里抽着大麻，我们觉得如果代码有什么问题，我们心里会有数。我们就是那么心有灵犀。

[07:20] **Kent Beck:** 一旦多个人开始在同一个代码上工作，那种个人所有权的感觉就开始消失了。我开始想，我们需要一些与代码一起的测试。

[07:34] **Kent Beck:** 在这一点上，我做出了一个重大的决定，那就是用目标语言来编写测试。在那时，有测试工具，而这些测试工具都有自己的脚本语言。所以你会在这种测试脚本语言和被测试代码的语言之间切换。我想，我想把这两者统一起来。当时并不清楚这是否可行，那是一个有点冒险的尝试。

[08:11] **Kent Beck:** 但是，我有一个小框架，如果你有一个类，附带有以 "test" 命名的方法的代码，你就可以把它们收集起来然后全部运行。如果它们出错了，你就知道有问题。但这是我第一次作为一个程序员，开始为双重检查我自己的结果承担责任，并且是以一种持久的方式。那是 1987 年。

[08:47] **Kent Beck:** 到 '94 年，我成了一名独立顾问，我跟团队谈论如何开发。这是 Extreme Programming 根源的时期。我记得我要去芝加哥，告诉一个团队他们应该如何开发这个项目。我知道我会告诉他们应该写测试，但我没有任何方法让他们写测试。

[09:21] **Kent Beck:** 所以在我出发的前一晚，我坐在电脑前，我实际上看了我刚才给你们看的那些工作区，我说，如果把这个工作区对象化会是什么样子？

[09:41] **Kent Beck:** 所以，如果每个代码片段都是一个测试，它是某个类（TestCase）的实例。有时设置代码会重复，所以这些应该是类的字段，它们会在一个 setup 方法中初始化，然后有一个测试方法，它会取值，执行我们想测试的代码，然后自动断言 17 就是 17，36 就是 36。然后我们可以用组合（composition）把一大堆这样的测试放在一起。

[10:23] **Kent Beck:** 这就是 xUnit 框架的起源，是我把那种工作区的风格拿来并将其对象化的结果。

[10:36] **Kent Beck:** 它只是一个小框架。大概有三个类和十二个方法。我觉得这没什么大不了的，除了我的客户用它写了上百个测试。我记得我把它给了 Hal Hildebrand，他是我认识的最聪明的程序员之一，他当时在做一个对象数据库，遇到了困难。一个月后他回来说，这简直是魔法。我为我最低层的对象写了这种 SUnit 风格的测试，我所有的宏观问题都消失了。整个系统就工作了。我想，好吧，好吧，也许我们有点搞头了。

[11:18] **Kent Beck:** 大约一年后，在我写了很多测试之后，我想起了我在引言中告诉你们的那本书，就是你先做的事情是输入输出磁带，然后你再写程序。在那之前，你总是先写一些代码，然后写一些测试。先写代码，再写测试。我想，好吧，如果我天真地应用这个模型，先写输出磁带，我就会先写测试，然后写代码。我大笑起来，因为这是个多么愚蠢的想法。

[11:53] **Kent Beck:** 当愚蠢的想法成本很低时，一定要尝试它们。因为如果它们不愚蠢，它们就非常有价值，因为没有别人在想这个，你没有任何竞争，因为没有别人傻到会去尝试那个想法。所以我只是，我有了那个想法，让我拿这个模型，把它应用到测试上。我要在写代码之前写测试。我只是为堆栈（stack）试了一下。

[12:22] **Kent Beck:** 新的堆栈是空的，推入一个，弹出，得到同样的东西。推入两个，弹出，顺序正确。我完全被震惊了，作为一个程序员，我变得多么冷静。那时我有十年的专业经验和总共二十年的编程经验，我充满了焦虑，因为我知道有很多事情可能会出错，而且我经验越丰富，我知道可能出错的事情就越多。

[12:58] **Kent Beck:** 当我使用 TDD 时，我只是很冷静。我破坏了什么吗？我按一下按钮。没有。我下一步需要做什么？哦，我不知所措了。不。我知道在这个新的工作流程中我下一步确切需要做什么。

[13:17] **Kent Beck:** TDD 就是从那里来的。那是那个时刻，然后我真的非常兴奋。所以我开始告诉其他人，这个技术经过了几次名字变更，我最终定名为 Test-Driven Development，人们开始在各种地方广泛使用它。

[13:42] **Kent Beck:** 在 '97 年，我和家人搬到了苏黎世，在那里住了几年。我的朋友 Erich Gamma，就是设计模式的那位，和我越来越熟。我们在会议上见过面，一起玩，讨论过事情。但现在，我们正从苏黎世飞往 OOPSLA 会议，我们途径维也纳，这是一个奇怪的转机，但就是这样，然后飞到亚特兰大。两个极客在长途飞行中会做什么呢？

[14:20] **Kent Beck:** 所以我说，让我给你看看这个测试框架，以及 Test-Driven Development，他当时还没做过。然后你给我看看 Java，它是一种全新的、闪亮的编程语言。我们交换一下。而且，就因为我们是超级极客，让我们把 TDD 应用于开发这个测试框架的 Java 版本，并且用它自己来测试自己。让我们来引导（bootstrap）这个东西。我们约定，除非有一个失败的测试，否则我们不写一行代码。

[15:00] **Kent Beck:** 飞了大约三小时，电池没电了，这是在旧时代，座位上没有电源，孩子们你们能相信吗？所以，那次飞行我们就干不了活了，但那真的很酷。比如，很容易添加新测试，所有基本功能都在那里，测试结果以易于阅读的方式报告。我们到了亚特兰大，我们把一张有这个东西的软盘递给 Martin Fowler，因为当时软盘是分发软件的唯一方式。我们把这张软盘递给 Fowler，第二天就有人 буквально 拉着我们的衣服说，我能要一份拷贝吗？我能要一份拷贝吗？

[15:50] **Kent Beck:** 我们俩当时都写过一百个程序了，没有哪个程序得到过那样的反响。所以，那是一个很大的警醒。就像，好吧，人们真的想要这个东西。我们设法把它放到了 SourceForge 上，那是当时的一个平台。有人为它写了一个用户界面，它开始被集成到 IDE 中，等等等等。然后，一百万个克隆就从那里诞生了。但这就是 JUnit 的来源，是在 TDD 被重新发现几年之后。

[16:35] **Kent Beck:** 我不说发明，我说重新发现，因为当我和老一辈的程序员交谈时，那些在 50 年代和 60 年代编程的人，他们会说，不然你还能怎么编程？当然，你必须在写程序之前输入你的期望。不然你怎么知道你完成了？这在 60 年代初的软件开发中，以某种形式是一种普遍的做法。然后我们把它弄丢了。所以我才说自己是重新发现者。

[17:09] **Kent Beck:** 那大概是 Extreme Programming 的时候，XP Explained 在 '99 年出版，那本书火了。那是一个很大的分心事。TDD 是 Extreme Programming 的一个重要部分，因为那种高度连接的开发方式，除非你的缺陷密度非常低，否则是行不通的。所以我知道我想写一本关于 TDD 的书。其他人也扬言要写书，我想，啊，万一别人先出版了呢，啊啊啊。

[17:55] **Kent Beck:** 我出版了 XP Explained，然后是和 Fowler 一起写的计划书，然后我想，我必须把这本书写出来。所以我开始写 Test-Driven Development by Example。这是一个故意的极客双关语，因为测试驱动开发就是通过例子来开发。但无所谓，如果你们没有捧腹大笑，我当然原谅你们。

[18:22] **Kent Beck:** 重要的是，封面图片是沙特尔大教堂（Chartres Cathedral）。它们不是一样的。它们是在略有不同的时期，在略有不同的条件下建造的，有着不同的局部决策，这些决策产生了不同的宏观效果。然而，这座大教堂有一种概念上的统一性，简直令人敬畏。我敢说你走进沙特尔大教堂而不停下脚步是不可能的。每个细节都为上一层级的细节做出了贡献，从整体到石雕中最微小的漩涡，简直令人难以置信。所以这就是为什么它对我来说是 TDD 的象征。你带着极大的信心做出这些局部决策，其结果是在宏观尺度上的辉煌。

[19:22] **Kent Beck:** 所以，我出版了 TDD by Example，我想，它是第一本关于这个主题的书。从那以后又出版了许多其他的书。它在当时引起了不小的轰动，并且至今仍然是我所有书中销量最好的一本。这本书已经 22 岁了。所以，为持续的收入来源欢呼吧。

[19:56] **Kent Beck:** 它也给了我一个机会，我喜欢写书就是因为这个，你有机会真正地深化你对一个主题的理解。

[20:08] **Kent Beck:** 我要谈的最后一个重要事件是 GOOS（Growing Object-Oriented Software, Guided by Tests）。Steve 和 Nat 是我的好朋友，我们在很多方面来自同一种软件开发流派，非常增量的风格。他们使用 mock 的方式与我在外界看到的 mock 使用方式非常不同，我会在接下来的幻灯片中多谈一点。但这有点像是……我不会说史前史，但 GOOS 的出现，有点像是 TDD 经典时期的结束。从那以后，情况发生了很多变化，我不敢说我知道所有变体的所有细节。

[21:11] **Kent Beck:** 但这就是我所知道的关于 Test-Driven Development 历史的部分。记住，如果你有问题，随时可以在聊天中提出，我们会讨论。但这就是前 15 年，是吗？15 年？25 年的 TDD。然后，从那时起，事情就起飞了，有了 TDD 的反弹，等等等等。我们稍后再谈。

[21:39] **Kent Beck:** 好的。今年早些时候，我发表了一篇名为《Canon TDD》的文章。我看到很多对 TDD 的批评，其实不是关于 TDD 的。至关重要的是，我并不是在说，这是你应该如何做 TDD 的方式。

[22:01] **Kent Beck:** 一旦你掌握了基础，就会有上百万种变体。每种情境都会创造出它自己的变体，而且也应该创造出它自己的变体。就像大教堂里的那两个尖塔。但有些东西绝对不是 TDD。所以当我看到有人说，“哦，我讨厌在写任何代码之前就必须把所有测试都写好”，我想，啊，叮，谢谢参与，那不是 TDD。

[22:29] **Kent Beck:** 所以我发表《Canon TDD》的目的不是告诉你们该怎么做，而是想说，有这么一个东西。你对它的变通，是你的变通。如果你想批评一些与此大相径庭的东西，请自便，但别叫它 TDD。

[22:55] **Kent Beck:** 所以，我相信这是一个对 TDD 很熟悉的观众，所以简单地说：列出你知道的场景，在这些场景中代码应该如何表现。把其中一个变成一个具体的测试，它会失败，或者应该失败。或者，也许它应该通过，并且它确实通过了，那也行。但更多时候它会失败。让这个测试以及所有之前的测试都通过。如果需要的话，进行重构。有时感觉像是在测试通过后才做，有时感觉像是在写下一个测试之前做，这都行。从外部看不出区别。然后，当场景列表为空时，代码就完成了。

[23:47] **Kent Beck:** 那是一个让我焦虑感消失的时刻。我列出所有的场景，在编程时，我会往列表里添加东西。当我把所有东西都划掉后，我就完成了。如果我想不出任何其他可能让代码失败的情况，我就真的完成了。啊哈。如果我以后想知道我是否还算完成，或者是否破坏了什么，我只要按一下按钮。

[24:22] **Kent Beck:** 所以，无论如何，这就是 Canon TDD。如果你想批评与此不同的东西，请自便，但别叫它 TDD。

[24:32] **Kent Beck:** 我想谈的另一件事是，我经常听到这个说法，通常来自 TDD 的倡导者：TDD 不是一种测试技术。TDD 不是一种设计技术。TDD 不是一种编程技术。

[24:51] **Kent Beck:** 这是我想请你们在想说这句话时问问自己的问题：你是在对谁说？目的是什么？

[25:03] **Kent Beck:** 我想有些测试人员会说，哦，这个 TDD 的东西，那不是真正的测试技术。有些设计师会说，嗯，TDD 不是一种设计技术。他们都对。它不是一种设计技术。TDD 不是一种编程技术。是的，它是一种编程工作流程。

[25:28] **Kent Beck:** 然而，拜托，当然是！

[25:32] **Kent Beck:** 如果你通过 TDD 得到了测试，那它就是一种测试技术。它可能与其他测试技术不同，但说它“不是”一种测试技术……它是一种“不同”的测试技术。

[25:44] **Kent Beck:** 如果你使用 TDD 工作流程，你可能会得到一个不同的设计。但这并不意味着……这是因为你在某些设计决策上得到了早期反馈的结果。所以，它不是一种设计技术，但它当然也是。它也是一种编程技术。

[26:06] **Kent Beck:** 所以，那种……如果你还想说，哦，它不是一种设计技术，那也行。我的意思是，TDD 不会替你做设计决策。你可以用 TDD，但设计仍然很糟糕。当然。你的设计是你所有设计决策的组合。如果你的设计决策很差，你最终会得到一个差的设计。TDD 的好处是，你不会被隔绝于你的决策质量之外。你几秒钟后就会面对它们。所以你会得到反馈。如果你选择不适应那个反馈，那也没关系。

[26:52] **Kent Beck:** 但这是我有点希望人们不要说的话。我不会那样说。我会说，TDD 是一种不同的测试技术。TDD 是一种不同的设计技术。TDD 是一种不同的编程技术。它提供了一个新的情境，在这个情境中你可以做出测试决策、设计决策和编程决策。

[27:17] **Kent Beck:** “测试”？

[27:26] **Kent Beck:** 各色人等，从第一天起，就反对“测试驱动开发”这个名字。对此我说，你给我个更好的名字，我就用。

[27:39] **Kent Beck:** 但特别是，“测试”这个词似乎真的让一些人很恼火。

[27:48] **Kent Beck:** 除了它们是测试。它们确实是测试。有一个固件（fixture），一个刺激（stimulus），和一个期望的响应（expected response）。它是一个测试。现在也许我这样说有点学究气，说有测试所以我们就叫它们测试。但你还能叫它们什么？例子？呃，它们是例子。我们是在通过归纳法来证明我们的期望与程序的结果相符。所以我不会穷尽地测试每一种可能的输入组合来对比期望的输出。我会说，有这个，有这个，还有这个，从中，通过归纳法，我可以说它对广泛的输入都有效。

[28:51] **Kent Beck:** 但我们做到这一点的方式是通过测试。所以，现在，有一件事是我们在 JUnit 的早期与之抗争的，其中一篇开创性的论文叫做《程序员喜欢写测试》。Erich 和我写了这篇论文，这是一个故意的，这是在有“标题党”之前就有的标题党。

[29:14] **Kent Beck:** 一个故意挑衅的标题，因为当时对测试有一种强烈的社会偏见。A 等生去做程序员，B 等和 C 等生去做测试员。哦，如果你能当程序员，你可不想当测试员。这是在 80 年代。

[29:36] **Kent Beck:** 所以我有时会想，这是否是人们不愿使用“T”这个词来谈论这个编程工作流程的部分原因。但我不知道。这不困扰我。如果它真的困扰你，想想为什么它困扰你，然后想一个更好的名字。我很乐意采用更好的，但我不会因为“T”这个词困扰一些人就采用一个更差的。

[30:08] **Kent Beck:** 另一个经常在 TDD 中出现的问题是，它是一种自上而下（top-down）的技术还是一种自下而上（bottom-up）的技术。对我来说，明确的答案是：都不是。

[30:25] **Kent Beck:** Ward 总是用的那句话是，我们是从已知走向未知（known-to-unknown）。我们是一次走一步。所以，TDD 在某种程度上是一种……具体化（reification），一种把一种风格具体地固化下来的方式，像 Ward 这样的程序员能够自然地做到。他不会一头扎进未知，写一大堆代码，然后才发现它做了什么。

[31:08] **Kent Beck:** 他也不会严格地自上而下或自下而上地工作。他会说，嗯，我们知道什么？有时，有一个构建块，你知道如果你有了这个构建块，其他一切都会变得容易，所以你构建足够的那个构建块，以便开始在下一个更高的层级上使用它。

[31:30] **Kent Beck:** 有时，你知道系统总体的行为会是怎样的。最终它会成为一个巨大的系统，但就目前而言，我们只要登录和注销就完成了。所以，我们做的看起来有点像自上而下。然后我们做一个已登录的例子和一个未登录的例子。

[31:53] **Kent Beck:** 但已登录的例子又会分成更小更小的东西。所以我们向下深入，在更低的层级上展示行为，相信、信任，通过归纳法，它会组合成这个更高的层级。或者有时，我们发现两个正交的维度，我们会说，好吧，让我去研究所有计算利息的不同方法，然后再去研究所有计算利息累积时间的不同方法。然后我再把这两者结合起来。

[32:29] **Kent Beck:** 所以我不是从上到下工作，虽然有时是；也不是从下到上工作，虽然有时是。我是从我所知道的东西，走向我不知道的东西。而且我总是会一次只走一步。这就是 TDD 意图的方式，或者说，它最初的意图是作为一种……

[32:58] **Kent Beck:** 如果你在攀岩，你会打入岩钉（piton），这样你就只会掉那么远。TDD……这个行业的大师们就直接自由攀登，直到……最终，你知道会发生什么。但如果你不是绝对的行业大师，你会打入岩钉，所以当你掉下来时——因为你知道这会发生——你只会掉那么远。TDD 就是这样。它是这种探索性的、基于直觉的、发现的过程，加上知道“嘿，我已经走到这一步了，我不会倒退，我不会失去已有的成果”的安全性。

[33:47] **Kent Beck:** 所以，我看到的争论之一是自上而下对自下而上——都不是。从已知到未知。TDD 旨在帮助你在所有尺度上工作。这就是为什么我不谈论单元测试，也不谈论功能测试。这个区别对我来说不重要。通常我会有一个系统级的测试，或者两个，然后这很快就会分解成单元测试。我的意思是，如果你画出整个调用树，这是进来的请求，然后有这个巨大的调用树，我们可以在那个调用树的任何我们想测试的地方进行测试，只要它能给我们信心，相信系统按预期工作。

[34:33] **Kent Beck:** 我有一个警告给你们这些作家：不要爱上一个词。我大约十岁的时候学会了 desiderata 这个词，我从来没有机会用它，直到……这个内容出现。我完全爱上了这个词，我想，啊，终于，五十年后我可以用 desiderata 了。没人知道这个词。它妨碍了人们理解这个材料。

[35:08] **Kent Beck:** 这里是好测试的 12 个属性。有时这些属性会相互冲突。所以，测试应该是隔离的（isolated）、可组合的（composable）、确定性的（deterministic）。测试应该是具体的（specific），也就是说如果出了问题，你知道哪里出了问题。它们应该是行为特定的（behavior-specific），也就是说如果代码的行为改变了，测试结果也会改变。它们应该对结构变化不敏感（insensitive to structure changes）。它们应该快速（fast）、可读（readable）、易于编写（easy to write）。它们应该完全自动化（fully automated）。然后在宏观层面上，它们应该能预测系统的行为，并且它们应该是鼓舞人心的（inspiring）。你按下按钮，它变绿了，你感觉很好。

[35:55] **Kent Beck:** 好的，所以那是测试的 12 个属性，我可以就这张幻灯片讲一个小时，我可以举办一个三小时的工作坊，关于你的测试套件在所有这些方面的表现，以及你还能怎么做。但是，这个的重点，哦，你可以去 testdesiderata.com，如果你想看更多关于这个的内容，上面有一系列的视频。

[36:23] **Kent Beck:** 我想指出的是，有一种 mock 的流派，它使用大量的 mock，频繁地在测试中使用 mock。我注意到的是，mock 经常会引入结构敏感性（structure sensitivity）。我记得去一家做视频会议软件的公司，他们有一些 C++ 代码，他们很自豪地给我看他们的测试。哦，我们有所有这些测试，它们真漂亮。这是一个测试，它说，首先，验证这个函数被用这些参数调用了。然后验证那个函数被用那些参数调用了。然后验证这个函数被调用了十次，带着这十个参数。

[37:13] **Kent Beck:** 我看着这个测试，我在想，我确切地知道 C++ 代码长什么样。这只是……这个测试是你能想象到的最糟糕的编程语言语法。确实，你无法改变源代码中的一个字符而不破坏所有的测试。那不是一个有用的测试。那不是一个双重检查。

[37:39] **Kent Beck:** Mocks 最初是一种项目管理技术。我们有这个系统，然后我们把结果传给那个系统，我们想先写这个系统，所以我们把那个系统 mock 掉。好吧，暂时可以。我们 mock 掉它，然后我们就说，好吧，它是 17，我们把它传给新系统。但我们假装它在那里。

[38:02] **Kent Beck:** 这种做法，就是……用 mocks 吧，如果 mocks 是个好主意的话。但是，想一想，设计需要变成什么样，你才不需要 mocks 来做某些测试，即使那些测试会更小、更细粒度。所以，我相信这会引发一系列问题，我希望如此。

[38:27] **Kent Beck:** TDD 旨在产生这一系列对软件开发的影响。现在，第一个检查是，如果它没有产生这些效果，那就别做了，或者做点别的。想想为什么它没有产生这些效果。我前几天在 LinkedIn 上发帖说，你写的测试是否降低了代码的缺陷密度？我收到了一些有点刻薄的回答，比如，不，测试不降低缺陷密度。我说，那就别写了。我的天哪。或者想想为什么它们不降低。因为它们肯定能为我捕捉到思维错误。

[39:18] **Kent Beck:** 所以，我就不逐一读了，但这就是它意图的效果。如果你不使用 TDD，但你想要这些效果，你需要用其他方式来创造这些效果。或者你就要学会接受更差的沟通，更多的缺陷，更难做的设计变更，等等等等。

[39:48] **Kent Beck:** 这也没关系。你仍然可以写出好代码。你仍然可以写出能盈利的代码，你仍然可以拿到工资，仍然可以升职，即使你有焦虑，即使你的流程不顺畅，即使你有时感到不知所措。这都没关系。但是，如果你想在编程中有一种不同的体验，为你自己和你的团队，这是可以实现的。

[40:14] **Kent Beck:** Beth, 我的大女儿，声称 TDD 是一个很好的编程技能诊断工具。如果你尝试 TDD 某件事，但做不到，那说明你缺少某种技能。设计切片、行为切片、增量设计，某些技能。所以，找出那个技能——如果我有了这个技能，我就能 TDD 这个东西了——学习那个技能，然后回来看看它是否奏效。但是，你知道，如果你不想用，就别用。

[40:53] **Kent Beck:** 为什么会有这么多争论？

[40:59] **Kent Beck:** 对我来说，过去五年左右最大的惊喜之一是，我看到了对 TDD 的激烈反对反应。而且，它真的很愤怒，很愤怒，你不能强迫我，你为什么告诉我必须这样做，等等等等。

[41:20] **Kent Beck:** 我不理解……嗯，我会告诉你我对我所理解的那种反应的看法。因为这是一种真实的反应，人们真的出于某种原因感受非常强烈。如果我们自己享受 TDD，享受 TDD 的好处，希望看到更多人使用它，第一个问题是，你为什么希望看到更多人使用它？我的意思是，有一段时间，我有一种救世主情结，那不是个好理由，但，你做你的。

[41:57] **Kent Beck:** 但是，如果那是真的，理解为什么会有这种反应是很重要的。所以，我听到的一个反应，来自团队中的人，说，有那么一个人，他讨厌 TDD，带着一种激情，如果他看到我这样做，他就会骂我。而且，他的代码不行。他会去写两个星期，试图合并东西，破坏构建，然后怪罪别人。代码就是不行。

[42:31] **Kent Beck:** 所以我认为，在对 TDD 的抵制中，有一个因素，即这里的社会策略是为你的代码行为承担责任。我的代码能用，你可以信赖它，我用 TDD 来证明这一点。你可以用其他技术来证明，那也行。但如果你想隐藏，让你的代码不行，并且不向自己或他人真正承认，那么 TDD 就会成为一种威胁，一种真正的威胁。然后你就得处理实际存在的情况。

[43:13] **Kent Beck:** TDD 的另一个巨大障碍是设计技能，能够切分你的设计决策，这样你就不必一次性做出所有决策。我称之为“继承问题”，我现在正在写的书都是关于这个的。你需要能够一次一个决策地揭示设计，并且有运行中的代码，才能有效地进行 TDD。

[43:40] **Kent Beck:** 同样，你需要能够一次一点地揭示系统的行为，而不是一次性全部揭示，才能有效地进行 TDD。

[43:51] **Kent Beck:** 我之前提到过，这种社会地位感。有些人就是不想写测试，因为……测试员不如我们程序员酷。我的意思是，那不是我的观点，但我认为确实存在。

[44:07] **Kent Beck:** 来自内部的最大的一个原因是羞辱（shaming）。这种，“如果你不用 TDD，你就不是一个专业的程序员”。我向自己保证过，在这次演讲中我不会骂人，我不会骂人，但是……

[44:22] **Kent Beck:** 那根本不是真的。而且说这种话对任何人都没有好处。除了说这话的人的自以为是。羞辱别人，因为他们的开发方式，永远不会让任何人变得更好。所以，请不要这样做。

[44:42] **Kent Beck:** 我们可以对人们有同情心。我们可以欣赏人们。哇，你没有时间去学习这种工作方式，却完成了工作。但你确实完成了一些工作，恭喜。

[44:59] **Kent Beck:** 那么，下一步是什么？第一，提升设计技能。这个二维码是我的付费新闻通讯的折扣订阅。Tidy First.substack.com。我去年通过 O'Reilly Press 出版了一本书，叫《Tidy First》，是关于经验性软件设计的。

[45:24] **Kent Beck:** 尝试在不同领域使用 TDD，前端、后端。James Grenning 做了一些非常棒的工作。我看到人们出现了，但我会一直说到我讲完。最后，但同样重要的是，试试 TCR。这是我个人在 TDD 之后的新工作流程。它很有趣。我看到很多抵制。这很有趣，试试吧。有视频可以教你怎么做。

[45:52] **Kent Beck:** 好了，这就是 TDD，在它生命的前半段的背景下。现在我们进入提问环节。

[46:01] **Daniel Moka:** 哇，这是一次充满活力和深刻见解的演讲。非常感谢。我想我们找不到比你更好的人来总结 TDD 的主题了。是的，我们有很多互动，人们还在评论。但我们有几个问题，我找到了一些非常好的问题。让我们看看他们问了什么。

[46:23] **Daniel Moka:** 首先，我们有来自 Ryan 的问题，我会分两部分展示。所以，大家都说 TDD 更多是关于设计而不是测试，但为什么它必须是“测试”驱动的呢？如果我们更感兴趣的是获得设计反馈，用今天的技术，会不会有更好的方法？例如，AI。让 AI 给你实时设计反馈，而不用费脑筋去设计测试，也不用花时间精心制作测试，这样它们就不会限制未来的代码重构。

[46:53] **Kent Beck:** 好问题。这取决于你认为“费脑筋”（twisting your mind）是好事还是坏事。如果你想减少费脑筋的程度，你就会学得更少。而我想学得更多。我认为 AI 如何做出贡献，目前还没有定论。它肯定能做出贡献。我正在尝试很多小的实验，看它如何做出贡献。所以，尝试所有的实验。

[47:28] **Kent Beck:** 然后回到第一个说法，它更多是关于设计而不是测试。它两者都是。设计、测试、编程、协作。它比 Xanax 便宜。它包含所有这些东西。所以，是的，我甚至对这个问题的假设都有些异议。AI 能否批评你的设计？是的，我认为那会是一个有趣的实验。试试看，然后告诉我们结果如何。

[48:02] **Daniel Moka:** 这个回答太棒了，因为 Dave Farley 在开头也说了类似的话，他说我们应该为学习而优化。所以如果我们不用 AI，我们就能更多地了解领域和所有的事情。所以，是的，太棒了。有一个很好的问题，已经争论了很长时间了，来自 Paul。Kent，你认为“单元”（unit）这个词在我们的行业中造成的伤害大于好处吗？很多人告诉我，我“做错了”，因为我没有 mock 掉所有的协作者，这都是因为那个词。

[48:39] **Kent Beck:** “单元”这个词对我没有帮助，所以我不使用它。如果你看一下“测试 desiderata”，有 12 个测试的维度。如果你把它看作一个 12 维空间，其中每一个都是一个滑块，那个空间里有很多点。单元只是那个空间里一个很小的点，功能测试也是一个很小的点。我们根本没有探索过那个空间。所以我希望我们能做的，我的 desiderata 是我尝试提供一个讨论这个的词汇。

[49:17] **Kent Beck:** 好的，我想要更容易读的测试，即使它们更难写。好的。那对测试的其他属性有什么改变？或者我想要更快的测试，但它们的可预测性更低。或者我想要更可预测的测试，我不在乎它们慢。就像，那个空间里有很多点，让我们大家都试试那个空间里不同的点，给它们起一些有用的名字，而“单元”就不是其中之一。

[49:46] **Kent Beck:** 如果你的测试对你有用，那你就没有做错。你能不能做得更好？也许能，也许不能。但是，说做错了？呸。

[50:03] **Daniel Moka:** 太棒了。下一个，也是一个百万美元级别的问题，来自 Steven。我与其他开发者（主要是年轻人）有很多问题。我们如何有效地让他们进行单元测试？

[50:17] **Kent Beck:** 你必须亲身体验。你必须经历……我的意思是，我记得一个我有的辅导时刻，和一个家伙坐下来，我们编码了两个小时，我们意识到设计是错的，我们修复了它。哦，天哪，我们破坏了什么？按下按钮，一切都是绿色的。

[50:46] **Kent Beck:** 哦，我们什么都没破坏。而且我们“知道”我们没有破坏任何东西。这种体验与我们通常在编程中的体验有多么不同？在通常的体验中，我们就像，YOLO！

[51:02] **Kent Beck:** 所以，我想，首先，作为一个前辈，Steven，我们有责任保持耐心，因为我们不久前也曾是那个年轻的程序员。好吧，也许是很久以前了。首先，我们有责任保持耐心。其次，我们有责任创造一个环境，让年轻人可以自己学习这些教训。当然他们现在还不知道。

[51:32] **Kent Beck:** 这是一个手艺活……《七天掌握分布式系统设计》，烧了它。《35 年掌握分布式系统设计》，那才是我要读的书。因为它就是要花那么长时间。但如果它要花那么长时间，那就意味着你第一年要学一些东西，这与你第 35 年学的东西相去甚远。

[52:01] **Kent Beck:** 所以，作为一个前辈（oldb，新手 newb 的反义词），你有责任创造一个让新手（newb）可以学习的环境。

[52:17] **Daniel Moka:** 太棒了。是的，这全都关乎环境，它总是决定了节奏。好吧，让我们转到下一个问题，明智地选择时间。这里有一个来自 Henrik 的问题。只是一个想法：问题的部分原因会不会是很多公司都有一个 QA 部门，负责测试方面的最佳实践？

[52:36] **Kent Beck:** 为什么这个话题又回来了？我……QA，我百分之一百万支持 QA。我百分之一百万反对 QA “部门”。这只是权力和责任的错位，它为所有相关人员创造了可怕的激励机制。

[53:06] **Kent Beck:** 如果程序员经常犯错，那么他们需要反馈，让他们不再犯那些错，无论是技能获取、新的测试工具、培训、文化变革、激励机制变革，等等。指望一个 QA 部门来确保代码能用，简直是一场灾难。这在 80 年代和 90 年代很普遍，我们摆脱了它 15 年，现在它又回来了。瀑布式开发（waterfall）正在回归，各位。它不会成功的，原因和上次失败的原因完全一样。这意味着我们用不同风格工作的技能变得更加有价值，但它正在回归。

[54:05] **Daniel Moka:** 这更像是一通咆哮而不是一个答案，但就这样了。

[54:07] **Daniel Moka:** 好的。在最后一分钟，让我们再选一个问题，因为你的回答太棒了。来自 Benoit。你会用什么论点来反驳我经常在开发团队中听到的常见言论：“TDD 拖慢了开发速度；对于一个普通的开发团队来说，它太复杂了”？所以在接下来的一分钟里，如果你能有一个好的……

[54:28] **Kent Beck:** 我和我的大女儿 Beth 开始谈论森林和沙漠。在沙漠里，当你没有足够的时间，没有足够的技能，没有时间学习技能时，TDD 毫无意义。如果你已经快要死了，好吧。在森林里，当有足够的资源时，部分创造足够资源的就是 TDD。这样我们就知道我们可以继续进行修改。我们知道代码能用，我们知道我们在学习和成长。所以，从森林的角度看，这个问题毫无意义。前提就是错的。但从沙漠的角度看，这个问题完全有道理，我的心与那些那样生活的人同在。他们本不必如此。但我的心仍然与他们同在。

[55:26] **Daniel Moka:** 太棒了。非常感谢。这里是最后一个，不是问题，来自 Emmanuel。我想我可以代表这里的每个人，或者大多数人，把这条信息传达给你。他说，Kent，我想谢谢你，因为多亏了 XP，它让我作为一个普通人和一个专业人士都得以成长，这部分要归功于你。所以，Kent，代表大家谢谢你，你让这个行业变得更好了。

[55:51] **Kent Beck:** 我很高兴你觉得我的工作有帮助。我会继续做下去的。

[55:57] **Daniel Moka:** 谢谢。谢谢这次演讲，真的太棒了。我们要跳到下一个了。

[56:02] **Daniel Moka:** 下一个是 Alistair Cockburn 带来的《Hexagonal Architecture》。我们将在四分钟后开始。

[56:10] **Daniel Moka:** 这是日程安排。我们之后还有三位演讲者。感谢组织者，我们的赞助商。当然，请在不同的社交媒体平台上关注我们。再次感谢大家，特别感谢 Kent Beck。我们下一个环节再见。

[56:28] **Daniel Moka:** 再见。

[56:32] **Daniel Moka:** 再见。

---

