### B-mad 文档拆分 (Sharding) 机制
[ 🔍 google Gemini](@https://gemini.google.com/u/2/gem/6569fe3adefc/636cfbd5c245e6e1)

B-mad 框架通过一个名为 shard-doc 的核心任务来拆分大型 Markdown 文档。

拆分过程是结构化的，主要依据文档的 ## (二级标题) 进行分割。

推荐的自动化工具是 @kayvan/markdown-tree-parser，通过 md-tree explode 命令执行。

如果工具不可用，也定义了详细的手动拆分规则。

此机制主要用于处理 prd.md 和 architecture.md，但可适用于任何类似结构的文档，目的是将宏观规划文档转化为适合开发执行的细粒度文件。

### 文档合并与可逆性 (Merging & Reversibility)

B-mad 框架强调拆分过程在理论上应是“可逆的”。

这意味着可以从拆分后的多个小文件中恢复出原始的单一文档。

但框架本身并未提供一个直接的“合并”命令或工具来自动完成此操作。

可逆性通过规范的拆分规则来保证：包括确定性的标题级别调整（如 ## 变为 #），以及生成一个 index.md 文件，该文件记录了所有被拆分文件的正确顺序。

### 变更管理的核心挑战：维护一致性

当项目进行到中途，PRD 或 Architecture 文档已被拆分，且部分用户故事已完成时，变更需求就带来了严峻挑战。

核心问题在于，如何确保源头高级文档（PRD）与下游具体实现（用户故事）之间的内容保持一致。

直接修改未来的用户故事，或立即修改 PRD 并重新拆分，都是不科学的，因为这极易导致文档间的逻辑断裂和信息不一致。

### B-mad 的解决方案：`correct-course` 结构化变更流程

B-mad 为应对这一挑战提供了明确的、规范化的解决方案，即 correct-course 任务。

这个任务并非漏洞，而是一个强制性的保障机制，旨在系统化地管理变更，防止不一致性的产生。

该流程由 po (Product Owner) 或 sm (Scrum Master) 启动，并使用 change-checklist 作为其核心指导框架。

### `correct-course` 流程如何保证文档一致性

correct-course 的核心思想是“先分析，再提议，后执行”。

它强制要求对变更的影响进行全面分析，而非直接动手修改。

change-checklist 会引导对变更的触发点、对当前及未来 Epic 的影响进行评估。

最关键的步骤是“产物冲突分析” (Artifact Conflict Analysis)，它强制审查变更与 PRD、Architecture 文档等所有关键产物是否存在冲突。

流程的最终产出是一份“冲刺变更提案” (Sprint Change Proposal)。

这份提案不仅包含分析摘要，还必须包含为每一个受影响文档（无论是 PRD 的某个章节还是架构图）起草的具体修改建议。

只有在这份提案获得批准后，才会执行实际的修改，从而确保所有相关文档得到同步、一致的更新。

### 结论：规范的流程而非漏洞

correct-course 任务是 B-mad 框架中用于防止文档不一致的指定机制。

它通过一个正式、可追溯的流程，强制对变更进行全面评估。

如果在分析后发现 PRD 或 Architecture 文档确实需要修改，而没有执行修改，这代表的是流程未被遵守，而非流程本身存在设计缺陷。

因此，该流程是确保项目在演进过程中保持文档完整性和规范性的核心保障。