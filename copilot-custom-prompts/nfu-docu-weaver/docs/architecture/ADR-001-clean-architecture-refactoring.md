# ADR-001: æ¸…ç†æ¶æ„æ··ä¹± - Schema/Template/Data åˆ†ç¦»

**çŠ¶æ€**: âœ… å·²å®æ–½  
**æ—¥æœŸ**: 2025-10-05  
**å†³ç­–è€…**: @architect.mdc, @po.mdc  
**å½±å“èŒƒå›´**: é¡¹ç›®æ¶æ„ã€è¯¾ç¨‹ç®¡ç†ã€æ–‡æ¡£ç”Ÿæˆæµç¨‹

---

## ğŸ“‹ èƒŒæ™¯ (Context)

### é—®é¢˜æè¿°

åœ¨ v1.4.0 ä¹‹å‰ï¼Œé¡¹ç›®å­˜åœ¨ä»¥ä¸‹æ¶æ„æ··ä¹±é—®é¢˜ï¼š

1. **æ¨¡æ¿è·¯å¾„æ··ä¹±**
   - é¡¹ç›®æ ¹ç›®å½•æœ‰ `/templates/` (å…¨å±€æ¨¡æ¿)
   - è¯¾ç¨‹ç›®å½•å†…ä¹Ÿæœ‰ `templates/` å­ç›®å½• (ç©ºç›®å½•)
   - `course.yml` ä¸­å¼•ç”¨è·¯å¾„ä¸æ˜ç¡® (`templates/lesson/default-lesson.docx` ç›¸å¯¹äºå“ªé‡Œï¼Ÿ)

2. **Schema ç¼ºå¤±å¼•ç”¨**
   - è¯¾ç¨‹å…ƒæ•°æ®æ²¡æœ‰å¼•ç”¨ Schema
   - æ— æ³•é€šè¿‡ `course.yml` çŸ¥é“åº”è¯¥ä½¿ç”¨å“ªä¸ª Schema
   - Schema-Driven Architecture æœªå®Œå…¨å®æ–½

3. **èŒè´£ä¸æ¸…**
   - ä¸æ¸…æ¥šå“ªäº›æ˜¯æ•°æ®æ–‡ä»¶ (YAML)
   - ä¸æ¸…æ¥šå“ªäº›æ˜¯æ¨¡æ¿æ–‡ä»¶ (DOCX)
   - ä¸æ¸…æ¥šå“ªäº›æ˜¯ Schema æ–‡ä»¶ (YML)

4. **å†—ä½™ç›®å½•ç»“æ„**
   - `.course-template/templates/` å­˜åœ¨ä½†ä¸ºç©º
   - æ¯ä¸ªè¯¾ç¨‹çš„ `templates/` ç›®å½•ä¹Ÿä¸ºç©º
   - é€ æˆå›°æƒ‘ï¼šä¸ºä»€ä¹ˆéœ€è¦è¿™äº›ç©ºç›®å½•ï¼Ÿ

### æ¶æ„å€ºåŠ¡å½±å“

- âŒ å¼€å‘äººå‘˜å›°æƒ‘ï¼šä¸çŸ¥é“æ–‡ä»¶åº”è¯¥æ”¾åœ¨å“ªé‡Œ
- âŒ ç»´æŠ¤å›°éš¾ï¼šè·¯å¾„å¼•ç”¨ä¸æ˜ç¡®
- âŒ æ‰©å±•æ€§å·®ï¼šæ·»åŠ æ–°æ¨¡æ¿æˆ– Schema æ—¶ä¸çŸ¥é“å¦‚ä½•ç»„ç»‡
- âŒ Schema-Driven ä¸å®Œæ•´ï¼šç¼ºå°‘ä» course.yml åˆ° Schema çš„è¿æ¥

---

## ğŸ¯ å†³ç­– (Decision)

### æ ¸å¿ƒå†³ç­–

æˆ‘ä»¬å†³å®šå®æ–½ **æ¸…æ™°çš„ä¸‰å±‚æ¶æ„åˆ†ç¦»**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¹ç›®çº§èµ„æº (å…¨å±€å…±äº«)                                â”‚
â”‚ - schemas/     â† Schema å®šä¹‰ (æ•°æ®å¥‘çº¦)             â”‚
â”‚ - templates/   â† Word æ¨¡æ¿ (æ ¼å¼å®šä¹‰)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ å¼•ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯¾ç¨‹çº§èµ„æº (å·¥ä½œç©ºé—´)                                â”‚
â”‚ - course.yml   â† é…ç½® (å¼•ç”¨é¡¹ç›®çº§èµ„æº)              â”‚
â”‚ - lessons/     â† æ•°æ®æ–‡ä»¶ (YAML)                    â”‚
â”‚ - cover/       â† æ•°æ®æ–‡ä»¶ (YAML)                    â”‚
â”‚ - outline/     â† æ•°æ®æ–‡ä»¶ (YAML)                    â”‚
â”‚ - output/      â† ç”Ÿæˆæ–‡æ¡£ (DOCX)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…·ä½“å†³ç­–ç‚¹

#### å†³ç­– 1: ç§»é™¤è¯¾ç¨‹çº§ `templates/` ç›®å½•

**å†³ç­–**: ä¸åœ¨è¯¾ç¨‹ç›®å½•å†…ä¿ç•™ `templates/` ç›®å½•

**ç†ç”±**:
1. Templates æ˜¯æ ¼å¼å®šä¹‰ï¼Œåº”è¯¥å…¨å±€å…±äº«
2. æ¯ä¸ªè¯¾ç¨‹éƒ½ä¿®æ”¹æ¨¡æ¿ä¼šå¯¼è‡´ä¸ä¸€è‡´
3. éµå¾ª DRY (Don't Repeat Yourself) åŸåˆ™
4. å‡å°‘ç›®å½•æ··ä¹±

**ä¾‹å¤–**: å¦‚æœç¡®å®éœ€è¦è¯¾ç¨‹ç‰¹å®šæ¨¡æ¿ï¼Œå¯ä»¥é€šè¿‡ `course.yml` ä¸­çš„ `config.templates` è¦†ç›–å…¨å±€è·¯å¾„

#### å†³ç­– 2: æ‰€æœ‰è·¯å¾„ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•

**å†³ç­–**: `course.yml` ä¸­çš„ Schema å’Œ Template è·¯å¾„éƒ½ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•

**ç†ç”±**:
1. é¿å…ç›¸å¯¹è·¯å¾„æ··ä¹± (`../../` åˆ°åº•å‘ä¸Šå‡ å±‚ï¼Ÿ)
2. ä¾¿äºéªŒè¯å’Œè°ƒè¯•
3. å·¥å…·è„šæœ¬æ›´å®¹æ˜“å¤„ç†ç»å¯¹å¼•ç”¨
4. æ¸…æ™°æ˜ç¡®ï¼Œæ— æ­§ä¹‰

**ç¤ºä¾‹**:
```yaml
config:
  schemas:
    lesson: schemas/lesson_schema.yml    # ä»é¡¹ç›®æ ¹å¼€å§‹
  templates:
    lesson: templates/lesson/lesson.docx # ä»é¡¹ç›®æ ¹å¼€å§‹
  data_dirs:
    lessons: lessons/                     # ç›¸å¯¹äºè¯¾ç¨‹ç›®å½•
```

#### å†³ç­– 3: Schema å¿…é¡»åœ¨ `course.yml` ä¸­å£°æ˜

**å†³ç­–**: æ‰€æœ‰è¯¾ç¨‹å…ƒæ•°æ®å¿…é¡»åŒ…å« `config.schemas` é…ç½®èŠ‚

**ç†ç”±**:
1. å®Œæ•´å®æ–½ Schema-Driven Architecture
2. æ˜ç¡®æ•°æ®éªŒè¯æ ‡å‡†
3. ä¾¿äºå·¥å…·è‡ªåŠ¨å‘ç°å’Œä½¿ç”¨ Schema
4. ä¸º AI å·¥ä½œæµæä¾›æ˜ç¡®çš„æ•°æ®ç»“æ„æŒ‡å¼•

#### å†³ç­– 4: åˆ›å»º `course_schema.yml`

**å†³ç­–**: ä¸º `course.yml` æœ¬èº«åˆ›å»º Schema å®šä¹‰

**ç†ç”±**:
1. Meta-schema: å®šä¹‰å…ƒæ•°æ®çš„æ•°æ®ç»“æ„
2. ç¡®ä¿æ‰€æœ‰è¯¾ç¨‹å…ƒæ•°æ®æ ¼å¼ä¸€è‡´
3. ä¾¿äºéªŒè¯ `course.yml` çš„å®Œæ•´æ€§
4. æ–‡æ¡£åŒ–è¯¾ç¨‹é…ç½®è§„èŒƒ

---

## ğŸ“ å®æ–½æ–¹æ¡ˆ (Implementation)

### Phase 1: æ¸…ç†å†—ä½™ç»“æ„

```bash
# åˆ é™¤è¯¾ç¨‹å†…çš„ templates/ ç›®å½•
rm -rf courses/course-*/templates/
rm -rf courses/.course-template/templates/
```

### Phase 2: åˆ›å»º `course_schema.yml`

åˆ›å»º `schemas/course_schema.yml`ï¼Œå®šä¹‰è¯¾ç¨‹å…ƒæ•°æ®ç»“æ„ã€‚

### Phase 3: æ›´æ–° `.course-template/course.yml`

å‡çº§åˆ° v2.0 æ ¼å¼ï¼Œæ·»åŠ  `config` é…ç½®èŠ‚ï¼š
- `config.schemas`: Schema æ–‡ä»¶è·¯å¾„
- `config.templates`: Word æ¨¡æ¿è·¯å¾„
- `config.data_dirs`: æ•°æ®ç›®å½•è·¯å¾„

### Phase 4: æ›´æ–°ç°æœ‰è¯¾ç¨‹

è¿ç§»æ‰€æœ‰ç°æœ‰è¯¾ç¨‹åˆ° v2.0 æ ¼å¼ã€‚

### Phase 5: æ›´æ–° `course_manager.py`

ä¿®æ”¹è¯¾ç¨‹åˆ›å»ºé€»è¾‘ï¼š
- ç”Ÿæˆ v2.0 æ ¼å¼çš„ `course.yml`
- æ›´æ–°ç‰ˆæœ¬å·åˆ° "2.0"
- æ·»åŠ æ¶æ„è¯´æ˜æ³¨é‡Š

### Phase 6: æ–‡æ¡£æ›´æ–°

- åˆ›å»ºæœ¬ ADR æ–‡æ¡£
- æ›´æ–° `.course-template/README.md`
- æ›´æ–° `schemas/README.md`

---

## ğŸ¨ æ–°æ¶æ„ç¤ºæ„å›¾

### ç›®å½•ç»“æ„

```
nfu-docu-weaver/
â”œâ”€â”€ schemas/                      â† é¡¹ç›®çº§ Schema å®šä¹‰
â”‚   â”œâ”€â”€ course_schema.yml         â† è¯¾ç¨‹å…ƒæ•°æ® Schema (NEW)
â”‚   â”œâ”€â”€ lesson_schema.yml         â† æ•™æ¡ˆæ•°æ® Schema
â”‚   â”œâ”€â”€ cover_schema.yml          â† é¦–é¡µæ•°æ® Schema
â”‚   â”œâ”€â”€ outline_schema.yml        â† å¤§çº²æ•°æ® Schema
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ templates/                    â† é¡¹ç›®çº§ Word æ¨¡æ¿
â”‚   â”œâ”€â”€ lesson/lesson.docx
â”‚   â”œâ”€â”€ cover/cover.docx
â”‚   â””â”€â”€ outline/outline.docx
â”‚
â”œâ”€â”€ courses/
â”‚   â”œâ”€â”€ .course-template/         â† è¯¾ç¨‹åˆ›å»ºæ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ course.yml            â† v2.0 æ ¼å¼æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ lessons/              â† ç©ºç›®å½•
â”‚   â”‚   â”œâ”€â”€ cover/                â† ç©ºç›®å½•
â”‚   â”‚   â”œâ”€â”€ outline/              â† ç©ºç›®å½•
â”‚   â”‚   â””â”€â”€ output/               â† ç©ºç›®å½•
â”‚   â”‚   [åˆ é™¤] templates/         â† å·²ç§»é™¤
â”‚   â”‚
â”‚   â””â”€â”€ course-001-xxx/           â† å®é™…è¯¾ç¨‹
â”‚       â”œâ”€â”€ course.yml            â† v2.0 æ ¼å¼ï¼ŒåŒ…å« config
â”‚       â”œâ”€â”€ lessons/              â† æ•™æ¡ˆæ•°æ® YAML æ–‡ä»¶
â”‚       â”œâ”€â”€ cover/                â† é¦–é¡µæ•°æ® YAML æ–‡ä»¶
â”‚       â”œâ”€â”€ outline/              â† å¤§çº²æ•°æ® YAML æ–‡ä»¶
â”‚       â””â”€â”€ output/               â† ç”Ÿæˆçš„ Word æ–‡æ¡£
â”‚       [åˆ é™¤] templates/         â† å·²ç§»é™¤
â”‚
â””â”€â”€ tools/
    â””â”€â”€ course_manager.py         â† v2.0ï¼Œæ”¯æŒæ–°æ¶æ„
```

### å¼•ç”¨å…³ç³»

```
course.yml (v2.0)
    â†“ config.schemas.lesson
schemas/lesson_schema.yml
    
course.yml (v2.0)
    â†“ config.templates.lesson
templates/lesson/lesson.docx

course.yml (v2.0)
    â†“ config.data_dirs.lessons
lessons/lesson-01.yml
    â†“ éµå¾ª
schemas/lesson_schema.yml
```

---

## âœ… ä¼˜åŠ¿ (Consequences)

### æ­£é¢å½±å“

1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»** âœ…
   - Schema â†’ æ•°æ®å¥‘çº¦å®šä¹‰
   - Template â†’ æ–‡æ¡£æ ¼å¼å®šä¹‰
   - Data â†’ å®é™…è¯¾ç¨‹å†…å®¹

2. **è·¯å¾„å¼•ç”¨æ˜ç¡®** âœ…
   - æ‰€æœ‰é¡¹ç›®çº§èµ„æºè·¯å¾„ç›¸å¯¹äºé¡¹ç›®æ ¹
   - æ‰€æœ‰è¯¾ç¨‹çº§æ•°æ®è·¯å¾„ç›¸å¯¹äºè¯¾ç¨‹ç›®å½•
   - æ— æ­§ä¹‰ï¼Œæ˜“äºç†è§£

3. **DRY åŸåˆ™** âœ…
   - å…¨å±€èµ„æºåªå­˜åœ¨ä¸€ä»½
   - é¿å…é‡å¤å’Œä¸ä¸€è‡´

4. **å¯ç»´æŠ¤æ€§æå‡** âœ…
   - æ›´æ–°æ¨¡æ¿æ—¶åªéœ€ä¿®æ”¹ä¸€å¤„
   - æ›´æ–° Schema æ—¶ç«‹å³å½±å“æ‰€æœ‰è¯¾ç¨‹

5. **å¯æ‰©å±•æ€§å¢å¼º** âœ…
   - æ·»åŠ æ–°æ–‡æ¡£ç±»å‹ï¼šæ·»åŠ  Schema + Template
   - æ·»åŠ æ–°è¯¾ç¨‹ï¼šä½¿ç”¨ `course_manager.py create`
   - è¦†ç›–å…¨å±€æ¨¡æ¿ï¼šä¿®æ”¹ `course.yml` ä¸­çš„è·¯å¾„

6. **Schema-Driven å®Œæ•´å®æ–½** âœ…
   - ä» course.yml åˆ° Schema çš„å®Œæ•´é“¾è·¯
   - æ‰€æœ‰æ•°æ®ç±»å‹éƒ½æœ‰ Schema å®šä¹‰
   - ä¾¿äºè‡ªåŠ¨åŒ–éªŒè¯å’Œ AI é›†æˆ

### è´Ÿé¢å½±å“ä¸ç¼“è§£

1. **ç°æœ‰è¯¾ç¨‹éœ€è¦è¿ç§»** âš ï¸
   - ç¼“è§£ï¼šæä¾›è‡ªåŠ¨è¿ç§»è„šæœ¬
   - ç¼“è§£ï¼šPhase 4 ä¸­å·²å®Œæˆè¿ç§»

2. **å­¦ä¹ æ›²çº¿** âš ï¸
   - ç¼“è§£ï¼šæ›´æ–°æ–‡æ¡£å’Œ README
   - ç¼“è§£ï¼šæœ¬ ADR è¯¦ç»†è¯´æ˜è®¾è®¡ç†ç”±

3. **è·¯å¾„é•¿åº¦å¢åŠ ** âš ï¸
   - é—®é¢˜ï¼š`schemas/lesson_schema.yml` vs `lesson_schema.yml`
   - ç¼“è§£ï¼šæ˜ç¡®æ€§æ¯”ç®€æ´æ€§æ›´é‡è¦
   - ç¼“è§£ï¼šå·¥å…·å¯ä»¥å¤„ç†è·¯å¾„è§£æ

---

## ğŸ“Š å¯¹æ¯”åˆ†æ

| æ–¹é¢ | æ—§æ¶æ„ (v1.x) | æ–°æ¶æ„ (v2.0) |
|------|---------------|---------------|
| **èŒè´£åˆ†ç¦»** | âŒ æ··ä¹± | âœ… æ¸…æ™° |
| **è·¯å¾„å¼•ç”¨** | âŒ ä¸æ˜ç¡® | âœ… æ˜ç¡® |
| **Schema é›†æˆ** | âš ï¸ éƒ¨åˆ† | âœ… å®Œæ•´ |
| **å¯ç»´æŠ¤æ€§** | âŒ ä½ | âœ… é«˜ |
| **å¯æ‰©å±•æ€§** | âš ï¸ ä¸­ç­‰ | âœ… é«˜ |
| **DRY åŸåˆ™** | âŒ æœ‰é‡å¤ | âœ… éµå¾ª |
| **æ–‡æ¡£å®Œæ•´æ€§** | âš ï¸ ä¸€èˆ¬ | âœ… å®Œæ•´ |
| **å­¦ä¹ æ›²çº¿** | âœ… ä½ | âš ï¸ ä¸­ç­‰ |
| **å‘åå…¼å®¹** | N/A | âš ï¸ éœ€è¿ç§» |

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä» v1.x è¿ç§»åˆ° v2.0

#### è‡ªåŠ¨è¿ç§»ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œè¿ç§»è„šæœ¬ï¼ˆå¦‚æœæä¾›ï¼‰
python tools/migrate_to_v2.py

# éªŒè¯è¿ç§»ç»“æœ
python tools/course_manager.py list
```

#### æ‰‹åŠ¨è¿ç§»

1. **åˆ é™¤ `templates/` ç›®å½•**
   ```bash
   rm -rf courses/course-xxx/templates/
   ```

2. **æ›´æ–° `course.yml` æ ¼å¼**
   ```yaml
   # æ·»åŠ  config é…ç½®èŠ‚
   config:
     schemas:
       course: schemas/course_schema.yml
       lesson: schemas/lesson_schema.yml
       cover: schemas/cover_schema.yml
       outline: schemas/outline_schema.yml
     
     templates:
       lesson: templates/lesson/lesson.docx
       cover: templates/cover/cover.docx
       outline: templates/outline/outline.docx
     
     data_dirs:
       lessons: lessons/
       cover: cover/
       outline: outline/
       output: output/
   
   # æ›´æ–°ç‰ˆæœ¬å·
   metadata:
     version: "2.0"
   ```

3. **éªŒè¯é…ç½®**
   ```bash
   python tools/course_manager.py info course-xxx
   ```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Schema README](../../schemas/README.md)
- [Course Template README](../../courses/.course-template/README.md)
- [Architecture Documentation](./index.md)
- [Schema-Driven Architecture](./6-schema-driven-architecture.md)

---

## ğŸ“ å˜æ›´å†å²

- **2025-10-05**: ADR åˆ›å»ºï¼Œå®æ–½æ¶æ„æ¸…ç†
- **v2.0.0**: è¯¾ç¨‹å…ƒæ•°æ®æ ¼å¼å‡çº§

---

## âœï¸ ç­¾å

**æ¶æ„å¸ˆ**: @architect.mdc  
**Product Owner**: @po.mdc  
**æ—¥æœŸ**: 2025-10-05  
**çŠ¶æ€**: âœ… å·²æ‰¹å‡†å¹¶å®æ–½

