
![images/c197c5efd9e95be64dc68775006baaa540d49694725e05e160b6bbd926a38ea9.jpg|200](https://i.imgur.com/g67T3PM.webp)  

全新交互设计及开发平台 TOUCHDESIGNER

# 目录

**[第1章 初识TouchDesigner](#第1章-初识TouchDesigner)**  

1.1 什么是 TouchDesigner? ..010  
1.2 下载、安装、注册 ..016
1.3 界面、操控与快捷键 ..020  
1.4 元件类型与基础鼠标操作 ..023  
1.5 元件属性、多元件连接、元件引用与层级关系 ..033  
1.6 如何从软件中寻求解决问题的办法 ..037  
1.7 如何使用本书 ..040  

**[第2章 实时视觉效果处理](#第2章-实时视觉效果处理)**

2.1 简单的图像处理 ..044  
实战案例：实时处理图像的滤镜组 ..044  
2.2 Feedback Loop 反馈循环 ..051  
实战案例：Feedback Loop 反馈循环特效 ..051  
2.3 三维渲染 ..055  
实战案例：渲染—从 3D 模型到 2D 图像 ..055  
2.4 Particle Effect 粒子效果 ..062  
实战案例：粒子系统初识 制作飘逸的粒子效果 .062  
2.5 Instance 功能的使用 ..069  
实战案例：利用 Instance 功能制作“小太阳” .069  
2.6 声音可视化呈现 .079  
实战案例：实时交互音画互动 ..079  

**[第3章 音画展演现场](#第3章-音画展演现场)**

3.1 构建参数化模型 ..094  
实战案例：—棵圣诞树—构建参数化模型 .094  
3.2 音画互动系统 .108  
实战案例：重构圣诞树——用 audioAnalysis 分析音频并制作音画互动系统 ..108  
实战案例：输出圣诞树NFT系列作品 .118  
实战案例：用MIDI设备控制音画互动系统 .120  
3.3 TDAbleton 与 Ableton Live. .123  
实战案例: TouchDesigner 结合 Ableton Live 工作流 .128  
3.4 TouchDesigner 与 Resolume Arena... .140  
实战案例：圣诞雪景--用 Resolume Arena 进行实时后期处理及播控. .144  
3.5 Notch VFX 与 Notch TOP. ..150  
实战案例：TouchDesigner 结合 Notch VFX 工作流 ..151  
3.6 Stable Diffusion 与 TouchDesigner. ..157  
实战案例：瞬息宇宙—-用 Stable Diffusion 进行实时风格化处理 .159  
3.7 Projection Mapping 三维投影. .163  
实战案例: Projection Mapping 中的 kantanMapper 与 camSchnappr. ..165  

**[第4章 硬件与通讯](#第4章-硬件与通讯)**   

4.1 Arduino 与串口通讯 ...178  
实战案例：按钮与旋钮—用 Arduino 开源硬件控制视觉效果 .179  
实战案例：用Firmata通讯制作虚拟手电筒... .190  
4.2 Kinect 体感外设 ..197  
实战案例：用Kinectv2制作“融球感应”体感互动效果 ..197  
实战案例：用Azure Kinect制作“舞动烟雾”体感互动效果 ..203  
4.3 Leap Motion手势交互外设 ..212  
实战案例：用Leap Motion 制作“掌中星尘”手势互动效果 ..215  
4.4 TOF 激光雷达. .226  
4.5 DMX 协议与DMX灯具 ..234  
实战案例：点亮灯珠--用 CHOP 数据通道控制灯珠色彩变化. .235  
实战案例：控制灯光阵列--用TOP 中的图像控制多条灯带变化 .241  
4.6 Flipdot 磁力翻转片模组 ..247  
实战案例：翻转磁力片--用CHOP中的数据通道翻转一个磁力片 .247  
实战案例：数字时钟—用 TOP 中的图像控制 Flipdot 模组 .253  
实战案例：大型 Flipdot 阵列的规划及控制 .256  
4.7 Touch In & Touch Out... .262  
实战案例：Touch In 与 Touch Out 在 TouchDesigner 程序内部的通讯. .262  
实战案例：不同电脑间TouchDesigner的数据通讯. ..265  
4.8 网络通讯 OSC 与 TouchOSC. ..268  
实战案例：OSC 协议在TouchDesigner程序内部的通讯 ..268  
实战案例：使用 TouchOSC 和 TouchDesigner 通讯 ..271  
实战案例：为 TouchDesigner 中的图像制作移动端交互界面 ..273  

**[第5章 TouchDesigner 社区与资源](#第5章-touchdesigner-社区与资源)**  

5.1 新媒体艺术工作室 .280  
5.2 全球社区与活动. .293  
5.3 学习资源. ..303  

元件索引 308  

后记 311


##### 拥抱全新的数字时代

四年前，在写下第一篇序言时，我正在从上海飞往美国的航班上。四年后，依然是在太平洋的上空,我重新写下序言。从本书出版到现在，已经过去了四年，在这四年中，无论是产业、学术还是市场环境,都在悄然发生着巨大的变化。实话说，在书籍刚出版的时候，我是无论如何也不会想到在接下来的几年里会发生如此大的变革。大家怀着一腔热血和雄心壮志投入这个领域中来，去学习和体验这个交叉学科所带来的精彩。  

当然，这个时代确实也没有辜负我们，还给了大家最精彩的感受。我们看到了一个更加多元化的 TouchDesigner、更多出人意料的AIGC 应用产品，当然，还有我们这个愈加有活力的社区。2019 年，TouchDesigner 占据着我们制作部门 $90\%$ 以上的工作量；今天再看，却可能只有不到 $50‰$ 一定有很多人有疑问，是不是软件不好用，或者这个行业在衰退？其实不然。一来是团队规模变大了，业务范围变得更加多元，但更重要的是，TouchDesigner 对于我们来说不再仅仅是一个生产的工具，她变成了一个更加包容的创造力工具。很多时候，我们通过她来开启一个全新的工作流程，在视觉上嵌入Unreal 引擎、加入 C4D、Resolume Arena 和 Notch 的玩法，在音乐方面与 Ableton Live 相互结合,在灯光领域与 grandMA2 控台即时通讯，能与微信小程序实时交互，虚拟制作时还可以对接相机追踪技术，完成 NDI 多屏输出的多媒体集成方案；而在沉浸式交互场景中，她的作用就更无须赘述，大到机械臂控制，小到传感器信号解码…….很多时候我们都能从TouchDesigner 的使用中找到灵感，更主要的是她能帮助我们在实际应用中将项目落地。她就像一个人的中枢神经，接管着无数个细小的血管。也许你看到的是皮肤和肉体，但是真正的内核却藏在最深处，她似乎无处可寻，却又无所不在。这么多年来,我最大的感受是从中得到了很多创意灵感，这个也是和非常多后来学习的朋友们聊到的最大感悟。很多时候灵感是基于足够的脑部神经链接，而学习TouchDesigner的过程就像是不断增加神经，让不同神经元的接触几率变得更大。也许从某一天开始，灵感就会不断涌现，而且是与不同的软硬件结合，甚至创新出不同领域之间的新玩法。随着这几年数字行业的发展，学习TouchDesigner 的人从单一的数字媒体领域拓展到了建筑、园林、景观、视觉传达、纯艺、音乐、软件开发、游戏、公共艺术，甚至还有传媒公司、电视台和传统制造业领域。很多学习者也许不会在职业生涯里面把 TouchDesigner 作为唯一的使用工具，但是大家都能从中找到属于自己的方向，探索更广阔的发展空间。现在的 TouchDesigner 已经不单纯是一个生产工具，她更像是一个创意平台，能把每一个不同背景的人带到一个更高的位置，去瞭望远方。  

过去的几年里，数字产业经历了一波又一波的高潮，从虚拟产业到区块链、从元宇宙到人工智能,从 ChatGPT 到 Stable Diffusion，从 Midjourney 到 DALL· E3...·纵然我们经历了困难的疫情时期，但同时见证了可能是人类诞生以来最为迅猛的科技进步。更加高效的内容产出流程，更加吸引人的艺术作品，以及更有创意的设计方案…各种软件和技术层出不穷，技术和创意的结合也变得更加多元。或许有很多人要问，是不是有了各种AIGC 应用产品，我们将不再需要TouchDesigner？对于我而言，答案是否定的。AIGC应用产品好比是一个人身上漂亮的肌肉，而除了肌肉之外，还需要筋骨的支撑和连接。TouchDesigner 以其不断进化的整合 API 接口，让一个个独立的 Al 工具得以联动，在使得不同 AIGC 工具协同作业的同时，又在创作上赋予设计师和艺术家以可控的灵感。AI的不确定性与发散性，正好与TouchDesigner的参数化的确定性特点相互补，让创作灵感肆意奔放的同时，达到一个应用层面所应该有的可控性。当前，我们面对一个学习资源爆炸的时代，很多时候我们必须用尽全力跟上时代的脚步。要么做个弄潮儿，要么就会被时代所抛弃。幸运的是，这个社区里有那么多的人和我们一起在前行，我们并不孤单。  

说到社区，这是至今为止在我的人生里做的最有意义的一件事情。八年前在芝加哥，我开始在网络上找志同道合的朋友一起学习，希望这么好玩的东西让更多国内的小伙伴知道。没承想八年后的今天，TouchDesigner中文社区已经有超过十万的来自各行各业的人，这不得不说是一个奇迹，也是时代的幸运。在随后社区发展的历程中，我们经历了很多挫折，付出了辛勤汗水。很多人问我坚持下去的动力是什么，我说那就是希望每一个人需要帮忙的时候，都有一双手愿意给予支撑，在遇到雨天的时候，都有一把伞为你撑开。所谓赠人玫瑰，手留余香，帮助他人是最纯粹的快乐，我们希望能在这个浮躁的世界里去孕育一个宁静、单纯和友善的乌托邦，做一件很少有人在做的事情，并把它做成。这也许就是我，以及每一个社区成员能够坚持下去，携手前行这么多年的动力来源吧。依然记得在社区建立初期，为了找到有在使用这个软件的小伙伴，在豆瓣上发出三四百封邮件、在TouchDesigner国际社区上一个个搜索有汉语拼音名字的使用者，再一一发出添加请求和站内信··.·当年的付出在今天看来都是如此值得，因为换回来的是无比巨大的快乐，并且这种乐于分享的社区精神在这片土地上快速传播，生根发芽。在过去八年的时间里，TouchDesigner中文社区从零一跃成为全球最大的社区之一，而这，就是对每一个爱好TouchDesigner的小伙伴最好的鼓励。  

当然，这些年来，社区的进步不仅仅体现在人数上的增加，更有内容资源的极大丰富。很难想象在八年前能找到什么中文学习材料，而如今用中文一搜，都有数不尽的中文学习资源。更重要的是，内容的深浅也变得有所区别。除了入门的教程之外，更有各种专业门类和进阶教程供爱好者们进一步学习和研究，这也标志着一个更成熟的学习体系正在形成。社区的发展轨迹其实就像一面镜子，反映着我们这个行业和市场的变化，社区在这些年的迅速发展，从另一个角度也说明了市场和这个社会需要更多的设计师和艺术创作者。从某种角度来说，也正说明了我们在这个时代里做出了一个正确选择，投身到一个蒸蒸日上的产业里来。当然无论在什么领域里，只有热情和兴趣，才能让人坚持走向成功。最后，在这个交互科技艺术的领域里，你是否也愿意怀揣热情，和所有一样对未来抱有无限憧憬的小伙伴一起，去拥抱这个全新的数字时代呢？  

##### 感谢DigitalFUN和TouchDesigner中文社区 Thanks to Digital FUN and Chinese TouchDesigner Community

I wish to thank Ruokun Chen and Jimmz Zhang of Digital FUN for creating the first book on learning TouchDesigner for Chinese users. This wide-spanning look at the concepts of TouchDesigner is a hint of the many possible artistic and practical uses of TouchDesigner.  

非常感谢 Digital FUN 工作室的陈若琨和张骏为中国用户编写了第一本有关TouchDesigner 学习的书。这本书从如此多维且开放的角度呈现TouchDesigner,同时它也展示了这个软件在许多艺术和实践方面的潜力。  

As you learn more techniques in TouchDesigner, you will find it to be useful in new ways you may not expect. Whether you are fulfilling some of your school work, hooking devices and software together, prototyping and exploring some ideas, making an art project or a live performance, or using it professionally in your work, TouchDesigner will help efficiently fulfill your goals.  

当我们在 TouchDesigner 中研究不同技术时，会发现许多意想不到的创作方式。无论是在完成学校布置的作业、找寻软硬件的接口、从事原型开发、创作现场表演和艺术作品，还是在工作中去完成专业任务的时候，TouchDesigner都将帮助我们高效实现目标。  

TouchDesigner's procedural workflow to help you work with images, videos, sounds, devices and data, and its ability to help you organize, present and deliver information make it suited for all forms media playback, interactive art, lighting, experience design, and communication of ideas. I hope you are able to use this book as your starting point of your TouchDesigner career.  

Again, thanks to Ruokun Chen and Jimmz Zhang for growing the interest in TouchDesigner in China and assembling a book that will inspire and educate media artists, students, professionals, researchers and technologists in the art of using TouchDesigner.  

TouchDesigner的程序化工作流程可帮助我们处理图像、视频、声音、控制设备和数据，最重要的是能够帮助使用者组织逻辑结构，最好地呈现和组织视觉语言，使作品适用于所有形式的媒体播控、交互艺术、灯光、体验设计等。希望所有读者能够将本书作为 TouchDesigner 事业的起点，相互学习，共同进步。  

最后，我要再次感谢陈若琨和张骏，他们过去的努力让中国地区越来越多的人关注 TouchDesigner。这本书的编著，能帮助大家激发更多的创作灵感，这对于媒体艺术家、学生、专业人士、研究人员和技术人员都有极大的教育意义。  

##### 与TouchDesigner一起视觉化思考 Visual Thinkingwith TouchDesigner

What is TouchDesigner? It's hard to describe in one sentence as it is more like a development platform than just a software developed for one purpose. TouchDesigner is a node-based visual programming environment for creating digital art in interactive installations and live performances, for prototyping new ideas and technologies, and for building and deploying real-time applications to a variety of markets. TouchDesigner's openness and flexibility in data processing allows it to be used for almost any imaginable type of project, enabling it to haNDIe the multiple genres of tasks required in today's digital media art installations.  

TouchDesigner's lineage goes all the way back to the 1980s with the software product PRISMS that served the computer graphics and visual effects industry for future films. PRISMS was developed for about 11 years by Side Effects Software until it evolved into Houdini in the mid-1990s. In the year 2000, Greg Hermanovic, Rob Bairos and Jarrett Smith formed Derivative and starting with Houdini 4.1 they began creating a new procedural real-time graphics platform called TouchDesigner. The driving passion was to build artist tools for creating real-time graphics with realtime controls, strongly inspired by performing visuals for the electronic music scene which was world class in Toronto at thetime.  

TouchDesigner's current form has ushered in a myriad of new use cases never imagined by its creators. Today it is used for everything from live visual performances, to architectural mapping and lighting, media servers and projection mapping, motion graphics, film on-set previz and live cinematic effects, spatial audio environments, designed experiential attractions, and countless other applications. Its strength as a tool for first prototyping and then building complete applications comes from its speed of development and rapid iteration, followed by its flexibility to deploy at any scale. The real-time engine and countless number of inputs and outputs allow all these use cases to be interactive if desired, with the level of interactivity only limited by technology and imagination. Building more inputs and outputs into TouchDesigner has been a cornerstone of its development for years now, this extensive interoperability with other hardware and software enables it to be used in an infinite number of creative ways by artists, designers, and programmers.  

Over the past 2 decades with Derivative, one thing that continues to be a beacon of inspiration are the people who use it daily in such imaginative and fascinating ways. Although the TouchDesigner community is not particularly large, it has successfully created a talented professional community around the world. This community is quite unique in that it draws from so many walks of life,including artists, musicians, researchers, designers, programmers, engineers, and kids. This variety has cultivated new and fresh ideas that are incorporated into TouchDesigner every year and has made the environment a pleasant one to be in. The TouchDesigner community has been the most fulfiling part of my career.  

This book is a grand step forward in sharing knowledge with the Chinese TouchDesigner community. The dedication of early adopters in the community, and of TEA and Digital FUN, has already laid the foundation for growth of a successful and vibrant TouchDesigner community in China and the surrounding areas. As China leads so many new technologies in hardware and software to the market and discovers incredible uses for them, the creative potential of these with TouchDesigner is exciting to speculate on. I welcome the exploration of users in the Chinese community to advance TouchDesigner through new perspectives and innovations. Let's create something together!  

什么是TouchDesigner？其实很难用一句话来形容。因为它更像是一个开发平台,而不仅仅是用于特定目的的软件。TouchDesigner是一个基于节点的可视化编程环境,可以用于创造交互装置和现场数字艺术表演，也可以用来进行创意和技术的原型开发。TouchDesigner灵活多变的架构和部署方式让它对当下多变的市场环境有极高的适应性,尤其在数据处理方面，众多的开发接口几乎可以用于任何能想到的项目类型，很方便地去满足当今数字媒体艺术作品种类繁多的需求。  

TouchDesigner 的诞生可以追溯到 20 世纪 80 年代，其前身是 PRISMS，一种用来为电影行业提供图形计算、处理视觉效果的工具。PRISMS 由 Side Effects 开发了大约 11 年，直到 20 世纪 90 年代中期演变为 Houdinia。在 2000 年,Houdini 的 GregHermanovic、Rob Bairos 和 Jarret Smith 组成了最初的 Derivative 公司，从 Houdini 4.1开始，创立了一个新的实时渲染的图像平台 TouchDesigner。这很大程度上要归功于当时多伦多令人惊叹的电子音乐和视觉效果氛围，它们成了这群人最初的开发动力。  

今天，TouchDesigner 的使用者们已经创造了众多连创始人们都不敢想象的案例。从视觉特效到舞台模拟预览，从现场表演到立体音频制作等，它之所以可以作为快速的原型制作工具和项目实现手段，取决于其强大的实时运算引擎和无数的输入输出接口。这种灵活性允许各种不同功能的模块交互作业，无惧项目规模，能够限制最后作品水平的，也就只有当下科技的瓶颈和我们大脑的想象了。这几年来，构建更多的输入和输出交互接口已成为 TouchDesigner的开发核心，我们希望能够和更多的软硬件进行通讯和连接,从而进一步解放艺术家、设计师和程序员的创作思维，进发出更多的创意火花。  

在过去的 20 年中，TouchDesigner的使用者们每天都能让我们看到惊喜，这些都一直鼓舞和激励着我们不断前进。尽管 TouchDesigner 社区的规模还未成为世界顶级，但是却已是一个专业并充满无限潜力的群体。这个社区的独特之处在于它吸引了各类人群,其中包括艺术家、音乐家、研究人员、设计师、程序员、工程师，甚至孩子。这种多样性和创新性每年不断融入，使TouchDesigner 成为一个令人喜欢并乐于加入的社区。不得不说，建立并拓展 TouchDesigner 社区是我职业生涯中最充实的部分。  

最后，本书是我们与中国 TouchDesigner 社区共享知识的重要一步。中国社区中第一批使用者以及 Digital FUN 和中国 TEA 新媒体社区的奉献精神，已然为中国及周边地区建立更多的TouchDesigner 社区做出了一个成功的表率，奠定了坚实的基础。随着中国未来更多的软硬件技术推向市场，可以预想到TouchDesigner的创造潜力将会被进一步发掘。我期待中国社区的用户从新的角度和创意方式来进一步使用TouchDesigner，让我们一起创造未来吧！  

##### 欢迎来到这个由元件构成的世界Into theWonderful World of OPs

Hey there TouchDesigner programmers. It is an exciting time to be exploring the world of New Media Art. From complex state of the art rendering techniques to retro-styles and we're living in an ever accelerating world that has an insatiable appetite for media. As ubiquitous as print on posters, motion on screens is everywhere. Even the menus at fast food restaurants have changed into an ever evolving and living piece of content. But New Media isn't limited to only screen based content. Programmable LEDs, large lighting fixtures, lasers, kinetic sculptures, and an impossible to categorize list of tools and mediums have become the standard toolkit for artists looking to transform the way we experience the world and make meaning.  

Where does TouchDesigner fit into this world for you? TouchDesigner provides a developers and artists a whole host of convenience features and functions that make the creative engineering fun and fast. From building dynamic UI systems, to controlling lasers and lighting systems, or creating stunning visuals, TouchDesigner has everything you need to build single installations or your own media control and generation system. You'll also find tools for physics and smoke simulations, creating point clouds from LIDAR scanners, working in VR, and an ever increasing set of input and control devices. TouchDesigner has also been used for projection mapping solutions all over the world and if you're excited about augmenting the physical world with projection and lighting, this is an essential tool for exploring that creative world.  

Looking back, I sometimes wonder what I would have told a younger version of myself about this work, and the chalienges that lay ahead. If you're just starting on this journey or continuing your adventure, here are some things 1 wishI hadknownsooner.  

Some of the most beautiful work is beautiful because of its simplicity. Like scale, it's easy to be seduced by complexity - to believe that complicated things are better because they're complicated. Some of the most beautiful art, however, is focused on simplicity. Anytime a project is becoming increasingly complicated, stop and ask how the added layers of logic and complexity are adding to your art. What are you trying to say? What feeling are you trying to evoke? Do you really need the additional pieces your focusing on, or have they become a distraction from your work.  

Understanding concepts is more powerful than understanding tools. It's often easy to feel like you need to learn a little bit of everything, or learn a little of every program. It is important to have a broad skill set, but it's also very important to understand the concepts behind those tools. I understood Photoshop better after learning some GLSL. Why motion tracking can be slow on computers didn't make sense to me until I learned a little bit about the fundamentals of computer vision. Learning to cook isn't just about learning how to follow a recipe, it's about how the ingredients work together and the chemistry of food. Understanding a concept will also make it easier to find the right tool. Make sure you not only understand the problem, but the broad ideas about how to solve it.  

What comes next is a lot of exploration, tinkering, and play. Find ways to be playful and joyful in your work, remember to ask lots of questions, and to share your triumphs and challenges with one another. Welcome to the TouchDesigner community, and Happy Programming.  

嗨，TouchDesigner 程序员们，当下正是探索新媒体艺术的绝妙时机。  

从复杂的渲染效果，到复古的旧照片风格，我们生活在一个瞬息万变、对媒体技术极具渴望的世界。如今屏幕上的视觉动画就像海报上的图案一样无处不在，就连快餐店菜单上的内容都会不断变幻。但是，新媒体不仅限于屏幕中的内容。可编程的LED、大型照明设备、激光机、动态雕塑以及无法分类的硬件媒介，都已成为艺术家们得心应手的工具，并逐渐转变我们体验世界和创造价值的方式。  

那么，TouchDesigner在哪些方面适合你呢？首先，如果你是一位开发人员或者美术创意者，那TouchDesigner的便利功能让你的创意阶段变得快速有趣；其次，无论你想制作动态的UI系统、控制激光、灯光系统、创造那些惊人的视觉效果，还是想制作简单的装置或者复杂的控制和复合型系统，TouchDesigner都能让你事半功倍。在TouchDesigner的世界里，你可以使用模拟物理状态的烟雾特效工具、LIDAR 雷达创建点云的工具、VR 工具，也可以通过它和各种各样的外设进行通讯。同时，TouchDesigner在全球范围内为各类三维投影项目提供解决方案，如果你也痴迷于通过投影和光影效果来增强对物理世界的感受，那么它将成为你探索创意世界的重要工具。  

回顾过去，我时常想对年轻的自己说点什么，谈谈关于这项工作的意义以及所要面临的挑战。如果你也碰巧刚开始这段旅程，并想继续探险，以下是我希望你能早点儿知道的事情：  

1．一些最优秀的作品之所以漂亮，是因为它的简单性。有时候我们容易被事物的复杂性所吸引—相信复杂的东西更好，仅仅是因为它看起来很复杂。但是，一些最为赏心悦目的艺术作品反而非常简单。每当项目变得越来越复杂时，我们就应该停下来问问自己，这些堆砌起来的复杂逻辑，能为你的作品加分吗？你想表达什么？你想唤起观众怎样的情感共鸣？你是否真的需要不断增加复杂度，还是它们在一定程度上分散了你的工作注意力？  

2.理解概念比理解工具更加有意义。我们通常感觉需要对所有的软件都有所涉及。拥有广泛的技能是很重要的，但了解这些工具背后的概念也很重要。在学习了GLSL之后，我对 Photoshop 有了更好的了解。在对计算机视觉的基础知识有所了解之后，我知道了为什么在计算机上进行运动追踪可能会很慢。正如学习烹饪不是单单学习如何依照食谱做菜，还在于了解原材料是如何组合的，以及各类食物的化学特性。了解各种逻辑概念后，我们更容易找到合适的工具。我们不仅得理解问题，而且还要掌握解决问题的各种方法。  

未来我们将要面对更多的探索，更多的纠错过程，以及更多有趣的事物。让我们一起放手去寻找那些让工作变得有趣和快乐的方法吧！记住要多问问题，并彼此分享胜利的果实和遭遇的挑战与困难。欢迎来到 TouchDesigner 社区，祝大家编程愉快。  

马修·睿甘[美国]MatthewRagan麦迪逊广场花园公司软件总监Madison Square Garden, Director of Software  

# 第1章 初识TouchDesigner  

第一眼看到TouchDesigner 时，你也许会被其全新的可视化编程界面所吸引。不同于传统交互开发软件，TouchDesigner标志着一个全新时代的来临。  

什么是TouchDesigner？它代表着最新的交互思想和功能，又如何帮助我们在交互视觉领域创造出前所未有的体验？让我们翻开这代表未来的第一页，开始千里之行的第一步。  


## 1.1 什么是 TouchDesigner?

TouchDesigner是由加拿大Derivative公司在2001年开始打造的一款节点式可视化创作软件。不同于传统的复杂编程工具，TouchDesigner提供了一种利用可视化节点作为制作手段的全新创作方式。创作者和设计师不需要担忧底层的编程开发，可以把精力集中到如何将不同媒介装置整合起来，如何去创造更有想象力的跨领域新媒体作品。  

如今，TouchDesigner已经开发到了第三代产品，众多的新媒体团队和艺术工作者在国际舞台上创作出了不计其数的经典作品。2016 年，TouchDesigner 首次被系统性地引l入中国。随着国内技术社区、帮助文档以及各类相关活动的兴起，TouchDesigner随后的用户量呈现出井喷式增长。无论是在教学、实验室、舞台创作、灯光设计、声音制作还是机械控制领域，都能看到很多由 TouchDesigner制作的令人惊叹的作品。更重要的是，TouchDesigner 的教育推广计划让所有人能免费接触这个全能的新媒体创作软件，无论在商业还是非商业领域中，TouchDesigner用户都能体验到这个软件的独特魅力。  

![images/f451043a767d9be35d24c0f4dbfcc243d7d0401d1617441c631a945567601372.jpg](https://i.imgur.com/YnB80fC.webp)  
图 1-1-01 TouchDesigner 官网页面  

TouchDesigner 在创造互动媒体系统、建筑投影、现场的视觉及声音表演等活动中，都是非常方便的工具。它可实现三维实时渲染、机械装置控制、实时灯光及声音特效输出，以及结合各类传感器制作交互作品、VR 作品等。配合多种软件协同作业，TouchDesigner 清晰的界面、便捷的操作，以及强大的API接口可以激发新媒体艺术工作者的更多创意。同时，跨平台的特点让 TouchDesigner 在 Mac 和 PC 上都能顺利运行，在团队合作上也能通过文件共享的方式让独立作品瞬间组合成一个超大的集成性应用。有趣的是，伴随着第三代 TouchDesigner 的出现, C++ 节点的存在让众多想从事编程的人有了更多的控制权，而 Python 作为内嵌编程语言，与 Al 的结合让人对 TouchDesigner 创作人工智能有了更多的想象。更为特别的是，无论作为媒体服务器，还是信息集成及计算核心，TouchDesigner 都有着行业内高级别的稳定性，这也是它能被 Moment Factory、Leviathan、WHITEvoid 等世界知名团队所采用的原因之一。  

![images/69af930247b2cb1f96f4ba23d4a337c44b8025dc1ece1fdd58e2a7560c0b9673.jpg](https://i.imgur.com/cBxt9dX.webp)  
图 1-1-02TouchDesigner 的功能与应用  

##### 舞台演出的应用

在舞台表演中，TouchDesigner 可以和表演者进行投影画面、灯光效果、机械装置等的实时交互，给艺术家舞台演出提供更多可能性，也为观众提供更为真实的沉浸式体验。  

![images/e41d559f15c0e514739385684b3bb76be89be8a7d1a2e50cfd172b12ecc3f60b.jpg](https://i.imgur.com/EoTpzLL.webp)  
图 1-1-03剧场舞台美术(艺术总监与 TouchDesigner 艺术家：Mattia Diomedi)  

TouchDesigner可以将画面投射在建筑物、实体模型等三维物体表面，并同时操控环境灯光画面等。如图1-1-04，三维投影与参观者四周的环境融为一体，利用多个立体模型和独特的建筑结构以及生成的投影内容，给参观者带来与众不同的空间体验。  

![images/1410701ae3829f89cf0a8a55571ed2e1c560d30202324530a61094734c5cc248.jpg](https://i.imgur.com/qdJ3ymz.webp)  
图 1-1-04 Bass Coast 音乐节投影装置 Prizome (Digital FUN 团队与艺术家 Yasushi Harada、Adam Barlev 联合创作)  

TouchDesigner可实现对不同机械硬件的实时控制，譬如利用软件控制的灯光矩阵可在空间中制造出奇妙的光影效果，如图1-1-05。运用强大的内置协议集成系统，TouchDesigner 可以跟几乎所有市面上的硬件进行通讯和交互，自由地控制大小型机械系统。  

![images/83279090368b2f810aba5d3144b4c28307d3d3d6ae048a2bba495295741db701.jpg](https://i.imgur.com/HFqzdYZ.webp)  
图 1-1-05交互动力灯光矩阵系统，2018一汽大众全新一代CC上市发布会(制作团队：Digital FUN;导演团队：Octagon Impact)  

##### 激光系统控制

TouchDesigner拥有极其便利的激光控制系统接口，可以对具有ILDA协议的激光机进行实时控制。结合激光矢量矫正系统，以及视频特效同步系统,TouchDesigner可以创造出完美的激光追踪效果。通过对激光色彩、亮度、路径的控制，能将任何传感器轻松地和激光机相结合，而这一切，并不需要手写一行代码。  

![images/5eb068d262a6041adfeb1c78730cc92b846d1dc4cd8150618e8e2a0ce8949523.jpg](https://i.imgur.com/1gKryNa.webp)  
图 1-1-06音画激光互动演出 (创作团队：Digital FUN)  

虚拟现实 (Virtual Reality)  

Touchdesigner 在虚拟现实领域也同样适用。配合 HTC Vive，Oculus 等VR设备，可在软件中实时创造、渲染场景和动画。有效的模块、渲染效果以及简单的操作方式，使我们可以更加简单有效地创造以及体验虚拟现实。  

![images/e16cd42c33cef623152acee2c77bf05a6ae6a0f36bd676ea93b805dab1e9469f.jpg](https://i.imgur.com/q36qcwA.webp)  
图 1-1-07HTC Vive Environment VR 虚拟场景搭建(艺术家：Peter Sistrom)  

利用传感器等各类外接设备输入数据，TouchDesigner生成的画面可以与数据产生互动，实时渲染出生动的可视化效果。导入 3D 模型，输入数据流，便能够生成更具有生命力的数据可视化图像。  

![images/b3576d46b2d6dcf4a062b1a964471897866e412313d095d23081a82d6cad24ca.jpg](https://i.imgur.com/YMJe8j7.webp)  
图 1-1-08交互视觉艺术 Voronosie Landscape (艺术家:Matthew Ragan)  

![images/234663aa2ba89a2e7bbfeb55d773e6deea54d1c8a63190cc00a668061834d5f3.jpg](https://i.imgur.com/bJ6A8lo.webp)  

Processing针对于课堂教学和有一定编程背景的实验项目，图形的算法库和纯编程的开发方式能够在程序员的手下变化出非常多的可能性。然而，Processing较为复杂的代码拓展及一些硬件兼容性的问题，使这款软件在商业及综合类型项目的运用频率较低，不过对于想学习入门级别的图像编程语言的程序员来说，Processing确实是一个不错的开始。  

![images/12a43faa82d11cf3f672cb698e3edd6706917bee6292df4587144816a6fc976a.jpg](https://i.imgur.com/ueoU2XZ.webp)  

openFrameworks作为最早一代的新媒体创作软件之一，在缺少高度集成化软件的时代确实是一款不错的新媒体开发工具。然而，极度依赖于 C++ 编程语言的原因，以及其他类型工具的出现，在新媒体艺术的今天，它已经极少出现在人们的视野之中。但是作为一些研究领域使用的软件，它的纯代码编写习惯依然是很多程序员选择它的原因之一。  

![images/9b83b98c10956a96ac4f2fe50aa1e061ccb957d905cf84638de43085c330706d.jpg](https://i.imgur.com/EsrCE29.webp)  

vvvV同样作为最早出现的一批新媒体工具之一，在很长一段时间内主导了交互媒体的创作思路，如今在很多的VJ项目中我们依然能看到vvvV的身影。作为节点式编程的早期开发软件，它为后来的可视化节点式创作架构提供了一种全新的思路，同时强大的开源性也是它的特点。然而作为一款开源软件，其应用的不稳定性成为了一个不可忽视的问题，目前较少见于大中型商业项目及团队应用领域。  

![images/0e5fe3cf2a91a50cf8e98f0bc131ebbaed74383ba696a07e9bf21856f5b2f7e2.jpg](https://i.imgur.com/Mg9Juaa.webp)  

MaxMSP最早是很多音乐创作人的工具，之后Jitter组件的加入让其在视觉应用领域有了一席之地。然而，作为一款早期的节点式编程软件，其复杂的节点结构让人望而却步，令其无法成为一款全能的应用软件。目前MaxMSP的定位是作为一款声音创作软件存在于众多的音乐制作人之间。  

![images/234fd140586b43d4f1d1616adf13904b07d9b482f52da9acfb358ea7db6a39cc.jpg](https://i.imgur.com/zmiTNcZ.webp)  
图1-1-09软件列举  

TouchDesigner是一款真正意义上的可视化节点式创作工具，一开始就定位于新媒体交互领域。强大的系统集成性与众多的API，使它与市面上几乎所有的软硬件之间的信息交换变得非常便捷。从机械控制到声音、灯光、实时视觉特效的渲染都有非常出不错的表现。由于定位在商业级应用软件，在稳定性方面它是新媒体创作软件中的依依者，是一款能从课堂教学实验到实际大型项目级别应用型的新媒体软件。  

##### TouchDesigner授权类型

Non-Commercial非商业版本：官方提供的免费版本，开放使用 $95\%$ 以上的功能元件。此版本最大输入输出分辨率限制为 $1280^{\star}1280$ ，如需解除分辨率限制，需购买付费版本。需商业版本授权的元件名称将显示为灰色，在当前版本状态下无法使用。  

![images/ecfc03372221107db41987d93c989b6104a563bad56af8203d7884d75f21c1e4.jpg](https://i.imgur.com/H3L7Grh.webp)  
图 1-1-10TouchDesigner 非商业版本  

Commercial商业版本：官方提供的商业付费版本，开放使用几乎所有大型展演所需的功能元件及软硬件接口。无最大输入输出分辨率限制，在显卡配置允许情况下，单台服务器最大支持8K，16路高清视频输出。  

![images/7a897cdc5037831f1fc5372f374989327156a0011749ebd01ff9e3afc54163eb.jpg](https://i.imgur.com/bhLStNg.webp)  
图 1-1-11 TouchDesigner 商业版本  

Educational教育版本：官方提供的教育折扣版本，提供与商业版本完全相同的功能。需要向官方提交高校教育证明，仅供在校学生和教师使用。  

![images/3dee0ccb84949f500d5cf9b4b0e3b13ad651dbb91d14740739ce09780a8cbede.jpg](https://i.imgur.com/DclWTPs.webp)  
图 1-1-12  TouchDesigner 教育版本  

Pro专业版本：官方提供的专业付费版本，开放所有元件及软硬件接口。在商业版本功能基础上增加 Notch、BlackTrax、多服务器同步等高级功能，并允许用户对工程进行加密。  

![images/f0efde7d4f2ed65ce275f0c3ec580e1d7cc041cbb98364e07968b7c1c41dd43e.jpg](https://i.imgur.com/F835klm.webp)  
图 1-1-13TouchDesigner 专业版本  

##### TouchPlayer 授权

TouchPlayer 可以简单理解为允许部署、但不能进行编辑的 TouchDesigner 播放器。通常用户利用 TouchDesigner进行编辑创作，之后在现场使用 TouchPlayer 在不同机器上进行部署。所有 TouchDesigner 授权类型都有相对应的TouchPlayer 授权版本，TouchPlayer 的价格基本上是对应版本TouchDesigner的一半。  

![images/13aca1df6e2366c1be948876cd3c6245c99f8f2ce1d87508b1415f63c96249df.jpg](https://i.imgur.com/nYbXOsw.webp)  
图 1-1-14TouchPlayer 的专业版和商业版  

特别地，对于每个购买的授权，TouchDesigner 提供从购买之日起，一年内的所有更新版本的使用权限。对于一年之后的版本使用，需要购买更新授权（价格通常是原价的一半或者更少，仅供参考）。  

##### License Dongle

Dongle 就是我们俗称的硬件授权密钥，方便用户在不同机器之间切换使用。用户即插即用，无需每次联网授权。需要注意的是，Dongle 本身并不带有授权信息，需要额外购买不同版本的授权。  

![images/7b56924f42e157d357f1327e9d49857f68e89f73c9d3a6939d3dcdaa709689fc.jpg](https://i.imgur.com/0ogGP3W.webp)  
图 1-1-15Dongle 硬件授权密钥  

##### TIPS  

目前国内由中国TEA新媒体社区提供不同软件授权与Dongle 硬件授权密钥的购买渠道。需要购买请访问：www.tea-community.com/shopping。或者通过邮件联系：info@tea-community.como  

![images/11f4aa6054a37cc4ac6cf0f7ce1a40917687095db5f1992055abb5ee3358e31b.jpg](https://i.imgur.com/x4KOccg.webp)  

## 1.2 下载、安装、注册

下载 TouchDesigner，可访问 TouchDesigner 母公司 Derivative的官方网站www.derivative.ca。点击网页右上角GETITNOW，进入下载页面。如图1-2-01，详细介绍了电脑安装TouchDesigner的配置要求，根据需要调整升级电脑配置，然后下载对应Windows或者MacOS版本。  

##### TIPS  

TouchDesigner的运行帧率和显卡性能有较强的相关性。同时，对于NVIDIA的显卡TouchDesigner具有更好的支持性。对于集成显卡或者AMD独立显卡的用户，有个别的功能不能使用，但是也不用太担心，因为基本所有常用功能都能顺利运行。如果是老式的电脑或者便携型笔记本，显卡的性能不足会导致帧率的下降，如果是新款游戏笔记本，请记得插上电源以激活独立显卡。此外，在MacOS系统上有一些基于Windows平台的应用不能使用（例如Kinect的系列产品）。最理想的配置是一台拥有NVIDIA系列独立显卡及WindowS系统的桌面型或笔记本电脑。  

![images/ba5e8674db1d380cd94bc8ec0bb859da073c9e5cafce55200f2aeee9cd20ab41.jpg](https://i.imgur.com/TXhzUyr.webp)  
图1-2-01最低系统配置要求  

双击打开下载好的安装包，选择安装位置，可以根据需要选择是否安装TouchPlayer和移动授权密钥。勾选许可条款，点击安装。  

![images/d333c0c1f12aab3991782250067405281c7030548f9cbe87eda629d2620b70f1.jpg](https://i.imgur.com/8gDP0Ew.webp)  
图 1-2-02　安装界面  

##### TIPS  

TouchPlayer 是独立于 TouchDesigner的执行平台。在创建 TouchDesigner 工程后可以直接在TouchPlayer里面运行，并且不能修改。TouchPlayer为用户提供了一个安全的部署环境，以及更加有性价比的价格。如图1-1-15,移动授权密钥就是图中的License Dongle，具体的移动授权密钥和TouchPlayer购买信息，可扫描上页TIPS框内右下角二维码登录中国TEA新媒体社区官网进行查看和购买。  

第一次进入页面需要注册或登录账号。在Username 后输入用户名，在 Password 后输入密码，点击 Sign In 登录。如果没有注册过,可以点击下方 Not registered yet，进入注册页面。完成注册登录后会得到10个免费的非商业授权，这样就可以开始使用软件了。对于非商业版本，最大输出分辨率会限制在 $1280^{\star}1280$ ，仅供个人使用和学习，专业创作和开发需要购买商业授权密钥进行最大分辨率解锁。  

![images/25d3591c10e28306c0ef8c1e71f6a6e7ee4effa28850f16486e1b31d59df9f6b.jpg](https://i.imgur.com/aseFnWe.webp)  
图1-2-03登录界面  

##### 创建和安装密钥

如果账户中已有购买其他付费版本，在登录后会弹出界面，如图1-2-04，对话框中显示账户内所有可用的许可证，选择需要授权本机的许可，点击 Create Key 创建密钥。变灰的许可表示授权过期，不支持当下版本，需要更新才可以使用最新的软件版本。  

![images/8dbd9f103b9e9ac080c46620794ac2bf34cafd6cc5551f176b46c931b1a09f4f.jpg](https://i.imgur.com/zKd2Z3S.webp)  
图1-2-04创建密钥  

##### TIPS  

由于近年来TouchDesigner的普及率越来越高，目前在市面上已经出现了所谓的TouchDesigner软件破解版本或者“一号多卖”的情况，请大家从Derivative 公司官方网站或者中国TEA新媒体社区官网(www.tea-community.com）进行正版软件的下载和授权采购，如需非商业版本，可以直接免费注册，足够初学者应用。由于 TouchDesinger每月定期的更新中都会采取新的反盗版机制，使用盗版的Pro 和Commercial版本或非官方序列号会导致程序随机崩溃，以及一些功能的限制和随机报错。作为价廉物美的商业软件，在我们享受TouchDesigner软件和社区福利的同时，也请大家支持Derivative、TouchDesigner中文社区和TEA新媒体社区在中国多年来所作出的努力，共同维护社区健康发展。  

##### TIPS  

以上创建密钥的方法仅对于有网络的用户。对于拥有移动授权密钥的用户来说，无需任何创建密钥的步骤，插上USB移动授权密钥，即可开始专业级别的开发和商业项目的使用，在不同机器之间进行脱机编辑，极其方便。  

如果此时电脑没有网络，我们可以选择脱机安装密钥的方法。通过在另一台连接到网络的设备上为它创建密钥。首先记下需要许可证密钥的计算机上Install界面最底部的SystemCode和Machine Name，如图1-2-05。  

![images/873f3691bc9ee775215e29c7aa61c24984289b2ef666850f3c465c9aab222aaf.jpg](https://i.imgur.com/VME5kEw.webp)  
图 1-2-05记录 System Code 和 Machine Name  

在另一台有网络的电脑上打开官网www.derivative.ca，并登录账号。进入个人信息界面，选择MYLICENSES，点击CREATEKEY，如图 $1-2-06_{\circ}$  

![images/23efb3d5fd4ee8c8088933a3bd19a54297b88b9d8c6ac2ed17385785317d1b45.jpg](https://i.imgur.com/4FgD4MZ.webp)  
图1-2-06创建密钥  

如图1-2-07，输入需要安装密钥的电脑上的SYSTEMCODE和MACHINENAME，选择软件版本为088或者099，点击GENERATE即可生成密钥。  

![images/208f18f78c3dff9bc0d143d45f6b6a9fe8bcac24da133f0585afa94ac55d9b12.jpg](https://i.imgur.com/PpjyAPT.webp)  
图1-2-07输入 SYSTEMCODE和 MACHINENAME  

将生成的密钥代码输入到需要安装密钥的电脑上。在 Install 界面的 Enter key 后输入密钥代码，点击 Install Key，密钥就安装完成了。  

![images/4547fd11937d892c9bae52c0e429e33d532398d12739205f659d16e81db0e7ed.jpg](https://i.imgur.com/4qAKall.webp)  
图1-2-08输入密钥代码  

##### 禁用密钥

一个授权密钥只能在一台计算机上使用，所以在使用完毕后我们需要禁用此密钥，以便在其他机器上再次使用。首先，确保电脑已连接网络。如图 1-2-09，打开 Dialogs 中的 Key Manager。接下来，如图 1-2-10，选择密钥后点击DisableKey，密钥就被移除了。  

![images/38cd1caab6cee569d86ea5b8c15103a281e50f4c77b1d34f14e0a2c7fe9a9661.jpg](https://i.imgur.com/jg3POri.webp)  
图 1-2-09打开 Key Manager  

![images/6efa565afc73699de4c82a9c03a01cb8c9c9d2f6e17f0c6f4b882ade3e3b85b2.jpg](https://i.imgur.com/Vs4eiDm.webp)  
图1-2-10移除密钥  


## 1.3 界面、操控与快捷键

TouchDesigner 的初始界面由以下几个部分构成：参数窗口、时间轴、控制选项区域、插件区和可视化编辑区。  

![images/d510f69e0e41c02a84476c2eeffb910b56f09c56dc19e5db092b53a8b990a607.jpg](https://i.imgur.com/bYb0RIa.webp)  
图1-3-01界面介绍  

**A 参数窗口** 

界面右上角的参数窗口中包含了元件所有的参数，可以通过改变参数来达到想要的效果。按“P”键或右击元件选择参数（Parameter），即可打开参数窗口，每个元件类型都会有不同的参数项。  

如图1-3-02，参数界面窗口上方（已用黄色序号标出）是每个参数窗口上都会有的图标，左边部分 $①\sim③$ 是参考类的信息，右边部分 $④\sim⑨$ 是功能性的按键。  

从左到右的选项分别代表：  

$①$ 帮助：
$1$ 打开这个元件的维基帮助文档;  
$②$ Python 帮助：打开关于这个元件的Python 帮助页面;  
$③$ 元件信息框：显示有关于此元件的相关信息；  
$④$ 显示标签：显示和编辑元件的标签；  
$⑤$ 注释：显示和编辑元件的注释；  
$⑥$ 显示复制参数：显示通过右键菜单复制的参数；  
$⑦$ 语言：选择使用Python 或 Tscript 作为其脚本语言;  
$⑧$ 展开／折叠参数：展开或折叠所有的元件参数;  
$⑨$ 非默认参数：仅显示被修改默认值的参数。  

![images/a2f070ee167778bdb58aafb0780ac30f9fc881f5aa91b67d0eff14aba75465b6.jpg](https://i.imgur.com/2Ai6A1M.webp)  
图1-3-02参数窗口  

特别需要注意的是，由于本书页面展示的局限，很多时候我们在截图时打开了 $⑨$ 非默认参数选项。所以读者在阅读本书时，会发现截图和实际的菜单参数不一样。  

##### B 时间轴

在界面底部的时间轴，我们可以实现播放、暂停、定位时间等操作，时间轴的操作方式与其他软件基本一致，通过空格键可以控制播放或停止。左侧的时间条区域能够看到项目的帧速率，通过在时间轴中设置开始帧和结束帧，可以使基于时间轴的动画在特定区间内播放。同时，可以强制将最大FPS（每秒渲染帧数）锁定在某个值上。  

![images/fe0b767139f900152994750136a53842c2276ab43bc92751cc8eaf5f3537e7ec.jpg](https://i.imgur.com/rzSpByQ.webp)  
图1-3-03时间轴  

##### C 控制选项区域

在控制选项区域中，大家可以通过Layout 调整视窗和布局，以便在展开多个区域任务的时候更方便地看到整体效果、元件的层级状态，等等。  

![images/da2be244d55dbba234daccf2bf86b135b3481400cdcab0fbf7fc8a6d674f1bb6.jpg](https://i.imgur.com/oYWxB2F.webp)  
图 1-3-04控制选项区域  

其余重要功能按编号顺序分别代表：  

$①$ WIKI: TouchDesigner 的维基页面;  
$②$ FORUM：TouchDesigner 的官方论坛;  
$③$ TUTORIALS:TouchDesigner 的官方教程;  
$④$ FPS：全称“frames per second”即实时帧率，或者说刷新率;  
$⑤$ Perform Mode：以表演模式进入播放状态;  
$⑥$ Palette：插件区。  

##### D插件区

如图1-3-05，是由官方认证的综合性插件区。插件区内所有的元件都是由TouchDesigner 内置的基本元件组成。其中包含一些 TouchDesigner 中常用的预置模块和工具，例如音频分析组件、VR 设备接入模块、用户界面模块等。使用时可以很方便地将区中的插件拖入编辑面板，这样就可以直接和其他元件进行对接。  

##### E 可视化编辑区

此区域是用户最常使用的区域，如图 1-3-06。TouchDesigner 中的基本操作是连线和拖拽，元件之间由连线组成网络。元件的左边是输入接口，右边是输出接口，数据从左向右流动，相互合成。每个元件都各司其职，通过连线网络，各个元件中的参数互相作用，共同组成具体的功能，满足各种各样的需求。  

![images/973fab1b4f6ee644b55608f690057c9f5b80716f1b625e2f24c1b053b1fe69b4.jpg](https://i.imgur.com/RUdmJX7.webp)  
图1-3-06可视化编辑区  

![images/4282dee390bf3bd72e31e055ca814ab76fa88c9e54d192a9da58ff12f0386998.jpg](https://i.imgur.com/lA3CLOh.webp)  
图1-3-05插件区  

如需增加元件，鼠标右键点击输出端添加新元件。相反，如需解除关联，右击连接线选择Disconnect 取消连线。  

![images/65c6c7fdbad5deabd1b8b2762cc3f76b0d3807048902755402da9183b07ddfbb.jpg](https://i.imgur.com/2kSsBxY.webp)  
图1-3-07添加新元件  
图 1-3-09快捷键操作指南  

![images/4ab7d0a32ccef50ff867100f4afd25ba9142f535b4ec6cade54b4472a6898945.jpg](https://i.imgur.com/yAgucYj.webp)  
图1-3-08解除元件关联  

##### 快捷键的使用

在 TouchDesigner 中熟练地使用快捷键能让效率大幅度提高，如图 1-3-09，整理出的快捷键的指南能帮助你很好地上手。  

<html><body><table><tr><td colspan="4">TouchDesigner常用快捷键</td></tr><tr><td colspan="4"></td></tr><tr><td colspan="2">GENERAL基础</td><td colspan="2">DIALOGS对话框</td></tr><tr><td>撤销</td><td>Ctrl +Z/Z</td><td>偏好设置</td><td>Alt+P</td></tr><tr><td>重做</td><td>Ctrl+Y/Z</td><td>关于TouchDesigner</td><td>Alt+ Shift +V</td></tr><tr><td>剪切</td><td>Ctrl +×/x</td><td>性能监控窗口</td><td>Alt+Y</td></tr><tr><td>复制</td><td>Ctrl +C/C</td><td>窗口位置</td><td>Alt+W</td></tr><tr><td>粘贴</td><td>Ctrl+V/v</td><td>插件区</td><td>Alt + L</td></tr><tr><td>选择元件</td><td>鼠标左键点选</td><td>MIDI设备映射</td><td>Alt + D</td></tr><tr><td>框选</td><td>鼠标右键拖拽</td><td>密匙管理器</td><td>Alt+K</td></tr><tr><td>删除所选项</td><td>Delete或Backspace</td><td>搜索</td><td>Alt+S</td></tr><tr><td>添加所选项</td><td>Shift+点选</td><td></td><td></td></tr><tr><td>平移编辑区</td><td>鼠标左键拖动</td><td></td><td></td></tr><tr><td>缩放编辑区</td><td>鼠标中键或滚轮滑动</td><td>NETWORKEDITOR编辑区设置</td><td></td></tr><tr><td>元件信息</td><td>鼠标中键点击</td><td>添加元件</td><td>Tab或双击鼠标左键</td></tr><tr><td>播放/暂停</td><td>空格键</td><td>加载.tox元件</td><td>Shift+X</td></tr><tr><td>演示模式进入/退出</td><td>F1/EsC</td><td>搜索元件</td><td>Ctrl +F</td></tr><tr><td></td><td></td><td>打开父级显示窗口 参数面板显示/隐藏</td><td>Shift+V</td></tr><tr><td>FILES文件</td><td></td><td>激活视窗编辑模式</td><td>P A</td></tr><tr><td>新建文件</td><td>Ctrl +N/N</td><td>元件名称大小</td><td>N</td></tr><tr><td>打开文件</td><td>Ctrl+0/0</td><td>以直线/曲线方式连接元件</td><td>S</td></tr><tr><td>保存</td><td>Ctrl +S/S</td><td>数据链接箭头显示/隐藏</td><td>X</td></tr><tr><td>另存为</td><td>Ctrl+Shift+S/S</td><td>面板缩略图</td><td></td></tr><tr><td>导出视频</td><td>Ctrl +M/M</td><td></td><td>0</td></tr><tr><td></td><td></td><td>调色板</td><td>C</td></tr><tr><td>退出</td><td>Ctrl +Q/Q</td><td>居中查看全部/所选元件</td><td>H/Shift+H</td></tr><tr><td></td><td></td><td>跳出(上级)编辑区</td><td>U</td></tr><tr><td></td><td></td><td>跳入(下级)编辑区</td><td>1/Enter/Return</td></tr></table></body></html>  

## 1.4 元件类型与基础鼠标操作

TouchDesigner 中的基本元件类型分为 6 种，分别是 COMP（Component Operator）、TOP（Texture Operator）、CHOP (Channel Operator)、SOP (Surface Operator)、MAT (Material Operator） 和 DAT (Data Operator)。在 2019 年的春季更新中，TouchDesigner开始支持自定义元件Custom 的引l入（用户可以利用 TouchDesigner 的 C++ API自己进行 Operator元件的制作）。在元件编辑区空白处双击鼠标，可以看到这6大类元件与其对应的元件颜色（如果没有在Custom存入自己制作的元件，Custom内就是空的）。  

![images/d0625a60cb4bda2a01c96c48c4eda7d9db860adfee39014e4db2ab53b3e6072d.jpg](https://i.imgur.com/CT9YLfQ.webp)  
图 1-4-016种元件类型及Custom自定义类别  

##### 6 种元件类型的基本介绍

##### TOP类型元件

TOP（Texture Operator）是一类关于输入、输出平面图片影像的元件类型，也是TouchDesigner 视觉项目中最常见的元件组。TOP元件是基于像素（Pixel）的，从技术上来说，所有的计算都是基于GPU的，这也解释了为什么 TouchDesigner 在图像处理和视频解析上具有超强的效率和灵活性。  

TOP元件可以通过对基本形态元件 Circle TOP、Rectangle TOP 形态生成非常复杂的抽象动态视觉效果。此外，Nvidia Flow TOP 更是可以通过简单的参数调整出复杂的火焰特效等。而且，CompositeTOP 的引入也可以让所有元件组成不同的层级，而LevelTOP、RGB Key TOP 等元件让后期视觉处理变得简单而清晰。  

![images/8f2a65d7b8ba8e3db76603b3c96b7c39b11f31f19077052a3736945b68d9f2ae.jpg](https://i.imgur.com/LefUon5.webp)  
图 1-4-02TOP元件家族  

TOP元件的I/O (输入输出接口)系统是其另一大特点，如图1-4-03,MovieFileIn/OutTOP支持几乎市面上所有格式的视频导入与网络视频流处理。Video Device In TOP 与操作系统自动同步所有采集设备的驱动，可以随心所欲地调配和使用各种照相机和摄像系统。  

![images/c37b8e989fb2f5a640b645431368cf620f1a5575d1e0504dd754689c2fcd0ba4.jpg](https://i.imgur.com/5sh12Ow.webp)  
图 1-4-03Movie File In TOP与ViedoDevice In TOP  

更重要的是，TouchDesigner软件内置的包括Kinect TOP、KinectAzureTOP（2020 年春季更新后加入的功能）、RealSenseTOP和ZEDTOP等硬件读取元件能直接让我们在创作时得到深度图和红外图等。  

![images/e1bd887d669a0b9b13a6cfa7e3a4edde96e83b400d5dd7373b892e4e0430e5d5.jpg](https://i.imgur.com/ezyNZJj.webp)  
图1-4-04在TouchDesigner中的互动粒子效果（艺术家：AndrewMonks与PeteWallace)  

同时，TOP元件组还支持与大量的第三方软件通讯与协议进行实时控制。Syphon Spout In/Out TOP支持所有主流软件的图像同步通讯，Notch TOP的出现让视觉软件 Notch VFX与 TouchDesigner的整合成为强大的视觉交互系统，而NDI等协议的支持也让大型演出中的网络视频传输变得易如反掌。  

##### TIPS  

NotchVFX是一款极具创意的视觉特效软件。如果你感兴趣，可以访问由中国TEA新媒体社区运营的Notch线上中文交流社区，www.notch-community.co。那里有大量的教程和案例供大家学习，同时也可以在网站留言加入Notch中文微信群，与所有爱好者一起进行日常交流讨论。Digital FUN团队在项目上也常常使用 NotchVFX和TouchDesigner一同进行交互创作。以下画面为DigitalFUN工作室用NotchVFX为一汽丰田Rav4发布会制作的视觉特效之一。  

![images/2e269a888c14d3583050161f3560d70d779eb06905ce6b40ac4727a088159807.jpg](https://i.imgur.com/51f6YNU.webp)  

外置的扩展元件包括CPlusPlus TOP、GLSL TOP 等让专业的图形图像工程师们有了自我发挥的空间，可以制作出更为复杂的效果，如图1-4-05。  

![images/b9ecfc72a7dc43601fcf91e8d4b7f1910509fcff5ea29dc15f2b1d0cdbd98b04.jpg](https://i.imgur.com/7Bj10Bl.webp)  
图 1-4-05 TouchDesigner 交互作品 Infinite Dimensions in Digital Art and Beyond (艺术家: Vincent Houzé)  

CHOP（Channel Operator）是数据通道元件类型，简单来说就是对所有流动的数据进行处理的一类元件。  

![images/a65e0f5753f5197dd2c6b4ddbed1ef43a59f1330d2602444253714e6f8dfeab2.jpg](https://i.imgur.com/BCoC3yg.webp)  
图 1-4-06CHOP 元件家族  

TouchDesigner 作为一款以交互和实时数据处理为核心的软件，所有的输入和处理都可以归结为对于数据的处理，这也令CHOP元件类型成为和 TOP一样最为常见的一类元件。  

![images/5b092f9558ac2b37fe373fd2f335c81ed04a819d9f77111b058b44b3e1c137d6.jpg](https://i.imgur.com/0BVryz5.webp)  
图 1-4-07 Constant CHOP 与 Noise CHOP  

CHOP元件可以生成和使用已有的数据以及集合。在CHOP 元件中，我们称每一条数据变量都是一个通道。运用LFO CHOP、Noise CHOP 等元件可以独立生成一串的数据，之后与 Math CHOP 等结合控制其他元件（例如 TOP中的各种图形)进行变化。  

同样，强大的I/O（输入输出接口）是CHOP元件的另一大特色。Audio系列的CHOP 组件让声音的导入、控制与变化变得非常简单，Audio Device In/Out CHOP 更是可以让 TouchDesigner 与任何声卡进行通讯和控制, $360^{\circ}$ 立体声场的制作在 TouchDesigner 中变得易如反掌。 Kinect CHOP、RealSense CHOP、Leap Motion CHOP 以及 ZED CHOP 可以直接读取到所有的深度摄像头的骨骼捕捉信息。BlackTrax CHOP、NatNet In CHOP、Hokuyo CHOP、Leuze ROD4 CHOP、PosiStageNet CHOP 等协议元件覆盖了市面上最重要和常见的几种动作和位置捕捉设备，Laser CHOP、EtherDreamCHOP、Pangolin CHOP（2020 年春季更新后加入的功能）与 Helios DAC CHOP 让激光控制无比简单便捷，而 OpenVRCHOP 和 Oculus Rift CHOP 等元件使得 VR 设备与 TouchDesigner 的通讯变得相当直观与便捷。以上这些元件可以直接联通相应设备获取数据，不需要一行代码。  

![images/02ef2b273b2216479ad9f581f85e955f58e5fa0ee0bd7320f85001465370190a.jpg](https://i.imgur.com/kV1qg2Y.webp)  
图 1-4-08激光交互作品，2019 年一汽大众迈腾上市发布会(创作团队：Digital FUN；导演团队：Octagon Impact)  

除了本身直接读取外设数据进行通讯，丰富的协议接口也是让 TouchDesigner变得无所不能的一个重要原因。MIDIIn/OutCHOP可以让其变身DJ和VJ软件，OSCIn/OutCHOP可以让其通过和各种第三方软件之间进行数据交换和远程控制，Ableton Link CHOP 让 TouchDesigner 和 Ableton 组成业内最强的音乐视觉交互制作系统， LTC In/Out CHOP 在舞台应用上与总控台同步时间码，Sync In/Out CHOP 让多服务器视频及音频同步成为简单的操作，DMX In/Out CHOP（包括 Art-Net、sCAN 等协议）的使用让TouchDesigner的控制系统覆盖了目前市面上的几乎所有灯光设备和绝大部分的机械控制设备。  

![images/feb3e1eb4e962037f7b18afc2f0c4f12ceb7325f4d680b02f49a36153736af69.jpg](https://i.imgur.com/iJTwgHS.webp)  
图 1-4-09TouchDesigner交互影像装置BOX(创作团队：Bot&Dolly)  

##### SOP类型元件

SOP（SurfaceOperator）是和 3D模型的制作、变换相关的一系列元件。由于TouchDesigner与Houdini共承一脉，两者之间都有非常类似的3D模型编辑功能。与基于像素（Pixel）的TOP元件不同，SOP元件的变化和计算是基于模型上的点（Point）的，也就是三维空间中的矢量转换。从技术角度出发，SOP类型的元件都是在CPU上进行计算，这个原理和几乎所有三维软件的基本原理相似。  

![images/873bf5d827de3c0dbbf26118123e4806840625de2105d9f8f804c8130b5fa065.jpg](https://i.imgur.com/C3O6UPf.webp)  
图1-4-10SOP元件家族  

![images/44bdfec8dde23e414cc126e4bb72af7181061f89349f043db8d4f2f3e2be2754.jpg](https://i.imgur.com/RuKIpXJ.webp)  
图 1-4-11 Sphere SOP 与 Particle SOP  

在传统的三维软件中，我们使用多边形建模的方法同样适用于TouchDesigner的模型设计中。几种模型元件 Sphere SOP、Box SOP、Torus SOP、Tube SOP 等提供了最初的基本 3D 形态。在模型操作中运用 Noise SOP、Copy SOP、Creep SOP 等元件可以创造出丰富的模型变化; Metaball SOP 与 Spring SOP的使用更可以通过场域变化创造出流体和绸带的效果。对于法线、曲面、线段等各种变化都可以通过不同的SOP元件制作出来。  

ParticleSOP作为TouchDesigner的粒子系统，通过对外力参数的控制，可以制作出具有震撼视觉效果的粒子画面。我们通常会结合一些外置设备，例如位置追踪器、动作捕捉设备、Kinect、Leap Motion等去控制各种粒子效果的参数影响因子，制作变化多样的实时交互作品。  

![images/a7e68b28d28211cd097a5e176cd562938a12d2475cbbfaace9b5ca62c00c2673.jpg](https://i.imgur.com/IMwZZSd.webp)  
图 1-4-12用TouchDesigner制作的丰富的粒子效果  

##### MAT 类型材质

MAT（MaterialOperator）用于给几何体添加材质，这和常见的在三维软件中添加材质的道理是一样的。所有的贴图都依附于材质，在 TouchDesigner 中可以直接将展开的 UV 贴图附属到材质上，这样三维模型就可以同步导入。同时，还可以将影片或者动态视频添加在不同材质上，这样就可以产生很多实时生成的动态贴图效果。  

![images/5069f241eae7c1f870b03f14012e7a955fc0a24eb4fe91c33a01fd261985537f.jpg](https://i.imgur.com/l3HeK2Q.webp)  
图1-4-13MAT元件家族  

![images/02f3bc92d34f1b8251d40335e11fdcb7eb90dd6ca7a0210409ad1ef5583b4ede.jpg](https://i.imgur.com/rGb7D2p.webp)  
图 1-4-14 PBR MAT 与 Phong MAT  

TouchDesigner中，经常用到的MAT元件包括Phong MAT（有高光的光滑材质）、Constant MAT（不受环境光影响、不分明暗面的材质）、Wireframe MAT（线框材质）等；针对于粒子系统，有专门的 Point SpriteMAT 材质；同时，TouchDesigner 还引l入了 PBR MAT（基于物理的渲染材质）。当然，TouchDesigner 依然支持用GLSL来编写材质，这让专业人员的作品变得更加引I人注目。  

![images/51ffa017514b1a087410da347ad98736586f1bd923a5c874dead7fd7942e4f17.jpg](https://i.imgur.com/BSsFiGm.webp)  
图 1-4-15在 TouchDesigner 中使用 PBR 贴图渲染出的金属模型  

##### DAT类型元件

DAT（Data Operator）可以处理不同类型的数据，例如字符串、整数、列表等数据，所有的数据在DAT元件中以表格的形式存在。在TouchDesigner 中，DAT可以当作一个信息中转站，对所有与字符、字符串有关的数据进行处理与收发。  

![images/5ed266fbc1e44b318f370c8832b73a2389cfc5aeeddaf11d81804deaa2b62bfd.jpg](https://i.imgur.com/GLOA1Zo.webp)  
图1-4-16DAT元件家族  

![images/335157cc83863ab4e7251488b565be73763e1436c13817741aa4605b4841dfaf.jpg](https://i.imgur.com/FldjTM4.webp)  
图1-4-17TextDAT与 CHOP ExecuteDAT  

TouchDesigner中的编程命令（Python指令）都是在DAT元件中运行的。在本书后面的章节中，我们会看到很多利用CHOPExecuteDAT元件进行不同事件的触发；而最基础的Text DAT元件可以执行任何Python 3的代码。TouchDesigner 会自动与系统所安装的 Python 库进行同步，可以直接在元件中导入任何已安装的库，无需进行任何配置。当然了，强大的 Python 语言也是Al（人工智能)的基础，这给用TouchDesigner进行人工智能开发提供了无限的遐想空间。  

此外，DAT元件还提供了对文件夹系统与表单系统的检索和导入／导出方法。利用 Table DAT（表单）、File In DAT（导入文件）、Folder DAT（导入文件夹）等元件可以很快地在TouchDesigner中动态地检索本地所有文件，同时进行文件的动态存储与读写操作。  

DAT 对于多协议的支持也让 TouchDesigner 与外部的信息交互变得更加便捷。TCP/IP DAT 与 UDP In/Out DAT 让网域通讯变得简单明了;Web/WebSocket DAT可以直接像爬虫一般抓取网页信息；Multi TouchIn 和 TUIO 协议的出现更是让触摸交互类型的项目制作变得易如反掌。当然，DAT同样支持 C++ 的编写，CPlusPlus DAT 的存在让其拥有了更强的扩展性。  

![images/c21b9e0d2df85602284b734f11c750b2417f18d12676f5ab0dc96fa1ce568b65.jpg](https://i.imgur.com/JUskKKt.webp)  
图 1-4-18Python 代码与 FadeCandy 进行通讯 (图片来源:Joe Ohara)  

##### COMP 类型元件

准确地说COMP（Component Operator）是一系列“容器”元件,是在所有元件类型中唯一一种内部可以放入其他类型元件的元件。“容器”的功能不仅有将元件组整理分类的功能，同时也是进行窗口显示和渲染的必要条件。在这个元件大类中，又有4个小类，他们分别是 3DObjects、PanelS、Other 和 Dynamics COMP。  

![images/f3714ee44a741d26676489ac56ad19bde644eac61ddc8f00e900962177cd1fd8.jpg](https://i.imgur.com/kETCDLX.webp)  
图1-4-19COMP元件家族  

![images/2c450f5c35be152652fb4b213542ab408401ea852070c42ece2528e3dcb9928b.jpg](https://i.imgur.com/o2QwTCU.webp)  
图 1-4-20 Geometry COMP 与 Button COMP  

3D Objects 包含了一系列和三维渲染有关的非模型元件。Bone COMP 和 HaNDIe COMP 可以制作骨骼系统；LightCOMP、Camera COMP 和 Geometry COMP 是将三维模型进行渲染的“三大件”。对于所有从外部导入的模型和动画,都会生成为COMP类型元件，强大的外部解析系统支持.fbx、.obj、.3ds、.dxf、.dae、.abc等格式，而USD COMP更是支持了.usd、.usda、.usdc、.usdz等皮克斯影视制作工作流中相关文件的导入与渲染。  

Panels 是所有UI 组件的集合。TouchDesigner 提供了包括 Slider COMP（滚动条）、Button COMP（按钮）、FieldCOMP（输入栏）等基本插件。在 2019 年，最新开发的Widget COMP 加入到TouchDesigner 的大家庭中来，这套UI整合系统代表着Ui制作在TouchDesigner中变得更加快捷和方便。  

Other包含了其他一些不属于任何范畴，但是极其重要的元件。BaseCOMP用来构建非视觉界面类型的模块；Animation COMP 是 TouchDesigner 中的动画系统，可以手动设置动画关键帧；Replicator COMP 是元件复制器，我们会在本书中进行详细介绍；而 Window COMP 是所有渲染或者视觉输出的最后一道程序，把在TouchDesigner 中编辑的结果进行屏幕输出，或者投影输出。  

Dynamics是用来制作动态刚体碰撞等物理效果的一系列元件。  

如图1-4-21，通常一个具有复杂功能的项目都由不同的UI模块组成人机交互界面。TouchDesigner多样的Ui类型为用户提供了更多的制作选择和组合方式。  

![images/c23d5c9bff0ad4934f408edb298964a2e55cd8b38c2216d5f358287879f8eeb8.jpg](https://i.imgur.com/sCmgpch.webp)  
图1-4-21利用不同COMP元件制作的VJ界面控制（图片来源：Derivative)  

##### 元件之间的相互转化

在不同元件之间，是可以互相进行类型转换的。由于数据之间的类型不同，我们通过TouchDesigner中一些特定的转换元件来完成这个过程。  

CHOPtoTOP元件将CHOP中的通道或数值转化为TOP图像。所有CHOP中的数会被转化为图像中的R（红）、G（绿）、B（蓝）、A（透明度）四个通道并在TOP中进行显示。如果CHOP中是由很多通道组成的，那生成的就是一张含有多个像素的图像，如图1-4-22。  

DATtoCHOP元件将数据表格转化为通道的形式进行输出，如图1-4-23。  

![images/12e146d487c23040899ee731ae67313ce4f4208b10ee1c165d719d79324c7a75.jpg](https://i.imgur.com/7Yn2vAz.webp)  
图 1-4-22CHOP to TOP 的转换  

![images/34f8bc9b207bb1797e8a19a16933625880d5681beb510845e6b6c658def7f00d.jpg](https://i.imgur.com/jXYpq9U.webp)  
图 1-4-23DAT to CHOP 的转换  

SOP to CHOP 元件将所有空间三维的点x、y、z 以及法线坐标转化为数组形式，如图 1-4-24。  

![images/7312a1eec80aa114d959e15c2289c0fe740d230dc1099014b825bc5af23248ec.jpg](https://i.imgur.com/uchuX8p.webp)  
图 1-4-24SOP to CHOP 的转换  

TOP to CHOP 元件将图像中的像素转换为 R、G、B、A 四个通道进行输出，如图1-4-25。  

![images/686d0e280d02eaadb25d1951d910f88b372969880b7c9455afa8de1c5ee2f563.jpg](https://i.imgur.com/CGFJS8m.webp)  
图 1-4-25TOPto CHOP的转换  

CHOPtoSOP元件将不同数组转换为三维空间中的顶点坐标，从而结合参照模型生成新的模型形态,如图 1-4-27。  

![images/ab43383937a273161a46c91307062eb1a7cb033c275da345ca4ba0397578d573.jpg](https://i.imgur.com/Kl6A8bn.webp)  
图 1-4-27CHOP to SOP 的转换  

DAT to SOP 元件将数据表格中的顶点坐标转换为三维空间的模型，如图1-4-26。  

![images/5e47caf25b171848b7a5a41bf32c35780fc338933fe5155ee4059d355252a72d.jpg](https://i.imgur.com/gkbZkwX.webp)  
图 1-4-26DAT to SOP 的转换  

##### 鼠标的使用

在 TouchDesigner 中，鼠标是最重要的控制设备。所有的操作都需要一个带有滚轮的鼠标来完成。  

鼠标左键：移动编辑区拖动元件进行引用；如图 1-4-28，拖动移动单个元件；如图1-4-29，长按连接不同元件。  

![images/517510a5725884a532fde50eaa833b5ae90984433673fc51031f162283bcede4.jpg](https://i.imgur.com/fKnx24z.webp)  
图 1-4-28鼠标左键拖动移动单个元件  

![images/f2a02acb1f9c58cacd96c70dd5f763605b0068b9fd1bce899ac85e35ed4eaed2.jpg](https://i.imgur.com/kgBlgug.webp)  
图1-4-29鼠标左键连接不同元件  

鼠标中键（滚轮）点击：如图1-4-30，查看元件属性。  
鼠标滚轮滚动：进入与离开COMP元件；浏览不同层级的编辑区。  

![images/afaf30276bf03ee5ec3dfa6d14080a00c2938115294992f15d3a9c733eb47269.jpg](https://i.imgur.com/XizFvO4.webp)  
图 1-4-30鼠标中键查看元件属性  

鼠标右键：单击，对编辑区执行命令；单击，对单一元件执行命令，如图1-4-31；按住拖动，对所有选取元件执行命令，如图1-4-32。  

![images/d9d28147e3953102c6d1c793cca485b50c245c32db4bd49104c3d2e06efd6d7e.jpg](https://i.imgur.com/mEzqUvP.webp)  
图1-4-31鼠标右键对单一元件执行命令  

![images/9b77cf7eaacbb527415a706ac9baa743ed7c47db0ce772e22a9e395513db1c4c.jpg](https://i.imgur.com/snlZPac.webp)  
图1-4-32鼠标右键对所有选取元件执行命令  

## 1.5 元件属性、多元件连接、元件引用与层级关系  

TouchDesigner 中每个元件都执行简单的特定功能，一个优秀的 TouchDesigner 作品往往是将多个元件进行结合,完成一项复杂的操作。在 TouchDesigner 中，元件之间的关系可以通过连接或者引用参数完成。而所有数值之间的引用依据都与层级关系有关。  

##### 元件属性

每个独立元件都有各自的元件属性，不同的属性功能区域略有差异，这里我们用一个CHOP 类型文件来解释。  

1．元件功能区 (如图 1-5-01)  

$①$ 关闭／打开显示区：关闭显示时，显示区只显示元件名称，减少CPU的计算量；  
$②$ 克隆免疫：在克隆组件中成为独立元件，不受克隆模式影响;  
$③$ 跳过／连通元件功能：跳过当前的元件功能，让数据直接传输到下一个元件；  
$④$ 锁定：将当前的处理结果进行冻结和锁定，并且将结果储存于工程文件当中。  

2．元件属性区 (如图 1-5-02)  

$①$ 背景显示：所有元件当前的处理结果都会在这个区域进行显示。点击区域 $③$ 的蓝色圆点可将其放大在编辑区作为背景播放;  
$②$ 元件名字：可以自定义当前元件的名字;  
$③$ 引用标识：当绿色圆点亮起时表示当前元件被其他元件引用；当蓝色圆点亮起时表示显示区 $①$ 的内容正在编辑区中显示;  
$④$ 编辑／拖动状态：点击加号可以打开变为编辑状态，将元件拖动到其他参数中进行引用，在CHOP中的使用特别广泛。关闭时元件变为移动状态，可以通过鼠标将其在编辑区内移动。  

![images/6758594fd9e66fcfa0f04604a529e9a413ee891b879760674de03d5cb9d63df3.jpg](https://i.imgur.com/Fe1HkRV.webp)  
图1-5-01元件功能标识图  

![images/82ca95e46f6f3b17ca0b92225c6096fab11ecba7fcada1427e3e0a49c3dc81d6.jpg](https://i.imgur.com/hFZhnxt.webp)  
图1-5-02元件属性标识图  

##### 元件之间的连接

TouchDesigner的数据由左向右传递，每个元件中，左侧的接口为输入口，右侧的接口为输出口。因为功能差异，大多数元件有多个输入及输出口，但某些元件没有输入或输出口。  

TouchDesigner 之间元件的连接遵循以下几种规则:(1）只有颜色相同的输出端与输入端才能相互直接连接;  

![images/078d8b52725849de77cf40f6e0b78f7049e819d7994629184b9586a59061c084.jpg](https://i.imgur.com/8Tsgpxf.webp)  
图1-5-03同色元件可以直接连接  


(2）输入和输出端通过不同的标记图形来标识是多连接口还是单连接口。如图1-5-04，左边两个元件没有输入口，各有一个输出口，而右边的元件有多输入口和一个输出口；  

![images/5984d826182e012c29df3556c95e50775992199687fcbe8b6149b823f3b9fb86.jpg](https://i.imgur.com/CcvVUu9.webp)  
图1-5-04多连接口与单连接口  

(3）如图1-5-05，除了特殊情况外，不要让不同元件之间形成环路，这在大部分时刻会造成程序出错。  

![images/0257b34aedb08db9909648c67808eb9bf8df257fb2b93cca4b01bb411039b985.jpg](https://i.imgur.com/Cewml7g.webp)  
图1-5-05形成环路出现警告  

我们以TOP为例，将一个元件的输出口连接到下一个元件的输入口，就实现了数据的传递。如图1-5-06，MovieFile InTOP（左）元件导入了一张图像。通过连接，这一图像被传递到下一个元件LevelTOP（右），LeVelTOP将输入进来的图像的亮度提高了。  

![images/97e00f942699f8c982eb9244a85bdc1432e44efca0f6797cb4735ef503e15d62.jpg](https://i.imgur.com/53qMvP1.webp)  
图1-5-06TOP数据在元件间进行传递  

如图1-5-07，ConstantCHOP（左）的数据是chan1通道内的数值0.4。通过连接，这一数据传递到下一个元件MathCHOP（右），经过设定的参数处理后，MathCHOP将输入进来的数据放大了10倍，chanl的数据变成了4。  

##### TIPS  

对于不同类型的元件，要彼此传递数据需要通过引用的方式。不同于直接的连线方式，引用指的是将元件中的某个变量作为一个数据被另一个元件的参数所使用。引用也适用于元件间的数据交流，最常用的是CHOP类型在不同元件之间的引用方法。具体引用方法操作如下：  

![images/5afb0df89589aebd203f817842d977d0bb66ab986b91b65ecbfec3b067a6d382.jpg](https://i.imgur.com/o39ZQBC.webp)  

##### 元件引用

如果在元件的右上角出现感叹号或者叉号时，代表当前元件异常。感叹号代表的是警告，本元件依然能对输入端进行处理，但是输出端与预期不同；叉号代表的是出错，本元件由于某些设定的错误，不能对输入端进行处理。  

如图1-5-08，点击CHOP元件右下角的小加号，进入编辑模式。鼠标放在CHOP元件上，长按鼠标左键拖动到需要的参数上。松开鼠标后弹出引用方式框，如图1-5-09，然后根据需要选择引用的方式。  

![images/943e446497a21077c1e7c65a8469e6533bda82bb309038e85132b1b311d4b05a.jpg](https://i.imgur.com/5X58UtN.webp)  
图 1-5-08拖动CHOP元件到需要的参数上  

![images/bda945558951e4e4c8df9232f14c8868f4d19bf13ce0fa92bf0070e2d87a49b0.jpg](https://i.imgur.com/b7xGnip.webp)  
图1-5-09松开鼠标弹出引用方式窗口  

![images/7b1920a922866e28e94fd7cb311af2c8544c6f5712b6705e44d652b92a9fd6e7.jpg](https://i.imgur.com/I5SVrbl.webp)  
图1-5-07CHOP数据在元件间进行传递  

如图 1-5-10，在 TouchDesigner 元件的菜单中，每个变量都有 4种使用数值的方式：Constant Mode 常量模式（灰色）、Expression Mode 表达式模式（蓝色）、ExportMode导出模式（绿色）以及BindMode绑定模式（紫色）。除了常量模式外，另外三种方法就是引用。  

![images/2c8f3b66164e7870a6b4362cdfd73b73bce755e8392cc62d1a9cf1fa6f31b4b8.jpg](https://i.imgur.com/bRXNvLx.webp)  
图1-5-10四种引用数值的方式  

Constant Mode常量模式（灰色）是指在元件参数内输入一个确定的数值、字符串、路径等，输入之后参数不再发生变化。  

![images/864e07abf20bcbe6a6251efc600c3a7a2bd9d9ee2d0acf5887d7c90cf0e27ce4.jpg](https://i.imgur.com/hg9MttG.webp)  
图 1-5-11Constant Mode 的使用  

Expression Mode 表达式模式 (蓝色)可以通过 Python 或 Tscript 语言为参数设置一个变量。通过这种方式，如图 1-5-12,Level TOP的Opacity参数引引用了'constant1'中'chanl'的数值。当名为'chanl'的数值发生变化时，“levell'中的Opacity（变量）也会随之发生变化。  

![images/a767d3b7a129628cb33221e528e947c34de4e9336210b14009c83edb9dba8094.jpg](https://i.imgur.com/wRQMlRy.webp)  
图 1-5-12Expression Mode 表达式模式  

Export Mode导出模式（绿色）主要用于直接引I用CHOP的通道。同样是上面这个案例，“levell'的 Opacity 参数也可以通过Export Mode 将'constantl'中'chanl'通道的数值作为参考。  

![images/59ba8ec894d4ed2a56e7d8571118da66624929a679af7e7a9294a55e6e1a90e6.jpg](https://i.imgur.com/anUbhO6.webp)  
图 1-5-13Export Mode 导出模式  

当使用导出模式或者表达式模式时，直接拖动该参数的滚动条会令引用方法失效，变回常量模式。导出模式与表达式模式的区别在于：  

(1）表达式模式可以在直接引用的基础上写上更复杂的运算公式;  
(2）导出模式在计算速度上比表达式模式更快，但是只有在数据非常复杂的情况下才会有比较明显的耗时区别。  

Bind Mode 绑定模式（紫色）是 2019 春季更新后推出的引l用方法，通常用于父子层级间。与 Expression Mode 和Export Mode 不同，通过 Bind Mode 相关联的两个参数，当其中任意一个发生变化，另一个都会随之改变。如图 1-5-14,'containerl'的×参数和'constantl'的 valueO 参数通过 Bind Mode 相关联，这意味着，当我们改变'container1'的×参数时，‘constantl'的valueO参数会同步发生变化，反之亦然。  

![images/a4fd0d30ddb515478067219f1f42fd1363becb5ea0cf378966403ba93daf355d.jpg](https://i.imgur.com/QeEukFa.webp)  
图 1-5-14Bind Mode 绑定模式  

在TouchDesigner中，元件与元件间可以彼此连接形成元件网络，这样的网络还可以包含父子层级关系，例如在ContainerCOMP、BaseCOMP等COMP 元件当中，我们可以放入其他元件成为它们的子元件。因为层级关系的存在，当我们引l用某一元件时，需要用具体路径来确定其所在层级。如图1-5-15，在主界面中当前所在层级的路径显示在路径栏。  

路径有两种表达方式：绝对路径与相对路径。绝对路径，即是从最上层级“／”（根目录，是TouchDesigner 网络中最高的一个层级）开始，自上而下依次标明元件所在的层级关系。如图 1-5-15，元件'moviefilein1'的层级为根目录中'projectl'元件内'containerl' 内的名为'moviefilein1'的元件，即绝对路径是 /project1/containerl/moviefileinl。  

![images/f83a971e4bd6fef1ad5b1084d8fb57aacdde44694538e6773f6bda561d431210.jpg](https://i.imgur.com/mdIEsCO.webp)  
图1-5-15层级关系  

使用鼠标中键点击特定元件，可以在信息框中看到Name一栏所标注的就是元件的绝对路径。  

![images/b9edfea864d2fb960e760f1772ce9bb33f173d3cbae8b93bbe593acaa99db5ab.jpg](https://i.imgur.com/riX5PkS.webp)  
图1-5-16元件绝对路径查看  

使用绝对路径的优点是，只要被选取对象的绝对位置不发生变化，那么这一路径在任何一个层级都是有效的。如图 1-5-17，元件'selectl'通过/projectl/containerl/moviefilein1 的绝对路径，选取出了根目录中'projectl'元件内'containerl'中的名为'moviefileinl'的元件作为其参数。  

![images/979a3f75d4b021799af5ccdc935342ca219809cd1a07f1b336d2e6661bcbb4b4.jpg](https://i.imgur.com/8dFAnRK.webp)  
图1-5-17使用绝对路径  

相对路径，则是从当前所在的层级开始，通过“/”（上一级）和“./”（下一级）的相对位置，标明元件所在的层级关系。如图1-5-18，元件'select1'通过.moviefilein1的相对路径，找到了位于其上一层级中名为'moviefileinl'的元件。使用相对路径的优点是，只要选取和被选取元件的相对位置不发生变化，路径始终有效。  

![images/6e8b681bb1cc665f89821a5ee3382236bc23d5654cd5e0c495d3d9571e12af77.jpg](https://i.imgur.com/67UcAaV.webp)  
图1-5-18使用相对路径  

## 1.6 如何从软件中寻求解决问题的办法  

TouchDesigner 不仅是一款创意编程软件，更是一个新媒体艺术爱好者群集的大社区。在学习过程中遇到问题，可以通过不同的途径得到解决。下面，我们为大家总结了以下几种官方解决方式。  

##### 元件解构案例 Operator Snippets

元件解构案例 Operator Snippets 位于 Help 菜单，是 TouchDesigner 自带的元件解释库。在 Operator Snippets 中,开发团队以精简的示例演示了元件的使用方式，非常直观便于理解。大多数元件都有相关的 Demo 演示和相关解释。  

![images/6bab0fdc6fb9589e0b760c32fec15dd67ce403aef8a98144c0f78b7f530da69a.jpg](https://i.imgur.com/eG9ZPGj.webp)  
图 1-6-01  Operator Snippets 界面  

##### Help 帮助文档

如图 1-6-02，点击元件参数页面的 Help 选项，则会跳转到 Derivative 官网的相关元件页面，如图 1-6-03，这是TouchDesigner 最全面、最细致的元件技术参数文档，解释精确到每一个元件的每一个参数。  

![images/abfb3358b60c0fe6e83f18db6a93c2137541ee74a47eac57c931266896e666c4.jpg](https://i.imgur.com/6bvBEMm.webp)  
图1-6-02　点击 Help  
图1-6-03官方元件解释文档  

##### Python 帮助文档

有关元件的 Python 指令问题，可以在其参数页面点击 Python Help，如图 1-6-04，进入到官网的 Python 指令帮助文档进行详细的查询，如图 $1-6\cdot05_{\circ}$  

![images/1c3fe9851f3bca44f5c4c6413f046ff2ad8a19629a47f17e5af65b8ed6e6bca9.jpg](https://i.imgur.com/3b4m4JY.webp)  
图 1-6-04点击 Python Help  

![images/a8acca83497d27ea50e2ca5ccdf8d8bd3bd9f522dce29549f941ba9cab6f30e7.jpg](https://i.imgur.com/fTOnZRB.webp)  
图 1-6-05官方 Python 指令帮助文档  

##### 官方教程

如图1-6-06，控制选项区域的三个按钮分别通往Derivative官方的百科查询页面、论坛、官方教程页面。用作参考之余，也可以在论坛上发帖寻求来自世界各地TouchDesigner用户的帮助。  

![images/368942f97ac5ac5a9bc1c03c1a09df724bc20463c0e781202f998354e9ce6ffd.jpg](https://i.imgur.com/Co55Uac.webp)  
图 1-6-06控制选项区域  

百科查询是TouchDesigner最主要的文档查询平台。除了前面提到的元件与Python 帮助文档，还包括了各个版本的特性介绍、开源代码共享、FAQ 等内容，是一个巨大的TouchDesigner 帮助和查询平台。  

![images/a93e7df27e3f6648eddffc8f95ff442a87f8f404aa4d88330e43dc14a69c521e.jpg](https://i.imgur.com/B98p85I.webp)  
图 1-6-07TouchDesigner 的官方百科查询页面  

FORUM（论坛）是TouchDesigner 的官方论坛，有众多的疑难问题被发布在此,通过众多的用户集思广益进行解答。此外，还有包括 Bugs 发布、用户共享.tox 文件，以及全球招聘启事等内容。  

![images/0a2058364f0f0643da993c4500919fba325627325ba3f1a1995431c793561a6d.jpg](https://i.imgur.com/c0oIJMv.webp)  
图 1-6-08TouchDesigner 全球官方论坛  

TUTORIALS（官方教程）是 TouchDesigner 官方收录的各类官方 Workshop 及各类用户经过审核的高质量教程。此外，还有很多基础教程及有趣的 TouchDesigner应用，可以进行参考和学习。  

![images/ba9f137b8dfcda21bbec999d0050549ccb0f05f90b8334c71f32937774078aa4.jpg](https://i.imgur.com/Jzhj4GN.webp)  
图 1-6-09Derivative 官方提供的 TouchDesigner 教程  

## 1.7 如何使用本书

##### 内页图文讲解部分

本书的教学将TouchDesigner 的主要编程思维和重点功能分解到不同的小章节中，以实战案例的形式呈现在书中。这些案例都以图文形式进行了细致讲解，难度循序渐进，让读者能够跟随案例的思路亲身实战，一边做作品，一边学技能。下面我们看一下本书的章节结构：  

![images/f0f025e45b3763290b7cbdb22a14b7e7397f18a66e38758d4b1a1e63b3a7fe4b.jpg](https://i.imgur.com/c8ZFy2F.webp)  
图 1-7-01页面图文讲解  

##### TIPS  

TouchDesigner 的其他要点知识、拓展内容都以随文 TIPS 的方式为大家做了重点标注。在跟随图文讲解完成案例的同时,不妨阅读一下这部分内容，做到“知其然亦知其所以然”。  

##### 参数标示与非默认参数按钮

设置元件参数时，图文讲解的配图中参数页面居右，对应的是其左侧绿色框选出的元件。需要修改的重要参数会标有醒目的提示框，如图1-7-02，黄框所示。  

![images/9536193d10da5fdc173be05c4efc6046bd18051af4a1d4033eab113724922c8a.jpg](https://i.imgur.com/32rg6WC.webp)  
图1-7-02元件参数界面  

特别需要注意的是，由于本书页面大小的限制，当一个元件有多个参数需要修改，且这些参数跨多个参数页面，我们会打开“非默认参数”按钮以方便展示所有的被修改参数。只有被修改过的参数会显示在窗口中，未被修改过的参数就会被隐藏。这也是一个非常方便的小技巧，在本书编辑的过程中，我们在部分参数区中会开启此功能。  

![images/00ea52721786be81732e1ab03943d3f4c0208e5b53b4a310046dbd12cda8f665.jpg](https://i.imgur.com/9Vl01BN.webp)  
图 1-7-03打开和关闭默认参数的效果  

##### 元件索引

在本书的最后，提供了书中涉及到的部分元件的索引（参见第 308 页）。大家可以通过翻阅索引快速查找元件的使用方法。  

##### 相关素材下载

本书中的案例.toe工程文件和相关素材，都可以通过访问此网址前往下载：  

toefile.tea-community.com  

![images/16c542a107b19247c104edadfd456e340b87207c0046e20399a3aba8fcc3016a.jpg](https://i.imgur.com/1MAyaSm.webp)  
图1-7-04扫码打开下载网站  

为了方便大家关于硬件章节的学习，本书中涉及的硬件设备可以在网上自行选择购买，如有特殊需求或关于工程文件等其他问题，请联系本书审定团队 TEA Community（info@tea-community.com)。  


# 第2章 实时视觉效果处理

![images/d08959c9a9165ae61d65987a69bb19bdb1f70a26b2d52b45b50abfe4adb5c65c.jpg](https://i.imgur.com/JPWkkoG.webp)  

##### 实时视觉效果处理

第一次接触TouchDesigner，大部分人一定会为其强大的实时视觉处理能力所惊叹。通过不同的组合方式和创造手段，所有人都可以在短时间内创作出令人印象深刻的视觉艺术作品。  

今天，新媒体艺术不再是一个离我们很遥远的领域，每个人都可以利用TouchDesigner 在这个领域进行高效地思考、学习和创作。让我们开始这章的学习吧。  

## 2.1 简单的图像处理

本节我们将学习如何运用最基本的TOP 类型元件来制作切换输入画面、滤镜效果的功能，并且将画面全屏显示。此外，我们还会了解将画面录制导出为视频文件的基本方法。  

### 实战案例: 实时处理图像的滤镜组  

无论是在VJ演出还是视觉呈现的项目中，我们都会用到大量的内容进行二次叠加创作和滤镜制作。TouchDesigner将原始视频或者素材进行图像处理，用实时渲染的方式带来不一样的视觉体验。在TOP元件中，有非常多的图形处理元件，同时可以将不同元件以“并联”或“串联”的方式加以制作，用“连连看”的方式来制作不同的视觉模块。  

![images/e15ccfe37d4e22f084c7aaae02625b983ee2dab5966ac21e75930afe7e0f3e7a.jpg](https://i.imgur.com/mxvrPs3.webp)  
图 2-1-01在编辑区的最终效果预览  

>在制作各类滤镜之前，首先导入需要添加效果的图像。这里我们挑选了三种有代表性的输入图像：通过MovieFileInTOP'moviefilein1'通过此元件可导入画面完整的视频或图片文件；通过MovieFileInTOP'moviefilein2'导入蓝、绿幕视频或者图片文件；通过VideoDeviceInTOPvideodevin1'视频设备输入TOP元件，导入摄像头实时画面。  

![images/f08a1f6bf1c204d91ea60ab839ee815bfaaed8fd8f3cb3b50f3912bfc37c1346.jpg](https://i.imgur.com/9vRYrws.webp)  
图 2-1-02输入图像之间的切换  

![images/ced9e85faa0acd038aae95a4433fc7bb95863f9a9a8ff0b447cf28e2462136db.jpg](https://i.imgur.com/jFzkOp1.webp)  

File（文件）：指定文件路径。除了本地路径，也可以为互联网上的地址。  
Reload（重新加载）：重新加载所选文件。  
Play（播放）：视频的播放与暂停。  
Cue（提示）：从提示点开始播放视频。  
CuePoint（提示点）：设置提示点。  

将两个 Movie File In TOP 与一个 Video Device In TOP元件作为输入端，三个输入图像通过SwitchTOP'switch1'元件进行切换。  

##### 滤镜效果一：勾边效果的使用

勾边是一个简单而有趣的视觉处理模块，Edge TOP元件会通过判断输入的二维图像来制造勾边效果。结合其他着色元件，可以创造出线条变换的有趣画面。在switch1后添加 EdgeTOP'edgel1'。  

![images/f8be8e4846395cdcdc5a5f82827e7ec766c97f7309b9cba2d5e4ba4fa827267e.jpg](https://i.imgur.com/Y00joLv.webp)  
图 2-1-03使用 EdgeTOP 添加描边效果  

本案例中，我们会用到Composite TOP 元件，其功能类似于 Photoshop 和 After Effects 软件中的图层叠加的概念。通过不同图层的顺序叠加，制作出不同的实时动态视觉效果。此外，Ramp TOP 元件也是在TouchDesigner项目中被大量使用的元件，通过不同的模式制作出不同的渐变效果，从而可以进行图像的二次叠加。现在，我们开始动手吧！  

##### Switch TOP

![images/648af914edac5e2a36b64881f8aceccf2c011ca932f63f752aca6c0554d5caab.jpg](https://i.imgur.com/4HuUh6z.webp)  

Index（索引l）：通过设置参数选择其中一个对应输入端进行输出。  

BlendBetweenInputs（渐变切换）：允许输入端之间渐变切换选项。关闭，各输入之间的切换是无过渡的“硬切”；打开，输入之间的切换是有过渡的“软切”。各输入排列顺序在Switch的菜单最下方，点击左侧箭头调整顺序。  

![images/bf7a939efb45dcf6c560c04f984773292f7ff926bf0450fd6bcfb4c903463e22.jpg](https://i.imgur.com/YjQvyRb.webp)  
Edge TOP  

Select（勾边参考量）：选择根据图片的亮度、RGB 值等进行勾边。  

BlackLevel（勾边精度）：数值越高，勾边的细节越少。  
Strength（勾边强度）：数值越高，勾边越明显。  
EdgeColor（勾边颜色）：勾边线条的颜色。  

新建 Ramp TOP'rampl'，Type 参数选择 Circular（圆形），也可以尝试不同的样式，Period（周期）设置为 1.62（不同的数值决定了图案中的重复数量），自定义色谱的形态和颜色。用 Composite TOP'compl'将'edgel'与'rampl'合成，Operation（叠加模式）设置为 Multiply（相乘）就可以得到彩色的勾边。为了保持图像分辨率，需要将 Fixed Layer（固定图层）设置为 Inputl。  

##### TIPS  

Fixed Layer指的是以第一或者第二个输入端的分辨率为输出分辨率，当前两个输入端分辨率不同时，可以通过Pre-Fit Overlay 中 的参数选择拉伸模式。  

![images/0c40c6e643cb0d6a88b82e9dd8e964059e6c217136d194d4502dcb8ba2958405.jpg](https://i.imgur.com/xSBzPLi.webp)  
图 2-1-04利用CompositeTOP的叠加模式将RampTOP与EdgeTOP进行叠加输出  

##### Composite TOP

![images/86ef299ce2f9b5ae7a3c4c66318f7d8373ce8969b4a859d17c1006a9d2755ee8.jpg](https://i.imgur.com/DkCbOfW.webp)  

![images/b7f8848dc4e942b11d738dbf37f3f32a16336daacab7998f8c505edeac1c6f89.jpg](https://i.imgur.com/lDH0RIz.webp)  

RampTOP可以用于生成色谱，点击参数页面色谱上方的空白处可以添加关键点，拖拽关键点到色谱外可以删除关键点。  

Type（色谱类型）：可以选择Vertical（垂直）、Horizontal(水平）、Radial（放射）、Circular（圆形）四种类型。Phase（相位）：调整渐变区的偏移量。  
Period（周期）：调整渐变区域的宽度范围。  
InterpolateNotches（关键帧之间的过渡）：改变关键帧之间颜色的过渡类型。  

![images/ba9d4b1bcd41cede3c1b7a11a3766e6b2e02f790dff9833ae49fab9781bad813.jpg](https://i.imgur.com/UiJdPR4.webp)  

Operation（操作）：参数中提供了多种图像的混合方式。  

![images/cb01031ef528d974822235c53fe4e25d1dd842cde91e54a150028414513be10c.jpg](https://i.imgur.com/GNAUrxS.webp)  

Fixed Layer（固定层）：将输出图像的分辨率对应Inputl或Input2的分辨率。  
Pre-FitOverlay（适应覆盖层）：设定覆盖层分辨率的适应类型。  
JustifyHorizontal（水平对齐）：水平对齐的方式。  
JustifyVertical（垂直对齐）：垂直对齐的方式。  

]滤镜效果二：利用RampTOP和LookupTOP来重置画面颜色，制作不同感觉的效果  

在开始之前，我们来理解一下 LookupTOP的原理:LookupTOP会分析第一个输入端每一帧图像中每一个像素点的Value值，也就是我们常说的明度值，越亮的部分Value值越大，越暗的部分Value值越小。  

![images/18bd76c18b024122e02c30b378b1ecac01ef5a5d6ac82c5a184687ecb787936d.jpg](https://i.imgur.com/mpR4oak.webp)  
图2-1-05LookupTOP根据亮度重新填充色彩  

同时，LookupTOP会参照第二个输入端图像的左右像素分别填充第一个输入端的内容。第一个输入端越亮的部分，会被第二个输入端图片越右边的像素颜色进行填充。反之，第一个输入端越暗的部分，会被第二张图片越左边的像素颜色进行填充（透明部分会被视为全黑）。  

准备好后，就让我们开始吧！使用MonochromeTOP'mono1'单色TOP元件将彩色图像变为黑白图像，这样,就可以很明显地看出图片Value值的分布（也就是我们俗称的亮暗画面的分布）。  

![images/18a17d989dd5982784c263694fe208b7c43fb0166f830c73e958904915efd773.jpg](https://i.imgur.com/Q3iettl.webp)  
图 2-1-06MonochromeTOP可以将彩色图片变为黑白图片  

##### Monochrome Top

![images/aafd7e03d36b1d925a02315b62a52994033a5b50f75ca94d03226fb4079070bf.jpg](https://i.imgur.com/WScUcke.webp)  

Monochrome（黑白）：调整图片中的显色度。0是全彩图，1是灰度图。  
RGB（RGB值）：以输入图像RGBA其中一个通道作为黑白通道的Value值。  
Alpha（透明度）：以输入图像RGBA其中一个通道作为黑白通道的Alpha值。  

新建 Ramp TOP'rampl′，新建 Lookup TOPlookupl'，以'mono1'为第一个输入，'rampl'为第二个输入。调整'rampl'的水平色谱可以给图像不同灰度的部分换上不同颜色。同时，可以尝试去创建不同的色谱效果，来理解和创作不同的输出效果。  

![images/caa276b50af778efc4f363b68da16cdd0e8dc2a5a23cc3b891f5059da9870f5e.jpg](https://i.imgur.com/Wb8E9Wf.webp)  
图 2-1-07 Lookup TOP 通常和 Ramp TOP 一起使用  

##### 滤镜效果三：抠像效果与背景替换

在电影制作和录影棚中，我们常常能遇到绿幕制作的情况。绿幕可以很容易被去掉，并且将其他背景叠加上去。TouchDesigner实时抠像的过程，让大家可以直接更换背景。  

首先，将'switch1'的参数 Index 设置为 1，也就是选取第二个输入端，这样就得到了带有绿幕的图像。添加 ChromaKey TOP'chromal'，抠除图像中特定的颜色区域。这里选择一个绿幕视频图像，以Hue（色相）为特征量，调整HueMin、Hue Max两个参数，使特定颜色恰好被抠除（在本案例中，将Hue Min 设置为 151，Hue Max 设置为 487）。很多情况下，可以结合色相Hue（色相）、Saturation（饱和度）、Value（明度）多个量来抠除特定范围内的色块。  

![images/8fcd57da010006cf80a3b523dcad1cd9fc28c38f9274d44d89676eaf51711c5b.jpg](https://i.imgur.com/wid8nyB.webp)  
图 2-1-08绿色背景在 Chroma Key TOP 中被直接抠除  

##### TIPS  

![images/42e58cf14100d84f72cd5885201a5841ff57f9a7bd3f36e0867cb05a7d9fb4cf.jpg](https://i.imgur.com/rEtP1z5.webp)  

Hue 的数值是由色相区间决定的，0\~720 横跨两个色相区间，所以如图 2-1-08，Hue Min和Hue Max两个值中间的颜色会被保留，其他部分的颜色会被去掉。  

![images/5423ff6a9cd73ec1e07cf63eae619dbe2b225f6dedbf94e5e02f7c1ce5ebc93c.jpg](https://i.imgur.com/evYKyX2.webp)  

新建MovieFileInTOP'moviefilein3'以导入一张背景图片。接下来，新建OverTOP'overl'，以'chromal′为第一输入端，'moviefilein3'为第二输入端，将抠出的图像置于背景图像之上，如图 $2\cdot1\cdot09_{\circ}$  

![images/4a1367830d368695fb46d335472039b2f7240c841a74907e7914c295ccda1e66.jpg](https://i.imgur.com/eEo0hQe.webp)  
图2-1-09使用OverTOP叠加图像  

然后，我们添加另一个SwitchTOP'switch2'用于切换不同的滤镜效果，并新建NullTOP元件并命名为'bg，如图 2-1-10。  

![images/83ca19432be431c13acdd06c7408051c2da215229f3fe9cf87d172ba9debe1fb.jpg](https://i.imgur.com/zS1aTI2.webp)  
图2-1-10Switch有多个输入端可以通过参数Index选择其中一个输入端进行输出  

##### TIPS  

NullTOP元件除了元件名外没有任何可以调整的参数，它只是对前一个元件内容的复制。便于在进行参数引用时，不需要反复调整元件名称，非常实用。同样每个元件类型都有一个Null元件，其用法都一致。  

ChromaKeyTOP可以结合Hue（色相）、Saturation（饱和度）、Value（明度）将图像中的特定色块抠除，可以在相应的参数页面看到对这些参数的最大、最小值设置。  

在完成了我们基本的逻辑连接和图像处理之后，我们需要有一个方式将生成的元件图像全屏显示，编辑界面作为设计和编程中的操作界面，一般情况下不会作为最终的输出界面。  

所以我们会用到WindowCOMP元件。一般来说，WindowCOMP元件是我们完成所有工程之后要增加的最后一个显示元件。  

我们将需要显示的元件'bg'拖到WindowCOMPwindowl'上（直接鼠标左键选择并拖动元件到指定元件上，再放开鼠标即可），然后选择Parm:WindowOperatoro  

![images/077d3f4a3e88d0298734fae86538b44e3bd9bf3c2a908904e4153286d862202a.jpg](https://i.imgur.com/t9A4wy6.webp)  
图 2-1-11设置显示元件  

在元件‘windowl'的窗口出现了画面之后，我们点击 'window1' 的参数列表里的 Open as Perform Window 后的 Perform 按钮即可看到我们的最终画面出现在了桌面上，如图2-1-12。  

![images/7e832d462d464a54dd8c8b483824cff8f2f3ad0eb5d6fd95cd4c3ef2491ea19f.jpg](https://i.imgur.com/5tvAQMa.webp)  
图 2-1-12呈现最终画面  

但是，我们会发现这个输出窗口并没有全屏，这是因为输入端元件bg的分辨率并不是 $1920^{\star}1080$ ，在没有最大化的情况下是撑不满画面的，并且还有菜单栏的边框。这时候我们只需要在WindowCOMP元件里面稍加设置，将OpeningSize设置为Fill,关闭Border，打开Always onTop，即可得到最终的没有边框的全屏画面。  

![images/92aa6253adae139d5a76eb92891fe61246ad6988d9e74f09dc23c2b7a0b98711.jpg](https://i.imgur.com/AKD93bC.webp)  
图 2-1-13全屏效果  

##### Window COMP

![images/0ccfa34761f2eed56611651ccb9b7ee03cef9f14010d266d93e5b5565f8ba6ab.jpg](https://i.imgur.com/gQv9V0F.webp)  

WindowCOMP对多个显示器进行编辑。  
WindowOperator（窗口操作）：需要显示的对象。  
Monitor（显示器）：输出显示器的编号。  
JustifyHorizontal（水平对齐）：设置水平对齐的位置。JustifyVertical（垂直对齐）：设置垂直对齐的位置。Borders（边框）：打开标题栏，当没有标题栏的时候，鼠标单击视窗，再按键盘Esc 关闭窗口。  
Open asSeparateWindow（以单独输出视窗显示）：在编辑界面之外打开输出窗口。  

另外，在日常使用中，我们常常会使用录屏软件，将显示器上的图像进行屏幕录制，保存成视频或者图片格式在本地。在TouchDesigner 中,我们会用MovieFileOutTOP元件，对输入端的图像进行录屏或者截屏。在本章节的最后，我们添加MovieFileOutTOP'moviefileoutl'，将带有滤镜效果的图像导出为视频或图片文件。  

在'moviefileoutl'中设置好参数 File（文件位置）、Type（类型格式）等，打开Record（录制）选项即开始录制图像，再次关闭Record选项即完成导出，可以前往目标文件夹查找文件。例如，在图2-1-14中参数下，我们将在指定文件夹中得到一个MOV格式的视频文件。  

![images/f1cc13667c54de8ef922cd56e542b003d91522bf1d5d41e1f4cab56af59180e3.jpg](https://i.imgur.com/iy8VQJN.webp)  
图 2-1-14录制参数设置  

##### TIPS  

特别的是，Movie File Out TOP 不仅可以导出视频格式文件，也可以导出图片格式文件。在参数Video Codec中，如果选择图片格式（例如JPEG和PNG），导出的文件格式将是一张图片。  

![images/70dcd7b97ccce19cb43c84fd0d5c0934df865706f763c96d1a23a03c0a616e22.jpg](https://i.imgur.com/omFAXIS.webp)  

Type（文件类型）：视频或图片的格式。  
File（文件）：文件路径与名称。  
VideoCodec（视频编码）：视频的编码格式。  
AudioCHOP（声音文件）：如果有声音输入，可以指定音频文件的路径。  
Record（录制）：开启后视频开始录制，再次关闭时停止录制。  

## 2.2 Feedback Loop 反馈循环

在这一节中，我们将会学习以Feedback Loop 为核心的拖尾变幻效果。作为大量视觉特效的核心,FeedbackTOP将用简单的模式创作出极其吸引l人的视觉效果。  

### 实战案例: Feedback Loop 反馈循环特效  

在众多的视觉效果中，一些带有拖尾、拉拽、缓动、无限循环的效果往往能瞬间吸引我们注意。一些烟雾和水的感觉其实就是粒子系统加上 Feedback Loop 制造出来的。而在 TouchDesigner 中，Feedback Loop无疑就是这么一套元件组。特别要注意的是，Feedback Loop 是由几个基础 TOP 元件组成的，在这个Loop组之上还可以通过增加其他 TOP 元件制造出千变万化的视觉效果。  

![images/49ab34982d161abb203a44fd5bfbe4bd93fe20353d5cb4a08021ef70c10793fb.jpg](https://i.imgur.com/u3c9Xd4.webp)  
图 2-2-01在编辑区的最终效果预览  

〉首先，我们使用Movie File In TOP'moviefilein1'导入图片（在本案例中我们使用默认图片），添加Transform TOP'transform1'，以绝对帧数 absTime.frame 为参考变量改变图像的 Rotate（旋转）参数。  

![images/1007f7dbffe0cd4b987318069f9eda4c055a2650e66360d0f64cbb886be9f0bb.jpg](https://i.imgur.com/RZN1zfj.webp)  
图 2-2-02制作旋转的图像  

##### TIPS  

在TouchDesigner中，菜单里的参数都可以是动态的，或者是被赋值的变量。在Transform TOP的Rotate参数中，我们选择表达式模式（Expression Mode，选择中间的蓝色小方块），这样我们可以通过表达式来控制变量。在TouchDesigner 中，有一系列的内置表达式，而 absTime.frame 和 absTime.seconds 就是最常用的两种表达式。absTime.frame 的值表示从打开 TouchDesigner 工程文件到当下所经过的帧数，absTime.seconds 的值表示从打开 TouchDesigner工程文件到当下所经过的秒数。absTime.frame 和 absTime.seconds 所产生的数值都是每帧更新的，所以我们经常可以用他们来给一些变量赋值，让变量成为一个连续变化的数值。在本案例中，absTime.frame的使用让输入端图像不停地旋转下去。  

接下来，我们利用MonochromeTOP'mono1'使图像变为黑白的，添加DifferenceTOP'diff1，将'diff1'的两个输入端都连接'mono1，此时'diff1'图像为黑色，因为两个输入图像完全相同没有差异。将旋转参数（Rotate）设置为3，即把第一个图像输入多旋转 $3^{\circ}$ ，这样两个输入产生一定差异，差异部分会体现在'diff1'的图像上，形成一个粗细不均匀的轮廓，如图 2-2-03。  

![images/78266aa3b8c0d40a9988e578fb2b29429dec902720f11d98a7e2788316c6c90e.jpg](https://i.imgur.com/Cxmh4dc.webp)  
图2-2-03利用旋转角度制作图像轮廓  

##### TIPS  

DifferenceTOP有两个输入端，元件会对比两个输入端的相似程度。相同颜色的部分显示为黑色，颜色不同的区域会显示白色；颜色差距越大，输出的白色区域越亮。  

下面为了制造拖尾的效果，我们添加FeedbackTOP。  

##### TIPS  

FeedbackLoop的连接方式一般是由几个基本的固定元件组成，如下图：  

![images/6a4f13e4068ee3008e93551f1492320720ecd4587c9550521b224a76660ade68.jpg](https://i.imgur.com/Rx6tMlk.webp)  

FeedbackLoop将生成的图像进行多次重复处理，就像一个无限循环，再把每一次循环的结果一层层叠加起来（在CompositeTOP中选择叠加模式）。无限循环的操作不会造成计算机崩溃，因为在图层变化到肉眼看不见时，计算机会自动停止计算处理。  

##### Transform Top

![images/1f0d0cdcb71a01c688b31b9cc277ec4cf13fb29220522980ae5bbccee6e3a7f8.jpg](https://i.imgur.com/oS7GCyY.webp)  

Translate（转换）：改变上下、左右的位置。  
Rotate（旋转）：按照角度旋转。  
Scale（比例）：改变大小和比例。  
Pivot（中心点）：改变中心点位置。  
Background Color（背景颜色）：改变背景颜色，以及透明度。  

如图 2-2-04，在制作了整个环路之后，将 Composite TOP 的 Operation 模式改为 Add。之后将Feedback TOP 中的TargetTOP参数设置为comp1（在本案例中，我们的CompsiteTOP元件的命名为'comp1），这样就可以看到一个虚线生成，这代表着每一次'compl'生成的图像都会被再次放到FeedbackTOP元件中进行循环处理。  

![images/79902a9c2acf3533617d680287f052a4a049e5f84d0b761b9ad31170f5e0a6c5.jpg](https://i.imgur.com/q9qcdqz.webp)  
图 2-2-04本案例中的FeedbackLoop 环路  

在 Feedback Loop 的环路中，将 Level TOPlevell' 的 Opacity(不透明度）调至略低于 1，这样反馈循环中的图像每进行一次循环就更加透明一点，直至完全淡出（可以观察拖尾的末端）。同时，通过增加 Blur TOP'blurl'让每一层叠加图层都变得更模糊一点，这就是拖尾的原理和本质所在，如图 $2\cdot2\cdot05_{\circ}$  

![images/98413b329b8fbdd83d613cd00da2f2c377ecb64b3d7cbd58863337bd954f83b2.jpg](https://i.imgur.com/ZY8QZcV.webp)  
图 2-2-05 Level TOP 中的 Opacity 参数可以改变每层透明度  

通过 Composite TOP 的 Add 模式，可将输入端的 DifferenceTOP与FeedbackLoop 的结果进行叠加，在原本的模糊拖尾效果上叠加一个高亮边缘，如图 $2\cdot2\cdot06_{\circ}$  

![images/3c40a0326ec03cb79691735f0e63943b36aff6534df0f071040fc5b1cf151dba.jpg](https://i.imgur.com/Eb4gUYq.webp)  
图 2-2-06Add 前后效果  

新建一个 Lookup TOP"lookupl'，以刚刚做好的'compl'为第一个输入元件，再新建一个Ramp TOP 为第二个输入，就像上一个案例所制作的那样。这样就能通过调整 Ramp TOP 的水平色谱给图像不同灰度的部分赋予不同的颜色，如图 2-2-07。  

![images/4bf682fe085c77b450cfad36a593087c07e2a01048fa4ce988c8cd0c8115e05a.jpg](https://i.imgur.com/BVjO7IQ.webp)  
图 2-2-07 Lookup TOP 和 Ramp TOP 结合使用  

![images/353cc846a446764afe5a6390fe310caed675c1115931a88f0478480b5fc93f3b.jpg](https://i.imgur.com/qUGi230.webp)  

Method（方法）：模糊的方向。  
Type（类型）：模糊的效果。  
Pre-Shrink（预收缩）：在应用模糊算法之前降低画面分辨率的大小。  
Filter Size（过滤程度）：以像素为单位改变模糊的程度。  
Sample Step（采样步数）：横向或纵向模糊拉伸的程度。  
Rotate Kernel（旋转核心）：旋转模糊方向。Dither（抖动）：可以让画面看起来更平滑。  

##### Level Top

![images/539988db51681ccdcbbb88ddbe329ad12ca36a46bfc13b0ff86b93a4dba846cc.jpg](https://i.imgur.com/XkwuWwG.webp)  

Invert（反转）：以色轮为标准反转图像中的颜色。黑色变白，红色变青色，蓝色变黄色。Black Level（黑电平）：数值越大图像越暗。Brightness（亮度）：增加或减少亮度。  
Gamma（灰度）：调整灰阶平衡，此处值为1的时候Gamma没有变化。  
Contrast（对比度）：增加会让亮区更亮，暗区更暗，减少反之。  
Opacity（不透明度）：改变图像透明度。  

有了颜色之后，我们来添加一些形态上的变化。新建一个 Displace TOP'displacel，以‘lookupl 为第一输入，同时新建NoiseTOP'noise1'为第二输入。调整Displace Weight（控制扭曲程度）为0.007，使图像只产生微弱扭曲。  

![images/cbf45559147920300d946a43a79d590d62bd38bf7b45241dbe75889dae0d560f.jpg](https://i.imgur.com/lYK97wU.webp)  

![images/deb7ae5506f790140d2fc692adf9c1d6f55934bb6a3cd1d2b3710ae79bb57b00.jpg](https://i.imgur.com/oCI2EZi.webp)  
图2-2-08DisplaceTOP将输出一个扭曲变化的图像  

![images/646571a36fc630a055d8629c4e71d5366e620a6c510732078084329d37e7e966.jpg](https://i.imgur.com/hgssEQo.webp)  

DisplaceTOP根据第二个输入端中每个像素颜色的变化，对第一个输入端的像素点进行偏移。  

HorizontalSource（水平轴）：可以分别指定Red、Green、Blue或者Alpha作为水平扭曲的参照基础。VerticalSource（纵向轴）：可以分别指定通道Red、Green、Blue或者Alpha作为纵向扭曲的参照基础。SourceMidpoint（中心源）：输出图像中心点位置。此处定义原点为 $(0,0)$ ，最远端为(0.5,0.5)。DisplaceWeight（置换权重）：分为水平和垂直方向，来控制输入端像素点偏移量的大小 $10$ UVWeight（UV权重）：设置UV方向（UV即水平和纵向的像素分布）相对于图像原点的扩散值。Offset（偏移）：偏移值。OffsetWeight（偏移权重）：设置整体偏移值的权重。  

至此，我们就得到了最后的带有扭曲画面和烟雾感觉的图像，我们可以通过设置RampTOP 中的颜色过渡，以及设置不同元件中的参数来制作出不同的效果。  

![images/4783dc7df8a854f10ddee8b1a45f6cf4941da199cc1519e330bd278bda101812.jpg](https://i.imgur.com/IGELikv.webp)  
图2-2-09最终效果  

## 2.3 三维渲染

三维渲染是所有交互引擎都必备的一种功能。很多时候，尤其是在VR/AR 等类型的项目中，我们都需要制作三维场景。在 TouchDesigner 中，它支持包括.usd、.usda、.usdc、.usdz、.fbx、.obj、.3ds、.dxf、.dae 和 .abc 在内的各类模型文件，同时支持.tog、.bhclassic 和 .fbx 格式文件的导出。所有的模型导入到渲染在 TouchDesigner 中有一套基本的渲染流程，本章节会针对这个流程给大家做一个基本的介绍。  

### 实战案例: 渲染—从 3D 模型到 2D 图像  

TouchDesigner 中的 SOP 元件允许我们新建和导入各类 3D 模型，这些 3D 模型通常需要经过渲染才能输出为我们最终需要的图形。在 TouchDesigner 中，我们经常借助这样的组合来实现 3D 模型到 2D 图像的渲染: Geometry COMP、Camera COMP、Light COMP 和 Render TOP。本次案例的项目总览图，如图 2-3-01。  

![images/6b93a8c26a3e3322d6e5499b841469cd6c117f51e195f25758978676dd8b38cc.jpg](https://i.imgur.com/h0yyYoo.webp)  
图 2-3-01在编辑区的最终效果预览  

>在新建 TouchDesigner 文件中添加 Geometry COMP 'geol、Camera COMP 'cam1、Render TOP 'renderl。默认情况下，Geometry COMP 会默认包含一个 Torus SOP 模型（可以进入到 Geometry COMP 看到），如果需要创建其他基本模型的话可以进行替换。  

##### TIPS  

TouchDesigner 中的三维基本模型包括以下几种。  

![images/1f6445e03ab95f12a2805c98d91261507be38c62a978525a9a4768132c4f049b.jpg](https://i.imgur.com/lB1nI0H.webp)  

##### TIPS  

在替换完之后，勾选 SOP元件的Display选项（元件右下角的蓝色圆圈）使元件中的内容在其父级Geometry COMP中显示。勾选Render选项（紫色圆圈）使元件中的内容被RenderTOP渲染成图像，如图 $2-3-02_{\circ}$  

![images/8976ccde3f6dd87e7c0bc2df758b12858687b406fdc4be883429ce015e2f1e1e.jpg](https://i.imgur.com/5Wg9P3r.webp)  


![images/0a9371cb502f20dd738d21efdf3de49ec07568a9ffc7112f78e4be199fa4d219.jpg](https://i.imgur.com/ojCtu7f.webp)  
图2-3-02渲染出默认模型  

##### Render TOP

![images/5aa81ab42c5f622dde8dbd40dba82a4ec35d2c6274790c692ba911f3683311b8.jpg](https://i.imgur.com/7fjbi5x.webp)  

RenderTOP可以看作一个三维渲染器。  
Camera(s）（相机）：用于指定渲染场景时使用的相机元件。  
Geometry（几何形状）：用于指定渲染场景时渲染的几何元件，输入对应几何的GeometryCOMP的名字即可选中。  
Lights（灯光）：用于指定渲染场景时使用的灯光元件。  
Anti-Alias（反锯齿）：消除锯齿，使渲染图像变得平滑。  

##### Camera COMP

![images/5626c736ab4aa2bf108183b6771948a13f19814dd011ac81ea79286bb9c3bb8f.jpg](https://i.imgur.com/bqRqH1O.webp)  

Uniform Scale（按比例缩放）：沿x、y、z 三个轴等比例缩放相机（通常不建议改变相机大小）。  

ConstrainTo（约束到）：让相机附属到某个指定元件上，跟随指定元件运动。  
LookAt（朝向）：让相机在移动过程中始终面对指定的元件。  
Path SOP（相机的路径）：输入SOP元件名字，为相机指定移动路径。  

#####  Geometry COMP

![images/8e4a6339c718e30e7dd4a0e013137722948af49419b78f51cdca6ff1e64c9a29.jpg](https://i.imgur.com/2au9T1o.webp)  

GeometryCOMP中的参数与CameraCOMP中的参数用法大部分都相似。特殊的是它的Instance页面的用法。  

Instancing（实例化）：打开Geometry组件的实例化功能。  
InstanceCount（实例计算）：通过输入CHOP、DAT或SOP元件的名字，引入通道、数据或者几何形的网格，用于实例转换成位置、旋转、大小、颜色等操作。  
InstanceCHOP/DAT/SOP（实例参考元件）：指定某个元件作为实例化的依据。  

![images/8832599b0d8a59ac3057df56fd72a4fe13993b1c25ff3394d72adf0149da2f97.jpg](https://i.imgur.com/LzgeWWS.webp)  

![images/7425be7991a5f8e3c65fdf8c9b5496fee7238c99369578b76cd0e8bf3b619965.jpg](https://i.imgur.com/W32sX2m.webp)  
Light COMP  

Light Color（灯光颜色）：可以自定义输入r、g、b值，改变灯光颜色。  

Dimmer（调光器）：不影响色调的情况下改变光照强度。  

Light Type（灯光类型）：可以选择任意三种灯光类型，PointLight（点光源）所有方向均等发散的光。ConeLight（锥形光）光线呈锥形发散，类似聚光灯效果。DistantLight（远光）从远方发射出的光线彼此平行，效果类似太阳。  

如图 2-3-03，在 Geometry COMP调整模型的旋转角度等参数，可以看到RenderTOP中已经渲染出模型对应的图像。由于缺少光源，图像当前是黑色的。  

![images/cf82255ddf98657a030e51b03c0782d77ed3d94f84b4b69cdeac3b1029680b6b.jpg](https://i.imgur.com/4VjapnW.webp)  
图 2-3-03未加光源的图像  

如图 2-3-04，添加 Light COMP 以后，Render TOP 中渲染出了模型在光源下所成的图像。  

![images/380c5a955163ca2863cc6329d01b7392117e4aa895f4c3b0d72b0c3fc9ee12b0.jpg](https://i.imgur.com/UesfnnQ.webp)  
图2-3-04添加灯光  

![images/709c17eca82150e2f880e2dd1db33fcec3abb3331c0ffba2325641856e353687.jpg](https://i.imgur.com/TKK5jld.webp)  
图2-3-05添加材质  

和大多数 3D 软件一样，TouchDesigner 中的模型也可以被赋予不同的材质。我们以 Phong MAT 为例，新建Phong MAT phong1′，拖动到 Geometry COMP 上作为 Material。 如图 2-03-05,这样就构建好了渲染的基本结构。  

##### TIPS  

在使用过程中，为了方便观察 SOP 元件，我们可以直接右击 SOP 元件右侧的输出端口再添加 Geometry COMP,此时的 Geometry COMP 内会自动添加 In SOP 与 Out SOP。另一种方法是我们直接将 Geometry COMP 内部的默认Torus SOP删除，替换为In SOP 和一个Null SOP（记得打开Null SOP 的渲染图标），回到上一层级之后我们就会看到Geometry COMP出现了一个输入端口，将外部SOP元件连接，即可看到图像在Geometry中生成。  

![images/5a69519e20c465f914775facd234efb25c83aab900b391916f93b876068bf86c.jpg](https://i.imgur.com/gFpiy3y.webp)  
直接右击SOP元件右侧的输出端口再添加GeometryCOMP  

![images/6b62cc734f790e5faa9dc12bd18cdc6049f7b25c303a80065ebf81a794c0fc04.jpg](https://i.imgur.com/f4kAbk5.webp)  
将Geometry COMP中的默认SOP替换为其他类型SOP和Null SOP  

SwitchSOP元件类似SwitchTOP元件，我们可以利用SwitchSOP在多个SOP元件中选取其一。  

![images/f81c1d650f54d057a71a959c8f6c040aeac58ad8a71745cd5e3aedeadb84f87d.jpg](https://i.imgur.com/6g0EjHX.webp)  
图2-3-06设置切换模型功能  

如图2-3-07，同样添加SwitchMAT元件，拖动它的Index参数可以切换不同的材质。添加NullMAT'null2'，并拖动到'geol'上（添加材质的方法，如上页图2-3-05）。这里介绍几种常用的MAT元件，ConstantMAT是一种不受光线影响、不区分明暗的材质，PhongMAT是具有真实立体感的材质，WireframeMAT可以产生简单的线框效果。  

![images/e97d3eb1dc9c2b81971b83f2b7bf0ec2e60e3008d69826c1f600afea866a79d1.jpg](https://i.imgur.com/8tmcQz7.webp)  
图2-3-07设置切换材质功能  

##### TIPS  

我们如果要导入三维的模型，直接将模型文件拖入TouchDesigner的编辑窗口即可。  

![images/c0ec67e5186ae6b8f9f931e9f8607969d623c18b2296cd2acd056a3871a9e8ce.jpg](https://i.imgur.com/WQ9a0Tm.webp)  
Constant MAT  

![images/55ee7b3e8c4c39782c0565ea5ba6256bd13602b63fcd498c95914585f46b78b4.jpg](https://i.imgur.com/8IHmURa.webp)  

Color（颜色）：调整材质的r、g、b 颜色。Alpha（阿尔法通道）：控制材质的不透明度。Post-Mult Colorby Alpha（r、g、b色值与阿尔法通道相乘）：开启该功能后，材质的不透明度会影响带有颜色、贴图的像素。ColorMap（颜色贴图）：使用TOP元件的图像作为材质的色彩贴图。  

##### Phong MAT

![images/277c6bae0115e76a198bca91ff74cf8f3bf108b7705a7425d4eb7261adb3382a.jpg](https://i.imgur.com/GTr7PtY.webp)  


Diffuse（漫反射）：材质在光照下反射的光色。  
Ambient（环境光）：材质自带的环境光色。  
Specular（高光反射）：材质高光部分的反射光色。  
Emit（自发光）：材质本身发出的光色。  
Constant（恒定颜色）：材质中不受光线影响的、恒定的一部分光色。ColorMap（色彩贴图）：使用TOP元件的图像作为材质的色彩贴图。Normal Map(Bump）（法线贴图）：使用法线贴图可以在简单模型的表面产生类似3D 细节效果。  
Diffuse Map（漫反射贴图）：可以使用 TOP 元件的图像作为材质的漫反射贴图。  
SpecularMap（高光贴图）：使用TOP元件的图像作为材质的高光贴图。Emit Map（自发光贴图）：使用TOP元件的图像作为材质的自发光贴图。Environment Map（环境贴图）：使用TOP元件的图像作为材质的环境，在镜面反射时可以看到物体反射出的环境。  
AlphaMap（透明通道贴图）：使用TOP元件的图像作为材质的不透明度贴图。  

##### I Wireframe MAT

![images/5975e971d78d120dae6dccc653df8c8e1efaad747be9012e48ae22edb4c8e43b.jpg](https://i.imgur.com/wBzDqNO.webp)  

Color（颜色）：调整线框材质的r、g、b颜色。Alpha（透明度通道）：控制线框材质的不透明度。Wireframe Mode（线框模式）：OpenGL TesselatedWire Frame 以三角形为基础的线框模式;TopologyWireFrame以四边形为基础的线框模式。Line Width（线条粗细）：线框线条的粗细（Mac版TouchDesigner不支持LineWidth的修改）。  

SOP方面，添加NoiseSOP可以使几何体发生不规则形变。我们在'switch1'和'null1'之间增加一个 Noise SOP 元件。  

![images/d8a9684c842a808e2f592fc6e2baf6b22fe843a5cf8e6706bd694d4bdb3ad865.jpg](https://i.imgur.com/4yq4LaJ.webp)  
图 2-3-08右击'switch1'和'null1'的连线选择 Insert Operator  

![images/3b05a4996c10c2c0a586b64a288a0b96e7788ebdf2eac08dd134846b263081cd.jpg](https://i.imgur.com/4u6qQ6o.webp)  
图2-3-09插入 Noise SOP  

将 SOP 几何体的参数 Primitive Type 设置为 NURBS 后，几何体的形变更加平滑。  

![images/47f484ea85cf9dfe2da46b70f8a2bd426c36eaf7f12663db29ae9ae5534a71ac.jpg](https://i.imgur.com/5pFnRrK.webp)  
图 2-3-10设置模型参数  

此时当我们缓慢调整 Geometry COMP'geo1'中 Translate 参数，会出现模型移出取景框的情况，如图 2-3-11。  

![images/7a619096ff535615c1dd59a287eae996b96548b8d2f36b359088dbba7ee637e1.jpg](https://i.imgur.com/pRzQ5Yh.webp)  
图2-3-11移动模型  

为了使物体始终处于取景框中，如图 2-3-12，我们可以将'geo1′设置为 Camera COMP 的 Look At 对象，这样无论模型位置如何变化，镜头始终朝向模型。为了方便观察调整模型，如图2-3-13，将界面分为两部分并打开GeometryViewer。  

![images/8b299fab2859290916d7dbcb4a5cf45ee0243bdc928af60729f7b7b73fcc7a0a.jpg](https://i.imgur.com/tt9ePNO.webp)  
图2-3-12设置相机镜头朝向  

![images/c82844867284ba608de5bee5f809d62eea1d81f9106a8b06e4bf084acd28c852.jpg](https://i.imgur.com/q1Kwra3.webp)  
图2-3-13将界面分为左右两部分，右侧打开 Geometry Viewer  

按快捷键H 使所有元件居中显示。在 Geometry Viewer 中，鼠标左键旋转视图、右键移动视图。当 Network 中相关元件被选中，GeometryViewer 中的元件将会被绿色的高光标记出来，我们可以根据GeometryViewer 中元件的位置关系进一步调整模型、摄像机、灯光的位置。  

![images/de0fd1fdb2f266a231bb5600cdc295af1b0eec07774646cb1bf64e29c436e35d.jpg](https://i.imgur.com/5mWeT9O.webp)  
图 2-3-14查看 Geometry Viewer 窗口  

几何体加上不同材质，最终渲染为不同的图像。  

![images/d00aa9309d8df8422c892d5f3ec7bafdb89bb87205cf229dc6ed29705b9abe69.jpg](https://i.imgur.com/wtIZ3Oc.webp)  
图 2-3-15从左到右分别为 Constant、Wireframe 和 Phong 材质  

经过 Render TOP 渲染后的图形可以进一步图像加工，例如使用此前所讲的 Feedback Loop 进行处理。以下图片展示的是美国新媒体艺术家Matthew Ragan的部分作品，可以给大家提供一些视觉启发。  

##### TIPS  

我们可以在GeometryViewer中用鼠标左中右键自由变换视图位置，在确定一个观测角度后选择顶部菜单栏SaveViewto $\rightarrow$ cam1的选项，即可将摄像机自动移动到当前视角位置上。  

![images/e98f8afd70dd75287b57fee36e167a6ab7426790ad7710385c215dc92d8baf39.jpg](https://i.imgur.com/WoEnCwu.webp)  
图 2-3-16 Matthew Ragan 视觉作品案例  

![images/926f2ffd5294d712ab4b834072e03fcf07ef53a8b2f82c27949d8a873f85774a.jpg](https://i.imgur.com/EFw4XVA.webp)  

## 2.4 Particle Effect 粒子效果

粒子效果是大量视觉内容中会运用到的一种表现形式。不同于建模，粒子是由粒子发射器喷射出的一系列点状物，由虚拟空间中的不同力（例如引力和旋转力）去控制粒子飞行的方向。粒子由于其具有物理模拟的特性，常常用来制作具有视觉震撼力的水、火、烟雾以及发光轨迹等抽象视觉效果。  

### 实战案例: 粒子系统初识—制作飘逸的粒子效果  

在这一部分的案例中，我们将会学习粒子 Particle SOP元件，以及粒子特效的在三维场景中的渲染和使用。  

![images/0a882dac2d2e4cdc4fab1d8b14a8472b5c86d35c461631c3107585ef55db41c6.jpg](https://i.imgur.com/KzH8E0Q.webp)  
图 2-4-01在编辑区的最终效果预览  

〉新建一个TouchDesigner工程文件，删除此层级默认元件。新建Container COMP'containerl'，鼠标放在此元件上滑动鼠标滚轮进入'containerl'，在这个容器中制作本章节的项目（关于ContainerCOMP元件的介绍，参见第67页）。  

为了生成粒子效果，我们需要新建一个初始的几何形体，利用其表面的点作为粒子发射源。在'containerl'中新建 Sphere SOP'spherel'，然后设置几何的细节，即在Detail参数页面将Rows和Columns设置为 $40_{\circ}$  

![images/afbfe7f97f785dace0a901695136d7e2b4c47eb5ff6c86692b8a81d459975cfb.jpg](https://i.imgur.com/mT6b9sB.webp)  
图2-4-02新建Container COMP  

![images/704321ba486f4fdb342e16ca96751643852f88c41b19578e0cd986e29454bc81.jpg](https://i.imgur.com/b51nWBX.webp)  
图 2-4-03新建 Sphere SOP  

##### TIPS  

如果希望看到顶点或者法线等参数，鼠标右击当前 SOP元件选择Display Options,在Guides&Markers窗口中选择需要在SOP视窗内显示的参数。如果我们选择黄框内的这个选项，每个顶点的序号都会被显示出来。  

![images/35f6528179e473c56113277883d676e6f4ac28a6c2da031fd5ca668945fa0915.jpg](https://i.imgur.com/LWGzjFZ.jpeg)  

为了生成粒子散发的效果，在'spherel'的后面添加NoiseSOP'noisel。默认情况下，此时的几何形态开始随着时间发生不规则的形变，如图2-4-04。  

![images/0e8fe39115a29f96de8691c4fe571ad88258381adfc1062ead132dedcb23a60a.jpg](https://i.imgur.com/KZadHnw.jpeg)  
图 2-4-04添加 Noise SOP  

为了使粒子的发射源变化可以更加丰富，我们在'noisel之后再添加Transform SOP'transforml，将Transform参数页面的 Rotate-rx、Rotate-ry 都设置为 absTime.seconds（按照绝对秒数进行旋转）。这样集合体将绕×轴、y轴旋转，即粒子发射源会不断旋转，如图2-4-05。  

![images/58273cc8cdc41c52920db884147d9f7b898839f6f4cbb00cf1f1e091e65c8d14.jpg](https://i.imgur.com/AkigTDH.jpeg)  
图 2-4-05添加 Transform SOP  

##### TIPS  

##### Noise SOP

![images/47d00eeca95825b7298d99fbfab9f1fb391b6e4f093453aa8d7cbc4d45102d8b.jpg](https://i.imgur.com/TUQoVxT.jpeg)  

Attribute（属性）：设置Noise SOP作用在几何的属性，可以分别在位置（Position）、法线(Normal）、颜色（Color）、透明度（Alpha）、点纹理UV（TextureUV）上添加噪波效果。  
Type（类型）：提供六种随机噪波类型。  
Harmonics（谐波）：数字越高，噪声越大。Roughness（粗糙度）：控制较高频率噪声的影响。  
Exponent（指数）：控制噪波，最大与最小值之间的平滑度过渡。  
Amplitude（振幅）：定义噪波值的幅度。  

![images/b20932abe9712caae77479ee367a946218d6d1dc418940b158f22800eead9acb.jpg](https://i.imgur.com/GKEaB8H.jpeg)  

粒子发射的顺序是按照顶点顺序发射的，在SphereSOP元件窗口上右键打开DisplayOption中的顶点顺序显示模式，我们能看到所有顶点的序号。对于一个球的形态来说，顶点排列顺序是规则的，也就是说作为发射体来说，粒子的发射样式也会呈现出规则的形态。  

![images/c68f9273be2e3c070d856802ccd69d0390196a2595cbe7f04728831a3c8ad759.jpg](https://i.imgur.com/S2Q6n59.jpeg)  

我们用一个SphereSOP来对比一下SortSOP之前和之后（采用Random随机参数后）的效果，我们可以很明显地看出顶点顺序变了，也就是说从视觉上来看粒子的发射会变得更加自然与随机。  

![images/52b87c8abe113cdc571db2ad9593db43a9edae7f4986a23d62f1c0d004b87332.jpg](https://i.imgur.com/WoUsjNN.jpeg)  
使用 Sort SOP 之前  
使用 Sort SOP 之后  

为了让粒子发射的形态能够更加随机和抽象化，我们可以在'transforml'后添加SortSOP'sortl，并将参数PointSort设置为Random（随机），这时候我们所有顶点的顺序会被随机重置，这意味着粒子发射的顺序将被打乱，变为按照新的随机顶点进行粒子发射。  

![images/c972e8f1f888fe2e9918fec2996b4f710a23297904841a871a03244ce6b1c139.jpg](https://i.imgur.com/M1z9WUw.jpeg)  
图2-4-06重置顶点序号  

接着是我们案例中的关键元件一ParticleSOP，此元件可以模拟出不同动态的粒子系统。在'sortl'后，添加新的ParticleSOP'particlel，此时'particlel'会以此前几何形体上的顶点为发射源，在默认设置下开始发射粒子。  

![images/09cec729ecd57b4b1f73b87ec4e7678735c8becff83bdbcfe98d562e16660ebb.jpg](https://i.imgur.com/zTyu96G.jpeg)  
图2-4-07制作粒子系统  

如图2-4-08，调整particle1'的相关参数，获取理想的粒子动态效果（不用调整TimeInc的参数）。在本案例中，我们通过调整Forces参数面板中的Wind、Turbulence和TurbPeriod参数来控制粒子飞行方向。用 Particles 参数面板中的 Mass 和 Drag参数控制粒子的重力，以及Birth、LifeExpect等参数来调整粒子的出现密度和生存的持续时间。最后，达到一个相对完整的效果。  

![images/1315304851757165700bd4c55e7cab5e8b00e937ab0eaa8a19ba97604364ba6d.jpg](https://i.imgur.com/DdFJKH0.jpeg)  
图2-4-08调整粒子参数  

##### TIPS  

在图2-4-08中，我们打开了“只显示变化参数”的按钮，所以菜单内只显示了一部分被调整过的参数（可以对比右侧ParticleSOP元件介绍）。  

##### ParticleSOP

![images/27fbd5d6251e166ca5e4f43e5ce54ee8fae2172d5e208fc32eaf0206421a0532.jpg](https://i.imgur.com/LqIDyXz.jpeg)  

ExternalForce（外力）：为粒子系统创建外力。Wind（风力）：作用在粒子系统上的风力。  
Turbulence（湍流）：作用在粒子系统上的扰动参数。  
TurbPeriod（湍流周期）：作用在粒子系统上的力量持续时间。  

![images/27f08f6eaa8775a435398bc1539e97bf85d9667243ba70ecc314eda1abae5e48.jpg](https://i.imgur.com/zrztTxW.jpeg)  

##### TIPS  

Particle 模拟粒子运动，生成粒子的3D形态。第二个输入端可以利用碰撞器限制粒子的Collision（运动）。  

AddParticleID（添加粒子号）：为每个粒子诞生时添加ID号。  

![images/9fb14b72a3b98740bcf77b09d8299af3261e05c377bbbc9790c8a4c5abbef04e.jpg](https://i.imgur.com/yDpPbx8.jpeg)  

AddMassAttribute（添加质量属性）：选中后，按照Mass的参数计算粒子质量。  

Drag（拖拽）：添加阻力造成拖拽效果。  

Birth（产生）：每秒产生粒子的数量。  

Life Expect（粒子生存周期）：每个粒子存在多长时间，以秒为单位。  

LifeVariance（粒子生存周期差异）：每个粒子生存周期之间可以允许的时间差，以秒为单位。Alpha Speed（透明速度）：调节粒子透明度的速度。粒子速度越快，粒子的透明度越高。  

在'particlel'后添加元件 Null SOP'null1。至此，我们已经为渲染准备好了所有的 SOP元件。  

鼠标右键点击'null'的输出端，即可弹出元件表，选择Geometry COMP,这样就将模型元件 'null1'直接连接到了Geometry COMP'geol'上。接着，添加渲染常用的元件 Light COMPlight1\`Camera COMP'caml' 和 Render TOP'renderl。这样'renderl'中就会有图像被渲染出来，如图 2-4-09。但是因为没有添加材质，所以粒子效果不够明显，接下来我们会为它添加材质。  

![images/b13cd84382ef0dd89665b32c1560884b8d1d89d62c981ff9d63a9230b52ddc7c.jpg](https://i.imgur.com/gC6hBl5.jpeg)  
图 2-4-09渲染图像  

在默认的状态下，我们的'renderl'中显示的粒子反射的是灯光的颜色。如图2-4-10，为'geo1′增加一个Constant MAT'constantl'材质，将颜色设置为白色。这样就可以在'renderl'中得到一个带有白色粒子散射效果的变换图像。  

![images/1b2fabbb8ca605a6da0987e9f0ee7dbf58dfdceacf5f3070247df566fced4ba1.jpg](https://i.imgur.com/Mah9IQm.jpeg)  
图 2-4-10添加材质  

然后，在'renderl'的图像基础上继续进行加工，构建新的Feedback Loop效果（详细方法参见第52页）。即新建Feedback TOP 'feedbackl'、Level TOP'levell'、Composite TOP'compl'。接着将'feedbackl'中的 Target 参数设置为'compl'，并将'compl'的 Operation 参数设置为 Add，如图 2-4-11。  

![images/a3f6335aedbb730d567a99bd4ba15e3099fca8384b899bf25c98056a50cb154b.jpg](https://i.imgur.com/Kzehg7E.jpeg)  
图 2-4-11 构建 Feedback Loop  

减小"levell'的 Post参数页面中的Opacity 参数至0.965，使粒子在产生拖尾效果后可以慢慢淡出，如图 2-4-12。  

![images/ff838495ca2bbb2cd2ae811fe12b51d8a8f887664ae9f7a157e3470dde1f2bc7.jpg](https://i.imgur.com/obtFwoS.jpeg)  
图2-4-12调节效果  

之后来进行画面调整，可以通过'cam1'的位置 Translate-tx、Translate-ty、Translate-tz 修改构图。为了方便观察,也可以将界面分为左右两块，其中一块打开GeometryViewer（切换到GeometryViewer 窗口的方法参见第60页），查看'geol、'lightl\`、'caml'的具体位置。  

![images/21f703f21853e4bccd9f84c6bc0175b48934a408a29216ef17f101718924dea3.jpg](https://i.imgur.com/bVuTKPX.jpeg)  
图 2-4-13查看Geometry Viewer 窗口  

如果觉得粒子亮度太高，我们也可以将'constantl'的Color参数设为深灰色，降低粒子的亮度。  

![images/11acbfb607cb1b6b46be4393c84138b8c1dfc5e8d68938e4f397fb04a1aede42.jpg](https://i.imgur.com/IntNmqZ.jpeg)  
图2-4-14调节材质  

还可以在'compl'之后添加 Level TOP“level2'，将参数 In Low 设置约为 0.046，这样，任何 Value（明度）值低于该数值的像素都会直接显示为黑色，我们可以得到更加纯净的黑色背景，如图2-4-15。  

![images/bfe5c19a39c16715fa985d1820f3a708256d0374d432bcf5388af4f61b0da714.jpg](https://i.imgur.com/AqswFzP.jpeg)  
图2-4-15添加 LevelTOP  

##### TIPS  

在调试过程中，我们常常会运用到当前元件的预览模式。可以右键点击打开View，即可看到当前输出画面的预览图。  

![images/1fe65d07fc1b59c7f39da8f57e909ec317b48d4219a829f55565b61076b0beb7.jpg](https://i.imgur.com/XYSuafu.jpeg)  

一般在完成效果制作之后，我们通常会以 Null TOP 作为最后一个元件，并命名为'bg'，如图 2-4-16。  

![images/61e3313e12d649dd7ce3409f90954fa760578e430f9135e20aac09767abe908c.jpg](https://i.imgur.com/Kb942La.jpeg)  
图 2-4-16新建Null TOP 并重命名  

返回到 /project1 层级,如图 2-4-17,利用表达式的方法使'container1'与其内部的 Null TOP'bg'长宽保持一致。  

![images/2b8768101c88a014be357348b5d59ded55c4e8973458ed235b35341e58c067a3.jpg](https://i.imgur.com/JTU7bzk.jpeg)  
图 2-4-17利用表达式设置长宽像素  

##### TIPS  

一般在元件菜单内的参数我们都可以用“op('元件名").par.参数”的形式,进行数值的获取，但是对于TOP元件，元件本身的分辨率是可以被获取的，我们可以通过“op(元件名").width ”和op('元件名").height”获取分辨率的横向和纵向长度数值（我们常常用这个方法去引用TOP元件的长宽数值）。  

./bg 表示下一级路径中名为'bg'的元件。具体路径表达方式参见第 36 页。  

![images/471826fe154381f6385c469aab60cb3de59798a5da97e8e496aeb672d7757703.jpg](https://i.imgur.com/RW159Db.jpeg)  

Container COMP 可以组合按钮元件、图像等，并设计其排列效果，从而制作为一个界面。常用于编辑程序交互逻辑、用户界面排布等。  

×（横坐标）：显示在父级元件中的水平位置（以像素为单位）。  

Y（纵坐标）：显示在父级元件中的垂直位置（以像素为单位）。  

Width（宽度）：显示面板的宽度（以像素为单位）。  

Height（高度）：显示面板的高度（以像素为单位）。  

Depth Layer(图层深度)：指图层的上下排列顺序，类似于 Photoshop的图层概念，数值大的图层排在上面，当数值相同时，按名称排序。  

BackgroundTOP（背景显示）：该参数位置在Look参数列表下，指定某个 TOP 元件，作为 Container COMP 背景显示元件。  

Align（对齐）：该参数位置在 Children 参数列表下，可以设置此元件内的子元件显示在上层面板的排列规则。  

将'containerl'的 Background TOP 设置为./bg，这样可以通过'containerl的窗口直接看到最终生成的图像，如图 2-4-18。  

![images/8290b40af69f43404e41336bad949df604c84d19e8d3066618dae0ae6a4c29e0.jpg](https://i.imgur.com/q4yDjgG.jpeg)  
图2-4-18设置窗口显示图像  

最后我们增加一个WindowCOMPwindow1′窗口，将OpeningSize设置为Fill（全屏显示），关闭Borders（窗口边框），打开 Always onTop（始终在最上级），并点击SetasPerformWindow（设置为默认输出窗口）。  

![images/42c8819e50c54c2065c006b839b494374590a6bdcbcfd3643f1d2b6f845d01f7.jpg](https://i.imgur.com/7ZXphXj.jpeg)  
图2-4-19全屏播放设置  

按下F1按钮打开最终的输出视窗，我们就可以看到一个全屏的粒子视觉图像，如图 $2-4-20_{\circ}$ 至此，我们就完成了本教程的学习任务，感受一下粒子特效的趣味吧，尝试一下调整各个元件的参数，来尝试一些不同的效果。  

![images/7ae966f302dfb624a0a5074c961afc939e8c07ea7bf1270e74b75802a8b5b5df.jpg](https://i.imgur.com/U7TQ4Ys.jpeg)  
图 2-4-20最终效果  

## 2.5 Instance 功能的使用

我们常需对一个模型进行复用，创造复杂多变的视觉效果。但如果每个模型都被单独导入到程序中,CPU 的单线程运算会使效率极低。本节将介绍一种新的模型复用方法一Instance，利用 GPU 强大的复用模型并行运算力，可以对模型形状、位置、贴图等进行动态处理，快速、高效地制作基于模型的互动变换。  

### 实战案例: 利用Instance 功能制作“小太阳”  

Instance 的使用让我们可以用非常简单的模型轻量化制作出复杂的效果。在本案例中，我们利用一个基础模型 Tube SOP 去制作一个较为复杂、实时变化的“小太阳”，如图 2-5-01。  

![images/56dfb223fde9c8d29dc1d7d131fa067bf1b9c55bfebf675af04b1d2be702fd41.jpg](https://i.imgur.com/0QKdLjv.jpeg)  
图 2-5-01在编辑区的最终效果预览  

Instance，中文称之为实例化。指参照一个变化参数表，将一个基础三维原型批量复制；同时，利用数据表格去控制每个复制模型的参数（形体位置、大小、颜色等），从而制造出一系列的模型组。  

![images/6ba01bf1dac8c25dd70fdbadc3894688d17bd067a042060b4b14d9356a50e1bd.jpg](https://i.imgur.com/Dhh87T0.jpeg)  
图 2-5-02 Instance 功能流程  

>新建一个TouchDesigner 工程文件，删除此层级默认元件。新建Container COMP'containerl'，鼠标放在此元件上滑动鼠标滚轮进入‘containerl'，在此容器中制作项目。  

![images/62038baca0c2a15a089006aa771a2c29d4275b7d28ab356df7658aca92d7c360.jpg](https://i.imgur.com/JJezu66.jpeg)  
图 2-5-03新建Container COMP  

新建 Tube SOP'tubel'，并将参数 Radius-radl设置为 0.1，以获得一个上下中空的圆台。  

![images/750ba1a8616433bfffc6648ca7af23e2b00b887b58323918a5607969582c0eb6.jpg](https://i.imgur.com/48oi2qY.jpeg)  
图 2-5-04新建 Tube SOP  

在'tubel'后添加 Cap SOP'capl'’，在U 参数页面将 First U Cap设置为 End CapFaceted，对底部进行平滑的封闭；将Last U Cap设置为EndCapRounded，对顶部进行圆滑的封闭，并且可以梢减小Scale的值使上底封口处不会过于突出，如图2-5-05。  

![images/025b036bbdd6a151cf58c192e576147051e6ac9e4b203ba51cda8ecc4a15f983.jpg](https://i.imgur.com/Q59HoBY.jpeg)  
图2-5-05调整模型  

添加TransformSOP'transform1'整体修改几何形体的形态，使其以×轴为中心轴旋转 $\scriptscriptstyle-90^{\circ}$ ，同时调整Scale参数中的第二个参数 sy 至 2.3，使得整体更加修长，如图 2-5-06。准备好 Instance 的基本形体后，增加一个Null SOP'null1'，准备进行Instance的操作。  

![images/4161b73d110394646206c3d24e8fbac01c2a0e7b3e76f922ddc2ff7261cfe890.jpg](https://i.imgur.com/oGSsiXh.jpeg)  
图2-5-06添加 Null SOP  

根据开篇对Instance制作流程的描述，如上页图2-5-02，我价还需要一张数据表用于定义Instance中每一个基本形体的位置与方向。为此我们新建一个 Sphere SOP'spherel’，将Primitive Type 设置为Polygon（多边形属性），如图2-5-07。  

![images/5d56d5914107bfc034cf6319d059e37c5fb06366ac3c234f2c4066cfac4dd2b0.jpg](https://i.imgur.com/E9q0CWt.jpeg)  
图2-5-07新建基础模型  

在Detail页面将参数Frequency设置为6（数据越大表面越平滑），此时'sphere1'上有362个点，如图2-5-08。我们将利用这些点定义Instance中的位置与方向。  

![images/f65304017ce8f52d5f8bc3ef6470cab5738606b8a005638546543ef65e941300.jpg](https://i.imgur.com/ghZieAR.jpeg)  
图2-5-08鼠标中键查看顶点数量  

##### Cap SOP

![images/71b34208b49c53a94f0d3fecf6f7181e893f331808db5626ccf0a4beab5fdbc3.jpg](https://i.imgur.com/0T0GlUW.jpeg)  

CapSOP用于封闭几何中扁平或圆形的开放区域。  
FirstUCap（顶部开口部分）：选择创建封闭区域的类型。  
LastUCap（底部开口部分）：选择创建封闭区域的类型。  
Divisions（分度）：封口区的横截面数。  

##### Sphere SOP

![images/2bdd390654e476913247d3116cda39f516886045c769576b480a7c102bca8f65.jpg](https://i.imgur.com/Qj1pF4J.jpeg)  

PrimitiveType（原始类型）：选择球体几何的初始类型。包括Primitive（原始类型）、Polygon（多边形）、Mesh（网格）、NURBS（柔滑曲面）、Bezier（贝塞尔曲线）。  

Connectivity（连通性）：选择Mesh（网格）类型时，此选项用于选择曲面类型。Orientation（方向）：确定球体的轴。球体的极点与定向轴对齐。  

![images/af91365c322f6dee88eb2e9ef4335b0aef2047df7b4cc42810cf2c5c1d174f3f.jpg](https://i.imgur.com/GoUzjW7.jpeg)  

Rows（行）：使用Mesh（网格）时球体中的行数。  
Columns（列）：使用Mesh（网格）时球体中的列数。  

在'spherel'后添加 Noise SOP'noisel'，选择 Type 参数中的 Harmomic Summation 类型，并调整 Seed 参数为 1.57，调整Roughness 参数为 0.876，调整 Exponent 参数为 0.59，使圆球的波动趋向平滑，调整 Amplitude 参数为 0.15 保持波动幅度较小。通过这些参数的调整给球体增添不规则的形变，如图 $2{\cdot}5{\cdot}09_{\circ}$  

![images/a45757c16d83119cbb9e5fe2dcd8fdc46c7275d4931775535051aeb83b219e7b.jpg](https://i.imgur.com/RCaCeEV.jpeg)  
图 2-5-09增加形变  

在'noisel'后添加 Null SOP 'null2'，鼠标右键点击'null2'右侧的输出口，添加 SOP to DAT'soptol'，如图 $2\cdot5\cdot10_{\circ}$ 因此可获取到模型每一个点的具体信息，我们将用这些作为Instance 中每个基本型的新位置。  

##### TIPS  

任何三维模型经过SOPtoDAT之后，每个点的参数都会根据ID列举出所有信息。在本案例中，'soptol'的表格展示了几何体上每一个点的位置、法线信息。  

![images/7056f5df95ced466b798d7402e68f307c26a43ace6333b1730ec9fc7ddb9edad.jpg](https://i.imgur.com/oiHHKHf.jpeg)  
图2-5-10添加 SOPto DAT  

同样，在'soptol′后，我们添加 Null DAT'null3'，这将作为Instance流程中的引l用表格。  

![images/e4a65621c544b17e8cbd380c20f1b6021b56cf89afa3838fc0b07bfdb1703961.jpg](https://i.imgur.com/jKRE5WT.jpeg)  

![images/2ab744eaf87dbf1699955af07b073c8ff9a431d34d2be3446cbb529cc0f73eeb.jpg](https://i.imgur.com/aewll2k.jpeg)  
图2-5-11添加 Null DAT  

然后，如图2-5-12，添加渲染常用的元件Geometry COMPgeol′（和上一个教程相似，我们将鼠标右键点击'null2'元件的输出端，用于增加一个 Geometry COMP）、Light COMP"light1\`、Camera COMP'cam1'以及 Render TOP'renderl'，这样，'render1'中就有单个几何体的图像被渲染出来。  

![images/aacd7a3d4a9c3fad7455550a666ef6f6603a8771fa779bdf84582ed62f7aeb4d.jpg](https://i.imgur.com/K34i18l.jpeg)  
图2-5-12添加常用渲染元件  

下面，我们开始 Instance 的创建。在geo1′的 Instance 参数页面，打开 Instancing，将‘null3'拖动到参数页 Instance 上的 Default Instance OP，设置为参考元件，如图 2-5-13。  

![images/c4dc456a7123466670585d89e7fd60ebb70df0a1732a9f2401d6727f32c75fbd.jpg](https://i.imgur.com/Bs0J7tf.jpeg)  
图2-5-13呈现最终画面将NullDAT设置为参考元件  

将 Translate X、Translate Y、Translate Z分别设为 P(0)、P(1)、P(2)，即用'null3"上每个顶点的位置确定Instance 中每一个个体的位置，使x、y、z 坐标一一对应。  

![images/00582ef93af3688ae855906504a192fb2c7669a945d98d6928c130c4832cfdcd.jpg](https://i.imgur.com/fBkjjcc.jpeg)  
图2-5-14对应位置  

##### TIPS  

在 TouchDesigner 中，我们用 P、N等参数描述顶点的位置和法线信息。特别地，在这个表格中 $\mathsf{P}(0)$ ${\mathsf{P}}(1),$ (2)代表每个点 $(\mathsf{x},\mathsf{y},\mathsf{z})$ 的坐标信息， ${\mathsf N}(0)$ $\mathsf{N}(\boldsymbol{1})$ 、N(2)代表每个点法线的 $(\mathsf{x},\mathsf{y},\mathsf{z})$ 向量信息，即法线的朝向。  

![images/463911989df6002a870e2309f5150a93a08ec1ea70afeffb093f1d824f487a2e.jpg](https://i.imgur.com/VUWMiOx.jpeg)  

将 Instance2 参数页面中 Rotate to Vector X、Rotate to VectorY、Rotate to Vector Z 的值分别设为 N(O)、N(1)、N(2)，即每一个基本型的旋转角度都与每个参考元件顶点的法线方向一致（朝外）。  

![images/d32c63e39370b51ea3b2a0026577e73fed866d0d93f02bd75e2c4af0e36609c3.jpg](https://i.imgur.com/yVjFv4B.jpeg)  
图 2-5-15设置基本型的旋转角度  

##### TIPS  

如果打开'null3'的 Display Options 并开启法线显示选项,我们可以看到这个参考元件的法线方向与Instance后模型上每一个小基本形的朝向是一致的。  

![images/59d975133fa399b1b61b6ab563725c41fd5df9e61a75d9def41150aade335671.jpg](https://i.imgur.com/Mp9ikO7.jpeg)  

如图 2-5-16，在 Xform 参数页面，将 Rotate-rx、Rotate-ry、Rotate-rz 参数设置为表达式模式，并用 absTime.frame/8，使整个几何体缓缓转动（通过除以8的表达式我们可以使得数值变化速度变缓）。  

![images/057ed60bcf30e96bb508e7de359aba3633ce23809a60d2954cc146754e7390fb.jpg](https://i.imgur.com/lNkkFZ9.jpeg)  
图2-5-16用表达式模式设置几何体旋转  

##### Geometry COMP

![images/cf448b47581c6ddd8354fa4604c2a605c0b463f7645eba5b4022abafdd2d5a81.jpg](https://i.imgur.com/zu2AMyp.jpeg)  

Instancing（实例化）：打开 Geometry 组件的实例化功能。  

DefaultInstanceOP（默认实例化元件）：总体数据通道的参考元件。通过输入CHOP\DAT\SOP\TOP元件的名字，引I入数据的参照。  

TranslateOP（位移指定元件）：与DefaultInstanceOP（默认实例化元件）功能类似。可以单独指定元件，作为位置信息的参考。相对2019版本的新功能。  

Active（激活）：可以指定本组参考信息的打开和关闭。点击后面三角会出现可以选择的通道。  

Translate×（X轴位移）：可以指定×轴位置信息参考的通道。点击后面三角会出现可以选择的通道。  

TranslateY（Y轴位移）：可以指定Y轴位置信息参考的通道。点击后面三角会出现可以选择的通道。  

TranslateZ（Z轴位移）：可以指定Z轴位置信息参考的通道。点击后面三角会出现可以选择的通道。  

Rotate OP（旋转指定元件）：与TranslateOP（位移指定元件）用法一致。  

![images/6409ae83b6d81fb33d4d4ab305fa330cfe4f8365f2f84dcdc377ac428e969a0e.jpg](https://i.imgur.com/xYDocDF.jpeg)  

如图2-5-17，调整'cam1'的Translate位置参数为(0,4,23)，并将LookAt参数设置为geol'，这样，无论Camera位置在哪里，镜头会始终朝向'geo1。  

![images/4c2d1741565cd4ced9557bddd5fe487241fe0e5f97449d87ea06e55345c2ef4a.jpg](https://i.imgur.com/FMp4rV6.jpeg)  
图2-5-17设置相机朝向  

如图2-5-18，给'geol'添加新的材质Phong MAT'phongl'，并在 RGB 参数页面将Diffuse-diffr、Diffuse-diffg、Diffuse-diffb 参数均设置为 $0.535_{\circ}$  

![images/f55a82f6acb0f09a86313a5cb799e64051a49265de05fc095a8ab2a331730402.jpg](https://i.imgur.com/vZkj5RN.jpeg)  
图2-5-18添加材质  

为了让模型的变化更加丰富，我们对基础形态增加一些简单的动态变化。新建Noise CHOP'noise2'，在Common参数页面打开Time Slice选项，这样可以得到一个不断变化的随机数。并在Noise参数页面将Amplitude 设置为0.8Offset设置为1，得到一个随机变化的数值，如图 $2\cdot5\cdot19\circ$  

![images/b964949c3b2068f53b78e99d8588b3fd9e1edec48022c1e209dff639f80fe351.jpg](https://i.imgur.com/MrH3EbO.jpeg)  
图2-5-19新建Noise CHOP  

在'noise2'后添加FilterCHOP'filterl’，在默认设置下，数据变化会趋于平滑，当我们用这一数据去改变基本形(即开始的'tubel)的高度参数时也会使动态更加自然。  

![images/c29c93092d4cc6e5ebd526ac9282787f659976e21d9ebe3cf45e5b5ec27fcc1f.jpg](https://i.imgur.com/9MRb3GX.jpeg)  
图 2-5-20添加 FilterCHOP 平滑数据  

![images/ac9a302774d474d6bffa08bc83d46012fcf0b4ef54b0a27ec0591bc8a6bb8ced.jpg](https://i.imgur.com/8VTCBaC.jpeg)  

NoiseCHOP常用在产生一个稳定而随机的噪波，默认为一个随机的平滑曲线，曲线是由随机的样本组成。  

Seed（随机种子）：根据Type（种类）选择的噪波模型，用来随机生成对应类型的噪波。  

Period（周期）：改变噪波的周期长度。  

在'filterl′后添加 Null CHOP 'null4'，并将'null4'的 chan1 通道通过表达式赋予在'tubel'的 Height 参数，让高度参数随机变化。这样，我们可以看到在'renderl'中渲染的图像在细节上，每个基本元件的高度也发生了不同变化。  

![images/9f1ac3fd09c6ee3e983a04bf7063faf3716ca153d777592f27c6236a14093178.jpg](https://i.imgur.com/2la32jW.jpeg)  
图 2-5-21高度参数随机变化  

完成之后，如图 2-5-22，我们在'render1'渲染的图像基础上建立 Feedback Loop。其中Transform TOP 'transform2'的参数 Scale-sx、Scale-sy 稍增大至约 1.013, Level TOP "levell'的参数 Opacity 稍减小至约 0.914，让画面产生放大淡出的光晕。  

![images/18f34e722d79bf7ef5a1f323c1da7bd90c4b68be35b914eff801d2d684003b5e.jpg](https://i.imgur.com/9tx5f3x.jpeg)  
图 2-5-22构建 Feedback Loop  

接下来，我们仿照第 2.1章节的颜色映射方法（参见第 46 页），为图形进行上色。新建Ramp TOP'rampl'，如图 2-5-23，设置或者自定义一个色谱。  

![images/c934221db91e5bc0163896bd6dbc25594f63cc8a68e7ccab5b751eff77db031c.jpg](https://i.imgur.com/lV2pAkV.jpeg)  
图 2-5-23新建 Ramp TOP 自定义色谱  

如果需要整体调整饱和度，可以在'rampl'后添加 HSV Adjust TOP'hsvadjl'，适当调整 Saturation Multiplier 参数,可以提高画面的饱和度，如图2-5-24。  

![images/9b73d2690f513e4a724de812630faba522ab74345c55fd836d3547c47e053f80.jpg](https://i.imgur.com/VeawSMJ.jpeg)  
图 2-5-24提高饱和度  

![images/c73aafe03167819f8afa6c8e6d2c1fbc248030afc675e7bc484131bcb9634bc2.jpg](https://i.imgur.com/qSrk3G2.jpeg)  

StartColor（起始颜色）：设置调整的起始颜色的位置。  

Hue Range（色调范围）：（Hue值图，参见第 47页）将要调整的起始颜色的色调范围，如果范围是1，就只调整起始颜色。如果范围是360，将调整所有的颜色。例如，HueRange（色调范围）选择20，StartColor（起始颜色）选择40，将会调整30\~50的色调范围内的颜色。  

HueFalloff（色调衰减范围）：控制色调范围的衰减。较大的色调范围会产生更多的衰减。  

HueOffset（色调偏移）：调整起始颜色的偏移度，其范围是 $0\sim360_{\circ}$ 例如，若所选色调值是180（青色），HueOfset（色调偏移）的参数设置为100，那么颜色将偏移为280（紫色）的色调。  

然后，将'compl'的结果与"hsvadj1'作为新建LookupTOP'ookupl'的两个输入端，得到上色之后的模型。  

![images/bcc673ed72cb36fe2fdd14fa26bd050fd050f0a041d0bbc7bb4cdc43263bfa92.jpg](https://i.imgur.com/FZmaakb.jpeg)  
图2-5-25将渲染出的模型上色  

我们进一步丰富一下细节。在'compl 后再分接一个 Edge TOP'edgel'，给图像勾边，参数 Strength 数值调整为 0.33,如图 2-5-26。  

![images/4799f7b1c1ac4b62fc8e6839a9315ac1d71e47767ded6f3315488e798bd1823a.jpg](https://i.imgur.com/fxGl6eK.jpeg)  

![images/ce06cfe286f30bf3813d22fcb581e0ae1d97970d127d75efab67789e8ae77935.jpg](https://i.imgur.com/3smwL0z.jpeg)  
图 2-5-26给图像勾边  

在'edgel′后添加 Level TOP‘level2'，将 Brightness1 调至 0，将勾边颜色压黑，如图 2-5-27。  

![images/ae6b120cda1913474867e4112650a26f9c7fa98e500de208a35815d953de73bb.jpg](https://i.imgur.com/1skjC1B.jpeg)  
图 2-5-27调整勾边亮度  

新建 Composite TOP'comp2'，以层叠的方式（参数 Operation 设置为 Over）将"level2'置于“lookup1'的画面之上,如图 2-5-28。  

![images/16fef46d784106289ef75f5db8b3d895c546c3f16cdf67f4c299f9415529dbef.jpg](https://i.imgur.com/gkNnur6.jpeg)  
图 2-5-28 新建 Composite TOP  

画面效果可以进一步微调，例如，'phongl'的 Diffuse-diffr、Diffuse-diffg、Diffuse-diffb 统一设置为 0.535，调整几何体的明暗；"lightl'的参数 Dimmer 设置为 1.2、参数 Shadow Type 设置为 Hard,2D Mapped，调整几何体的光影细节。习惯性地，新建NullTOP并命名为'bg作为最后一个元件。  

![images/1cd96e6cb7526587598488131a2e0e751091163e8edb54b242a0efc741b4c447.jpg](https://i.imgur.com/W0V4VSh.jpeg)  
图2-5-29新建Null TOP'bg  

返回到/projectl层级，如图 2-5-30，利用表达式使'container1′与其内部的"bg’长宽保持一致。将'containerl′的Background TOP 设置为./bg，这一案例就制作完成了。  

![images/0c45a821717991e42c8075adca69b7d6573a921515eb1187a8ecb4023ddec261.jpg](https://i.imgur.com/zKAhMEX.jpeg)  
图2-5-30设置长宽像素与内部元件一致  

![images/a31617d16644df866ff498c01e0507c9492bc7e77e28093c9a4693a1919ff5bc.jpg](https://i.imgur.com/W1HaDPf.jpeg)  
图2-5-31最终效果  

## 2.6 声音可视化呈现

在视觉交互领域，我们会大量地用到外部数据来驱动图像的生成和变化，也就是常常说到的数据可视化（DataVisualization）。在传统的VJ演出中，VJ通过MIDI键盘来切换不同的预设视觉效果。在本章节中，我们将突破传统的视觉创作手段，用 TouchDesigner 强大的数据转换和处理方法，将音乐节奏和韵律以实时视效的方式呈现出来。  


### 实战案例: 实时交互音画互动  

在本案例中，我们将学习如何导入音频文件，用音乐驱动一个线性的三维图像，实时生成不同的视觉特效。作为本章节的最后一讲，我们将综合性地结合之前的内容，同时引I入CHOP 元件，以及讲解不同类型元件组之间的转换方式。  

![images/a263375c5fb8aa1449027f865b3137633dbc83ddde736b3eff86720f6398696c.jpg](https://i.imgur.com/SkI9YKE.jpeg)  
图 2-6-01在编辑区的最终效果预览  

〉新建一个TouchDesigner工程文件，删除此层级默认元件。如图 2-6-02，新建Container COMP'containerl'，将鼠标移至此元件上，滑动鼠标滚轮进入'containerl'，我们将在此容器中制作本章节的声音可视化项目。  

制作音画互动，首先需要导入音乐文件。新建AudioFileIn CHOP'audiofileinl。这个案例中，我们直接使用默认的音频文件，也可以在参数File里选取音频文件。因为案例中可视化只需要一个声道，我们可以打开Mono选项，保留一个声道。  

![images/f9f8d351f0d56f20caaffba825b1fac1483d59f224e14b4126e4488c06343a9c.jpg](https://i.imgur.com/Y6qzKEh.jpeg)  
图 2-6-02新建Container COMP  

![images/e3b89833757a9bdb99ebebe15f38679c8f869c167d0e6e4aed736176270d79ee.jpg](https://i.imgur.com/9GRmIma.jpeg)  
图 2-6-03单声道音频输入  

##### IAudio File In CHOP

![images/a3ac80e2461ca858d379faabcbe5e217521aee95e869b6d2f0bd88746f306b1c.jpg](https://i.imgur.com/u1PLyzb.jpeg)  

![images/3448be3cff7efc61a76f4d496115fb4a165da21e8932ee1726c55f1b11d2ac68.jpg](https://i.imgur.com/u1Nx3Xn.jpeg)  

Trim（剪切）：剪切音频。  
TrimStart（剪切开始点）：剪切音频的开始点。  
TrimEnded（剪切结束点）：剪切音频的结束点。  
Mono（单声道）：将多声道文件转为单声道。  

AudioFileInCHOP是用于导入音频的元件。可以读取磁盘中音频文件或网络音频文件的地址。支持的文件类型包括：.mp3、.aif、.aiff、.au、.wav 等。  

File（文件）：指定文件路径。除了本地的路径，也可以为互联网上的地址（以http 或https开头）。  

Reload（重新加载文件）：重新寻址定位文件位置。  

Play（播放）：音频的播放与暂停。  

PlayMode（播放模式）：LockedtoTimeline（锁定到时间轴）将播放位置锁定到时间线上时，时间线改变播放位置改变，不能使用播放、重置、速度和索引l的功能；SpecifyIndex（指定索引I）可以使用输入CHOP的参数指定歌曲中的特定位置；Sequential（顺序）最常见的独立播放模式，时间轴改变，播放顺序也不会变。  

Speed（速度）：在播放模式为Sequential（顺序）时可以调节播放速度。0.5是半速度，1是正常速度，2是两倍速。  
Cue（开始播放）：从指定位置开始播放音频。  
CuePoint（起始播放点）：设置开始播放点。  
Repeat（重复）：循环播放音频。  

在创建了音频导入元件之后，我们并不会听到任何的声音，这是因为我们需要创建一个播放器元件AudioDeviceOutCHOP进行音乐的输出。特别地，我们每个播放器都可以指定输出的声卡和声道，通过任意多个外放设备进行播放，制作立体环绕效果。  

如图 2-6-04，在'audiofilein1'后连接AudioDeviceOutCHOP'audiodevoutl’，这样音频可以通过扬声器播放出来。在Device参数中可以选取特定的输出设备。  

![images/6258eb05299217c8b5ae83df2558cc1219caba364fa1649d74f68ce5a7881ced.jpg](https://i.imgur.com/K7Acws6.jpeg)  
图2-6-04利用默认内置扬声器播放音频  

![images/095eed7cbdeae0d7480cfe9fae4c8a451ab46a57497faead82f508c5ffb6af44.jpg](https://i.imgur.com/CxzjZ6n.jpeg)  

Active（启动）：启动或者关闭音频输入。  
Driver（驱动）：声卡驱动，常用的驱动有DirectSound、ASIO 和 Datapath。  
Device（设备）：选择外设音频设备。  
BufferLength（缓冲区长度）：音频缓冲区的长度（以秒为单位）。对音频进行一定时间的缓存后输出，从而使音频播放更加流畅。  
Volume（音量）：调整声音大小。  

##### ■ Audio Spectrum CHOP

'audiofilein1' 后新建 Audio Spectrum CHOP'audiospect1',这样，我们可以直观地看到输入音频的频谱（声音的频率分布图），这是我们可视化将用到的原始数据。  

![images/faa24bd6c564a3aed315df46bccaa1c402f3a98751601b441cf0a58f513ad775.jpg](https://i.imgur.com/UP4RBX1.jpeg)  

AudioSpectrumCHOP在默认模式中，通过强调较高和较低的频率范围，以更容易理解的可视化方式显示音频频谱。  

High Frequency Boost（高频增强）：调整高频部分的音量增益。  

![images/963cbf776b2c3832f7ed409a6f951a757d590501c48aada39dbbb2ad9c03ef80.jpg](https://i.imgur.com/kxWbJA4.jpeg)  
图 2-6-05 新建 Audio Spectrum CHOP  

![images/1e8b2bf480c0f1680ee912f8dae0d0403ba5ee36352b2544c4c67b93ad9919ec.jpg](https://i.imgur.com/5sRJeA3.jpeg)  

Set Output Length（设置输出长度)：在 OutputLength 参数中，当选择 Set Length Manually（手动设置长度）模式时，可以调整所需音频样本数，样本越少，采样数越少。  

通过'audiospectl'可以看到，数据 channel 中有大量采样点，而进行可视化操作并不需要这么多的采样点，我们可以通过新建 Resample CHOP'resamplel'，并在 Common 参数页面关闭 Time Slice 功能，对 Channel 进行重新采样。  

![images/b76618a7b4f2368ecb94677fad0b664417848ac5f75812ee6ba7d59fa2b9b6cb.jpg](https://i.imgur.com/dADqZyO.jpeg)  
图 2-6-06 新建 Resample CHOP  

在 Resample 参数界面，Method 参数选为 New Rate, New Interval 模式可以拉伸或压缩 CHOP 通道。Unit Values参数设置为Absolute，范围是从第1个采样点起，第 $500^{\star}20$ 个采样点止，因为接下来要创建 $500^{\star}20$ 的位图。  

![images/386d8746603150ed5b2f807cd727bc45a360be94f1c85f46066680471f465fb8.jpg](https://i.imgur.com/DCqh29b.jpeg)  
图 2-6-07设置采样点  

![images/64b628136bd8027f300f358f50ce2004b9fa639f3bc6109f1511ff1e0b45f242.jpg](https://i.imgur.com/jYeWa1B.jpeg)  

Method（方法）：用于频道重新采样的方法。SameRate,New Interval（相同速率，新间隔）拉伸或压缩CHOP的通道；New Rate,SameTimeRange（新速率，相同时间范围）更改采样率而不更改CHOP的时间长度；New Rate,Same Index Range（新速率，相同索引范围）更改采样率而不更改CHOP中的样本数；NewRate，NewInterval（新速率，新间隔）更改采样率并拉伸或压缩CHOP。  
SampleRate（采样率）：设置新的采样率。  

在获取了音频数据之后，我们开始做数据的可视化处理。在接下来的部分中，大家会看到数据是如何通过音频采样 $\rightarrow$ 二维图像 $\Rrightarrow$ 三维图像 $\rightarrow$ 摄像机渲染的过程。  

我们先来看看 $\mathsf{C H O P}\to\mathsf{T O P}$ 这个步骤的最终效果：我们将用音频驱动一个水流状的效果，如图 $2\cdot6\cdot08_{\circ}$  

![images/3abd1bc3da008a1ed03b1bc5e3d017597d3e0051a6461d3ea0a4b68af0750901.jpg](https://i.imgur.com/3SW6HYP.jpeg)  
图2-6-08CHOP到TOP最终产生的水流状效果图  

为了获得适用于可视化的图像，我们将进行第一次的数据转换，把CHOP的原始数据转换为TOP图像。在'resamplel'后添加 CHOPto TOP'choptol，将数据通道中的采样点及其数值通过图像的像素亮度体现出来。  

![images/154c628e0db08feda3a543a544987032472df074f3bef455558011f2a794c61c.jpg](https://i.imgur.com/F4U7AuD.jpeg)  
图2-6-09将CHOP转换为TOP  

##### TIPS  

CHOPtoTOP的原理是将输入端的CHOP元件用像素描述出来。如图2-6-09，‘resample1'的横坐标代表着水平像素的分布，纵坐标代表着Value（明度）值，DataFormat中的R说明了这个图像反映的是红色R通道中每个像素的Value(明度）值，数值越靠近1，在TOP 中显示的像素点越亮。由于输入端只有一个Channel，所以在'choptol'中，纵向像素为1，水平像素为输入端的采样数（水平坐标） $10000_{\circ}$  

接下来，我们要对这个单行像素进行纵向拉伸。如图 2-6-10，在'choptol′后添加TransformTOP'transforml，并在Common 参数页面将Output Resolution 设置为Custom Resolution，宽resolutionw 为 500，高resoluationh为 20，将Output Aspect参数的长宽比输出设置为Custom Aspect，默认情况下按照1:1输出画面，我们就得到了一个分辨率为 $500^{\star}20$ 的图像。  

![images/763e47e357ccf544b7577eff32de6aadefae2f2db5640c97d8a197e5fe9677b3.jpg](https://i.imgur.com/WwZ3JPX.jpeg)  
图2-6-10拉伸图像  

##### TIPS  

在TOP元件中，我们可以使分辨率的长宽比例和元件显示比例不一致。如图2-6-10，虽然输出的分辨率是 $500^{\star}20$ 但是显示比例是1：1，这是因为我们将每个像素强行拉长了。  

在 Transform 参数页面，将 Scale-sy 设置为 0.1 以将原图像压缩到十分之一的高度，将 Translate-ty 设置为0.5，注意单位为F即Fraction（比例），使图像处于画面最上方，如图 2-6-1lo  

![images/bf026ee802915eb58e388b26542bf59742dbb6eee41ab287aa7c1b3abd025f0a.jpg](https://i.imgur.com/vnjBAlP.jpeg)  
图 2-6-11调整图像位置  

在'transforml'的图像之后构建 Feedback Loop，如图 2-6-12，使最上方的像素像瀑布一样落下、淡出。其中,Transform TOP 'transform2'参数 Translate-ty 设置为-0.01，即每次循环向下位移一次; Level TOP"level1'的参数Opacity 设置为 0.99，即在循环过程中不断淡出；Composite TOP'compl'的 Operation 参数设置为 Add，这样我们就得到了一个有明暗渐变的图像。调高音量，我们可以明显地看到'comp1'中的图像跟随着音乐节奏在变化。  

![images/2513285b4861e77ed5c38bb8dedd3599ae8b67040c5db0691dbe324c21383aee.jpg](https://i.imgur.com/7C7bkQY.jpeg)  
图 2-6-12　构建 Feedback Loop  

在这部分的最后，我们习惯性地给当前图像添加 Null TOP'null1'元件，如图 $2\cdot6\cdot13_{\circ}$  

![images/205fa96cba0cf07c5d27549ef81053b2f0e46b944758162f079f8c5953f76506.jpg](https://i.imgur.com/vfNRUrx.jpeg)  
图 2-6-13添加 NullTOP  

下面，我们将把TOP转换为CHOP，然后利用新的CHOP元件去驱动SOP元件中的图形变化。这里开始变得有些复杂了？深吸一口气，我们继续一步步做下去，向最终的目标前进。  

右击'null1'右侧输出口添加 TOPto CHOP'topto2'以获取图像的像素信息，对于黑白图像，如图 2-6-14，我们只保留r一个通道，将参数 Green、Blue、Alpha 清空不显示（这是因为RGB 在黑白图像中的值是完全一样的）。  

![images/1dc85677f6d601fb2d2a2b4bc327ac283945e5509e749fb1f07dd0a579c07739.jpg](https://i.imgur.com/MddqxOk.jpeg)  
图2-6-14获取图像的单个CHOP通道  

之后，在'topto2'元件的Crop参数界面，将Crop参数（裁切方式）选为RowsandColumns，参数VStart设置为O，即不对画面做裁切，可以获取画面中所有像素点的信息（TOPtoCHOP中每一通道各代表着TOP图像中每一行像素点的数值）。  

![images/5b9c7d79e70f973c412ac49d94276a9575305a2d920c97f36968e81824b96019.jpg](https://i.imgur.com/0CsANDx.jpeg)  
图2-6-15获取画面所有像素点信息  

##### TIPS  

图像UV坐标图 $(\mathsf{U},\mathsf{V})$ 代表着像素位置，如下图看到的那样，（0，0）代表着一张图片最左下角的那个像素点， $(1,0)$ 代表着右下角的像素点，而(0,1)代表着左上角的像素点。所有的坐标表示都不是以实际像素（例如 $1920^{\star}1080)$ 来作为UV坐标值，而是统--用0和1来描述一个像素点在整张图中的比例位置，我们只要将这个数值乘以实际的长宽值，就能得到实际的像素位置。例如：在1080P的图像中（0.5,0.5）就代表着（960,540)这个正中央像素的位置。  

![images/deb809816dbccf6f9b8039fbeb95469b54893ad7059e2aee26a416c77b52a2f1.jpg](https://i.imgur.com/lHoqNgZ.jpeg)  

由于此后的CHOPto SOP要以一个标准的数据通道作为输入，所以我们需要用一个通道去描述整张图的像素值。在'topto2"之后添加 Shuffle CHOP'shufflel'， 将参数 Method 选为 SequenceAll Channels，将'topto2'所有通道的数据首尾相接成一个通道。  

![images/642a1d5801aaefa8b4f9179397ec892b3cd35183937e85e7f72c621e4b5a722f.jpg](https://i.imgur.com/iBY5RaQ.jpeg)  
图 2-6-16添加 Shuffle CHOP  

##### TIPS  

在这里，我们提示一下图像 ${\mathsf{T O P}}\to$ TOP to ${\mathsf{C H O P}}\to$ ShuffleCHOP的采样规则。  

我们以一张 $4^{\star}4$ 像素的黑白渐变图像为例，对它进行TOP toCHOP 的采样，以及使用 Shuffle CHOP 的 Sequence All Channels的方法排列通道，如下图。  

![images/98053bcb6a9c0d5b5ee1dcee3e53959e1886f70c868922f4296772266c5b2076.jpg](https://i.imgur.com/3OaAdA5.jpeg)  

如下图，我们将每个像素点标出序号，根据每个像素的序号可以清晰地看到TOPtoCHOP的采样规则是从图片的左下角开始从左到右、从下到上逐行采样，采样后最上面的通道就是图像最下面一行的像素，因为图片尺寸为 $4^{\star}4$ 像素，所以topto1'有四个通道。在'shufflel'中每一个峰值就代表着一行，所以我们可以直观地看出有4行像素，它将'topto1'的四个通道首尾相连，16个像素被依次排列在一个通道上。  

![images/8e3b6e09652086372959c5a488691663cca91a753aa8df1cfeaaa8203a28e89c.jpg](https://i.imgur.com/jvpxgQd.jpeg)  

在'shuffle1'后连接RenameCHOP'renamel’，将通道重命名为tz。这一组数据之后将用于确定下面的几何体中每个顶点的z轴坐标。  

![images/3cda8470bbce88456490f8ae8ea4197d3b6d11c2c3f4ad92082205bc1e6dce53.jpg](https://i.imgur.com/Ct6TgE9.jpeg)  
图2-6-17重命名通道  

##### TOP to CHOP

![images/c38a01b96c1c7a2d9d0d535590a50ed465ee5494e285deb6d348a5a204d980d2.jpg](https://i.imgur.com/DzB1mMI.jpeg)  

TOP：输入TOP元件名，对其做采样运算。Red（红色通道）：扫描TOP 图像中每一行红色像素的值并创建一个 CHOP通道，并可以进行重命名。  

Green（绿色通道）：扫描TOP图像中每一行绿色像素的值并创建一个CHOP通道，并可以进行重命名。  

Blue（蓝色通道）：扫描TOP图像中每一行蓝色像素的值并创建一个CHOP通道，并可以进行重命名。  

Alpha（透明通道）：扫描TOP图像中每一行像素的透明度并创建一个CHOP通道，并可以进行重命名。  

RGBA Units （RGBA 单位）：可以将输出缩放到0\~1，0\~255或0\~65535 范围内。  

![images/9538bdcfc91103196879f4f962b684b63d11f2ccef69112978903a4c90d78863.jpg](https://i.imgur.com/1iTXjDC.jpeg)  
Crop（剪裁）：从图像中指定提取的内容。  

##### Shuffle CHOP

![images/b696c28d42120ed4fedc9fd15786dce1416c39c3187dbb39ceebd00d63150e88.jpg](https://i.imgur.com/Byvh5fc.jpeg)  

Method （应用方式）：Swap Channels andSamples（交换通道和采样）交换通道数量和采样数量，例如5个通道每个通道10个采样，置换后变为10个通道，每个通道5个采样； Sequence Channels by Name(按照通道名字顺序排列）按照其名字顺序将通道组合在一起； Sequence All Channels（所有通道按照始末顺序排列）；Sequence NChannels（N组通道按照始末顺序排列）将通道分为 N 组排列; Sequence Every NthChannel（按始末顺序排列每N个通道）。  

![images/5fd72e7c1a4de2658698bb0d971c164a5bc6fe2571b982f9ea4127ca5ed59566.jpg](https://i.imgur.com/sXArEjV.jpeg)  

下面，我们就要开始制作一个三维基本形态，然后用上面得到的数据去驱动这个模型的顶点变化。如图2-6-18，新建GridSOPgridl'，将Primitive Type 设置为Polygon（多边形模式），其大小设置为 $1.6^{\star}0.3$ ，Rows 为 50，Columns 为 $200_{\circ}$  

![images/a4e21eaae52c946b81048f59d116f944221c64e3b7454583989a81c3e33eb5c5.jpg](https://i.imgur.com/oOuHl5t.jpeg)  
图2-6-18新建 Grid SOP  

参数Connectivity（连接方式）设置为Rows，只连接同一行上的点（grid1'制作了一根根细长的线），并关闭TextureCoordinates和ComputeNormals选项（这里我们不需要法线和贴图）。  

![images/b89bc6d26623e05cba3d287e916752522a943bdb38ac932280ef57ac3c23f363.jpg](https://i.imgur.com/Deh9oJ0.jpeg)  
图 2-6-19将模型转为线条  

##### TIPS  

我们先来看一下 ${\mathsf{S O P}}\to{\mathsf{C H O P}}\to{\mathsf{S O P}}$ 的变化流程，这是一种通过改变三维图像中某一种参数的方法来重建一个基本型（在本案例中我们替换tz值，即每一个坐标的高度值来让这个基本型动起来）。  

![images/6910a42cbf552884b56772ee3a7fc7ee87520b78740c822663afa2944b3ebbc7.jpg](https://i.imgur.com/uGYywgI.jpeg)  

首先，右击'grid1'右侧输出口添加 SOPto CHOP'soptol'，获取几何形体上每个点的坐标信息。为了将'soptol'中的tz 通道替换为我们准备好的'renamel'中的tz通道，新建 Replace CHOP'replacel'，以'soptol'为第一输入、‘renamel'为第二输入。  

![images/4bf8631a3c7c75f30ccab04a70257d6fc914333381c0993faa196536f95ede2d.jpg](https://i.imgur.com/WrFKnOA.jpeg)  
图 2-6-20替换通道  

![images/4a286f6e83bef7a573feaa8b2751fa518425e8ffc491d71829e6d7a66906ccdc.jpg](https://i.imgur.com/BRY29AV.jpeg)  

在'replacel′ 后新建 Null CHOP 'null2'， 在'grid1'后新建 CHOP to SOP 'chopto2'′， 并将'null2' 设为'chopto2"的映射参数（直接将'null2'元件拖到对应参数中）。  

![images/917ba4087ee97a0b6459bc184ec3a48607cb162c37da7be290ea2f5575e8db8c.jpg](https://i.imgur.com/hGXoc1p.jpeg)  

![images/942813c34e2d66941f83632cc2ab9bbe7ac7af4fd119d2dfb14c57dbbbec9eea.jpg](https://i.imgur.com/v6fLQgM.jpeg)  
图 2-6-21新建 CHOPto SOP  

##### TIPS  

如图 2-6-21， Channel Scope 指的是'null2'元件中的三个坐标通道 tx，ty，tz，Atribute Scope 指的是输入元件'grid1'中的每个顶点 $(\times,\vee,z)$ 的坐标值。意味着在'chopto2'中，我们用'grid1'作为输入端的基准三维模型，但是模型上每个顶点的位置都由'null2'中的通道值来描述（这和 Instance 原理很相似，参见第69 页）。  

##### CHOP to TOP

![images/319966f17eb388cd8a736f28f6377949d9e64c4489f68eb57a906c4831761acb.jpg](https://i.imgur.com/oaOe1rk.jpeg)  

CHOPto根据CHOP通道的数值，转换成TOP图像。  
CHOP：输入引I用的CHOP名称。  
DataFormat（数据类型）：选择需要的CHOP通道。  

至此，我们已经完成了一个动态变化的三维图形，在'chopto2'后连接 Null SOP'nul3'准备下一步工作，制作视觉特效，如图 2-6-22。  

![images/6e5d874c5a4ceeab30173ade6385b6ea7607a2c9e2065e781f430df8d258acc4.jpg](https://i.imgur.com/m19i8vB.jpeg)  
图 2-6-22连接 Null SOP  

如图2-6-23，添加渲染的常用元件GeometryCOMP'geo1′（右击'null3'右侧输出口添加元件，可以将'null3'和'geol'直接建立关联），并添加Camera COMP'cam1'和Render TOP'renderl’，之后给'geol'添加材质ConstantMAT'constantl’，将几何体的图像渲染出来。  

![images/53d7ad4835e25c5e497ad41f13bf0b499584a1d0729d9cc8af7037b907a9007e.jpg](https://i.imgur.com/5LxX4n0.jpeg)  
图2-6-23渲染出图像  

如图2-6-24，通过调整位置、角度等参数对画面进行构图。  

![images/7ba1cb5b3eb8d864e325c0cb3bca7881f09656788f948f768214d677b2b29abb.jpg](https://i.imgur.com/pzX4XmE.jpeg)  
图2-6-24调整构图  

除此之外，我们还可以在'shufflel'和'renamel'之间添加 Math CHOP'mathl'，增大或减小参数 Multiply的数值，控制几何体的起伏幅度。这里将 Multiply 数值设为 0.6 以减小z 轴方向上波动的幅度。  

![images/1c4905eb591cea690d2704ced68330a4673222bbf573e17726f1c73d2ceef3d3.jpg](https://i.imgur.com/qFdJKBW.jpeg)  
图 2-6-25改变起伏幅度  

在'render1'的图像基础上，如图 2-6-26，构建 Feedback Loop，使图像带有拖尾、放大、淡出的效果。其中,'transform3′的参数 Translate-ty 设置为 -0.001，Scale-sx、Scale-sy 均设置为 1.006，即每次循环向下位移一次并放大一些；“level2'的参数 Opacity 设置为 0.834，即在循环过程中不断淡出，‘comp2'的 Operation 参数设置为 Add。  

![images/e4803a4d9548d397d87e7311e716533a67522d0a25ada817b763e65359df95e8.jpg](https://i.imgur.com/b8zXXjI.jpeg)  
图 2-6-26构建 Feedback Loop  

如果想要进一步丰富画面，可以在 Palette 插件区的 ImageFilters 列表下,挑选已经搭建好的图像处理模块。如图 2-6-27，这里使用了 rgbaDelay 模块使图像发生r、g、b、a 通道的分离，制作出三原色通道错层的效果。  

![images/4bb5ede9b46696e55cb8f6fe0a631fd9b429d3d319a84c167f4eadfc70c0ff5f.jpg](https://i.imgur.com/exHKi3v.jpeg)  
图 2-6-27使用 rgbaDelay 模块  

##### TIPS  

Palette是TouchDesigner中的插件区，里面涵盖了很多视觉处理、系统数据调用以及硬件交互的插件，可以很快达到预期的效果。特别地，每一个插件也都是由TouchDesigner中 COMP、TOP、SOP等基本元件构成的。我们可以通过位于编辑器左上角的Palette按钮进行菜单的显示与隐藏。  

![images/5ccf4818236a9b35c84e3b54e69d43b4265a230941c1bd7129e1f2f5e1e9d7b1.jpg](https://i.imgur.com/U0RmToy.jpeg)  

![images/e12fa99214bd19f715ffbe7bfe95bf879db2ec0a67aceb941e4b345fca7289b2.jpg](https://i.imgur.com/gmDFtFP.jpeg)  
 

按照惯例，创建 Null TOP'bg'作为最后一个元件。  

![images/efffa8da8aeddeea3b108eaf4a866d2a14c069289126f354a13c347b40b5446c.jpg](https://i.imgur.com/3SwE40v.jpeg)  
图 2-6-28连接Null TOP  

返回/projectl 层级，如图 2-6-29，利用表达式使'containerl'与其内部的'bg’长宽保持一致。  

![images/7e4b45e7c9cdf069c36df17723677f213fadb8c5a515318c56283d49e2271c8a.jpg](https://i.imgur.com/LI94VG6.jpeg)  
图2-6-29用表达式设置长宽与内部元件保持一致  

将'containerl'的 Background TOP 设置为./bg，这一案例就制作完成了。  

![images/facc82e6e3db4ec7796c4399495a3437aeb8db83cacb09086408ec6c9ef9342d.jpg](https://i.imgur.com/kQvAlAq.jpeg)  
图2-6-30设置窗口播放显示  

最后，我们看一下全屏之后的最终画面效果。  

![images/7370416b178398a64aac43bf3ad90b5604f09355c84d3451ea9c9e259a95f537.jpg](https://i.imgur.com/XTxhcf4.jpeg)  
图 2-6-31音频可视化最终效果  

# 第3章 音画展演现场

TouchDesigner在不同领域内的强大适应性，是让其在全世界新媒体艺术展示和教学领域内被广泛采用的重要原因。  

无论是实时特效渲染、数据可视化、三维投影还是VJ系统，TouchDesigner都能以其全面的功能轻松应对。  

TouchDesigner高度集成化的系统和便捷灵活的可视化编程方式，让视觉创意更容易实现。  

3  

![images/c5fa649dfd4e2c2828cdb988af753fededb15673ff2eab9bd8da9ff398244be8.jpg](https://i.imgur.com/pFbCh4b.jpeg)  

## 3.1 构建参数化模型

本节将讲述如何通过Instance功能，构建一个可交互的复杂参数化模型。使用参数化的方式制作视觉系统，优势在于灵活多变，可控参数非常多。这为视觉内容后续与声音、软件、设备的互动联通，做了系统的准备。  

### 实战案例: 一棵圣诞树——构建参数化模型  

本案例中，我们将利用几个TouchDesigner 中最基础的元件，快速制作一个有趣的圣诞树效果，如图3-1-01。在之后的章节中，还会引入声音驱动、软件控制、硬件交互等手段，对此视觉系统进行拓展和舞台演绎；最终生成我们自己的NFT作品。  

![images/b4df0340aeb64171c3fb8d1adf06ef9dcda9b8c2d009063e32053b59c4a59b95.jpg](https://i.imgur.com/FYOVquL.jpeg)  
图 3-1-01最终效果预览  

>首先新建一个ContainerCOMP，并将其命名为'container_Instance’，如图 3-1-02。在这个容器中,我们将通过单片树叶渲染制作、单片树叶实例化克隆、制作树干等步骤，最后进行更多视觉处理。  

![images/598bd7c2ac8a2250ab743bd8c91f4f7e29ba23c51b82317d6c82271770e43395.jpg](https://i.imgur.com/DOPi0Mx.jpeg)  
图3-1-02新建'container_Instance  

为了制作一个基础的树叶，需要准备一个如图3-1-03所示的在三维建模软件中制作的树叶模型（你可以自己在三维建模软件中制作，或下载本章节工程文件获取模型，下载链接见第41页)。  

![images/0126a398e39be0f142d79fa6c975c1d8611db406bdee4ce20b4aba31fd248604.jpg](https://i.imgur.com/RF61CPR.jpeg)  
图3-1-03单片树叶三维模型  

##### 渲染一片树叶

我们先利用基本元件构建并渲染出一片树叶，如图3-1-04。  

![images/ae57fd6f23c679872996197fc0af122a1e501dd1ceda63d4e06cb2a752619895.jpg](https://i.imgur.com/suZR6b8.jpeg)  
图3-1-04树叶渲染最终工程预览  

将树叶的基础模型（建议为.obj文件类型）拖入TouchDesigner 编辑区，如图 3-1-05，可以看到自动生成了一个File In SOP元件，将其命名为'leaf。  

![images/eff47f61f957a4da2d81e631427aac73635f9060da98c1e40b46c6d71788e430.jpg](https://i.imgur.com/AuyPags.jpeg)  
图 3-1-05拖动外部模型进编辑区  

如图 3-1-06 所示，在"leaf 右侧输出端口点击右键，新建 Geometry COMP'geo1′元件，再增加 Camera COMP'cam1'、Light COMP'lightl'、Render TOP'renderl'，搭建基础渲染框架。  

##### TIPS  

如何在两个已连接的元件之间插入元件？  

![images/a7126cd74f50bd5732921fdd5d6fdb907df494ea9c662592aaa44e8037e21ab1.jpg](https://i.imgur.com/16YptCG.jpeg)  
图 3-1-06渲染框架搭建  

鼠标放在连接线上 会显示黄色的高亮，鼠 标右键点击，弹出窗口， 选择 Insert Operator。  

由于建模软件的单位不同，叶子的模型较大，我们需要对它进行缩小，如图3-1-07。因此在“leaf'与'geol'两个元件之间插入Transform SOP'transforml'，调整UniformScale（整体大小）至 $0.01_{\circ}$  

![images/5cf8a1cf4863bae4f8e5f5304a893052c9008170ceb79864845e6fba279f5968.jpg](https://i.imgur.com/8gqB8SL.jpeg)  

![images/e83d19d3cd5a79f543f1746f4b7f6495f56c876fcd679396b61b8680698bb838.jpg](https://i.imgur.com/3eCxcIV.jpeg)  
图 3-1-07模型整体缩放  

##### TIPS  

PBR （ PhysicallyBased Rendering）是一种物理反射材质，可以更加真实地模拟物体表面的光线反射情况。  

![images/e06dee511ea6af61ba292acf14ef779514bfa17021b8accda95dfb76972a33d9.jpg](https://i.imgur.com/eG2Q2B2.jpeg)  
图3-1-08给模型赋予材质  

接着，我们要给叶子添加 PBR 材质，如图 3-1-08。  

新建 PBR MAT'pbrl'，将此元件拖动到'geol'上，可以看到自动弹出窗口，选择第一行Parm:Material，即给'geol'添加上PBR的材质属性。  

PBR材质还需要添加各种贴图来配合使用，因此，新建 Substance TOP'substancel'，将此元件拖动到'pbrl′上，弹出窗口，选择第一行 Parm:SubstanceTOP。此时，'render1'产生了黄色感叹号，点击感叹号查看，如图 3-1-09，提示模型缺少 tangent attributes (切线属性)。  

![images/3cb47d3cbc56aa0177267909d5fa52e1aac53cce968ce9928c5b9ffa8fa52334.jpg](https://i.imgur.com/cQr7nN2.jpeg)  
图 3-1-09缺少切线信息提示  

为了解决这个问题，如图 3-1-10，在'transforml′和'geo1′中间，插入元件Attribute Create SOP'attribcreatel'，并在其参数面板中打开 Compute Tangents（计算切线）开关。这样，就可以解算出模型的切线信息，解决缺少切线属性的问题。  

![images/3bee3cbc54ec9a5dab7ba3573ec948bdd6f799b8ab9977c35d26165fe97364b2.jpg](https://i.imgur.com/9OFTA27.jpeg)  
图3-1-10缺少 UV 信息提示  

![images/9ed78eb7b63e4e591184bc576b96c6fdd3c9e68437abe8450b98a182b8aa9093.jpg](https://i.imgur.com/Ov43o2i.jpeg)  

但这时，'attribcreatel'会接着出现黄色感叹号，提示：无法解算切线，需要创建UV坐标信息。因此，需要在此元件之前创建Texture SOP'texturel’，用于给模型添加完整的 UV 信息。完成这两步操作之后，PBR 材质可以正常使用了。如图 3-1-11，可以看到，'renderl'中渲染出的模型材质和'pbrl'预览窗口中的样式一致了。  

![images/6f95f1cf70bf19812726e4bb878f248dde2a85676e39794c9745299b8bb7290d.jpg](https://i.imgur.com/k4lxIfn.jpeg)  
图 3-1-11渲染预览的 PBR 材质  

##### TIPS  

PBR、Substance、UV、Tangent 之间的关系是什么?  

在使用 PBR 材质时,需注意 Substance、UV、Tangent等关键属性,因为它们可以帮助模拟出逼真的表面细节和纹理效果。  

Substance一般是用于生成各种纹理的。在 TouchDesigner 中,SubstanceTOP可以加载或创建 PBR 材质所需的各种贴图，如漫反射、金属度、粗糙度等。  

UV是用于给模型添加纹理坐标的属性，指示每个顶点在纹理贴图上的位置，从而使PBR材质能够正确地将纹理映射到模型表面。  

Tangent 是指切线属性，用于计算法线贴图。在PBR 材质中，法线用于计算光照效果,切线则用于计算法线贴图。因此，为了正确计算法线贴图，模型上每个顶点都需要具有切线属性。  

综上所述，合理规范地使 用 Substance、UV、Tangent 等关键属性，可以使 PBR 材质模拟出更逼真的表面细节和纹理效果，从而使模型更加真实、细致。  

接下来添加一个环境光组件，如图3-1-12，新建Environment Light COMP'environment1，再在编辑区空白处新建 Ramp TOP'rampl'，并在其后连接一个 NullTOP'nulll'。这个渐变图像将作为环境光贴图来使用，因此，将'null1'拖动到'environmentl′上，在弹出的窗口中选择第一行 Environment Map。由于 PBR 材质需要配合环境光使用，且主要受环境光影响，普通灯光影响不大，所以我们将'light1'删除。  

![images/815dddb9bbd5f1ae7426a26ea88434a180e90e4edaf64d9859cfcd2b3f3a2e92.jpg](https://i.imgur.com/f79zThm.jpeg)  
图 3-1-12环境光搭建  

![images/a3b97d582bb29c1f30b4b9a8edc1220efb944d04f012d52e375b7db80034e15a.jpg](https://i.imgur.com/PqQrLSf.jpeg)  
Environment CoMP  

![images/9bfb1e97320a61ccdf247c113b1af0b0ac53d584d960a88c65f4b4e6143170bb.jpg](https://i.imgur.com/TryHcuR.jpeg)  

Light Color（灯光颜色）：设置光源的颜色，可以控制光照的色调和氛围。  

Dimmer（亮度）：调节光源的强度，可以控制光照的亮度和影响范围。  

EnvironmentMap（环境光贴图）：设置光源的环境贴图。环境贴图通常包含场景中光源的反射和折射信息，可以让场景更加逼真。  

BaseColor（纹理颜色）：设置物体的基础颜色，也就是物体表面的颜色。可以使用颜色调色板来进行设置。  

Metallic（金属度）：设置物体的金属度，它控制着物体表面的金属感。当这个参数设置为0时，物体表面看起来像是非金属的；而当这个参数设置为1时，物体表面看起来像是金属的。Roughness（粗糙度）：设置物体表面的粗糙度，它决定着物体表面的反射光的散射程度。当这个参数设置为0时，物体表面看起来非常光滑；而当这个参数设置为1时，物体表面看起来非常粗糙。  

##### ISubstance TOP

![images/59143f3087855db74ca160e622afab7e0387d8edfb64989099298da6e4a6ed83.jpg](https://i.imgur.com/GtneUum.jpeg)  

SubstanceDesigner File（Substance文件）：这个参数用来指定 SubstanceDesigner生成的.sbsar文件的路径。可以从SubstanceDesigner导出.sbsar文件，然后将其拖放到SubstanceTOP的参数面板中。  

Graph（预设）：指定 Substance 材质的预设，可以通过下拉菜单选择。TouchDesigner 中预设的 Substance Designer 材质设定好了不同的材质，如金属、玻璃、塑料等。  

接下来调整渲染效果，如图 3-1-13。  

如果整体环境光太暗，就会看不清树叶模型。因此，需要提高物体反射亮度，把'environmentl'的Dimmer（亮度参数）调至3.5。  

![images/091f97ff91ada82fdbb20a6c2b0119778e8ab7ad00ed13b5b66b1d08fafdd539.jpg](https://i.imgur.com/KWK9dx8.jpeg)  
图 3-1-13环境亮度对渲染图像的影响  

为了让树叶更有金属质感，如图 3-1-14，我们将'substancel′材质贴图元件的Graph(图形参数）选择为 Metal(金属材质)。  

##### TIPS  

不同 substance 贴图的内置参数不一样，这是由创建贴图的作者决定的。  

![images/0398f4bec7cb8cf883553fbde869903058a009ec62a792d0c8258a32bcc1bade.jpg](https://i.imgur.com/45nLg7t.jpeg)  
图 3-1-14赋予材质贴图  

可以在 substance贴图下载网站搜索并下载贴图: https://source.substance3d.com/  

进一步调整材质贴图，如图 3-1-15，进入Input Values 页面，将金属的基础色MetalColor调整为（0.9,0.9,0.9）的白色。  

![images/c643a0fa41be9efe71742eb1b5c02744695bc0494ca093769727cc63f8ed1011.jpg](https://i.imgur.com/B7aFqQP.jpeg)  
图 3-1-15材质贴图颜色更改  

接着，通过改变'ramp1′的渐变颜色，来调整环境光颜色，如图 3-1-16。这里我们使用一个圣诞风格的配色，大家可以先简单调整，之后根据整体效果再进行微调。这样，使用PBR材质渲染的基础树叶框架就搭建好了。  

![images/9e5329974dd9834d7d7f8525f9b1ee503d8a3662a78a4506ba1b62354848b5e1.jpg](https://i.imgur.com/lHaRgee.jpeg)  
图3-1-16调整环境光颜色  

最后，我们整理一下界面，并添加这部分工程的备注，如图3-1-17。  

在空白区域右键选择AddAnnotate（快捷键：Shift $+\mathsf{A}$ ）添加一个备注框，备注标题为“树叶渲染”，并把TitleHeight(标题高度)拉到100。正常情况下，创建标注框之后，左下角会默认弹出选色面板，可以直接给标注框换色，按键盘C键显示隐藏这个选色面板。  

![images/8779deec3a6670a68efd8dfb120b9c7160442c94b92caa3b0e3105edbf0b02ea.jpg](https://i.imgur.com/mmd980D.jpeg)  
图 3-1-17树叶渲染最终工程预览  

##### 树叶实例化排布

这里将使用 Instance 功能制作树叶的排布规则（Instance 用法见第 69 页)，如图 3-1-18。制作 6 个从大到小的圆环作为圣诞树叶片的分布位置，每片小树叶将被放在这些圆环的一个个顶点上。  

![images/0a558897cb2e9c0c7c2bd76fd09ce65303cef2ab2e3b1845451c467dc453296b.jpg](https://i.imgur.com/P9fuzRo.jpeg)  
图 3-1-18树叶排布最终工程预览  

新建 Torus SOP'torusl'，为了对最后呈现的帧率进行优化，我们将 Primitive Type（原始类型）调整为 Polygon(多边形）布线方式，Connectivity（连接方式）选择Triangles（三角面)，同时降低参数面板的 Rows（行）和Columns（列）至 10，从而使整个模型点数减少。接着，在元件后新建 Null SOP 并将其命名为'pos'，如图 3-1-19。  

![images/aab1af209db4dc382e22763d31115df7cfff67ecbd98e13c3cbe783b0bcca19d.jpg](https://i.imgur.com/DDbMeR0.jpeg)  
图 3-1-19选择布线方式  

在'torus1′ 与'pos'中间插入 Copy SOP'copyl'，如图 3-1-20。将参数面板的 Number of Copies 参数调整为 6，即共生成 6 个圆环；调整 Translate 的Y轴参数为 1，即沿着Y轴每隔单位 1复制出一个模型；将 Uniform Scale 调小至0.7，即每复制一个大小就缩小0.7倍。这样，就做出了由6个圆环组成的圣诞树造型。  

![images/bae5f61148aa60addc9ae1986e7b30fad76339af07248ba9f713a7ce5285fcb5.jpg](https://i.imgur.com/NceeC93.jpeg)  
图3-1-20 Copy SOP  

接着，将树叶克隆到圆环的每个顶点上，如图3-1-21。  

找到'geol'的第三个参数页面 Instance，打开 Instancing 开关，将'pos′拖动到 Default Instance OP上作为参考元件。Translate X、Translate Y、Translate Z分别对应选择 P(O)、P(1)、P(2)，这样，树叶就被克隆到了这个模型的每个顶点上。  

![images/7dec360cb47e0f5ddccb01f239931e585acced0ac33371d0e5dc5e4e08dae2a1.jpg](https://i.imgur.com/DYVyr1r.jpeg)  
图 3-1-21 Instance 实例化  

为了方便观察，可以在'renderl′上单击右键选择View，打开一个单独的视窗观察。可以看到，相机离模型太近，没有把模型显示完整。因此，将'cam1'的Translate 参数后的Y轴上的位置调整为1，Z轴上的位置调整为 18,如图3-1-22，这样，渲染出的模型将全部显示在视窗范围内。  

![images/27a2f67b52d7f2b27a52ddc7ae5dc838c994cc628f44752a8467d54aa1dbd086.jpg](https://i.imgur.com/DZ8soFW.jpeg)  
图 3-1-22调整摄像机位置  

接着调整每片树叶的角度，如图 3-1-23，使每片叶子都按照圆环上点的法线朝向来摆放（法线介绍见第72页）。  

![images/f79089018a178587eb9f122bbb3cd8edee734a7dc4a0a881ea4c406dda3b0172.jpg](https://i.imgur.com/A9mpOGZ.jpeg)  
图 3-1-23查看法线方向  

找到'geo1′参数面板 Instance 2 页，如图 3-1-24。将 Rotate to Vector X、Rotateto Vector Y、Rotate to Vector Z 对应选择 ${\mathsf N}(0)$ 、 $\mathsf{N}(\boldsymbol{1})$ 、N(2)，并修改 Rotate to Vector:ForwardDirection（前端指向）为 $+Y$ ，这样，每片树叶的朝向就与法线朝向一致了。  

##### TIPS  

![images/57460194587877ccb3b3fbd2c19586f7ef5fea49bc22a3cb4306c543d11c820f.jpg](https://i.imgur.com/EZeJvzq.jpeg)  
图 3-1-24法线旋转实例化  

Forward Direction前端指向参数通常保持默认为-Z方向，如果建模时，基础元素没有按照模型的法线位置摆放，可以尝试修改这个参数，将其调整一致。  

接着，让模型像齿轮一样自动转起来。找到'torusl′元件的Detail参数页面，尝试拖动 Angle Offset 参数，可以看到模型就转起来了。如图 3-1-25，为了使圆环一直随时间转动，在 angleoffset 后输入表达式： absTime.seconds\*50。  

![images/e24d16e6b67ff08ca9599fab028a18b82b5a54e28f870d49c016b2812d2589d6.jpg](https://i.imgur.com/O9ocQzb.jpeg)  
图 3-1-25表达式赋值  

为了进一步丰富树叶动态变化的效果，如图3-1-26,在'copyl′后插入 Twist SOP'twist1′元件，将 PrimaryAxis（主轴）设置为Y轴，将Rolloff（滚动偏移量）参数设置为1，这样，扭曲效果将均匀地分布在圆环表面上。然后拖动Strength（强度）参数，将数值设置为 $300_{\circ}$  

![images/d9a1b79eac9b2884d7f12e170a1857466bce64055e51345d1220e90b0521c366.jpg](https://i.imgur.com/irM86QY.jpeg)  
图3-1-26Twist SOP  

如图3-1-27，可以看到最后的渲染效果，树叶排布产生了丰富的变化。最后，快捷键Shift $+\mathsf{A}$ 添加备注框，填上本功能模块的备注名。  

![images/72b2532d4136994fb2dd0c1d6d84a47411145a55a44f61a861c859ddf51700fc.jpg](https://i.imgur.com/1qEw1DY.jpeg)  
图3-1-27 树叶排布最终工程预览  

![images/e41151132580bef3593d6cc737ac87050fa947a22f42217b8ddec80eb70ebedf.jpg](https://i.imgur.com/bUNH3GP.jpeg)  

##### TIPS  

网格模式可以更好地观察扭曲效果。点击右下角小加号激活视窗，按快捷键W快速变为网格预览模式。  

![images/c988575a6d61a7abf819cdb93111dad5b4423a362e66ccad1049acb7adcdad3e.jpg](https://i.imgur.com/UwxGyVx.jpeg)  

![images/f06761a34784cd9b6f4c144d398ab4c5e3f6e4a7a74a170b7d07a4a7c2f57283.jpg](https://i.imgur.com/9v7SlYc.jpeg)  

Operation（类型）：可以选择其中一种非线性变形。  
PrimaryAxis（主轴）：设置变形的主轴，变形效果会首先应用在主轴上。  
SecondaryAxis（次轴）：选择变形的次轴，变形先发生在主轴上，然后发生在次轴上。  
Strength（强度）：变形对于模型影响的强度。  

##### 树干制作及渲染

接着制作树干部分，将它渲染成线框材质。如图3-1-28，新建Tube SOP'tubel'，将 Primitive Type（原始类型）调整为Polygon（多边形）布线方式，Height（高度）调整为8.5；Radius 的第一个参数顶部半径调整为0.1，第二个参数底部半径调整为0.85，这样可以形成一个锥体；同时，将Center（中心点）向Y轴方向移动到1.09；随后，在Detail细节页把Rows（行）和Columns(列）分别设置为3和11，使树干视觉效果更纤细。  

![images/bb6aeeff1d9e00a48a848ba5bb79755193717de0af27e6d41616f1537f1f3661.jpg](https://i.imgur.com/TLxA6jA.jpeg)  
图3-1-28　制作树干  

在'tube1'的输出口右键添加Geometry COMP'geo2'，此时，‘renderl'会自动渲染树干模型。  

如图 3-1-29，新建 Wireframe MAT'wireframel′线框材质，将 Color 统一调整为（0.5,0.5,0.5)，Line Width(线条宽度）改为 2.43；随后，将'wireframel'拖动到'geo2′上，在弹出窗口选择 Material。如图 3-1-30所示，可以看到树干被渲染到树叶下方。最后快捷键Shift $+\mathsf{A}$ 添加备注框，填上本功能模块的备注名“树干渲染”。  

![images/f0f27f67737a51c13084ab04add7da73886dc202748b802fc61f5914d0ef8469.jpg](https://i.imgur.com/8WyKazw.jpeg)  
图 3-1-29 树干部分最终工程预览  

![images/70332cd2d18d04b4fe0097a3175ed7f396e19eaf5b32eb7cb9131c654aaf9c00.jpg](https://i.imgur.com/b1pzRs0.jpeg)  

![images/cb207253ac8fc71ab853d9aaa918b99cd170608efce300c3130771276e59b3a0.jpg](https://i.imgur.com/oSftVIL.jpeg)  
图3-1-30 赋予树干线框材质  

##### 视觉处理

至此，圣诞树的制作就完成了，下面将为圣诞树加上动态背景。如图 3-1-31，从 image 文件夹中把背景图片直接拖动到操作编辑界面，可以看到自动生成了一个 Movie File in TOP 元件，将其命名为'bg’。  

![images/d6344efc64ad0155649ebb81eeee08d7a76be552c51e041654cbea8b0b83bffa.jpg](https://i.imgur.com/BwxNTW0.jpeg)  
图3-1-31 拖动外部图片到编辑界面  


新建 Composite TOP'compl'，如图 3-1-32，将'renderl'和'bg'分别连接到'comp1'的输入口，并将Composite的Operation（叠加模式）改为Over（上下覆盖)。  

![images/f51a610ab71913b79dee3bcd9d99ecf8c01b12d69e056ec7f4f85db4c865e1eb.jpg](https://i.imgur.com/fok8VP6.jpeg)  
图3-1-32 合成模式  

调整圣诞树的位置，使其匹配到背景。如图 3-1-33，将'geol'参数面板Xform 页的Translate（平移）参数设置为(2.8,-0.4,0)，使其在×轴和Y轴的位移分别改为 2.8和-0.4；'ge02'也执行与'geo1'相同的操作。为了让树叶和树干同时旋转，将'geo2'参数面板中rotate 参数的ry变量设置为表达式：absTime.seconds\*50。  

![images/e4280fd55ccc02d206b545e659f52b505589e1149b6eafe9e2d31ec502a188ce.jpg](https://i.imgur.com/HH1hbSA.jpeg)  
图3-1-33 旋转整体模型  

如图 3-1-34，最后连接 Null TOP 元件并将其命名为'bgl′,快捷键 Shift $+\mathsf{A}$ 添加注释框，视觉处理部分就完成了。  

![images/dc466d21e748bac9c33b2d9ab3a874038286bbebc811cc1274b5b8dc4a2e333b.jpg](https://i.imgur.com/aNEc6tE.jpeg)  
图3-1-34 案例最终效果  

图 3-1-35 为案例最终效果。保存后关闭工程文件，将其命名为“重构松树.toe”，方便后续章节使用。  

![images/ec2f9483dcd3a3b8f95fd85c67ca063663c0a76c02ab43b09e9aa1038e806c32.jpg](https://i.imgur.com/U5hPdJx.jpeg)  
图3-1-35 案例最终效果  

##### 更多学习资源：TouchDesigner与动态海报设计

由 TouchDesigner 官方中文社区一TEA Community 开发的《TouchDesigner 与动态海报设计》线上课程，在本章节的教学基础上，更加深入平面设计与交互设计，如图 3-1-36，注重教读者建立算法思维，从0到1逐步搭建、迭代更为复杂的可交互视觉系统。  

![images/3570f593f7238b1671acc116183dd410f8657d2813cc76810fb91e1a8a7b3932.jpg](https://i.imgur.com/LAiUqlp.jpeg)  
扫码了解课程  

此课程案例中的视觉效果均可商用，也可以结合本书硬件教学章节延展出无限交互效果一导入音频实时驱动画面变化，调用鼠标、摄像头、键盘···打造可互动的动态视觉。  

![images/4d6c197ad2fa6b32a9e7ca12b4daefbb3e7142b77a939a028faff3c66081767f.jpg](https://i.imgur.com/23P9wua.jpeg)  
图3-1-36 课程效果及教学流程示例  

## 3.2 音画互动系统

音画实时交互在音乐表演、多媒体艺术装置和交互体验中都有广泛应用。画面通过投影、LED 屏幕或照明效果等媒介增强和补充音乐，为观众创造更加多感官、沉浸式的体验。在本节中，我们将学习如何在TouchDesigner中导入音频并对其进行分析，从而制作音画互动效果。这些参数化控制生成的图像可以用于制作NFT艺术品；或接入MIDI设备进行实时控制，用于音乐现场演出等。  

### 实战案例: 重构圣诞树--用audioAnalysis 分析音频并制作音画互动系统  

本案例将沿用上一节的TouchDesigner工程文件，将音频导入其中进行分析处理；再由分析出来的高、中、低频及鼓点控制圣诞树模型视觉效果的实时变化,如图 3-2-01。  

![images/210f2e72c671733f7f269eac86787958577e70dce560364a65a512f6074a9b0d.jpg](https://i.imgur.com/kXMBl1y.jpeg)  
图3-2-01最终效果预览  

为了制作音画互动效果，首先需要准备一段最好为mp3格式的音频文件（你可以使用自己喜欢的音乐，或下载本章节工程文件获取音频文件，下载链接见第41页)。  

##### 声音分析

>打开3.1章节实战案例中完成的“重构松树.toe”工程文件，进入/projectl/container_Instance/层级编辑界面。  

接下来，我们用音频的中频和鼓点节拍控制圣诞树模型中单片树叶的长度、旋转、颜色的随机变化，以及树叶的总体数量、树叶的整体排布造型和树冠膨胀体积大小的随机变化，如图3-2-02。  

![images/6deb7e311cc29cd97eaa75e1abe50ce5822d401edba468409d189db3c7d70e41.jpg](https://i.imgur.com/2dMEBVP.jpeg)  
图 3-2-02声音分析最终工程预览  

首先导入音频文件，如图 3-2-03。将提前准备好的音频文件拖入编辑界面，可以看到自动生成了－个Audio File inCHOP元件，将其命名为'audiol'。在它的输出口点击鼠标右键，添加 AudioDeviceOut CHOP'audiodevoutl'，就可以听到声音了。  

![images/fc1ebca828cf2fa6882119481e6776da924afcd00b6404dd67b77be3b3901e66.jpg](https://i.imgur.com/b3S1uMs.jpeg)  
图 3-2-03声音导入及输出  

接下来制作音频分析模块，如图 3-2-04。在 Palette插件库面板 Tools 中找到 audioAnalysis 音频分析插件,将它拖动到编辑界面中，连接'audio1'和音频分析插件。  

![images/21ca0ea750191676d3f817f2116ade621e50750d7c3711e4436b251ac607f977.jpg](https://i.imgur.com/ZrG0jwi.jpeg)  
图 3-2-04音频分析插件  

点击音频分析插件右下角的小加号激活这个元件。如图3-2-05，点击小圆圈关闭Low（低频）部分的分析，打开Mid（中频）和 Rhythm（鼓点）的分析开关。  

![images/33a541f955a5070dd8cdaaa7dac52dec9bb7992c887730de399743a102e3051e.jpg](https://i.imgur.com/I5FVqJY.jpeg)  
图 3-2-05激活频段分析  

如图 3-2-06，将'audioAnalysis′的Controls 参数页中的 Rythm Threshold (阈值）调整到22，使插件更容易分析出鼓点节奏；关闭激活，并在第一个输出口新建Null CHOP'null2'。  

![images/254856d640e12fde3527fd29954108bf6f25e180cf8f534e712633e4c8581250.jpg](https://i.imgur.com/lEQaFX0.jpeg)  
图3-2-06声音分析部分  

在'null2' 后新建两个 Select CHOP,用于提取中频和鼓点。'selectl'的 ChannelNames 选mid（中频)，'select2'参数面板的 Channel Names 选择 rythm（鼓点)。接下来，需要计算鼓点的累计总数。在'select2'的输出口右键添加 CountCHOP'countl'计数器元件，在'countl'后连接 Null CHOP 并将其命名为'rythm',如图3-2-07。这样，每检测到一个鼓点，计数器就会加1。之后，我们会将其作为NoiseCHOP的Seed (种子数)。  

![images/9807caeed7a3cbb1d0d14524d0643a2c7c5c37770af0274cfe8267554ed238b0.jpg](https://i.imgur.com/v3J8GBs.jpeg)  
图3-2-07计数器元件  

接下来，在视觉处理页面将鼓点可视化，这一步将会把每个效果对应的种子数值显示在背景上。当你想重新调出某个效果，直接输入种子数即可。在'renderl′和'compl′之间插入 Text TOP'textl'，在 Text 文本页删除默认的Text文字“derivative"。如图 3-2-08，在视觉处理面板中新建 CHOP to DAT'chopto1′元件，将'rythm'拖动到'chopto1′的CHOP 参数上，这样CHOP 类型的数据就会转成DAT类型；将'chopto1'拖动到'text1′的 DAT 参数上，这样'textl′的文字内容就可以显示出鼓点的当前计数。  

![images/ac63e450b6169a8dc6e88aa873272d92a31e2ba6f1f4b36c07a18c28100246dd.jpg](https://i.imgur.com/aiDvNxX.jpeg)  
图3-2-08引用DAT类型文字  

回到'textl'参数面板的Font页，将FontFile（字体文件）设置为自己喜欢的字体。将FontSizeX（字体大小）改为47，Position（位置）改为515和-185，使其匹配排版图的位置，最后在Color页中，将FontColor（字体颜色）改为（0,1,0.176)，这样就完成了鼓点可视化，如图3-2-09、图3-2-10。  

![images/936c893ac36bda6524a79aad36a3378d825bd803b01c3937ddcf2483bccd05dd.jpg](https://i.imgur.com/jS3tfFE.jpeg)  
图3-2-09字体调整  

![images/c9225036c93452d34db27a41db2e86f9c8ce30ea09df8da7f03c67202eeec0dc.jpg](https://i.imgur.com/b6y1QVy.jpeg)  
图 3-2-10字体颜色调整  

##### 用NoiseCHOP生成一个随机数

我们将继续使用分析出的音乐鼓点和中频控制圣诞树的单片树叶的外观和树叶总体排布状态，使圣诞树的造型和色调随着音乐变化，如图 3-2-11、图3-2-12、图3-2-13。这些功能都离不开 NoiseCHOP。  

![images/7c4c1281da4ee2f16c4724c6ec4d92abc849ac269753a04af1b08f99b10d7e37.jpg](https://i.imgur.com/REM8JGp.jpeg)  
图 3-2-11数据控制最终工程预览  

![images/befa2f4526ba735f1ab75defaec60d3d89db65b310928a8289f277993c67f99d.jpg](https://i.imgur.com/owSIFLe.jpeg)  
图 3-2-12树叶模型整体控制  

![images/0362ffb48d643e0994502f6139c04a70861914261430301dc00213407e0f0749.jpg](https://i.imgur.com/i1KbPsI.jpeg)  
图 3-2-13颜色控制  

NoiseCHOP常用在产生一个稳定而随机的噪波，默认为一个随机的平滑曲线，曲线是由随机的样本组成。  

![images/a78e737749fcb88e0ace03fc0d1e89230a6bf5984803d076b333d73e71fbe14d.jpg](https://i.imgur.com/KiihCDm.jpeg)  

Seed (随机种子）：根据Type (种类)选择的噪波模型，用来随机生成对应类型的噪波。  

Period（周期）：改变噪波的周期长度。  

下面让叶片长度可以随机变化，即通过树叶渲染部分'transform1'元件，让树叶模型沿Y轴随机缩放。如图 3-2-14，新建 Noise CHOP'noise1′使其生成随机数。将 Type 改为 Random（随机)，Amplitude（振幅）改为0.5，这样随机数值将在-0.5到0.5之间；将Offset（偏移量）改为0.5，使随机数值在0到1 之间。  

![images/fde0e5538a98ea4f0b8acead122b8f7d38e86f3ba5445bd1f85319ecc5887477.jpg](https://i.imgur.com/7YBYM7w.jpeg)  
图3-2-14随机数生成  

由于只需要一个随机数来控制树叶模型的Y轴缩放,在'noise'元件的Channel 参数页中，将Start和End的单位都选择为 Samples（样本)，并把 End 数值改为 0,这样我们就得到了一个范围从0到1的随机样本，如图3-2-15。我们将 Channel Names 改为 scale_y，方便后续操作的识别和调参。  

![images/8bdfe4fa8f5d1b7ff7a6f4b718566afbbbdc91686cec9816b6a6cc7abbd80749.jpg](https://i.imgur.com/EZRzffO.jpeg)  
图 3-2-15生成并重命名随机数  

##### 用鼓点控制单片树叶长度的随机变化

接下来，我们用鼓点驱动上一步制作好的随机数样本变化，如图3-2-16。  

![images/5591a8e8c71b926adb7485e8480d256cb3e4dedd0600b2ab9889a6a5e671910c.jpg](https://i.imgur.com/6gjwWug.jpeg)  
图 3-2-16树叶随机长度工程预览  

首先通过改变'transform1'的 Scale 缩放参数Y轴数值，得出我们希望控制的树叶长度数值范围在0到1.5之间;已知'noise1'的数据区间在0到1之间，因此在'noise1′后面添加MathCHOP'math1'来更改随机数的数据范围，如图 3-2-17，在'math1'的 Range 参数页中将 To Range 改为(0, 1.5)，这样随机的数据就由 0 至 1 被映射到 0 至 1.5 的范围内。  

在'math1'后面添加“agl'让数据变化更和缓，并连接一个 Null CHOP，将其命名为'scale_y。  

![images/0e88aecf6bb6d7d5198e2b69dc1987be703eae6094a7cea6003ba4e8fe77e25c.jpg](https://i.imgur.com/0ZR2ilA.jpeg)  
图 3-2-17数据缓冲和映射  

##### Lag CHOP

Method（方法）：选择通道滞后缓动的方法。  

Lag（滞后）：第一个是数值向上增加的时候，向上滞后的最大范围，第二个是数值向下递减的时候，向下滞后的最大范围。  
Overshoot（过冲）：数值递增或递减时，过冲的最大范围。  

点击鼓点计数的'rythm'，激活右下角的小加号，拖动通道赋值给'noisel的Seed（种子参数)，这样随机数的种子就与音乐鼓点产生关联，如图 3-2-18。最后将'scale_y'激活，拖动通道赋值给'transform1'的 Scale 缩放参数Y轴数据。添加注释框，这样树叶随机长度的变化就由鼓点所驱动了。  

![images/a6e2e33aeb13966dc27f258a3ee3d598383ee1e8d28dff2f0ba5572a926d0ccc.jpg](https://i.imgur.com/htiLnat.jpeg)  
图3-2-18数据赋值  

##### 用鼓点控制单片树叶旋转角度的随机变化

复制随机长度的节点流程，将注释改名为“随机旋转”。接下来，我们用鼓点控制单片树叶旋转角度的随机变化，如图 3-2-19。  

![images/4b9aeaec2ad059c52f50bfee444e6f078f727a639791099879127ba688fd4a55.jpg](https://i.imgur.com/wYWs2aC.jpeg)  
图 3-2-19随机旋转工程预览  

这里我们会用'noise2'产生的随机数值控制'transform1′的 Rotate 旋转参数×轴的旋转数据，所以将'noise2'中的 Channel Names 和 Null CHOP'scale_yl′元件名称改为'rotate_x。 通过调整'transform1′ 的 Rotate × 轴旋转数据，得出其需要的范围为 0 到 360，所以将'math2'中 To Range 改为(0,360)。同样地，将'rotate_x 激活赋值给'transform1' 的 Rotate ×旋转参数，如图 $3-2-20。$  

![images/3037661a5e6225788d380c2d4f2323a2d7bed9d6030adc355c860b8bfcf4d73a.jpg](https://i.imgur.com/miUssp7.jpeg)  
图 3-2-20数据赋值  

##### 用鼓点控制单片树叶颜色的随机变化

复制随机长度的节点流程，将注释改名为“随机颜色”。接下来，我们用鼓点控制单片树叶颜色的随机变化，如图3-2-21。由于树叶是 pbr 材质，其颜色主要受环境光影响，因此，我们主要控制环境光贴图的变化。  

![images/9062e5bec040f80e18fde1b37052e6521d6564e254dd8495d077e3f8e0e28154.jpg](https://i.imgur.com/WvMeuii.jpeg)  
图 3-2-21随机颜色工程预览  

在树叶渲染部分，决定 Environment Light 环境光贴图的'ramp1'和'null1'中间插入 HSV Adjust TOP'hsvadj1。接下来，我们用随机颜色中'noise3'产生的随机数值控制'hsvadj1'中的 Hue Offset（色相偏移)，将随机颜色的'noise3'中的Channel Names及NullCHOP的元件名称改为'color。  

通过调整'hsvadj1′中 Hue Offset 的参数，得出所需的数据范围是从-360 到 360 的整数，因此将随机颜色中'math3'的 To Range 改为(-360，360)。同时，Hue Offset 不需要小数和数据缓冲，所以将'math3′的 OP 参数页Integer（整型）改为Round（四舍五入取整)，并删除“lag3"，如图3-2-22。  

![images/9fc195cfc307b11f86191c36df499782d19a67b7f0ad231d461f595c5172f50a.jpg](https://i.imgur.com/belCHlZ.jpeg)  
图3-2-22小数取整  

将'color激活并赋值给'hsvadjl′中的Hue Offset参数，同时在背景底图bg和'compl’中间插入 HSV Adjust TOP'hsvadj2'用于背景色相的调整。如图 3-2-23，将 Start Color 改为红色(1, 0, 0)，以背景图片的主色调红色为起始颜色做调整，然后将Hue Range（起始颜色范围）改为78，这样之后的调整只会影响与红色色相范围相近的颜色。将'color'激活赋值给'hsvadj2'的HueOffset，使背景图的色相和树叶在视觉上形成统一。  

![images/36df26740edfb379283e28d5265979334d845a3b9a26a8c2bb2ad8da4260f888.jpg](https://i.imgur.com/AZLRcsh.jpeg)  
图 3-2-23数据赋值  

##### 」用鼓点控制树叶排布的随机变化

在完成树叶随机造型和颜色后，我们对树叶排布进行控制，如图3-2-24，主要调整的参数是树叶排布部分'twistl'的扭曲强度、'torus1'的顶点数量和模型体积。  

![images/067b184f8a401f4cb05a51891542f8c794c63f5809d3393031075bd369376272.jpg](https://i.imgur.com/TOT9rJV.jpeg)  
图 3-2-24随机排布工程预览  

首先调整树叶排布部分‘twistl'的扭曲强度，如图 3-2-25。  

![images/ffff8defa6bb1e5677e37f95277842bc5b32d1dd5db0e934170992ea86441d71.jpg](https://i.imgur.com/Td7DjFY.jpeg)  
图 3-2-25随机扭曲工程预览  

新建'noise4'，并将 Type 类型改为 Random，Amplitude（振幅）和 Offset（偏移）改为 0.5，数据范围保持在 0至 1 的区间内。在 Channel 参数页中，将 Start 和 End 的单位改为 Samples，数据都改为 O；将 Channel Names 改为 twist。通过调整'twistl'参数面板的 Strength（扭曲强度)，得出其所需的范围是从0到 360，因此我们在'noise4"后新建并连接 Math CHOP'math4'，将 To Range 改为(0, 360)；在'math4'后面新建并连接“lag3′，给扭曲强度加一个缓动效果；在"lag3'后面新建并连接 Null CHOP，并将其命名为'twist'，激活并赋值给'twistl'的 Strength。最后,将'rythm'激活，并映射到'noise4'的 Seed 上，快捷键 Shift $+\mathsf{A}$ 添加注释框，如图 3-2-26。  

![images/999773dea2b0e22306f98c3a9a64a7c1c6b06b92881f5f18b0081d911f7ae647.jpg](https://i.imgur.com/VVTt57J.jpeg)  
图3-2-26数据赋值  

##### 用鼓点控制树叶数量的随机变化

接下来调整'torus1'的顶点数量，从而控制树叶数量的随机变化，如图 3-2-27。  

![images/a9319cb4eeeeef17765126096d37ba30f15d7709c8d913111e55d95ebcd77b90.jpg](https://i.imgur.com/omDYEng.jpeg)  
图3-2-27随机数量工程预览  

复制两组随机扭曲的节点流程，将'noise5'和'noise6'的Channel Names 分别改为'rows'和'columns’，之后用它们控制'torusl'的Columns、Rows(行、列)，以此控制树叶的数量。  

调整'torus'的参数，观察视觉效果，得出 rows（行）所需的数值范围在3至15之间，columns（列）所需的范围在 15 至3 之间，且不需要数据缓动。因此，我们分别将'math5'和'math6'的 To Range 改为(3,15)和(15,3),在Integer（整型）选择Round（四舍五入取整）；删除"lag4'和“lag5’，将最终的'null4'和'null5'分别命名为‘rows和'columns'，并激活元件，对应赋值给'torus1'的Rows、Columns，如图 3-2-28。  

![images/023897b29914224d9f95d92942f888f77b0ac4d1ded743be1902df5d37c60472.jpg](https://i.imgur.com/TsA1E3u.jpeg)  
图3-2-28数据赋值  

##### 种子数差值

可以看到，现在所有 Noise CHOP 的 Seed（随机种子数）都是由'rythm'同一个音乐鼓点控制的，数值完全相同。如果要避免这种情况，我们可以将鼓点数值加上该Noise 元件本身的名称后缀序号数值，作为 Seed。在TouchDesigner中不会存在名称相同且名称后缀序号也相同的两个元件，因此我们选中所有 Noise CHOP，在原来表达式的基础上添加 me.digits 表达式，写法为 op('rythm')['rythm']+ me.digits，如图 3-2-29。  

me.digits在表达式中指的是本元件后缀数字的值。  

![images/72a2b7fd85e96c874a17824f1d6f1377d0b3f6291f35385f74bc197325da7b3f.jpg](https://i.imgur.com/D1M0eDy.jpeg)  
TIPS  

由于每个 Noise CHOP元件的名称序号均不相同,我们可以利用同一个表达式，在每个NoiseCHOP里得到不同的Seed数值。  

![images/8aac34ac15435df3e7a02bbff9e585e2472cea05f7da124312f95f9c8bd31ffe.jpg](https://i.imgur.com/BLYdZQm.jpeg)  
图 3-2-29 me.digits 表达式  

##### 用中频控制树叶排布松散程度的随机变化

接下来调整'torusl'的体积大小，从而控制树叶排布松散程度的随机变化，如图 3-2-30。  

![images/c6faa5ed55363dc15d127607b980c1383374b52920dc1d39a1b2805faf7bc9bb.jpg](https://i.imgur.com/BeCIwGH.jpeg)  
图3-2-30树叶排布随机变化最终工程预览  

调整参数，观察视觉效果，可以得出我们需要控制'torus′的 Radius × 轴上的半径值为 0.7至 3。在声音分析部分的 'select1' 后新建并连接 Math CHOP'math7'， Range 页的 To Range 值设置为 (0.7, 3)， 在'math7' 后添加 "lag4',给数据添加缓动；最后，连接 NullCHOP 并命名为'size’，激活元件并赋值给'torusl′参数中 Radius× 轴上的半径,如图 3-2-31。  

![images/ea187587611db5789b7a490030f95dede8288af0e7e99c12025c0512784e9c95.jpg](https://i.imgur.com/E6vF7UC.jpeg)  
图 3-2-31控制膨胀大小  

至此，圣诞树的造型就可以通过音乐的中频和鼓点进行控制，如图3-2-32。  

![images/c3e8e76ac8b427181ee1967e8ebc0850ddd44ea1f6be3c036dccdd1f712cb5b3.jpg](https://i.imgur.com/0za4sy4.jpeg)  
图 3-2-32数据赋值  

### 实战案例: 输出圣诞树NFT系列作品  

在这一案例中，我们将使用MovieFileOutTOP将圣诞树不同时刻的图像自动输出，用于制作一套NFT。这里我们利用音乐鼓点自动导出同一系列不同效果的平面作品。  

>找到节拍触发部分，如图3-2-33，在'select2'后连接一个NullCHOP，并将其命名为'record，用0和1的数值变换来触发图像的录制。  

![images/4996a034ed556dd6cf3fc166cf79b5f30eb3ff49da32f2c1546e17bb75edb0c2.jpg](https://i.imgur.com/yLWWciq.jpeg)  
图3-2-33新建'record"  

下面我们建立一个工程文件夹，用于渲染图像的统一保存。如图3-2-34，在上方工具栏点击File（文件)，在下拉列表中点击Create ProjectFolder（建立工程文件夹)，可以看到自动弹出CreatProject Folder参数面板。  

![images/b5097b7abd946f610d9d754e119b745b0aa18915cf7966cf7cc2ad45ccd283ca.jpg](https://i.imgur.com/0ULGqOM.jpeg)  
图 3-2-34新建工程文件夹  

点击参数面板中Path（文件夹路径）右侧的文件夹图标，选择工程文件储存位置；在 Project Floder（文件夹名称）输入自定义文件夹名称，其他选项保持默认选中。点击右下角Create（创建)，这样就基于此工程生成了一个TouchDesigner工程文件夹，如图3-2-35。  

![images/1597053eb1b40146cb08063c54581fe621dbe9601e786af7c3d24fce0fcb738f.jpg](https://i.imgur.com/1dPIscn.jpeg)  
图3-2-35设置文件储存位置  

点击参数面板中 Path 右侧的文件夹图标，选择工程文件储存位置；在 ProjectFloder（文件夹名称）输入自定义文件夹名称。接着，点击右下角Create（创建)，就基于此工程生成了一个 TouchDesigner 工程文件夹，如图 3-2-36。将正在使用的音频文件、三维模型、背景图等文件拖入相应的文件夹，并在文件夹里重新链接。  

![images/a716bbbfffc5949b1db7261926a1ddda4c1614a619b4ac09f9fddf4dfb5076e2.jpg](https://i.imgur.com/sTterxM.jpeg)  
图 3-2-36工程文件夹  

在视觉处理部分的'bgl′后新建 Movie File Out TOP'moviefileoutl'，用于输出图像。如图 3-2-37，将参数面板的 Type (输出类型）改为 Image (图像)，Image File Type(图像类型）选择 PNG，并打开Unique Suffix（唯一后缀）开关，这样输出的图像后缀就会递增，不会重叠覆盖。  

在工程文件夹中新建名为“NFT"的文件夹，用于NFT图像储存。点击'moviefileoutl'参数面板的 File（文件）使其显示 expression 表达式写法，默认是‘TDMovieOut' $^+$ me.filesuffix。 在'TDMovieOut'字段中添加 NFT/，即将表达式改为'NFT/TDMovieOut‘+ me.fileSuffix，指定图像保存路径为工程文件夹下新建的 NFT 文件夹。  

##### TIPS  

me.fileShffix指返回生成的文件名称后缀序号，它根据参数 UniqueSuffix或 N 的值生成文件后缀。  

![images/300b41f88ca64dd44503574925ae7e3b343b5c5aa9ea5d85f97666ba84a9ff46.jpg](https://i.imgur.com/mLXtBmw.jpeg)  

![images/1f348bd20425b0c303c688d8970f0b0e38f8fd01c7f375aa69f0eec7ba6f4194.jpg](https://i.imgur.com/1375WDO.jpeg)  
图 3-2-37文件录制  

将'record'激活并赋值给'moviefileoutl'的 Record 参数，这样每当鼓点触发的时候，就会自动录制一张 PNG 图片。将 Record 参数点击为 constant 状态，即可停止录制。至此，NFT 文件夹中可以得到一系列不同配色和造型的圣诞树 NFT 图像，如图3-2-38。  

##### TIPS  

系统默认的表达式写法是'TDMovieOut $^+$ me.filesuffix，即让输出图像储存在与工程文件同一层级的目录文件夹下，即上一步新建的工程文件夹。  

![images/8516e5dc2be22dd44d22916c162b5ae9b239fc0ffb3dcf6ad57e55364add2e83.jpg](https://i.imgur.com/0wCMZst.jpeg)  
图 3-2-38输出至指定文件夹中的NFT系列图像  

### 实战案例: 用MIDI设备控制音画互动系统  

TouchDesigner 可以通过 MIDI In CHOP 与 MIDI 设备进行通讯，MIDI 设备则返回对应的数字信号。在这一案例中，我们会将MIDI设备接入上个案例中搭建好的参数化模型工程，这样就可以使用实体的旋钮和按键来控制音画互动作品的视觉参数了。  

![images/5e55bb2a8b9e0ca3fbdc5dbd4b375bf044906cef0643e762b986ebeaa95e410d.jpg](https://i.imgur.com/D8YXcG3.jpeg)  
图 3-2-39最终工程预览  

##### MIDI设备简介

MIDI设备通常是指可以生成、接收和处理MIDI数据的电子音乐设备，如图3-2-40。  

MIDl (Musical InstrumentDigitalInterface）是一种数字音乐标准，它允许音乐设备之间通过传输音符、音量、音色等信息进行交互。在DJ、VJ演出的现场，单纯用鼠标键盘操作控制界面会让现场表演受到很多限制；因此，表演者往往使用MIDI设备来控制音乐和视觉，以获得更好的演出体验。  

![images/bf474594a9e18a2434c35ce58367f3a0cfe6e15ac0d2520f6d9f50b9128cb64b.jpg](https://i.imgur.com/3rNW0jl.jpeg)  
图 3-2-40多种 MIDI设备  

MIDI设备的型号多种多样，如图3-2-41。本节中，我们将使用一款比较简单的 MIDI 设备：Korg -nanoKONTROL2。  

![images/c917bedf156c82b98e47930bfe39b45b927feadc308aa4f716fc78d318183af7.jpg](https://i.imgur.com/eksJtDw.jpeg)  
图3-2-41 Korg-nanoKONTROL2  

##### MIDI设备接入

$>$ 通过USB 口，将MIDI控制器连接在电脑上，确保其正常运作，然后重启TouchDesinger。  

在顶部菜单栏 Dialogs 页点击 MIDI Device Mapper,调出MIDI Mapper设置框，如图3-2-42。若此时 InDevice（接入设备列表）未出现相应的MIDI设备型号，则需要手动导入 MIDI 设备。 点击 Create New Mapping,在InDevice下拉列表选择所接入的MIDI设备型号。此时，转动MIDI设备任意旋钮，会发现有对应数值在面板下方出现（一个MIDI设备只能同时被一个软件调用，若没有反应请排查是否有其他软件同时在使用MIDI设备)。  

![images/a836cbd76a87b8f61ce82373089e91abc98142e8452006993e094b05b0899164.jpg](https://i.imgur.com/VYfndH2.jpeg)  
图3-2-42 MIDI设备导入  

##### MIDI数据控制

将随机长度、随机旋转和随机颜色部分的控制映射到按钮、旋钮和推子上，使之可以通过MIDI键盘控制，如图 3-2-43。  

![images/f7eae6efc424afb5dd6a21c21c01dde85b8fcef5caf8f9031947e3c4cdda08bc.jpg](https://i.imgur.com/d6lgrJL.jpeg)  
图3-2-43按钮、旋钮、推子分配  

新建MIDI In CHOP'midin1'，先按下按钮，再依次推动上图中MIDI键盘的推子和两个旋钮，可以看到'midin1'按照先后顺序自动生成了对应的四个通道，如图3-2-44，其中第一个通道为按钮输入的信号值。  

![images/28198cf2197bbfcc91aea469573b7326ffe339df4a0967c0f57ca6470a34911f.jpg](https://i.imgur.com/zryJIx6.jpeg)  
图 3-2-44对应通道  

在'midin1′后面新建并连接 Math CHOP'math8'，在 MIDI 设备中，按钮类型的数值是0至 1，而旋钮和推子返回的数值是 0 至 127，因此，将'math8'的 From Range 改为 (0, 127)，To Range 保持不变，这样 MIDI 输入的数据就都被映射到 0 至 1 之间。新建 4 个 Select CHOP，在 Channel Names（选择通道名）处将 MIDI 输入的四个通道依次选择出来；其中，'select3'对应按钮信号输入通道 chlctr161。将 4 个 Select CHOP 参数页的 Rename to 依次改名为：auto_switch、Scale_y、rotate_x和 color，后三者与树叶随机长度、随机旋转、随机颜色工程部分的第一个元件NoiseCHOP的通道命名保持一致，如图3-2-45。  

![images/3f422da425115a8f92c93b2405bb7e4661bbad327b16b13671506143828577dd.jpg](https://i.imgur.com/Z4e6uo5.jpeg)  
图 3-2-45数据映射  

在'select3'后连接CountCHOP'count2'，用它来改变自动状态和MIDI控制状态之间的切换。如图3-2-46，在Count参数页将Limit改为Loop Min/Max，将Limit Maximun改为1，这样Count就会在0和1之间循环计数，刚好对应随机状态和MIDI控制状态之间的切换。最后，连接一个Null CHOP，并将其命名为'index。  

![images/153ca1d4f79edf269c2c245a8e319520202e6091809b1b807f1cf5589c5f1cd1.jpg](https://i.imgur.com/W6ZrdaZ.jpeg)  
图 3-2-46 文件储存位置  

在原来的随机长度、随机旋转和随机颜色部分的NoiseCHOP和MathCHOP之间插入SwitchCHOP，并分别将Select CHOP 连入Switch CHOP 的第二个输入口，如图 3-2-47，最后，将名为“index 的Null CHOP激活并赋值给三个SwitchCHOP的Index参数。快捷键Shift $+\mathsf{A}$ 添加工程注释，这样就完成了MIDI设备接入和数据控制部分。  

![images/952760bb8e64df479abe1ebab27ad82289a6d0ac22f1329b2fe2530b6da49880.jpg](https://i.imgur.com/gdv4EWB.jpeg)  
图3-2-47MIDI设备数据控制最终工程  

这样，案例就完成了，如图3-2-48。  
保存并关闭工程文件，将其命名为“重构松树_MIDl.toe”，方便后续章节使用。  

![images/11d997dd02c1f1eaff96fcfbf8a510a0224947470f0be77a785837e10e2a1174.jpg](https://i.imgur.com/6IrF3dW.jpeg)  
图3-2-48MIDI设备控制参数化模型最终工程预览  

## 3.3 TDAbleton 与 Ableton Live

本节会讲解如何利用 TouchDesigner 与 Ableton Live 的通讯，将 Ableton Live 中的音频信号输入 TouchDesigner中，实现更精准丰富的音画互动效果；同时，讲解如何使用 TouchDesigner 实时控制 Ableton Live 中的效果器参数,实现双向通讯。通过学习，音画创作者可以掌握更精细的创作工具和更灵活的创作技巧，为现场演出、展览制作更个性化的艺术作品。  

##### Ableton Live 简介

Ableton Live 11（以下简称 Live）是一款功能强大的音乐制作软件，以其音频、MIDl 编辑功能及专为实时表演设计的特殊模式而闻名。使用Live，用户可以轻松地创建、编写和编排音乐；此外，软件预置丰富的音色、效果和工具，可以满足各种音乐制作需求。它支持多种设备和平台，便于与其他软件和硬件集成；且具有直观的用户界面，使所有人都能快速上手，同时适用于从业者和业余爱好者。  

![images/10d0206bfdfc4f57bc353ac69919014ca3e9f551395b7cba8b89b8af0e183dcd.jpg](https://i.imgur.com/laKdHP9.jpeg)  

![images/02ca432dac9ddaa60ad32d9f7e1f83d5f141b5a403f37a036fde34e9d5c4f605.jpg](https://i.imgur.com/iDfahsE.jpeg)  
图 3-3-01Live 工作环境  

##### Ableton Live 下载安装

访问官网 www.ableton.com/en/trial/下载页面，见图3-3-02，点击“Download"，即可下载。本书使用Live 11.1.5版，语言设置为中文。  

##### TIPS  

此处需将Live 安装至默认路径，否则会影响下一步 Live 与 TouchDesigner之间通讯的建立。  

![images/c496fb24f5fdb76d31dc986001e9382012312299f8460c37e9827da6aec0202f.jpg](https://i.imgur.com/BLlvIeo.jpeg)  
图 3-3-02 Ableton Live 官网  

##### 建立 TouchDesigner 与 Ableton Live 的通讯

从技术角度看，在TouchDesigner 中完成音画互动项目制作时，常常借助TouchDesigner自带的'audioAnalysis插件对音频进行分析，以获取中高低频或节奏鼓点等关键信息，用于驱动画面效果，见图 3-3-03。  

然而，这种方式往往无法精准分析音乐的关键信息。原因在于，‘audioAnalysis'插件的分析原理是对整首音频的高、中、低频进行分析；如果一段音乐中多种乐器发出声音的频段相近，audioAnalysis'插件就无法准确区分它们。  

![images/5ed2b9ae5a8dcf630ee3abc98828a299c605af8eb880fe19e59f13aa58631851.jpg](https://i.imgur.com/Q2GsT1X.jpeg)  
图3-3-03使用'audioAnalysis'分析音频  

而在Live 中，我们通常使用多个音轨来制作一段音乐。此时，可以在TouchDesigner 中获取Live 中每个音轨的最原始、最准确的关键信息，从而实现更为定制化的音画效果。此外，Live 作为一款强大的音乐制作软件，也可以弥补TouchDesigner在音乐生成方面的不足。通过建立TouchDesigner 与 Live 之间的通讯，我们不仅可以用Live 中的音乐数据控制TouchDesigner 的视觉效果；还可以从 TouchDesigner 端控制 Live 中的音频参数，进行实时音乐控制。  

建立TouchDesigner与Live 的通讯，通常使用TDAbleton，它是TouchDesigner 中一款预置插件包，使用它可以在TouchDesigner 中访问Live设置中的大部分内容。TDAbleton 还包含许多双向通讯的插件，并提供构建自定义插件和新功能的框架，实现了 TouchDesigner 与 Live 之间的互相访问与控制。这个插件使TouchDesigner 与Live 能够紧密地连接在一起。  

![images/e058e7cf7169a04c78f05d7dcd587a0b7773fd825888838158a5a6694c7eb772.jpg](https://i.imgur.com/rcPET1y.jpeg)  
图 3-3-04  TouchDesigner 与 Ableton Live 通讯  

##### TDAbleton的应用领域

TDAbleton 在音乐制作和视觉艺术表演领域有广泛应用，如电子音乐演出、派对、展览、电影和动画等场景，如图3-3-05。它可以同步音乐和视觉效果，以及在音乐制作过程中对音频数据进行处理和分析等。  

![images/06411e7b746f7f4dad3670e4e8bd0c1f9e1ae6a5bf5a25bd3622d1120b56d4c6.jpg](https://i.imgur.com/tYmJBF1.jpeg)  
图3-3-05音画互动演出现场  

##### TDAbleton的下载与安装

![images/62727b13c10b9d9b802cb3726a0aebc92ad8510d28606f9c2b00d3dbb18fe30f.jpg](https://i.imgur.com/e8Lfkxr.jpeg)  

TDAbleton 是 TouchDesigner 官方预置的插件，位于 TouchDesigner 的 Palette 插件工具栏。接下来，需要给 Live 也安装对应的 TDAbleton 相关文件。首先，要确保此时 Live 处于关闭状态。打开 TouchDesigner，进入编辑界面，从左侧 Palette(插件库)选择 TDAbleton，点击 Live 11，在下方列表中找到'tdAbletonPackage'，将其拖动到编辑区，如图 $3\cdot3\cdot06_{\circ}$  

![images/43f5d4892c7eda08ad10a00aa5a6ea4007e30a4b9fbe4ab4f43a384165abaf25.jpg](https://i.imgur.com/H1dK1Nm.jpeg)  
图 3-3-06从插件库找到'tdAbletonPackage?  

在'tdAbletonPackage'参数面板的AbletonLiveInstall选择对应的Live版本，点击Install（安装)，可以看到自动弹出一个提示窗，点击Confirm（确认安装)，如图3-3-07。  

![images/c08db3c521d1084e52651249b35825157d81a39d6543c94acdf1f3693b8c8aa5.jpg](https://i.imgur.com/fdjj9Zw.jpeg)  

图 3-3-07‘tdAbletonPackage'参数面板  

##### TIPS  

若此处AbletonLiveInstall只有Custom（自定义）选项，且AbletonLiveBuild（版本号）始终显示NoAbleton InstallSelected，即找不到Live安装位置，是因为Live软件没有安装在默认路径；建议重装Live至其默认安装路径。  

![images/086b03b4477d4e05b8d40936b55c521cbfbb04f48f5e7783c6ca6729048f583b.jpg](https://i.imgur.com/nd9U023.jpeg)  

运行Live，点击上方工具栏的＂选项"，在下拉列表最后一行点击“偏好设置”，打开偏好设置面板，如图3-3-08左所示。  

在偏好设置面板左侧选择LinkTempoMID 栏，在控制界面的下拉列表中选择 TouchDesigner，如图 3-3-08右所示。  

![images/406afc7e07bb808ee92ffd92b34d4cf7d7486c50cd07785ecba33c373bcaf0fe.jpg](https://i.imgur.com/9hPyne8.jpeg)  
图 3-3-08Live 偏好设置面板  

此时可以看到，TouchDesigner 界面中'tdAbletonPackage′的显示值由“Oconnected” 变为“1connected"，说明TouchDesigner 已成功与 Live 建立通讯，如图 3-3-09。  

![images/85c07403dd82713787413a457c835d9de9bbbb181ae9dc5ed79f6a9a7965dd1e.jpg](https://i.imgur.com/DSwj5Q5.jpeg)  
图3-3-09 'tdAbletonPackage'  

### 实战案例: TouchDesigner 结合 Ableton Live 工作流

接下来，我们要基于上一节实战案例制作的TouchDesigner工程，实现两个功能：首先,使用TDAbleton插件包，获取Live中每个音轨的音频信息，取代原本在TouchDesigner中使用'audioAnalysis'分析音频的部分，使我们获得最精准的音频数据信息，实现更精致的音画互动效果；其次，我们将通过 TDAbleton 插件包反向控制音频，使 TouchDesigner 可以操控 Live 中的音频参数，实现声音的实时交互变化。  

![images/917594303cc0c8e9d0d60d2ebf3e5188d003dde6a97ea0743adde1470641db38.jpg](https://i.imgur.com/cw0u9dq.jpeg)  
图 3-3-10TouchDesigner 最终工程预览  

为了用Live中不同音轨控制TouchDesigner中的视觉效果变化，我们需要准备一段如图3-3-11所示的在Live 中制作好的MIDI（你可以自己在Live 中制作，或下载本章节工程文件来获取Live 示例工程，下载链接见第41页)。  

![images/e0a6bc9265865de6aad2ef6b098217a49d96fa87a53e9b2c004ec992ecd60a73.jpg](https://i.imgur.com/ylgiYP5.jpeg)  
图3-3-11Live 示例工程  

>首先打开Live示例工程，如图 3-3-11；然后打开3.2章节中实战案例最终完成的“重构松树_MIDI.toe"工程文件，如图 3-3-12 。  

![images/1ac33d28ca05d3c196ef8648339cc155ea058c52130e0982b7a91806fe155da0.jpg](https://i.imgur.com/PFTNGCe.jpeg)  
图 3-3-12重构松树_MIDI.toe  

##### 使用 tdAbletonPackage 建立通讯

在上一步操作中，我们已经通过'tdAbletonPackage′成功为Live安装了TDAbleton运行所必要的相关文件。接下来，我们要建立TouchDesigner与Live之间的通讯。  

在左侧 Palette 插件栏中，找到'tdAbletonPackage'插件，将其拖入右侧编辑区。正常情况下，不需要任何操作，‘tdAbletonPackage′的数值会自动显示为'1connected'，如图 3-3-13。  

![images/2abeb40845cab803972c183409c97435024ecf05be4180da682148bdb3ee1a0c.jpg](https://i.imgur.com/jzCzTOF.jpeg)  
图 3-3-13使用'tdAbletonPackage'建立通讯  

##### tdAbletonPackage

'tdAbletonPackage'是本节的核心插件，用于TDAbleton相关文件的安装，以及 TouchDesigner 与 Live 之间通讯的建立。'tdAbletonPackage'内部包含TDAbleton的其他功能插件，可以复制出来使用，这些插件也可以在Palette 面板中找到并使用。  

![images/ab521e2fcde74eeaa6c7775acc8a9cf66cb3ca3f39b7feff0c80be2603c22431.jpg](https://i.imgur.com/3a6VVJ7.jpeg)  

##### 使用abletonMIDI获得音轨数据

接下来，我们将使用TDAbleton插件包，在TouchDesigner中获取Live 每个音轨单独的音频数据。在Palette插件面板中找到TDAbleton的Live11下拉列表中的'abletonMIDl'插件，将其拖入右侧编辑区，如图3-3-14、图3-3-15。  

![images/03990c94294c9ee38972c79d8ae70f18ba6b678dd8e1b131d44e236ddb9d73f7.jpg](https://i.imgur.com/6Eex6cP.jpeg)  
图3-3-14插件面板中的AbletonMIDI  

![images/220a859019fc926c936aaf40e9e7137e27f66979c67b84d906b0d281afd5cb40.jpg](https://i.imgur.com/DyaqwbN.jpeg)  
图3-3-15网格中的TDAbletonMidi  

##### I abletonMIDI

'abletonMIDIl'可以让 TouchDesigner 通过 MIDI 协议获取在Live 中每个音轨的实时触发事件。它可以传输所有类型的MIDI数据，包括音符、控制消息、程序消息等数据。  

![images/841ee4d7bbca507f73dbd4818fb920a4be3dd874199780fb67652664b8a28192.jpg](https://i.imgur.com/0qwIl8J.jpeg)  

点击'abletonMIDIr'参数面板的Track(音轨)，可以发现其下拉列表中的选项名与Live中各个音轨的轨道名相同，如图 3-3-16、图 3-3-17。  

![images/2fef21f6acb64e0b2ff8e7edc197049f75a3e469fb3042ec96c9c8fb39cd14f2.jpg](https://i.imgur.com/haDpMH0.jpeg)  
图3-3-16TouchDesigner中的音轨名称  

![images/74c646620ef6a575a8723f120c55c80bdb90e610ebb167e5d1533209279d480e.jpg](https://i.imgur.com/sRvg5UL.jpeg)  
图3-3-17Live 中的音轨名称  

首先获取名为DrumMQ的音轨信息。在Track（音轨)参数下拉列表中选择 Drum MQ，此时Device(设备)选项被激活，选择TdaMIDl，如图3-3-18。  

![images/5f36f8c1f0bd0c8ce03ba1bbe71f382dbb545b5eb11144eb9add6ae1bd0ba624.jpg](https://i.imgur.com/Jq51Xeu.jpeg)  
图 3-3-18选择音轨与设备  

连接成功后，我们回到Live界面，按空格播放音频。可以看到，Drum MQ通道的节拍被触发时,TouchDesigner 中对应的通道也会发生数值的变化，如图 3-3-19、图 3-3-20。  

![images/4bdd1d1d01d1723888e85d888986df6484cc65a68d0b53c71991058521535aa4.jpg](https://i.imgur.com/ilF7I9N.jpeg)  
图 3-3-19在 Live 中播放音频  

##### TIPS  

在Live中创建新的音轨时，你可能会发现，音轨对应的'abletonMIDl'参数面板中的Device（设备）没有TdaMIDI 选项。  

![images/f8c460487ea26f3b8189e0d37132fb0531aadf4b444bcd5c7a57f6a83d6d3a55.jpg](https://i.imgur.com/AViwfIg.jpeg)  

这是因为每个TdaMIDI设备都是与Live中每个音轨一一对应的。  

![images/25c0ddfcdbf1abb87dca48829feb55ad10e65261d6bb3f80e2e235b222a55b61.jpg](https://i.imgur.com/zea6X5q.jpeg)  

因此，我们需要为相应的音轨新建一个TdaMIDI设备。点击参数面板中的AddTDA MIDI Device按钮，即可为音轨添加TdaMIDI设备。  

在我们提供的 Live 示例文件中，已经为Drum MQ 和Drum LQ 两个音轨添加了对应的 TdaMIDI 设备。  

![images/f58c1c732cbaad8f7045ed300d624ee0c08e1d91abed5a8d7f0f2977ada0de72.jpg](https://i.imgur.com/FAiqCss.jpeg)  
 

![images/f162a54951190545b67be777b9eab74a5c94af7885026ad15851b728bc0f5699.jpg](https://i.imgur.com/3LiFIkO.jpeg)  
图 3-3-20‘abletonMIDl'对应通道的数据变化  

接下来，我们用这个音轨的节拍信息控制圣诞树形态的变化。在'abletonMIDl'后连接一个Select CHOP'select7'，选择 Channel Names（通道名称）为 midi/tl/TdaMIDl/last_velocity 通道，这个节拍检测功能每次被触发时，通道数值都将从0变为127，如图3-3-21。  

![images/fcb02d091f2ec9d23f0370635b1e7e414d096047d030217f5b7ecc278bb9bfdc.jpg](https://i.imgur.com/wNJRhFx.jpeg)  
图 3-3-21 选取通道  

在之前的章节中，我们使用'audioAnalysis'插件对一段音频进行分析，并提取其中的rythm 通道来控制圣诞树的形态。接下来我们只需要用'select7'中提取的 midi/tl/TdaMIDl/last_velocity 通道替换掉原有的 rythm 通道，就可达到使用Live中的Drum MQ音轨控制圣诞树形态的目的，如图3-3-22。  

为了能顺利替换数据，我们需要将提取到的通道名也改为"rythm"。这样做能避免由于通道名称的变化，导致其他元件中已关联参数报错的情况，如图3-3-23。  

![images/9fd681a8d14e19eb4a9f50d3fd6e3ea0814eb030933d0ba9775095a7dcb03fd3.jpg](https://i.imgur.com/IgXcBfw.jpeg)  
图3-3-22‘audioAnalysis'插件  

![images/f15568e2ac03d4c848f90046a064d73c97738e32914bb2d443d86565610153c5.jpg](https://i.imgur.com/84RBQyP.jpeg)  
图3-3-23参数报错的情况  

点击'select7'，在 Rename to 参数栏中输入"rythm"，对通道进行重命名，如图 3-3-24。  

![images/f179c58102ee00f927c059c507b7e080cb4889ec6cc8d5a2729572a545763bc7.jpg](https://i.imgur.com/0WiJLP7.jpeg)  
图 3-3-24 通道重命名  

接下来，我们只需将'select7'连接至'countl′的第一个输入口，就完成了通道数据的替换，如图 3-3-25。  

![images/f545b4a204ea11ea5264238e1b67eb78778223225bdb73fcabfd6dfdaec8d922.jpg](https://i.imgur.com/q87nKtX.jpeg)  
图 3-3-25通道数据替换  

##### TIPS  

如果再从Live中获取一个音轨数据，我们需要建立一个新的'abletonMIDl'，然后在Track（音轨）中选择与Live中相对应的音轨。  

![images/97522978f0d712218d90c9c430009952ccfd1f82a84a7a60e2713ab477d2f4ca.jpg](https://i.imgur.com/5ZCpe54.jpeg)  

到目前为止，我们已经实现了用Live 中的Drum MQ音轨的节拍精准控制圣诞树的形态变化。  

##### 使用abletonLevel调用频段参数

在之前的步骤中，我们已成功将原 TouchDesigner 工程中'audioAnalysis 插件分析出的 rythm 通道替换为'abletonMIDl'提供的音轨节奏触发通道。接下来，将原始工程中'audioAnalysis'插件分析出的 mid 通道（已改名为size）用'abletonLevel'分析得出的低频通道进行替换，如图3-3-26。  

![images/fabde40c7acf66b2b8a446491970b63c30dcf624b9328f945b6aceae8f6a8753.jpg](https://i.imgur.com/BwIkGKr.jpeg)  
图3-3-26 使用'audioAnalysis'获取mid 通道  

##### abletonLevel

abletonLevel'可以基于任意轨道（包括Master轨道）返送原始音频流，并对音频进行分析。其功能类似于 TouchDesigner 中的'audioAnalysis'插件。  

![images/65a74f2d7488e9a7897880e09d23a1bb7387162905b4fb88d98945e9db1bd3a5.jpg](https://i.imgur.com/ctRq1Wa.jpeg)  

##### TIPS  

在通道名称中，"level"被解释为程度，后缀中的"Low"代表低频，"Mid"代表中频，"High"代表高频，""与"r"分别代表左右声道。这样的命名规则使通道的含义变得更加清晰明了，便于准确识别和处理不同音频特征。  

接下来，在Palette 插件面板中找到TDAbleton 的Livell 下方列表中的'abletonLevel'插件，将其拖入右侧编辑区空白处，如图3-3-27、图3-3-28。  

![images/440c692be4fb15e1140a5bf7a0014356f2b9abb8c140e81e0753278c7ca6171a.jpg](https://i.imgur.com/RqOzaM1.jpeg)  
图3-3-27Palette 面板中的'abletonLevel'  

![images/1c07579f04469e089d4c9b0baa7c0a0ac2381f8f8b474847d36085ad11c47f00.jpg](https://i.imgur.com/Qk3RiV4.jpeg)  
图3-3-28编辑区的'abletonLevel'  

打开其参数面板，将Track（音轨）设置为 [[MasterTrack]]#，Device（设备）设置为 TDA_Audio_Analyzer,这样就获得了'abletonLevel'对整段音频高、中、低频的数据分析，如图3-3-29。  

![images/481bf0f33c74438935e2fa41ff02142ce474ecc685882147992d1a71e26136ca.jpg](https://i.imgur.com/ig45x3g.jpeg)  
图 3-3-29选择音轨与设备  

##### TIPS  

在 Live 中建立新的音轨或选择其他音轨时，你可能会发现 TouchDesigner 中对应的'AbletonLevel'参数面板的 Device（设备）栏找不到 TDA_Audio_Analyzer 选项。此时需要为其添加 TDA_Audio_Analyzer，点击 Add TDA Audio Analyzer Rack,即可为该音轨添加设备。  

![images/cc667cc67c6d7e03fbf4a8100b354de7afb0eb77622886cb9dcac2d7b67f41bd.jpg](https://i.imgur.com/D1rW3Yx.jpeg)  

本书提供的 Live 示例文件中，已经为 [[Master]] Track# 添加了相应的 TDA_Audio_Analyzer 设备。  

##### TIPS  

目前 2.1.0 及以下的 TDAbleton Version 版本在使用'abletonLevel'时会出现一个漏洞。  

点击 Add TDA Audio Analyzer Rack 为其音轨添加设备后，数据不会产生变化;同时在 Live 界面中，下方会提示“缺少媒体文件。请点击此处了解更多信息”。下面我们来修复这个漏洞。  

![images/6336728eb7cdb0eab73ca06844302f1f770c216efb89144aafc0035e2ebc3926.jpg](https://i.imgur.com/IRAi16W.jpeg)  

![images/6921455542d6b9736b861ec4e11c02c10c5c71c4db44a941a97839a225167934.jpg](https://i.imgur.com/huVftGh.jpeg)  

![images/887627268328f7d84b75250c93b3bea2521289f89f9b159cf96410486c45375c.jpg](https://i.imgur.com/G8gXT87.jpeg)  

1.点击提示文字，会弹出“丢失媒体文件”窗口。  

![images/bc1d49f0cc9adf1ad9da384ba9dc5a02828b265125ffbfda2d875bcd63caf66e.jpg](https://i.imgur.com/5DpLUsW.jpeg)  

2.点击自动搜索的“开始”按钮。  

![images/cb6ee386e678b5bbe4da617dad006a4a266506bf7c5e02af385948da22a2ac21.jpg](https://i.imgur.com/TQqqjbh.jpeg)  

3.点击 TDA_Level.amxd 前的"?"图标。  

![images/b9f0c5050e7a996a422cdf06fbcf2cef667675c7703b02c933120f9d257bf593.jpg](https://i.imgur.com/mf9JIXe.jpeg)  

1. 此时，软件会自动找到丢失的 TDA_level.amxd 文件,双击进行重新关联。  

![images/b58e21f2b07d9a959e7f7311e8a10e77603d12b36f29734e4d49600b5996b2b3.jpg](https://i.imgur.com/U5qaUxN.jpeg)  
TDAbleton\* [TDAbleton] - Ableton Live 11 Suite  

5.此时，Live界面下方不再有提示性文字，且TouchDesigner 中'abletonLevel的数据开始变化。  

接下来，我们选取需要的通道。在'abletonLevel'后新建并连接SelectCHOP'select8'，在'select8'参数面板的Channel Names（通道名称）选择level/tm/Low/r，如图 3-3-30。  

![images/e71761284fd2a277f27902d59893c79854adf61c8e9505e0fd3e7d3a6a98ae9a.jpg](https://i.imgur.com/FwY0JhX.jpeg)  
图 3-3-30提取所需参数  

为了避免由于通道名称的变化，导致TouchDesigner中已关联参数的报错，我们需要将'select8'的Rename to参数改为 size，如图 3-3-31。  

![images/0eb612170bbfa8a1b731e73b09ba189e178699d8e5901c905d0519e8730df51c.jpg](https://i.imgur.com/ChjCPIy.jpeg)  
图 3-3-31修改参数  

最后，我们断开'selectl'与'math7'之间的连接，将'select8'连至'math7'即可完成数据替换，如图3-3-32。  

![images/108520db1d01c9eecc58ccbedf1262c4a464ee12ceb074c259398b324d247c8a.jpg](https://i.imgur.com/g3VF22I.jpeg)  
图 3-3-32 数据替换  

至此，整个圣诞树的树叶排布就已经完全由'abletonMIDl'和'abletonLevel插件提供的Live 中的音频信号控制了，如图3-3-33。  

![images/176761681533a5d92aa6bacce489b2d81fe40680fef7e78eb4bdb2f3e9884d6e.jpg](https://i.imgur.com/tT6fFjd.jpeg)  
图 3-3-33最终工程预览  

##### 使用abletonMapper调用频段参数

在上文中，我们已经学会使用'abletonMiDl'与'abletonLevel来获取从Live 传输到 TouchDesigner 的音频特征。接下来，我们使用TouchDesigner来控制Live 中的效果器参数，从而实时修改音乐。  

找到Palette插件区的'abletonMapper，如图3-3-34，并将其拖入编辑区，如图 3-3-35。  

##### abletonMapper

![images/5f5de4a423d73a8d0e838dfe6679dfd05aea8edc2229b0d6a9db05384f6bba8c.jpg](https://i.imgur.com/1t71N7D.jpeg)  
图 3-3-34Palette 插件区  

在'abletonMapper'参数面板中，Track（设备）选择Melody，Device 选择 TDA_Mapper，如图 3-3-36。  

使用abletonMapper插件时，我们可以实现从TouchDesigner向Live动态传递参数的功能。这些参数在Live中可以再次映射到任意效果器的参数上，从而实现更加灵活多样的效果控制。  

![images/c354f073317c108fa64411fed0147340b90cda428187543d8ebbee7c272df28e.jpg](https://i.imgur.com/I0pBnwN.jpeg)  

![images/baf007ebde029c9e80148519f0de2baa7e7264ff47e6ea7c6c06f67e13b83e77.jpg](https://i.imgur.com/KRwgoor.jpeg)  
图3-3-35编辑区中的'abletonMapper  

![images/33b038ef6fde803a440ce8489c6e93a9a72bbc93af772070fa30e177ea92d962.jpg](https://i.imgur.com/aEzHDtv.jpeg)  
图3-3-36'abletonMapper'参数面板  

##### TIPS  

与上文两个插件相同，在Live 中建立新的音轨或选择其他音轨时，你会发现在 TouchDesigner 中对应'abletonMapper的 Device 参数列表中找不到 TDA_Mapper 选项。此时，我们需要手动为其添加 TDA_Mapper。点击 TouchDesigner中'abletonMapper' 参数面板的 Add TDA Mapper Device，为此音轨添加设备。在本书提供的 Live 示例文件中，已经为 Live 中的 Melody音轨添加了相应的 TDA_Mapper 设备。  

![images/8187a0ed4a14ace6d7db52720111106e7b1601397e29f80892b525aa9c9f93a1.jpg](https://i.imgur.com/qDEco8K.jpeg)  

接下来，我们需要将TouchDesigner中'abletonMapper'参数面板的 MapValues 页第一组数据映射给 Live 中其他效果器。回到 Live界面，点击 Melody音轨，在下方插件栏中可以找到对应的TDA_Mapper，如图 3-3-37。  

![images/523a3e6371fcc92d0f1a308f7e08ad8c70a3bba2949199a4447f5706dd257144.jpg](https://i.imgur.com/wf2caDT.jpeg)  
图 3-3-37选择 Melody 音轨  

在'abletonMapper 参数面板的 Map Values 页，我们可以随意调整这些参数。每组参数与 Live 中的 TDA_Mapper 一一对应，让我们能够方便地进行映射设定，如图 3-3-38、图3-3-39。  

![images/ade33e3868556b54225abc809426a587a931ac7da1a93d8ca02d1d401b799f13.jpg](https://i.imgur.com/Y4FKnA6.jpeg)  
图 3-3-38 Map Values 参数栏  
图 3-3-39 TDA_Mapper 参数栏  

点击 Map 开始映射，在 Map 进入闪烁状态时点击其他按钮即可完成映射。这里选择映射 Audio Filter 面板中的 Frequency 参数，如图 3-3-40、图 3-3-41 。  

需要注意的是，本书的Live 示例工程中，已经完成这一步Map 的映射，因此第一组的"Map"字样已经变为"Frequency"， 如图 3-3-42。  

如果想继续跟随教程操作，可以点击红色 Unmap按钮解绑映射。  

![images/341a36e4c63cc6c8ca1261dba5520665bc991510ef2c782d5dce99ae9e9b5471.jpg](https://i.imgur.com/FR75RVy.jpeg)  
图 3-3-40“Map"闪烁状态  

![images/de19c9f239a14e532d0bf4f3fe6fd0d5969cd93cf9ac5381d5202d8f54ea9740.jpg](https://i.imgur.com/VEFeE1S.jpeg)  
图 3-3-41映射至 Freq 参数  
图 3-3-42 示例工程中关联 Frequency  

至此，当我们在 TouchDesigner 中控制'abletonMapper 参数面板 Map Values 页 Send Value1 和 Min/Max1 参数的数值时，会影响 Live 中 Melody 音轨 TDA_Mapper 的第一组数值；而 Live 中的 TDA_Mapper 的第一组数值则会进一步使 Auto Filter 效果器中的 Filter Freq 参数值产生变化。这种链式的参数映射使我们能够在 TouchDesigner 中实现对Live音轨和效果器参数实现动态精细控制，如图3-3-43。  

![images/b3a85fcef2183c3792b3eca4b131523aca4867118c25d3bb77d23ebfbf31dd1b.jpg](https://i.imgur.com/aSBJuLz.jpeg)  
图 3-3-43使用'abletonMapper'插件控制 Live 中的 Freq 参数  

这样，就完成了TouchDesigner与Live 的双向通讯，既使用Live 中的音频参数控制了TouchDesigner 中的视觉效果，让我们可以利用比'audioAnalysis'插件更细致丰富的音频数据制作音画互动作品；又尝试了通过TouchDesigner 中的参数实时控制 Live中的音频数据，便于实时演绎的系统集成。  

## 3.4 TouchDesigner 与 Resolume Arena

本节将讲述如何利用 TouchDesigner 与 Resolume Arena 的通讯，将 TouchDesigner 中实时渲染的画面内容传输到 Resolume Arena 进行二次编辑和控制；同时，本节将介绍 NDI 协议和 Syphon/Spout 协议的原理异同、优劣，使读者能将所学知识在现场演出、展览等艺术场景真正落地。  

##### Resolume Arena 简介

Resolume Arena（以下简称Arena）是一款专业的视觉艺术创作和演出VJ软件，能够制作、播放和控制图像及音频等素材，营造出丰富、震撼的视觉效果，如图3-4-01。该软件支持多种视频格式，同时可以和音乐产生互动效果。其自带的 Mapping 矫正及融合功能，能够将视频投影到不同形状的物体表面上。此外，Arena 还支持 MIDI 设备、OSC通讯等外部控制方式，从而实现更加灵活的控制方式。Arena 的用户界面简单直观，方便VJ在现场演出时使用。  

![images/afe6a25c97b7424c925ff48d46b9dd943c4e5b2eb442444c856e18f2af0e5b66.jpg](https://i.imgur.com/XYl8Qks.jpeg)  
图3-4-01使用Arena进行音画演出播控  

##### ResolumeArena的应用领域

Arena 主要应用于音乐会、演唱会、舞台表演、夜店演出、艺术展览等现场活动和视觉艺术创作领域。在舞台表演中，它常被VJ用来播放和音乐相关联的视觉特效和动画，与音乐家和 DJ协同演出，营造出独特的视听体验。在艺术展览中，Arena也常被用于播放和展示艺术家制作的影像作品、数字艺术作品等。  

##### Resolume Arena 的下载与订阅

访问官网 https://resolume.com/download/下载页，如图 3-4-02， Windows 用户点击"Download Arena & Wire"进行下载。  

##### TIPS  

Resolume Wire是一个模块化的、基于节点的软件，可用于为ResolumeArena 以及 Avenue 创建效果、混合器和视频生成器。  

MacOS用户先点击右上角灰色小字"Downloads for MacOSC"切换至 Mac 版本软件的下载页面，如图 3-4-02。再点击"Download Arena &Wire"进行下载。  

![images/a1bbd83c67a952c94d8547188d40d4db74fc5260ce76a61e232e747c0fca55d2.jpg](https://i.imgur.com/EhgPubf.jpeg)  

Resolume Alley 是一个快速、轻量的视频播放器和视频转换器。  

##### TIPS  

![images/51ef3e9d6aabae96dabe420d5e5d2a3d1b0a8d2527bf22988919e72aca3b8eb8.jpg](https://i.imgur.com/uldg5as.jpeg)  
图 3-4-02Arena 软件下载  

![images/2f58af4b3ffbedefd9d80c31c364f3ef23b39e65f16e0170df8a9826487474e6.jpg](https://i.imgur.com/LXMyNFc.jpeg)  

Arena 采用的是年度订阅制，如需使用，用户要每年进行续费。如图 3-4-03，访问官网 resolume.com/shop/付费订阅。  

![images/05f0ef114c2489a8bdaadb99644701c6342adb9ff61627f3d3586988fe5bf93f.jpg](https://i.imgur.com/Besv40c.jpeg)  

![images/5cabfdbcb1ef996db0dcfddc227b1d95f8d3de2411315d42990eb6c50b9f9c95.jpg](https://i.imgur.com/vQJu9Vw.jpeg)  
图 3-4-03Arena 官网订阅页面  

下面将依次介绍Resolume Arena 软件编辑界面的功能布局，包括主窗口、监视窗口、属性面板和浏览器面板，如图3-4-04。  

![images/c1f68f63c8407603759e767c9bff17f10036ca12812f37a319d80c589e8f918d.jpg](https://i.imgur.com/Dk0Sbu4.jpeg)  
图 3-4-04Arena 软件界面  

主窗口：主要用于预览和控制输出内容。如图3-4-05，此处可以添加、编辑、管理和播放视频、图像和音频文件。  

![images/a0be4ef723bcb588ee622c1dcf739928abd828cc6e8b504dfb39e221393ff694.jpg](https://i.imgur.com/78UgRph.jpeg)  
图 3-4-05Arena 软件的主窗口  

##### TIPS  

主窗口的每一行是一个“图层”。上下“图层”之间存在叠加关系，不同图层的叠加可用于合成不同的效果。  

每个缩略图都代表一个“片段”，在每个图层上，同一时刻只能选择一个片段作为播放素材，但每个图层可以同时存放很多片段素材，用于在不同时间进行切换（下图中“案例 $6^{\mathfrak{n}}$ 为此时图层1正在播放的片段素材）。  

![images/be9819c775ba258d9f68b56173075d1f945680ab6d9e30506cc876576c74f1c8.jpg](https://i.imgur.com/Wm6QAJG.jpeg)  

监视窗口：CompositionMonitor（合成监视器）主要用于查看最终不同图层叠加后的视觉效果，如图3-4-$06_{\circ}$ 除此之外，我们还可以自定义一些需要监看的画面内容。PreviewMonitor是单个素材的预览监视画面。  

![images/3b54ea9ab5ba84ea7fcb26b4d177cee9b4cc85fe17f5e15213095d08f1383dad.jpg](https://i.imgur.com/BDQghwA.jpeg)  
图 3-4-06Arena 软件的监视窗口  

浏览器面板：主要用于素材的管理，在Arena中我们可以直接导入视频、音频、图片，也可以使用其预置的滤镜效果与素材，如图3-4-07。同样，由ResolumeWire制作的素材，也可以导入Arena进行播控。  

![images/feb0e53010afde8e570ec63f1a4e31322caf066e19e8f859f0bb3a2efacf5e8c.jpg](https://i.imgur.com/b5mGu8i.jpeg)  
图 3-4-07Arena 软件的浏览器面板  

属性面板：主要用于调整每个视频的参数。如图3-4-08，在这里控制每个视频的播放状态、图像变换、滤镜等。  

![images/703245b60cc1bffbd6f9b6d1583551cbac127c7b5f5c239e884e06e93078d2ff.jpg](https://i.imgur.com/PVElTvR.jpeg)  
图 3-4-08Arena 软件的属性面板  

##### TouchDesigner $^+$ Arena 工作流

NDI 协议与 Syphon/Spout 协议  

TouchDesigner在实时交互方面具有得天独厚的优势，可以结合各种体感设备进行创作。此外，它还能兼容AbletonLive，获取最底层的音频数据，用于视觉效果的驱动。即使是其他方式输入的实时音源信息，TouchDesigner也具备一定的分析能力。  

一场音画互动VJ 演出中，需要较为丰富的播控功能和清晰友好的操作界面，因此，视觉的播放控制管理至关重要。如图 3-4-09，在 TouchDesigner 中搭建一个完整的播放控制系统，通常需要较为专业的操作水平和更多时间；而 Arena 在 VJ 领域的操作简易性对于新手来说更友好。  

NDI协议和 Syphon/Spout协议都用于在不同软件间传输音视频信号，如在 TouchDesigner 和 Arena、Unreal、Unity3D 等软件间。但它们有一些区别。  

![images/86d7f3fb9ed414d01416483d19f4e08e2af03db77d3a2311288e5a544d286cbe.jpg](https://i.imgur.com/BQQaRtj.jpeg)  
图 3-4-10NDI 协议与 Syphon/Spout 协议  

![images/34a743df47b1b77deb3557f8dc143a3dd7e61f3e7d1fc4cdd5c633a2ad891f27.jpg](https://i.imgur.com/pPKknLo.jpeg)  
图 3-4-09TouchDesigner向 Arena 传输视频  

Syphon / Spout 协议：Syphon 协议和 Spout 协议都是本地应用程序之间的数据传输协议。在一台电脑上同时启动不同程序，Syphon/Spout 协议允许应用程序之间通过共享内存传递图像数据，所以几乎不产生延迟。  

##### TIPS  

Syphon 协议指 Mac 系统上的本地图像传输协议;而Spout 协议指PC 上的协议，他们的功能和原理是一样的。  

NDI协议：NDI协议是由NewTek公司开发的一种基于网络的协议，不仅可以用于本地程序之间的信号传输，还可以通过局域网将视频信号从一台计算机传输到另一台计算机，但网络速度可能会导致传输延迟。  

我们可以使用图像传输协议，如NDI协议Syphon/Spout 协议，将TouchDesigner 中的画面实时传输给Arena，通过Arena对整场演出进行播放控制。  

简言之，Syphon/Spout协议适用于一台计算机内不同程序之间的无延迟图像数据传输，而NDI协议适用于通过网络在一台或者多台计算机之间传输视频信号。  

### 实战案例：圣诞雪景--用 Resolume Arena 进行实时后期处理及播控

接下来，我们将尝试分别使用 NDI 与 Syphon/Spout 协议，将之前完成的音画互动视觉内容实时传输至Arena。我们还将简单使用一些Arena 自带的效果器进行画面的后期效果调整，如图 3-4-11，最终将内容全画幅输出到主屏幕上。  

![images/de9758efc9a79f68a031f4e013e9d22227ca64fb9e88e8a2e87ecc91764eb4c8.jpg](https://i.imgur.com/MTJotK8.jpeg)  
图3-4-11在编辑区的最终工程预览  

$>$ 打开ResolumeArena，点击上方菜单栏中“作品”，在下拉列表中点击“新建”，如图3-4-12。  

如图3-4-13所示，在弹出的面板点击左下角“新建”，一个新的Arena 工程文件就创建成功了。  

![images/b7d9c26d5f953e953e0d819c0db0441e7dab48c9aad2622891565c90398576e2.jpg](https://i.imgur.com/cXEh8Zc.jpeg)  
图3-4-12菜单栏  

![images/4f85a6ad732738f3d528b3e247223a3ebbed8c114e878ab945fe70c2031764eb.jpg](https://i.imgur.com/BBRW3OU.jpeg)  
图3-4-13成功新建作品  

在顶部菜单栏中，选择“输出”，在下拉列表中找到“作品输出分享”，分别点击“Texturesharing(Spout)”和“网络串流(NDI)"，将这两个选项打开,如图 3-4-14。  

打开3.3实战案例中制作好的MIDI设备控制圣诞树音画互动效果TouchDesigner 工程文件，如图 3-4-15。  

![images/e8fb261ee63c788d0fc2c16f039ea213c7ff45b803e85b5dd9563537b03aa181.jpg](https://i.imgur.com/l6QnCqF.jpeg)  
图 3-4-14打开 Spout与NDI输出选项  

![images/a8c416c1fc7a4a84fe6332ba1ec3d51d95a0828a4285f4c3bee26e259be5e01d.jpg](https://i.imgur.com/KgD4eOy.jpeg)  
图 3-4-15 打开 3.3 实战案例 TouchDesigner 工程文件  

在编辑区最右侧新建 NDI Out TOP'ndiout1′与 Syphon Spout OutTOP'syphonspotoutl′元件。如图3-4-16，将'text1′与'ndiout1′相连，'hsvadj2'与'syphonspoutout1′相连。接下来，我们分别使用 NDI与 Syphon/Spout这两种协议同时将画面输送给 Arena，以此来分别演示这两种协议传输画面的功能。  

![images/b51f6a9701acf4e2db73bea1417d645305399c4ca5a6b3407a2bbb62ee194cee.jpg](https://i.imgur.com/Ua47HXI.jpeg)  
图 3-4-16 新建 NDI Out TOP 与 Syphyon Spout Out TOP  

点击'ndioutl'打开参数面板，将Include Alpha（包括不透明度信息）选项打开，如图 3-4-17。这样做能够将图像中的 Alpha（不透明度信息）一起传输给Arena。  

##### TIPS  

在 NDI Out TOP 中,Source Name（资源名）默认为TouchDesigner。当有多个基于NDI协议传输的链路存在时，需要在发送端和接收端修改成不同的资源名，以避免信号冲突。  

![images/71827bfce76dde65e622869dad2386a8960d105070a3048ca99368961f54ab19.jpg](https://i.imgur.com/GLSTw2L.jpeg)  
图3-4-17NDIOut TOP参数面板  

点击'syphonspoutoutl'进入参数面板，如图 3-4-18。在这个案例中，我们使用其默认参数即可。  

##### TIPS  

在 Syphon Spout Out TOP 中,SenderName（发送者名）默认情况下为TDSyphonSpoutOut。当有多个基于NDI协议传输的链路存在时，需要修改发送者名。  

![images/02e4af71f5642b021e85ff2b5af0fb4ac4a7df75da279529995ae9e6fbc4f460.jpg](https://i.imgur.com/AE9P5SM.jpeg)  
图 3-4-18Syphon Spout Out TOP参数面板  

接下来，我们将TouchDesigner 工程最小化（不要关闭程序)。  

默认情况下，TouchDesigner最小化的时候会停止运行工程，因此我们需要进行一些设置。如图 3-4-19，在TouchDesigner的左上方菜单栏中点击Edit(编辑)，在下拉列表中选择Preference（偏好设置)。  

![images/c2aff7bbeeea19f0c46a7f1286577fd6802cf3cd9f42f662cc59b3b9e6944ab8.jpg](https://i.imgur.com/iNI9zok.jpeg)  
图3-4-19偏好设置  

如图 3-4-20，在 Preference（偏好设置）中，取消勾选 Stop Playingwhen Minimize（当最小化时停止运行工程）选项，点击右下角Save,保存偏好设置。  

##### TIPS  

在TouchDesigner默认设置中，工程文件最小化后，只有当其在桌面最前端的状态下，程序才会运行。因此，如果需要保证程序在后台或最小化状态下正常运行，需要在偏好设置中进行设置。  

![images/41326d91588d92e99f7be2561b52724b0e1dcc73a9bd0bdd18352109eff53b60.jpg](https://i.imgur.com/DYPcPH7.jpeg)  
图 3-4-20 取消勾选 Stop Playing when Minimize  

回到Arena 界面中，在右下方浏览器面板选择“源"，如图 3-4-21,在下拉列表的最底端可以看到 NDISERVERS（NDI 服务）下有一个后缀为"TouchDesigner"的选项，SPOUT SERVERS（SPOUT 服务）下有名为"TDSyphonSpoutOut"的选项。  

![images/fd26d510d08822dd76f34c9136294ce80465c017bf5789e76fe7b052c3dd1130.jpg](https://i.imgur.com/MIGbnU1.jpeg)  
图3-4-21NDISERVERS与 SPOUT SERVERS  

用鼠标将这两个内容拖拽至主窗口中。如图3-4-22,将 Spout 的内容放置在图层1 中的列 1，将 NDI 的内容放置在图层2中的列1。  

![images/acd0c7ea9a4549903db41a1fe19d70cc859b679ab8842e92ac1cd5849c3a4b0d.jpg](https://i.imgur.com/O22EjqV.jpeg)  
图3-4-22将内容放入主窗口播控栏  

分别单击这两个图标，如图3-4-23,这样我们可以在监视窗口中看到不同图层叠加在一起的视频内容。  

![images/932737038e8fbfa5fa98b3fb5e0c965876c606d4cb2b9526ec0dd4be2cac775c.jpg](https://i.imgur.com/ZsRE9sr.jpeg)  
图 3-4-23 查看内容预览  

至此，我们已经成功将TouchDesigner中的画面实时传输给Arena 作为素材进行播控了。接下来，可以在Arena中添加一些预置效果。  

如图3-4-24，我们在右下方浏览器面板中选择“效果”，在搜索栏中搜索snow(雪花效果)。  

![images/46de8db51ed37a95c717bbc819a1bd51c5127ecf21b4cf4816aaf2d263fe37f0.jpg](https://i.imgur.com/Ikqqenz.jpeg)  
图 3-4-24 搜索雪花效果  

如图3-4-25,将搜索出来的 snow（雪花效果）拖拽至图层3中的列1。  

![images/ef365be5dcf0fc0214aad31bd4fe7d9200d76bc97d7d82bb1e628bbc6b6617e8.jpg](https://i.imgur.com/e7MMuMv.jpeg)  
图3-4-25将雪花效果拖拽至片段上  

鼠标点击视频片段，如图3-4-26。  

![images/3be2601ed2396ddb3a0b954d22d775d53b602d6745dd790963a83f00aa7204c4.jpg](https://i.imgur.com/8J54FlG.jpeg)  
图 3-4-26点击查看预览  

可以看到监视窗口的片段预览为添加雪花效果后的片段，如图3-4-27。  

![images/e44da3126787a26ba7bd4c1ea2e532f0ad701d9d77b2d7892eec8fc155b54527.jpg](https://i.imgur.com/f6Nk6j2.webp)  
图 3-4-27添加雪花的效果  

##### TIPS  

在 Arena 中存在图层叠加的概念，因此我们在合成素材时，要注意素材放置的上下层关系。层数越高，叠加的位置就越靠前。  

我们还可以在原始图像上添加一些滤镜效果。  

如图3-4-28，在右下方资源面板中同样选择“效果”，在搜索栏中搜索rotating（旋转效果)，找到 RotatingPanel (旋转面板效果)。  

![images/f59e998ccd4dc6729fda166f787fa00d5b31b38e481ccceca33765c9c5cafd7c.jpg](https://i.imgur.com/7flbP42.webp)  
图3-4-28搜索旋转效果  

如图 3-4-29，将rotating（旋转效果）拖拽至图层1的列1视频素材上，为其添加旋转面板的效果。如图3-4-30，可以看到TouchDesigner 中实时渲染的视觉图像在Arena中被添加了旋转效果。  

![images/ed23143007ea46de46b22350b8f71a18a3200847008c294f315db7c8473ad0a6.jpg](https://i.imgur.com/MyfvK7J.webp)  
图 3-4-29将旋转效果拖拽到内容上  

![images/bec9a2cbe11b0657ee10c18c28e135a9c25f1aaefc253aeda7d40d79235a89f1.jpg](https://i.imgur.com/KabUYHV.webp)  
图 3-4-30旋转效果预览  

最后，需要将合成监视器中的画面全屏输出给主显示器(通常为电脑显示屏或投影仪）。  

点击顶部菜单栏的“输出”，在下拉列表中可以找到“全屏”，其中任一输出设备均可被指定为全屏显示的主显示器。在本案例中，如图3-4-31，计算机接入了3个显示屏，因此会有显示 1、显示 2和显示 3。  

![images/013cb0f0b6605967b81f183f1517f68000b384195360a8f257b57a53893b7df8.jpg](https://i.imgur.com/Iqcvxvf.webp)  
图 3-4-31旋转效果预览  

选择需要输出画面的屏幕序号，点击即可进入全屏画面。如果需要退出全屏，我们可以点击“禁用”或者使用快捷键 Ctrl+Shfit+D。至此我们就完成了 TouchDesigner 与 Arena 通讯的建立，如图 3-4-32。  

![images/2b5c33183741dc64f989ca96deb482f6e15738a922ee9e01a24d3d1e8b39578f.jpg](https://i.imgur.com/LXYN0eH.webp)  
图 3-4-32案例最终效果  

##### 更多学习资源：TouchDesigner 与音画互动设计

![images/a0ac8ff126bf8a2a9aca093045041ef03880a4f876ab92b58d04d7da392317b7.jpg](https://i.imgur.com/CoDChMW.webp)  

![images/c1a19d31d5034e576504a682763818ecce7a8f602a3c78a3cbc26df194059ad8.jpg](https://i.imgur.com/JLI6Bvr.webp)  

由 TouchDesigner 官方中文社区一TEA Community 开发的《TouchDesigner与音画互动设计》线上课程，在本章节的教学基础上，更深入不同风格视觉效果、音画互动设计。教学案例包含交互粒子系统、可视化示波器、实例化地形及几何元素、摄像头实时滤镜等多种视觉风格，教学案例效果均可商用。  

同时，教学以演出全流程思维为框架，教学内容涵盖视频素材创作、音源输入、演出现场的硬件控制器、软硬件通讯等，打破软件壁垒，建立 Ableton Live、TouchDesigner 与 Arena 共同构建的音画互动演出系统。  

## 3.5 Notch VFX 与 Notch TOP

Notch VFX 是一款视觉特效软件，主要用于创建动态图形和视觉效果。它具有高度可定制性和强大的工具集，使用户能够快速创建复杂的视觉效果，如粒子效果、烟雾效果、火焰效果等；它还具有很强的实时预览功能，可以支持大型的视觉效果工程，是视觉特效行业的一款领先软件。  

Notch VFX 和 TouchDesigner 可以结合在一起，创建复杂的视觉效果项目。用户可以把 TouchDesigner 强大的实时计算和外设硬件整合功能与 Notch VFX 的视觉效果结合在一起，以创建更加复杂和高效的交互视觉效果项目。  

![images/1210e91f1f1487601f3a966495616fb6848d5ee75d123c9fc45dc5cab6b50a93.jpg](https://i.imgur.com/eTMXp3x.webp)  
图3-5-01Notch VFX 官网  

本节将介绍如何用TouchDesigner中的数据对Notch的视效进行控制，从而与Notch强大的视觉效果融合。  

结合本书其他软硬件知识点，读者可以创作效果更惊艳的交互视觉体验作品。  

![images/6209877dafdc39d2e24aed9b96c4c2cb70d598b30f199e872c6f43b44f1961e7.jpg](https://i.imgur.com/JbPCnqT.webp)  
图 3-5-02Notch VFX软件界面  

### 实战案例: TouchDesigner 结合 Notch VFX 工作流  

本案例以介绍和展示 Notch 软件和 TouchDesigner 的结合为主，如图 3-5-03。学习如何通过TouchDesigner控制 Notch 中的视觉效果，并搭建对应的交互控制界面。更深入的 Notch 软件学习,可以通过 Notch 官网获得教程（想要在 TouchDesigner 中实时交互 Notch 效果，需要购买 Notch 的 prolicense 的加密狗，以及 TouchDesigner的商业或以上级别付费版本)。  

![images/a708188d21b4e5294dd2e5b27a1b4a6a64d381831b4182a53f6ca2816411ae65.jpg](https://i.imgur.com/iR2aGjY.webp)  
图 3-5-03最终工程文件预览  

![images/e8fe394cfd3f4072a68bbe2db45d0319a74c56fa4319185431f5fdb108105c8f.jpg](https://i.imgur.com/Rf1hBD2.webp)  
图3-5-04Notch VFX开启后的文件选择窗口  

##### TIPS  

如果想制作分辨率在 2K 以上,或2个以上Notch 的联动效果，需要购买 TouchDesigner 专业版。  

##### TIPS  

NotchVFX软件官网下载链接： https://www.notch.one/support/ downloads_area/  

##### Notch 初识

$>$ 在本案例中，我们将使用 Notch自带的案例文件。打开 Notch 软件,如图 3-5-04，在初始界面窗口中选择Samples 大类之下的 Physics Box ofMarbles 案例效果，进入默认效果编辑区。  

先确定效果，以及 Notch 里的哪些参数由 TouchDesigner 进行控制。在本案例中，我们将控制Notch 案例里Rocker（纸盒）的参数来进行效果的变化。如图 3-5-05，找到对应的节点区域，可以看到3个 Math Modifier的节点，这3个节点控制了纸盒的高度，以及在横向和纵向上的选择角度。我们选择这3个节点作为被控制的因素，取消3个Math Modifier与Rocker 节点的连接。  

![images/7d0927ebf0ea6bda5222c2e9aa52026d27ecc0983f7e55a01bedd755938e9f30.jpg](https://i.imgur.com/lQoOOn8.webp)  
图3-5-05用 TouchDesigner 控制的节点  

在Rocker节点的参数界面，可以选择要开放给TouchDesigner进行控制的参数。这里我们选取PositionY、RotationPitch和RotationBank，如图 $3.5\cdot06_{\circ}$  

![images/a3798b455501467d09baf313fe01be0d3ccc92a63c82cd7a9ff44bc41e720d51.jpg](https://i.imgur.com/CaJjsFX.webp)  
图3-5-06Rocker节点的参数界面  

将3个EnvelopeModifier作为新的控制端连入Rocker节点，并分别将它们重命名为PositionY、RotationPitch、RotationBank，如图3-5-07。Notch中的EnvelopModifier与TouchDesigner中的ConstantCHOP功能类似，可以设定为一个可控常数。  

##### I Constant CHOP

![images/e8867470188af25365fb5589b5cd295388475b0f414dff4d22a7061131ae3243.jpg](https://i.imgur.com/u21gwzq.webp)  

Name0（通道0）：更改当前通道的名称和通道值；下方“+”“”符号可添加或减少通道。  

![images/3a32f6ce299c3074278ea9c40342dbe53a2449861850c0daa15855a999bb8f0e.jpg](https://i.imgur.com/NpfsC9U.webp)  

Snapshot Input(输入截图）：可以截取当前一帧的通道数据。  

![images/f5cba918aff8a2355d2e86f232017c5072d158b629f6ba9518d1a0ed939895b7.jpg](https://i.imgur.com/kyVIwQA.webp)  
图3-5-07Envelope Modifier 中的Value 参数  

点开对应的Envelope Modifier参数最左边的问号按钮，如图 3-5-08。  

![images/3a18e74c273bac94516f16664725fd9eb46a48a98b3efab5f4d6639956fae8d3.jpg](https://i.imgur.com/T4GFrjp.webp)  
图 3-5-08打开 Property属性界面  

在弹出的Property（属性）面板中，如图3-5-09，改写对应输出参数的MinValue（最小值）为-10，Max Value（最大值）为10；勾选 Expose Property（开放参数)，并改写Exposed Name（开放参数名称）；点击OK确认属性设置，退出 Property属性窗口，并分别对3个节点的参数进行相同操作。  

![images/35a5ee82ad4eb420efa174d31a90edfca8aeb7ee94a2e058a21ea8e11f09d408.jpg](https://i.imgur.com/vYWcnpd.webp)  

##### TIPS  

在 Notch 中，点击参数左侧的“？”按钮可以打开当前参数对应的Property属性面板。  

![images/28d6b3a85a697ce26cb039c6fd0ba6f0675b511d3c27286571f89e65ad850979.jpg](https://i.imgur.com/rSMDe4q.webp)  
图 3-5-09Property 属性界面  

在面板的 Property窗口中可以设置参数的最大值和最小值;在面板的 Exposed PropertySettings 窗口中可以设置输出给外部软件的参数信息。如果勾选Expose Property，则可以将参数开放给外部软件。窗口中的 ExposedName用于设置参数名，Exposed Group Name则用于设置参数所在类型的名称。  

同理，我们可以在Notch中对小球的颜色进行控制，找到所有相关材质的ColourCorrection节点，如图3-5-10，使用同一个EnvelopModifier节点对3个Colourcorrection节点中的Hue（色调）参数进行控制。  

在 Envelop Modifier 后增加 一个 Range Remap 节点来控制参数的取值范围。Range Remap 节点类似TouchDesigner中的Math CHOP，可以对数据范围做映射，如图3-5-11。  

![images/a89a51ad09cfbe7d5439a8cc47aad2ad49a27ce928167a978faa9b2b17039544.jpg](https://i.imgur.com/3Vc5v3U.webp)  
图 3-5-10控制小球颜色的节点  

![images/e69c1016ff21df40ea1145405c23585bb614e7d3245b646c1cf17bdf51f65480.jpg](https://i.imgur.com/mUwhMYl.webp)  
图 3-5-11Colour Correction 节点中的 Hue 参数  

重复上文中的步骤，如图 3-5-12，将 EnvelopModifier 的 Value 参数开放给 TouchDesigner。  

![images/b8d5128e52020b4c5cb3f5d8cab8c9dc5659adcb42fdab92e3858c24909510c6.jpg](https://i.imgur.com/c1vdcql.webp)  
图3-5-12开放Value 参数  

##### TouchDesigner 与 Notch 的通讯

首先在 Notch 界面的控制选项区域点击 Project，在下拉列表中选择输出 Compile Block for Media Server(媒体服务器编译模块)，如图 3-5-13。  

![images/f9747dfaa5131454064ab94a5675c6dbe21b913cfcece67e17ab0c45b9ced0ac.jpg](https://i.imgur.com/GKzU0Ws.webp)  
图 3-5-13Complie Block for Media Server 的选项  

在模块的参数面板将Filename输出模块命名为Notch toTD，如图3-5-14，并点击右侧设置编译模块在电脑资源管理器中的文件保存路径。值得注意的是，Notch软件以及其输出的block文件需要一个全英文的文件夹路径来保存文件。若路径中有中文，则会导致Notch无法保存或者block文件无法读取。  

![images/fb1fcb7f2ccaea0464d3f5c6f11d256eba16b4c8a80ebf68dd0bd2f6d79012ba.jpg](https://i.imgur.com/fierUV2.webp)  
图3-5-14保存文件目录  

在 TouchDesigner 中新建一个 Container COMP，并将其命名为'container_notch'，如图 3-5-15，我们将在这个容器中实现TouchDesigner与 Notch 的通讯，以及交互控制界面的搭建。  

![images/f98b3dfae4325b3af1870064fbed94e21e1c2b91e12b723c84be009840846304.jpg](https://i.imgur.com/Z4IXEaG.webp)  
图3-5-15新建 Container COMP  

进入/projectl/container_notch 层级，新建 NotchTOP 并将其命名为'Notch_to_TD'，如图 3-5-16,在参数面板的Block（模块）选项，选择上一步编译模块文件保存路径中由 Notch导出的Notch to TD.dfxdll 文件。  

![images/05982351d86dd96adcdb20631d4f762b2bd29998c5844796bee7785bc4f995c3.jpg](https://i.imgur.com/5lVYF1v.webp)  
图 3-5-16 Notch TOP  

##### Notch TOP

Block（模块文件）：加载 Notch VFX输出的 Block 文件。Layer(图层效果）：选择 Notch 中对应图层的效果。  
Play Mode（环境光贴图）：与 Movie File In TOP 类似，可以控制是走时间线还是连续的形式。  
Purge GPU mem (清理 GPU 内存）：清理 Notch TOP 占用的GPU内存。  

在 Notch TOP 的 Physics 页，如图 3-5-17,可以看到从 Notch 软件中开放出的四组参数，分别是上文提到的：Hue、Position Y、Rotation Bank、Rotation Pitch。  

![images/7bd906092e89f0a74e76263cebf386e4c14d760d1434cff8eb6887b4ddc08576.jpg](https://i.imgur.com/EHOOvTA.webp)  
图 3-5-17Notch 开放给TouchDesigner 的参数  

接下来，为每个参数制作控制滑条，如图 $3\cdot5\cdot18\circ$ 新建一个Slider CHOP，并将其命名为'Hue'，在后面连接 Rename CHOP'renamel'，将 Rename 参数面板的To重命名为Hue，完成通道的重命名。连接一个MathCHOP'math1'用于对数据范围进行映射，最后连接一个Null CHOP'null1'，完成 Hue 参数的控制滑条制作。  

![images/5cec7b33dcc6e1256d086d2ebd1066604c68c1b741c49c328235042ca2db2ce5.jpg](https://i.imgur.com/4r6k1mc.webp)  
图 3-5-18Hue 参数控制滑条制作  

重复以上步骤，分别为 Rotaion Y, Rotation Bank,Rotation Pitch 创建控制滑条，如图 3-5-19。  

其中，Math CHOP 的 To Range 映射值根据每个参数的效果需求进行更改。在此案例中，Hue 的取值范围为(0,1)，Position Y的取值范围为（-10,10)，RotationBank 的取值范围为（-80,50)，Rotation Pitch 的取值范围为（-35,50）；因此，将它们各自对应的Math CHOP参数面板 Range 页的 To Range 改为对应值。最后，分别激活 4个 Null CHOP，拖动到'notch1′中 Physics 页的对应参数进行映射，即可完成TouchDesigner 的控制端界面的搭建。  

![images/d0a52a472e6ff5dd531ddf5581fd3a8c57878f9c91c5afdf2b5b229cd061786a.jpg](https://i.imgur.com/74flIp2.webp)  
图 3-5-19为 4个参数制作控制滑条  

这样，就实现了 TouchDesigner 与Notch 的通讯。如图 3-5-20，在 TouchDesigner 中开启预览演示，拖动滑条就可以控制 Notch 中盒子运动、小球颜色等状态。  

![images/7a42b9e5c31b0b46b66c90e55d0f928b88c4029827b22d571df829deb2a5e669.jpg](https://i.imgur.com/6nOoYka.webp)  

![images/2e0d1ddc50351a7a9487c9cf5746a7dd77bc29f120779a13cad1b2ec2526a613.jpg](https://i.imgur.com/mR0dHZf.webp)  
图 3-5-20最终效果预览  

通过这个小案例，我们可以看到TouchDesigner强大的软件交互功能。它就像一个神经中枢，可以控制所有不同软件的联动，集各软件之所长，使它们在不同的领域内发挥出最大的能力。  

TouchDesigner与Notch的通讯功能常应用于大型舞台演出的实时视觉艺术以及交互艺术展览展示之中，通过上文介绍的方式和流程，将Notch超凡的高精度实时渲染视觉效果集成在TouchDesigner的总控交互系统里，可以很好地完成精致的视觉表现且大体量的交互艺术作品和项目。  

## 3.6 Stable Diffusion 与 TouchDesigner

借助深度学习技术，计算机能模拟多种艺术创作风格，这使得我们能够拓展创意边界，获得全新的创作工具。随着数字媒体与虚拟现实的崛起，AI绘图成为艺术设计领域的重要趋势，是作品创作过程中的重要增色工具。紧跟行业发展潮流，本节将介绍如何在 TouchDesigner 中充分利用 Al 绘图工具 Stable Diffusion，更深入地融合艺术与技术,为作品赋予新的思维与可能性，创造引领未来的数字艺术体验。  

##### Stable Diffusion 简介

Stable Diffusion 是目前常用的 Al 绘图平台之一，扩散技术和 Al 绘图技术为其生成高质量图像提供了关键支持。  

##### AI 绘图技术

AI（人工智能）是计算机科学领域的一种技术，旨在使计算机系统模仿人类智能的能力，包括学习、推理、问题解决和感知的能力。AI系统通过使用大量数据和复杂的算法来自动执行各种任务，以实现更智能的决策和行为。  

AI绘图是一种使用计算机和人工智能来创造图像的方法。它就像是让计算机成为一位虚拟的画家或设计师，可以帮助我们制作图画、插图，或者编辑照片。这种技术学习了很多艺术作品，可以按照这些作品的风格和技巧来创建新的艺术作品，或者对现有的艺术作品进行改造。  

截止到 2023 年 10 月，常用 Al 绘图平台包括 Midjourney、Stable Diffusion、NovelAl 和 DALL·E3。这些平台各有特点和优势，且更新迭代速度较快。用户可以根据自己的需求和喜好进行选择。  

##### StableDiffusion的原理及功能

Stable Diffusion（下文简称 SD）是Stability Al 公司于2022 年8月发布的一款基于扩散技术的深度学习模型，通常也被称为 Al 绘图工具。它能够根据提供的 prompt（提示词）和图片，以惊人的速度创作出绘画作品，即大家常说的“文生图”和“图生图”。这些绘画作品不仅具备高质量，还可以根据需求进行风格和效果的灵活控制，甚至可以微调绘画的细节。它的工作原理类似于模拟扩散过程，将最初的噪声图像逐渐转化成所期望的目标图像，就像在画布上不断添加更多颜色，直至达到完美效果。  

##### TIPS  

在 SD 中，prompt（提示词）是用于指导模型生成图像的文本输入。它可以包含主体、风格、色彩、质量要求等。例如，正向提示词“masterpiece,best quality, extremelydetailed face, perfectlighting”表示希望生成的图像是“一幅杰作,具有极佳的画质，细节非常丰富，光线完美”。  

##### 建立TouchDesigner与 Stable Diffusion的通讯

SD作为AI绘图工具，目前主要有“文生图”和“图生图”两种图片生成模式。以后者为例，通常是将计算机中的一张图片传输给 SD，并提供相应的提示词，以成功启动该模式。如果只使用本地的图片，可能会有些乏味。TouchDesigner 具有强大的实时互动和编程功能，同时可以方便地连接各种外设。因此，我们可以通过建立TouchDesigner与SD的通讯，扩展Al 绘图这一工具的趣味性和应用场景。  

本书不仅提供用于建立 TouchDesigner 与 SD 通讯的 SD_TD API，还开发了一款SD启动器，使SD的安装更加便捷。  

提示词可根据个人需求来自由选择和搭配。  

为了在TouchDesigner 中使用 SD生成图像的功能，我们需要以API 的方式调用stable-diffusion-WebUI 插件。SD_TDAPI.tox 是由 Lyell 制作的 TouchDesigner 插件,如图 3-6-01，它为我们提供了利用API 来控制 stable-diffusion-WebUl 的途径。  

##### TIPS  

SD_TD API.tox已获得原作者 Lyell的授权,仅供购买书籍的用户学习和交流使用。根据不同的 TD 版本，选择对应的插件。  

![images/ee963d8a19257e9380d9decd1131c6ee7ca40b7277a6aca4c625b9aa915c6dfe.jpg](https://i.imgur.com/NXibqLX.webp)  
图 3-6-01 修改参数  

![images/8d94ccd050c9944c9d0c32a60877b2488f0385022d1b1fca10bea6fcbe2edead.jpg](https://i.imgur.com/utFe8GO.webp)  

SD_API_2022.toX  

![images/8fe1e036065f76f80da406dccaf687bc0c9123e2605e00260bb5e79ae8d17d4f.jpg](https://i.imgur.com/J0AOGjJ.webp)  

##### StableDiffusion启动器安装

为了使SD的安装和部署更加便捷，我们开发了一款SD启动器，如图3-6-02。运行这个启动器时，它将自动部署SD程序及其所需的系统环境。此外，该启动器还内置了由AUTOMATIC1111在github上分享的stable-diffsion-WebUl插件，这个插件允许我们通过本地网页界面来管理SD，同时承担着本节实战案例中建立SD与TouchDesigner通讯的接口任务。  

##### TIPS  

![images/0999f670392b327b75e999b57c3d92190db99fb81024408dbb555c7622d4b41b.jpg](https://i.imgur.com/CyU1Lg9.webp)  
图3-6-02修改参数  

扫描下方二维码,获取本书提供的 SD启动器及SD_TD API.tox的下载链接。  

首先，打开提供的 SD 启动器文件夹，如图 3-6-03，进入其中的 sdQuickStart 文件夹，双击运行SDWebLauncher.exe应用程序。  

SD启动器目前仅支持Windows10、11系统的用户使用。  

![images/d334c856f1e4ed97129bf6463724d83a35e9c3987cf9806d690e4e3dd90d1ba5.jpg](https://i.imgur.com/979DJTL.webp)  
图3-6-03运行SDWebLauncher.exe应用程序  

如图3-6-04，在弹出的启动器界面中，点击“开始”按钮。此时将会启动命令提示符窗口，如图3-6-05。首次启动时间可能相对较长，大概需要等待1\~5分钟。后续即可迅速启动。使用期间，命令提示符窗口需保持运行，不能关闭。  

##### TIPS  

本书提供的所有文件及程序仅用于学习交流;未经授权，禁止将其用于商业用途。  

违者将面临法律诉讼，并导致严重的财务和法律后果。  

![images/3fb2990122fa5a2be54af26070a31ca2ff5659e936be919d637be5b4b8794bdf.jpg](https://i.imgur.com/hlyIxn1.webp)  
图3-6-04启动器界面  

![images/10a1250a00dc331e0a2f9548328477f6a343e23149acb287a81a7070f5cc8860.jpg](https://i.imgur.com/6DyHK49.webp)  
图 3-6-05命令提示符窗口  

稍候片刻，当 SD 配置安装并启动成功后，如图 3-6-06 所示，将会自动弹出 WebUI 控制窗口。不要关闭命令提示符窗口及 WebUI 控制窗口，用于下文实战案例与 TouchDesigner 建立通讯。  

![images/3b6c1251b900554adc2d9bf1b71c40449a242d2d50483b48b818c172c506c95c.jpg](https://i.imgur.com/puCGFZJ.webp)  
图 3-6-06webui控制窗口  

### 实战案例：瞬息宇宙—-用 Stable Diffusion 进行实时风格化处理  

本案例以SD 的“图生图”功能为例，演示如何将摄像头捕捉的人像实时传送给 SD，通过 SD_TD API插件设置参数，控制 SD 对图像进行风格化处理。从而利用 TouchDesigner 的实时互动功能，拓宽 SD 的使用场景。  

![images/c8f7b96355b7cee652ac8b5b8fa08ac59037d07e03912bf40974a826dd079dce.jpg](https://i.imgur.com/4BHOMPg.webp)  
图 3-6-07  TouchDesigner 最终工程预览  

##### 搭建当前帧处理框架

>在 TouchDesigner 编辑区新建Video Device In TOP'videodevinl'，用于调用本机摄像头。接着，如图 3-6-08 所示，新建并连接Cache TOP'cachel'，在其参数面板点击Pre-Fill参数的Pulse按钮，缓存当前帧。  

![images/9ae5ced1d7730ebc507ee727b1fd8e397c282600e40ffcccd957b1ac4beb3f53.jpg](https://i.imgur.com/NOMeRm8.webp)  
图3-6-08缓存当前帧  

将SD_APl.tox插件拖入编辑区空白处中，将'cache1'连接至'SD_API插件的第一个输入口。接着，新建 Null TOP'null1'，将'SD_API'第一个输出口连接至'null1',如图 3-6-09。  

![images/d3e008449fad3df0f50a73e5de706bd68fcf18b4dd70e6f16f88c9facaf4a049.jpg](https://i.imgur.com/4QSl1J4.webp)  
图3-6-09连接 SD_API 插件  

打开'SD_APl'参数面板的Al111页，Automaticll1Connection参数显示为on，则插件已成功与刚刚启动的webui相连，如图3-6-10。  

##### Cache TOP

![images/88533281f3d98effae9baa474b834027c7d8171d513df2186b0969f1ad883b40.jpg](https://i.imgur.com/GWpJU5r.webp)  
图3-6-10检查 Automatic111 Connection 参数  

Active（激活）：此选项打开时，Cache TOP会将图像捕获到其内存中。  
Get One Image On Startup（启动后获取一张图像）：选中此选项将在启动后加载初始的图像。  
Replace Single（ 替 换 单帧）：用输入图像替换“替换索引”选项中的图像。  
Replace Index（替 换索引）：定义索引的数值。  
PreFill（预存）：根据“缓存大小”对 Chache TOP 进行图像填充。  
CacheSize（缓存大小）：决定Cache TOP可以缓存图像的数量。  
Step Size（步长)：在捕捉图像前的记录次数，当步长为n时，将在每n次缓存图像。  
Reset（重置）：清空存储图像的缓存,释放CacheTOP占用的内存。  

##### 设置 AI绘图的参数

在'SD_API'参数面板的 Settingl 页,如图 3-6-11 所 示，将 Stable DiffusionMode（绘图模式）改为 Image to Image（图生图模式）；接着，打开DisplayLast（显示最新生成完的图像）选项，并输入 Prompt（正向提示词）与 NegativePrompt（逆向提示词）；最后，将Denoisingstrength(噪声强度)改为 0.52,将 CFG Scale（提示词引引导系数）设置为10，Sampler（采样方式）设置为DPM++2MSDE方式。  

##### TIPS  

Prompt: award winning photo of a male, wearing cyberpunk intricate streetwear, digital painting, concept art, smooth, sharp focus, rule of thirds, dark fantasy,intricate details,  

Negative Prompt: deformed, blurry, bad anatomy, disfigured, extra limb, ugly, poorly drawn hands, missing limb, blurry, floating limbs, (mutated hands and fingers), ((anthro)), ((animal)), crown, flowers, caNDIe, fire, flame, hat, horse, riding, umbrella, snow, zipper,  

![images/9045e236996ade30ea5a39b0095d79b593f2fae384ba88a778af4350b9e32b91.jpg](https://i.imgur.com/2Fc1oQn.webp)  
图 3-6-11参数设置  

##### TIPS  

Denoisingstrength 控制原图上添加噪点的程度，即控制 Al 对输入图像的参考程度。因为 Image to Image 的基本生成原理是，先在图片中添加噪点，再进行扩散绘图；因此，噪点强度越高，AI创作空间就越大，出图也就与输入图像越不同。  

CFG Scale 控制 Prompt（提示词）对生成图像的影响程度，即该参数越大，生成的图像与文本提示的相关性越高，但可能会失真；该参数越小，提示词与生成图像的相关性越小，AI发挥空间越大。一般设置范围在4\~15。  

Sampler(采样方式）可以设置不同的采样器。采样器决定了如何进行随机采样，如下图所示，不同的采样器会对结果产生不同影响；通过重复进行随机采样和去噪，最终生成完整图片。  

![images/5cda57c756f94c0754b23da093b90efc52d2efadd009cbf3ec1fcf33299bce6d.jpg](https://i.imgur.com/ak9P9Q5.webp)  
图片来源: https://stable-diffusion-art.com/samplers/#What_is_Sampling。  

参数修改完毕后，如图3-6-12所示，我们点击Generate（生成图像）按钮；观察命令提示符窗口，如图3-6-13所示，可以看到SD正在进行图像处理。  

![images/e4ace023a5cf56143667f901c097dc4244633e32405d314f92c1e9d0aafe12f6.jpg](https://i.imgur.com/YobYYBY.webp)  
图 3-6-12点击 Generate 生成图像  

![images/64b435e7b9f8190def562a48ec3e45f53aed30a3270fddc0a5b53647985adeba.jpg](https://i.imgur.com/S3byJaC.webp)  
图3-6-13 图像生成中  

稍候片刻，如图3-6-14所示，即可看到'null1'显示了SD根据我们设置的参数及提示词，对摄像头输入画面尽心的风格化处理。至此，我们就成功通过SD_TDAPI.tox控制Stable-diffsion-webui生成图像。  

![images/a521d9151a9b5e12abd11d622702f5c40577e010c08615fa579969b85178f5b3.jpg](https://i.imgur.com/FEGwCs0.webp)  
图3-6-14成功生成图像  

##### 更多学习资源：TouchDesigner 与 Al 绘画

由 TouchDesigner 官方中文社区一TEA Community 开发的《TouchDesigner 与 Al 绘画》课程版块，在本章节的教学基础上，更加深入创意艺术与交互设计相结合的实践过程。课程将介绍如何结合TouchDesigner的交互设计技术和 Stable Diffusion 极大的操作自由度进行创意艺术创作。学员可以利用Al绘画功能在TouchDesigner上创作出令人惊叹的视觉艺术作品，获得前沿的创作体验。  

## 3.7 Projection Mapping 三维投影

本节介绍用投影仪将视觉画面投影到立体面的方法，即我们常说的 Projection Mapping、光雕艺术，或三维投影技术。通过 Projection Mapping 光雕投影，将虚拟世界中的三维影像在现实世界中利用真实模型进行重现。  

##### 投影仪：成像原理及三大要素

目前，市面上大部分投影仪的工作原理都是将输入信号转换成光信号，然后通过一个非常强的光源产生一束光线；通过一个彩色轮，这束光线被分为红、绿、蓝三种颜色；之后通过透镜系统将这些光线聚焦成一个小点，并将这个小点的光线投射到屏幕上，形成图像，如图3-7-02。  

![images/769d38ac8fd17580e02f267db12af52e64a50df6e22c9c155bae4e10ce0ceaa0.jpg](https://i.imgur.com/4ppF5rv.webp)  
图 3-7-01爱普生投影仪  

![images/23e5861201bdfdbc402c112dfe831773611a70075e41c3b14f8d548fa07a3417.jpg](https://i.imgur.com/SPocDAR.jpeg)  
图 3-7-023LCD 成像原理  

了解投影仪的成像原理后，如何选择一款适合做 Projection Mapping 的投影仪呢？此时，要考虑投影仪的三大要素：投影流明度、透射比和分辨率。  

##### 投影流明度

投影流明度指投影机输出的光线强度。投影空间越亮，对投影机的光亮影响就越大，因此需要更高的投影流明度。此外，投影机距离被投射物体越远，画面就会越大，但物体表面的成像亮度也会降低。  

##### TIPS  

通常只有在全黑的环境中，且所需投射的物体面积不大时，才适合使用流明度在2000到4000之间的投影仪。如果需要在室外或明亮的环境下投射大面积的画面，如建筑投影项目，则需要使用上万流明的工程级投影仪。  

![images/c977ba94f5e8e787d5545a6dcf01b630606679df78653171856798335887f9d6.jpg](https://i.imgur.com/cCLy38i.jpeg)  
图 3-7-03投影流明度对比  

##### 投射比

投射比指投影仪投射出来的图像宽度与投影仪到投影屏幕之间距离的比值，通常表示为：投射比 $=$ 投影宽度／投影距离。例如，如果投影仪将一个100英寸宽的图像投射到离屏幕10米远的距离，那么它的投影比就是 $100/10{=}10.$ ，投射比越大，投影距离就越近，图像就越小，反之亦然。因此，面对不同的安装环境，我们需要选择适合的投射比的投影仪。  

##### TIPS  

一般来讲，普通投影仪的投射比在1.5到1.9 之间。当透射比小于1时，我们通常称之为短焦镜头；当投射比小于0.6时，我们通常称之为超短焦镜头。  

![images/d465cf0d4609854ca4b26655cc97b8eb10cc35fbf90ab3c7959f0aea8e3234bb.jpg](https://i.imgur.com/VsjYKzc.jpeg)  
图3-7-04投射比  

##### 分辨率

投影仪的分辨率指投影仪能够显示的像素数量，通常以水平像素数和垂直像素数来表示。分辨率的大小会影响投影画面的清晰度和细节程度。具体来说，分辨率越高，投影出来的图像就越清晰、细节越丰富。此外，投影仪的分辨率也会影响到投影画面的大小。如果投影仪的分辨率不够高，当我们将画面放大时，画面上的像素点就会变得更加明显，导致画面模糊或失真，如图3-7-05。  

![images/010227be6af26dac6b418712ae68fca53b2d766e84e18663778caed7102c4c5f.jpg](https://i.imgur.com/dewA3uD.jpeg)  
图3-7-05分辨率  

## 实战案例: Projection Mapping 中的 kantanMapper 与 camSchnappr  

目前有很多 Projection Mapping 的软件，其技术原理基本相同。下面我们将介绍行业内最主流的两种 Projection Mapping 方法一kantanMapper (平面三维映射法)和 camSchnappr (立体三维映射法)。在TouchDesigner 中，也预置了相关插件，下面我们将用它们制作光雕投影小案例。为了方便大家进行测试和使用，我们选取正方体石膏进行组合拼接。大家可以很方便地购买这些材料并完成制作。  

![images/8e5079471fbb106a0b37717ecef30166ecada36a1e69ba8cd07fa85b75be8e4f.jpg](https://i.imgur.com/GgEIyWB.jpeg)  
图 3-7-06在编辑区的最终流程预览  

>新建ContainerCOMP 并将其命名为'container_mapping'，如图3-7-07。在这个元件中，我们将采用两种方式—kantanMapper（平面三维映射法)和 camSchnappr(立体三维映射法)，将平面图像投影至立体面。  

##### TIPS  

本案例中，你需要一台投影仪,将画面投影到实际物体上。  

![images/f30dfa162c2dc8c7491f2c928a83bd1c6cd6a8aa6987f2c841049de59f18e82f.jpg](https://i.imgur.com/I2ZbRVE.jpeg)  
图3-7-07新建Container COMP  

顾名思义，kantanMapper 就是简单快速重建三维投影的方法。简单来说，就是将一张贴图裁切成多个形状不同的部分，然后将这些部分通过投影机投射到真实的模型上，如图 3-7-08。  

![images/0406c852b324a104a11467ddc0abbd40aeda4ba3578439f01065b6468d69eb94.jpg](https://i.imgur.com/15WtGcr.jpeg)  
图 3-7-08kantanMapper 的效果  

进入'container_mapping'元件，新建 Container COMP 并将其命名为'container_ kantanMapper'，如图 3-7-09，设置分辨率 与边框参数。  

![images/70ec703679937bc06ffc88bd21ce48b3c9908ab3653014038a54cfe51089faa5.jpg](https://i.imgur.com/mqpRFmK.jpeg)  
图3-7-09新建 Container COMP  

进入'container_kantanMapper' 元 件，从TouchDesigner 左侧插件区域选择 Mapping下的'kantanMapper’，拖动到 编辑区中，如图3-7-10。  

![images/7107ba0d2437243a31643f4b153997bad3cfa78f6e5c7d26eb51d9c12125b93b.jpg](https://i.imgur.com/nHfK7BB.jpeg)  
图 3-7-10将 kantanMapper 拖动到编辑区中  

接下来，我们要了解‘kantanMapper'的操作与显示界面。在'kantanMapper的Kantan参数页面，点击OpenKantanWindow对应的Pulse按钮，即可打开操作界面，如图3-7-11。  

![images/ab0393eb02e50428e5ac3d7c074346174f6f5922c24b66fccc2210b1a2ce9cb0.jpg](https://i.imgur.com/l6eMHZ6.jpeg)  
图3-7-11打开OpenKantanWindow操作界面  

如图3-7-12，在界面左上角的项目设置区域，将Resolution设置为外接投影仪的分辨率（我们使用的是 $1920^{\star}1080$ 的高清投影仪)，点击WindowOptions唤出投影窗口设置页面。  

##### TIPS  

如果投影仪是720P的，可以输入1280和720作为显示分辨率。  

![images/b835f13d54529ddad134772aea84e711b317f860075f008ffe4f23ad5d2ccfc5.jpg](https://i.imgur.com/mmLVMO1.jpeg)  
图 3-7-12唤出投影窗口设置页面  

如图 3-7-13，在这个设置页面中，通过调整 Monitor参数的数值，我们可以选择用特定的投影仪或显示器来输出最终画面。例如，案例中的计算机除了一个自带的显示屏（对应Monitor 参数O），还有一台外界投影仪（对应Monitor 参数 1），我们希望通过投影仪来输出画面，因此，这里Monitor参数设置为1。  

![images/e69320096f515f84997efa25154732d6eb16320e1585b384c06f01d899e4e240.jpg](https://i.imgur.com/d6AmgMH.jpeg)  
图 3-7-13选择投影仪  

设置完成后，可以点击操作界面左上角的ToggleOutput，检查输出区域是否在指定的投影仪上。若设置成功，如图 3-7-14 左，我们将操作界面的鼠标用黄色虚线标出位置，可以明显看出右边指定投影仪或显示器相应区域会出现定位坐标。否则，需要修改 Monitor 参数的数值,找到正确的输出设备（图左侧的黄色虚线在实际操作过程中并不会出现)。  

![images/338dbb6498b6911b6123172961bd9a6576f4acfd234f81bdf65536988dbae748.jpg](https://i.imgur.com/Gxl4Z8I.jpeg)  
图 3-7-14操作界面与投影仪输出画面  

将文件夹中的投影贴图拖动到 /projectl/container_mapping/container_kantanMapper 层 级，并 连接 NullTOP'null1'备用，如图 3-7-17。  

![images/67b1a0f5db87c7b9591d3e6c8de869ea3cf5368a39082357cffb72c01ebc4246.jpg](https://i.imgur.com/srHeCRc.jpeg)  
图 3-7-17连接 Null TOP  

在 kantanMapper 操作界面左侧的工具栏选择矩形CreateQuad，并在红色线框区域拖拽鼠标，生成一个矩形投影面，如图3-7-18。  

![images/d02927631d2ac56e79e79f3923f94b753c12477d015c2bf5da505df8ce457f34.jpg](https://i.imgur.com/Dzkxxid.jpeg)  
图 3-7-18创建投影范围  

接下来，我们要导入一个贴图，并将贴图进行切割,继而投影到这个石膏模型上（你可以下载本章节工程文件获取贴图，下载链接参见第 41 页)。如图 3-7-15、图 3-7-16，以下是案例中使用的投影贴图和实际模型。  

将编辑区的'null1'拖动到这一投影面的Texture选项上，并单击其右侧的“”以显示材质（点击后，即为绿色对号)。利用这个投影面，可以将字母'A'投影到一个立方体面上，在Name 中将其命名为'A'以方便管理，如图 3-7-14。  

![images/33e8992a52dca72da7a48228072aadd1d493b28e497dc951d6494fa9f3fc9cbd.jpg](https://i.imgur.com/Xg1QaTR.jpeg)  
图 3-7-15投影贴图  

![images/6bd9a6a2531d2cab9394383f9eb52b13d925d593a5d7f84bb4d7c8811bc0b2b5.jpg](https://i.imgur.com/W4YHjnR.jpeg)  
图 3-7-16实际模型  

![images/f15533df214f7c8aefd64b3fc10ee141b2560adfe486b496edc15bde20f8317f.jpg](https://i.imgur.com/hkK8lPB.jpeg)  
图3-7-19导入材质  

此时，能看到投影仪将画面投射在了石膏模型上，如图3-7-20。由于我们还未做分割矫正，因此看到的是一张凌乱的图。下面开始做分割校正，原理逻辑如图3-7-21。  

![images/34d9fb036905eecf2b475174c58986dd00909749a88ea3d3d07d8adc97de0920.jpg](https://i.imgur.com/jHGNX6M.jpeg)  
图 3-7-20实际投影画面  

![images/6883ae12fa339f23033575b4a7200cb381294c4e2a94827d9de552bcaf9b0621.jpg](https://i.imgur.com/CKpA9wf.jpeg)  
图3-7-21分割校正的原理逻辑图  

选取贴图中要投影的区域，即从图像中截出字母“A”区域。如图3-7-22，点击EditTexture进入材质编辑界面。在材质编辑界面的左侧工具栏中选择白色箭头Transform功能，如图3-7-23。观察右侧材质贴图区域，此时蓝色控制柄变为粉色和黄色。  

![images/082c23d14add95924153e90f6d0d9060190d6c0266bd821a40ab676819c59b18.jpg](https://i.imgur.com/MuXs0Ar.jpeg)  
图3-7-22点击进入材质编辑区  

![images/91a0e382c6a626c48f9605addee8aa1a0baef9090f74419a2ad54a78114e520d.jpg](https://i.imgur.com/cjCbURB.jpeg)  
图3-7-23选取 Transform 功能  

粉色控制柄用于缩放，黄色控制柄用于选择，鼠标拖拽材质框内空白区域（不是黄色和粉色点的区域即可）可以整体平移材质框。借助这些方法可以将材质字母“A”选取出来，如图3-7-24，按键盘EsC退出材质编辑。此时，投影仪投出来的画面只保留了字母“A”，如图3-7-25。  

![images/9d17aefd2a154cb5d99615bb575113c88829feb539c8b04ec641f57701a926f9.jpg](https://i.imgur.com/TkzyPUY.jpeg)  
图 3-7-24编辑材质  

![images/80414c9775b7c81dfb43b8d57a82fd1b9bf1530c8ca2b4135f30d633b6aee2da.jpg](https://i.imgur.com/s7TKtMi.jpeg)  
图3-7-25投影出的画面  

回到'kantanMapper'的操作界面中，如图3-7-26，一边观察石膏模型上的投影，一边拖动蓝色控制柄，使四个控制柄与石膏模型一个面的四角相对应，这时图像恰好能映射在石膏模型的这个面上。这样，我们就完成了其中一个面的 Mapping工作，如图3-7-27。  

##### TIPS  

此处也可以直接将Transform 中 Scale参数调整为(0.25,0.25)。  

![images/88c07aea30eec4bf5427c9112070c2114be60321560c90649f29ce933198fe09.jpg](https://i.imgur.com/0KQo6nh.jpeg)  
图3-7-26调整位置  

![images/269eed3631d20add535daab3cfa17f35e31ee8ac1a266264456c92887ac63b8b.jpg](https://i.imgur.com/HC337qP.jpeg)  
图 3-7-27实际投影效果  

将其他8个字母映射到立方体的剩余8个面，并进行投影矫正，如图3-7-28。  

![images/93c80eaddcfcb8edc281b38470c3aa459f3bbc8c6b346efd6adbc21a7fa10ad6.jpg](https://i.imgur.com/DfBDa2W.jpeg)  
图 3-7-28对剩余面进行投影矫正  

映射完成后，可以根据情况，在'null1'前添加 Level TOP"levell'，调整 Brightness 1等参数，以提高或降低图像亮度，如图 3-7-29。现实中投影面整体亮度调整前后的效果对比,如图 3-7-30。  

##### TIPS  

此处请注意：不同于 Adobe Photoshop等图像编辑软件，在kantanMapper 的图层列表中，位置顶层的图层在实际投影中位于底层。  

![images/cc877f6a136e10f10b3397fde16829e694b1d0bbc90d9fc1b27fb021abfe2776.jpg](https://i.imgur.com/0DQKld1.jpeg)  

![images/4f0e443c332b078ad6707afb9ff832e231ac9d63fb664682338e0e90b3206a26.jpg](https://i.imgur.com/nCRHsUu.jpeg)  
图 3-7-29添加 Level TOP 以提高亮度  

![images/e40c9f69f889dd01fae0bcadf8faa631c8a029e8d6776bc2e50f4a3659994578.jpg](https://i.imgur.com/FCZiKin.jpeg)  
图 3-7-30亮度前后对比  

我们也可以给图像添加简单的动效。在 /projectl/container_mapping/container_kantanMapper 层级新建Ramp TOP'rampl'，如图 3-7-31，通过在颜色块上添加关键点,来制作一个简单的渐变纹理。其中，Type 参数选择为Vertical（垂直）；Phase 参数通过表达式absTime.seconds与时间相关联，使相位随绝对时间变化。  

##### TIPS  

请注意'rampl′与'Kantan_ Mapper_frame"接入'comp2'后图层的前后顺序。  

![images/7e1dbc28c00da5ea3a9c81c7beff791dd995bdca8a805eb7b1bafcb6b6927335.jpg](https://i.imgur.com/qyFcHhx.jpeg)  
图3-7-31新建 Ramp TOP  

之后，新建Composite TOP'compl'，将'rampl′与'Kantan_Mapper_frame′连入'compl'，使用默认叠加方式Multiply（相乘）；再连接“level，用于调整投影物体上的扫描效果，如图3-7-32。  

![images/6aa52bdd470a2cf91c03a725a40151f5bcb60ee30e66584df9492383b6915ccd.jpg](https://i.imgur.com/91X20xN.jpeg)  
图3-7-32新建 Composite TOP  

在这个kantanMapper的案例中，投影的画面是通过切割材质图像形成的，所以在材质图像上添加扫描动态时，其效果无法同步；它不能把投影物体当作一个整体自上而下扫过，而是每个块面单独扫过，如图3-7-33。如果我们想呈现整体的三维视觉效果，就要用到'camSchnappr插件。  

![images/0fc99062e14ce678d89dfd8399a3c1290b4de96d644e68bd2050307cad5bf899.jpg](https://i.imgur.com/E6mEtPo.jpeg)  
图 3-7-33实际投影效果  

##### camSchnappr (立体三维映射法)

camSchnappr 是基于三维立体模型实现映射的一种方法。相较于 kantanMapper,camSchnappr 不再需要对模型的每个面分别划分投影内容。  

我们回到 /project1l/container_mapping层级，新建一个 Container COMP，并将其重命名为'container_camSchnappr'，随后对参数进行调整，如图3-7-34。  

![images/721ec338f307f2ada92dbc2b127e2fa9dfa7738f54727a2be434fc7e9281e94c.jpg](https://i.imgur.com/qK58zs4.jpeg)  
图 3-7-34  新建'container_camSchnappr' 容器  

在 camSchnappr 案例中，我们使用的投影模型如图 3-7-35 所示。参照这个实体，我们需要提前在 3D 建模软件（如C4D）中建立一个等比模型，将模型导出为 OBJ格式的文件，同时导出一张UV 贴图，如图 3-7-36、图3-7-37。案例中使用的 OBJ 模型可以在示例 toe 文件夹 /asset/geo 中找到，UV 贴图可以在示例 toe 文件夹 /asset/img 中找到，建议先将其存放到自己的工程文件夹的相应位置。  

![images/16aa841ce2c2e634b3212d6714218a1f7baa782e6d9c43ee2811fe50ebb7d0c4.jpg](https://i.imgur.com/bGQjN5C.jpeg)  
图3-7-35投影模型  

![images/6e970987dc9269c810b55ad86c40b6d2bc61d9a01d10ed3875e10c0e68e3a42c.jpg](https://i.imgur.com/3h0YUJ1.jpeg)  
图 3-7-36模型对应的 UV  

![images/b50486f4569105ea66e966918ba6b9f17bc09eb9de7fd4bae46d10967242241d.jpg](https://i.imgur.com/4spWFIB.jpeg)  
图3-7-37UV 展开贴图  

将准备好的 OBJ文件直接拖动到 /projectl/container_mapping/container_camSchnappr 层级，可以看到，在编辑界面中自动生成了一个 File In SOP'UV_Map',如图 3-7-38。  

![images/c4d6decac908aa10c0b039b9b378520c2845568fc8763b6814abe18a3db430be.jpg](https://i.imgur.com/nB1L74c.jpeg)  
图3-7-38拖入OBJ文件  
  

在开始下一步操作前，我们先了解一下 camSchnappr的原理，如图 3-7-39。  

![images/ac8422feda5a6935a37c524ac7a269bdfca0838b855548c418f1a5928e22af46.jpg](https://i.imgur.com/jpZO0xe.jpeg)  
图 3-7-39 camSchnappr 的原理  

回到 /projectl/container_mapping/container_camSchnappr 层级，在'UV_map'后添加 Null SOP'null1。在插件区中，选择我们要使用的第二个投影 mapping 组件'camSchnappr'，将其拖动到编辑区上。在'camSchnappr' 参数面板的camSchnappr 参数页面将 Geo SOP 设置为'null1’，并点击 Open Main Window 的 Pulse 按钮，打开主窗口，如图3-7-40。  

![images/de35036984a66ac1da93d354daaaef47982f55ea871d8c36008fbfe598f1f8d0.jpg](https://i.imgur.com/UEuVNFs.jpeg)  
图3-7-40设置投影模型参数  

如图3-7-41，我们已唤出 camSchnappr 的操作页面。在操作页面中，按住Ctrl键（Mac、Win均为Ctrl 键，非Command 键）配合鼠标进行位移(Ctrl+鼠标右键)、旋转(Ctrl+鼠标左键)、缩放(Ctrl+鼠标中键)，按H键可让视图回到中心位置。  

![images/06fe6da26d49435578850e83fe4ffda5afb585efe53d811fa50501639b91e47b.jpg](https://i.imgur.com/kZbCqvA.jpeg)  
图 3-7-41唤出 camSchnappr 的操作页面  

单击模型上任意一处，可以添加校准点；鼠标右键点击可取消校准点。这里我们选择了16个顶点作为校准点，如图3-7-42。关闭操作界面，在'camSchnappr 参数页面将 Output Monitor 设置为 1(或其他与输出投影仪／屏幕对应的数值)，点击 Open Output 后的 Pulse 按钮，在投影仪上唤出'camSchnappr 的校准页面，如图 3-7-43。  

![images/ed4c399ff867085b8c752b272b647853dba3c057a3b0aa921609ca7e0a25af34.jpg](https://i.imgur.com/d8d4Jd9.jpeg)  
图 3-7-42设定校准点  

![images/58bb28da19d395e45b8508a79a4ed67f6491af087187957ffa2c8ac9a8c338fe.jpg](https://i.imgur.com/aEYw6eO.jpeg)  
图 3-7-43设置投影仪  

鼠标拖动模型上的校准点，使每个点落在实体模型相对应的位置上。这样，校准过的投影就可以真实反映实体模型的 UV。校正前后的软件界面和真实空间中投影效果的对比，如图 3-7-44、图 3-7-45。  

![images/2aea0062450fc7b4e68afe28ad689021586bf588b785df8c73a5f8d7c5740838.jpg](https://i.imgur.com/lFaUgCA.jpeg)  
图3-7-44校正前(左图为软件界面看到的内容，右图为真实空间中的投影状态)  

![images/64234dd7da3b69768e76d6c57614bcf51ef4059fc142307ad3d0b60c10edda58.jpg](https://i.imgur.com/87JCPSZ.jpeg)  
图3-7-45校正后(左图为软件看到的内容，右图为真实空间中的状态)  

模型校准好后，开始为模型贴上材质图。首先将此前准备好的 UV贴图拖动到 /projectl/container_mapping/container_camSchnappr层级，根据需要使用EdgeTOP做勾边处理，这样我们就可以清楚地看到对应UV的位置了，如图 3-7-46。  

![images/bb5fad2981f0a103c6733d1a15f7ce5dc1b703437bb6570c9aa6578b66e95365.jpg](https://i.imgur.com/Lsbzvi0.jpeg)  
图3-7-46加粗UV描边  

为了使图像更便于观察，可以新建TransformTOPTransforml'用于添加白色背景，如图 3-7-47，打开CompOverBackgroundColor 选项，并将 Background Color 改为 (1,1，1，1)。最后新建并连入 NullTOP 'null2。  

![images/22de86af7d54527daa82e776e31363587bbd6cdbeb60f2d9d112066cc40d451a.jpg](https://i.imgur.com/uBq1jfk.jpeg)  
图3-7-47添加白色背景  

将'null2'拖动到'camSchnappr'上作为Color Map，或直接拖入Color Map 参数中，如图 3-7-48。  

![images/49c63757da8a7dd32f6f081c9f9821d8104e1c001708e6fbab85a75d313a3574.jpg](https://i.imgur.com/itOnEjF.jpeg)  
图3-7-48设置为颜色贴图  

为了输出有贴图的投影图像，如图 3-7-49，在元件'camSchnappr' 的 camSchnappr 参数页面将 Texture Alpha 设置为1，提高不透明度。  

![images/21a8652faf06e9743593b96b435fd56b1402ea3fee1bc9ea0221b6e7dc8855bf.jpg](https://i.imgur.com/333jVu5.jpeg)  
图 3-7-39设置不透明度参数  

点击'camSchnappr'的OpenOutput选项，就可以看到实体模型上贴有默认UV展开贴图。此时，已将UV贴图贴回真实模型上，如图3-7-40。  

![images/668f0c3195f126cb21c2d696923baad349b91c5271172a1e16d20f575ccd5624.jpg](https://i.imgur.com/HImck0h.jpeg)  
图 3-7-40投影校正的实际效果  

接下来，我们制作一个简单的动效，并进行投影。如图 3-7-41，新建并设置一个类动态的Ramp TOP'rampl°。  

![images/26caacad9764ded5e4b15d88808cbbea313c9b283c87e3e776fb07f240dc05ef.jpg](https://i.imgur.com/5j047mP.jpeg)  
图3-7-41制作投影动效  

如图 3-7-42，断开'transform1'与'null2'之间的连接,将'ramp1'连入'null2'。  

![images/f83a7b0560ed8d75a84b9fa1a266325aae2b9bccb081eec31aeaa92c6e1a3ed8.jpg](https://i.imgur.com/wQnOqoF.jpeg)  
图 3-7-42替换渐变效果  

此时，点击'camSchnappr'面板的 Open Output 选项，可以观察到实体模型上的投影变化。由于使用了camSchnappr的三维映射方式，投影图像可以在模型上发生整体的变化，而不仅仅是一个个块面上的变化。利用这种特性，我们可以制作非常多的基于真实三维图像的Projection Mapping 效果，如图 3-7-43。  

![images/8d1b897ba9803e989a6f3183f8c7792266ea5bfb7603ca1b694711d0a3bd39f2.jpg](https://i.imgur.com/Hdn3RYu.jpeg)  
图 3-7-43输出的整体三维投影效果  

![images/10205913b210aa68d32643dc825cd96f3a5311228fdd89ca6c9cd406dec6bcfd.jpg](https://i.imgur.com/R8kSCc6.jpeg)  

# 第4章 硬件与通讯  

TouchDesigner以其出色的硬件交互性能区别于其他交互软件。无论是实验室级 别 的 Arduino、Kinect、LeapMotion，还是工业应用级别的舞台灯光系统、激光雷达追踪系统、人体骨骼捕捉系统，TouchDesigner强大的数据接口都能和它们进行无缝对接。  

全面的数据转化与处理让所有的软硬件可以相互连接和通讯，使我们能创造出更具特色的人机交互作品。  

## 4.1 Arduino 与串口通讯

Arduino是一种开源的单板微控制器，其设计目的是使电子制作变得更加易于入门。它使用了简单的硬件和软件接口，使得用户可以轻松地创建控制各种电子设备的交互式项目。例如，可以使用 Arduino 控制LED 灯的颜色和亮度，以反映环境中的音乐节奏或者其他传感器读数；或者使用 Arduino 控制电机的转速和方向，以实现与观众的互动。通过 Arduino 和 TouchDesigner 的通讯，用户可以创建各种复杂新颖的交互装置、交互雕塑、音乐表演、虚拟现实和增强现实项目等。  

![images/564044d2afa809a18c20f5ef091a46ce2ef80b0ca49ccc49b3d6f57b5d34a918.jpg](https://i.imgur.com/G22pKD9.jpeg)  
图4-1-01《她生活的方方面面》(艺术家：丛浩天)  

Arduino等开源硬件平台包含各类硬件（传感器、效应器、微控制器等）、集成开发环境（ArduinoIDE等）和各类开源社区资源。  

![images/02beb22c02708747d1f51e1331564d375a60a816c2ff4ca5a2b48d59880a31a5.jpg](https://i.imgur.com/glxse6e.jpeg)  
图 4-1-03 Arduino 社区资源  

##### TIPS  

本节不详细介绍Arduino的使用原理及其硬件属性，查看更多Arduino IDE 编译环境的下载安装信息，请访问Arduino 官网:www.arduino.cc 。  

![images/287846bab8efbc59eb1f13f0c3eead3a671f316b0933eacb6cae94fd2321d995.jpg](https://i.imgur.com/dhUAbOe.jpeg)  
图 4-1-02 Arduino 硬件  

![images/98000035505c5e06dd7679f07bb667773130392210ba3f3e2741015edd612b78.jpg](https://i.imgur.com/r3FTuIo.jpeg)  
图 4-1-04 Arduino IDE 集成开发环境  

Arduino 可以与 TouchDesigner 结合使用，以实现更加复杂的互动艺术和交互式项目。在此过程中,Arduino 用来读取光敏电阻、温度传感器、压力传感器等各种传感器的数据，并将这些数据通过串口通讯的方式传输到 TouchDesigner 中，在 TouchDesigner 中进行数据处理和多种可视化输出设计。  

### 实战案例: 按钮与旋钮—用 Arduino 开源硬件控制视觉效果  

接下来我们学习如何在 Arduino IDE 开发环境中给按钮(Button Switch）和旋钮(Rotation Sensor)设置指定的引脚，并在TouchDesigner 中制作简单的视觉效果；通过串口通讯让两个传感器分别控制TouchDesigner 视觉效果中模型的大小和颜色，如图 4-1-05。  

![images/590cb11eda8feaf03ef7cafeb68d92e1548e940f121966e2aa2ac52a5a81ddfb.jpg](https://i.imgur.com/HnkHqTj.jpeg)  
图4-1-05最终效果及工程预览  

Arduino 软、硬件有多种版本和型号，且处于不断更新选代中。本案例主要使用 Arduino UNO 开发板，及兼容Arduino的Button Switch（按键传感器，以下简称按钮）和Rotation Sensor（可调电位器，以下简称旋钮)，如图 4-1-06；Arduino 编译环境为 Arduino IDE 2.0.0版。  

##### Arduino硬件连接与编程

![images/797433c93fdec249edb1a8ae6a022a9f09202d593a5fdf1c6447089623375ee1.jpg](https://i.imgur.com/lVqItDP.jpeg)  
图 4-1-06接线参考  

>首先完成硬件部分的操作，如图4-1-06，将按钮、旋钮与Arduino 开发板相连接。其中传感器接地线（GND）与Arduino开发板接地引I脚（GND）相连，传感器电源线（VCC）与Arduino 开发板供电引l脚（5V）相连；按钮信号线（一般为“SIG”或“OUT"字样，本案例使用的传感器模块标为“S”）与Arduino开发板的数字引l脚2相连，旋钮的信号线(S）与Arduino 开发板的模拟引l脚 AO 连接。完成接线后，将Arduino开发板连接到电脑上。  

##### TIPS  

不同型号可调电位器的引脚排列方式可能不同，以其具体标注为准。  

接下来，我们将通过Arduino IDE 向Arduino开发板上传代码，并发送数据到串口。首先选择此次使用的开发板，如图 4-1-07，在Arduino IDE 顶部菜单栏选择Tools（工具)，然后在下拉列表中选择Board（开发板），在其中找到ArduinoAVRBoards，最后选择ArduinoUNO。  

![images/bbb3f8ea19890828ca15e6d090f23c583336ac7987812280569a93d4be0ea237.jpg](https://i.imgur.com/pteOjRg.jpeg)  
图 4-1-07选择开发板  

接着，选择通讯端口。在ArduinoIDE顶部菜单栏选择Tools（工具），在Port（端口）中通常有一个选项注有“Arduino”字样；若没有，尝试插拔开发板，过程中消失又出现的端口即为此开发板连接的端口，如图4-1-08。  

##### TIPS  

图中为MAC电脑的ArduinoIDE2.0.0操作界面。在Windows 系统中，端口通常为 $^{6}(\mathsf{C O M}+$ 数字”，如“COM3”  

![images/ff1ab877525f6f2daf4c5b9aa49408772c45f3f43e3710d704f23ed26a60b2d1.jpg](https://i.imgur.com/GjKc6Jn.jpeg)  

![images/da605f75f996171d7d3753b4187332aee62f06b373ad710240eeb38bcb0797f0.jpg](https://i.imgur.com/kxq7ID8.jpeg)  
图 4-1-08选择端口  

![images/517781cdeb3e51c8b2f690d107743244a984cde452bc7ff88d1a5e6d403a7acb.jpg](https://i.imgur.com/EkSgLC0.jpeg)  
图4-1-09Arduino 代码  

接下来，在ArduinoIDE中输入如图4-1-09所示代码（图中已包含代码解释)，用于给传感器指定引脚，开启串口通讯。  

编译完成后可以点击左上角“√”检查编译，点击$^{6}\rightarrow$ ”标志，向Arduino 开发板上传代码，如图 4-1-10。  

上传成功后，界面下方会显示 Done uploading（上传成功)。  

![images/c3da58c367f8ac2c9ab051081762f251977e9bb21a50c34ac2f52349fe17f1ce.jpg](https://i.imgur.com/h7tyexa.jpeg)  
图4-1-10编译、上传 Arduino 代码  

点击右上角SerialMonitor（串口监视器）图标，如图4-1-11，可以在ArduinoIDE中观察到两个传感器的实时数值变化。此时用手按下按钮，串口第一列数字在0和1之间变化；转动旋钮的旋钮，第二列数字在0至1023 之间变化。至此，本案例的Arduino 硬件和编程部分就已经全部完成。  

![images/8cb25c7f6ba7466d0ea743aea0e9da8530972fa507482e9b1108d3268d048b7b.jpg](https://i.imgur.com/DQxoUYH.jpeg)  
图 4-1-11在串口监视器中查看读数  

##### TIPS  

当我们将Arduino开发板连接到电脑的USB口，数据就通过USB口传到电脑中，这个通讯通道就可以简单理解为所谓的“串口”，串口输入的数据就可以被其他程序读取。  

##### 」TouchDesigner 中的视觉制作

这里将使用TouchDesigner 中的Instance 功能制作整体视觉（Instance 功能的详细介绍参见第 69 页)，如图4-1-12。  

![images/635e6d5ef0f9c510845d164cd1c1105d5648c4c3911e5c81639bb065cfab78e6.jpg](https://i.imgur.com/cHWhSae.jpeg)  
图 4-1-12此部分最终工程预览  

首先我们进行实例化渲染。新建一个 ContainerCOMP，并将其命名为'container_Arduino’，如图 4-1-13。在这个容器中，我们将通过Instance 实例化渲染、串口通讯和数据处理、调整材质等步骤，使传感器可以通过TouchDesigner与Arduino的串口通讯，控制TouchDesigner中的视觉效果。  

![images/d73d75e62c008c22dd8bf3dd4684f19080c104fc4617d77a32af008278ae36c8.jpg](https://i.imgur.com/PV58GRr.jpeg)  
图4-1-13 'container_Arduino'窗  

渲染出 Instance 实例化需要使用的基本单元 一个小长方体，如图 4-1-14。新建 Box SOP'boxl'，将其参数面板的 size 设置为(20,1, 1)，并将长方体拉长。在'boxl'后新建 Transform SOP'transform1'，将 参数 Uniform Scale设置为0.025，使长方体等比例缩小。在'transforml'输出口点击鼠标右键，新建并连接Geometry COMP'geol'，随后,新建 Camera COMP'cam1'\`、Light COMP'lightl'、Render TOP'renderl'，搭建基础渲染框架。  

![images/6983c62d47f5ba319540657ad6ff69ab4230fe73f9a8f66e0b87b359608a7201.jpg](https://i.imgur.com/jeoFuxf.jpeg)  
图 4-1-14渲染基本原件  

如图 4-1-15，在'geo1'的参数面板Instance 页点击Instancing，打开实例化功能。快捷键shift $+\mathsf{A}$ 添加注释框，就完成了Instance 实例化渲染部分。  

![images/b00b6ab6b20b801546621a645141b18ca516d3c903999debba12106d2902794d.jpg](https://i.imgur.com/wAmS6ej.jpeg)  
图 4-1-15打开Instance功能  

接下来制作Instance实例化的参考，如图 4-1-16，新建 Sphere SOP'sphere1'作为小长方体的位置参考。点击元件右下角 $^{66}+^{,5}$ 号激活元件后，将鼠标移动到元件框中，快捷键W键，显示线框模式。将'spherel'参数面板的 Primitive Type参数设置为 Polygon，即将模型上点的分布方式由经纬线分布改为三角面分布。  

![images/397294a251a2459be6ac6c16dbc95a8fc7258f1f0f00fedf77fd425a36509a62.jpg](https://i.imgur.com/PGlPcsu.jpeg)  
图 4-1-16Polygon 模式下 Sphere SOP 的线框  

在'spherel'参数面板的Detail参数页将 Frequency 设置为 16，增加模型的顶点数量，如图4-1-17。  

![images/9b9a962293019ad9523fa503fff97b934847c3ef44820806de640d9671203e42.jpg](https://i.imgur.com/xt14dvZ.jpeg)  
图 4-1-17 增加 Sphere SOP 的点数  

在'sphere1′后新建并连接一个 Transform SOP'transform2'，用作后期调整模型大小；在'transform2'后面新建并连接 Noise SOP'noisel'，用于让模型随机变化；最后添加 Null SOP'null1'，如图 4-1-18。  

![images/9a564f2eb5f78f9a22bd9953ad88738186bcc948c98e1d0669dc338eb4b657af.jpg](https://i.imgur.com/sszX5tX.jpeg)  
图 4-1-18让模型产生形态变化  

如图 4-1-19，在'geo1'的 Instance 参数页将 Translate OP（位移参考元件）设置为 'null1'，并在 Translate X、Translate Y、Translate Z的右侧下拉菜单中分别选择P(0)、P(1)、P(2)，即分别用'null1'模型上所有点的x、y、z 轴坐标控制所有小长方体在x、y、z 方向的坐标信息。  

![images/aa884f2bb63cca578470e00f87dcb1166a99dd6e7d99b69214ce71661c3ca8cc.jpg](https://i.imgur.com/euhiwkX.jpeg)  
图 4-1-19设置位移参考  

为了快速生成一组可以控制小长方体旋转的参数，在"null1'输出口右键添加 SOPto CHOP'soptol'，如图 4-1-20，获取三组代表模型点坐标信息的曲线 tx、ty、tz。这样，生成的数据在采样点数量上可以和控制位置的参考元件保持一致。之后，用它们控制旋转参数，在'sopto1'后添加 Rename CHOP'renamel'，将‘rename’参数面板的To 参数设为 r[xyz]，即将三组曲线分别命名为 rx、ry、rZo  

![images/9b743dffe43b5afce750b89dbb784d073884a9c6a8c5a0f00290f9f5b8801e8e.jpg](https://i.imgur.com/rkD5wwN.jpeg)  
图 4-1-20生成用于控制旋转的数据  

观察三组曲线，其纵坐标值大致在-2 到2之间，如图 4-1-21，由于旋转参数的范围应在-360到360 之间，因此在'rename1′后添加 Math CHOP'math1’，在 Mult-Add页将 Multiply（乘数）设为 180，扩大数值变化的范围；最后，新建并连接 Null CHOP'null2' 。  

##### TIPS  

是 Python 中的索引表示法，用于从列表（或数组）中选择元素。r[xyz]是一个快捷方式，用于同时创建 $\lceil x_{\setminus}$ ry和rz这三个名称，而不必逐个输入它们。这样做是为了方便命名一组参数，用于控制小长方体的旋转。  

![images/e442bf94629f533c5be7c65a2826316546e1e9584cba03c9ee8adce130dd9c75.jpg](https://i.imgur.com/12dussA.jpeg)  
图 4-1-21旋转参数处理  

在'geo1'的参数面板Instance参数页将RotateOP（旋转参考元件)设置为null2，如图 4-1-22，并在 RotateX、Rotate Y、Rotate Z的右侧下拉列表中分别选择 rx、ryrz，以分别控制所有小长方体在x、y、z方向的旋转角度。  

![images/1e2c17381aed02b1819a026d7f883c155a09a0c1488e94df1b88a63dcb0c40de.jpg](https://i.imgur.com/d4mLrzV.jpeg)  
图4-1-22设置旋转参考  

接着，给'geo1′添加材质。如图4-1-23，新建Constant MAT'constantl’，将此元件拖动到'geol'上，在弹出列表中，选择第一行Parm:Material，即给geol'添加上纯色材质。  

![images/235a8d67a63970ec42c2b882a1529c3809b9025279228e2cb876426edc0f1ace.jpg](https://i.imgur.com/7HqkKWL.jpeg)  
图4-1-23添加纯色材质  

新建两个不同配色的Ramp TOPramp1'和'ramp2'，如图 4-1-24，将它们连接到新建的 Switch TOP'switch1'上。为了使两个 Ramp TOP 在切换过程中能有渐变视觉效果，在'switchl1'参数页打开 Blend between Inputs 选项；最后,连接NullTOP'null3'。  

将'null3'拖动到'constant1'上，可以看到渐变色成为该材质的 Color Map(色彩贴图)，如图 4-1-25。  

![images/e24fd74903bf444fdc2b4fbdf260fc69302742c26d10754a09c91ce9ce56cc44.jpg](https://i.imgur.com/MvV7M4b.jpeg)  
图 4-1-24准备材质贴图  

![images/3371c9ea68ca2cff0012f901c27f02de021b3b2032727172148b846d80c8a9d8.jpg](https://i.imgur.com/OvcmVfx.jpeg)  
图 4-1-25添加材质贴图  

快捷键shift $+\mathsf{A}$ 添加注释，就完成了视觉效果的制作，如图 4-1-26。接下来,我们用导入的Arduino传感器数据控制材质贴图的颜色和 Instance 实例化参考的模型大小。  

![images/7074dd57a99e8ddd9e70f2fc94ad716dc35954bc269aa10a06e8d487be404ec4.jpg](https://i.imgur.com/o0ToS42.jpeg)  
图 4-1-26在编辑区的工程预览  

![images/3bbd119c0b33d78f817b96f731ccfe41931ddf05e11d3b5358be6d100e40bfa6.jpg](https://i.imgur.com/D1FSM18.jpeg)  

##### Arduino传感器数据导入及映射

为了让TouchDesigner可以通过串口协议读取Arduino发送的数据，在编辑界面空白处新建Serial DAT'seriall'，在其参数面板Port（端口）下拉列表中找到此前Arduino 连接的端口，如图4-1-08、4-1-27，此时即可在'serial1'中看到两个传感器的读数。注意：因为串口协议具有独占性，应当提前关闭Arduino IDE的串口监视器以及TouchDesigner等其他可能占用相同串口的软件。  

![images/0d82d78582ce99ebffb2820e5c3780a39dcfd205a4504b85529ba75412ed5dd5.jpg](https://i.imgur.com/Ru85yit.jpeg)  
图4-1-27读取串口数据  

在'serial1'参数面板的Received Data页，如图 4-1-28，将MaximumLines 设置为1，即只显示最新一组传感器读数。  

![images/8b99bf42768db20b01a06980618a1c80c95f1a93e1e3659402c0012ae9ae8e58.jpg](https://i.imgur.com/IMjRlNs.jpeg)  
图4-1-28只保留最新一组传感器读数  

为了将两个传感器的数值拆分到不同单元格，在'seriall'后添加ConvertDAT'convertl，如图4-1-29，在'convertl'参数面板的 Split Cells at 输入一个空格（注意：不是什么都不填写），元件就会以空格为标志进行单元格拆分，第1行第0列为按钮读数，第1行第1列为旋钮读数。  

![images/77742c9d8eb51939f550b1d6a2daa96dd16ad692243fb2e429ac7e0f22ce16aa.jpg](https://i.imgur.com/BDhOq3G.jpeg)  
图4-1-29分离传感器数值  

![images/54327bd612d1538a727dc1f847d52fb670da62ffeb90459fbcb7da5b5c7f4301.jpg](https://i.imgur.com/Zxlwdyr.jpeg)  
图 4-1-30选取旋钮数值  

在'convertl'后新建并连接 SelectDAT'selectl'，将参数面板的 Select Rows和 Select Cols 设置为 by Index 模式，根据行、列序号，选择旋钮的读数。接着，如图 4-1-30，将 Start Row Index、End RowIndex、Start Col Index、End Col Index 参数都设置为1。  

![images/f11885806f29b93410970bff83601cb1012f630ad17825870f0d67914b48d826.jpg](https://i.imgur.com/BBIGh6u.jpeg)  
图 4-1-31将数值放入 CHOP 类型元件  

为了使数据导入 CHOP类型的元件中以方便后期处理和使用，在'selectl'的输出口点击鼠标右键，新建DATto CHOP'dattol'。默认状态下，'selectl'中的值会成为'dattol'中通道的名称；因此，我们将'dattol'参数面板的 First Column is-设置为Values，其他参数保持不变，如图4-1-31。这样，就可以将'selectl'中的值变为'dattol'中通道的数值。  

![images/3f8966f4099a965c318bc8f0dcb5e2a84278b38e36bacb67b2f7b7ce6b4cc863.jpg](https://i.imgur.com/I9vMq0R.jpeg)  
图4-1-32选取按钮数值  

选取按钮读数的方式同上，可以直接复制'selectl'和'dattol'，粘贴出'select2"和'datto2'。如图 4-1-32，此处唯一需要修改的参数是'select2'中的 Start ColIndex、End Row Index，将其都改为 $0_{\circ}$  

![images/1a65f2e42d91f57e019c797b5a9493965cb289082d8a93bb90040ff5b4f24cc0.jpg](https://i.imgur.com/NcC0ciT.jpeg)  
图 4-1-33测试 Uniform Scale 数值范围  

接下来，我们将用旋钮的数值控制整体造型的缩放，需要映射的目标参数是'transform2′的Uniform Scale。如图4-1-33，通过鼠标拖动测试，将我们需要的目标数值范围控制在 0.35到 1.2 之间。  

接下来，将Arduino旋钮的数值映射到该范围。在前面的步骤中，我们从Arduino的串口监视器观察到旋钮返回的数值在0至 1023，因此，在'datto1'后添加 Math CHOP'math2'，在'math2'参数面板的 Range 页将 From Range改为(0,1023)，To Range 改为(0.35,1.2)，如图 4-1-34。为使数据平缓变化，在其后添加 Filter CHOP'filterl'，并新建Null CHOP'null4'作为结束标志。  

![images/98419c2d2dbc1d25fe510473d124278f0fdf7ff6fb0a658cec61d1aec24a4009.jpg](https://i.imgur.com/gbDqtKc.jpeg)  
图4-1-34映射数值范围  

##### 

![images/daae8e20b306c61b51b8f7a3c1609e47dd67ddd1165b1e087c46ae9de433d57e.jpg](https://i.imgur.com/FuEWaHB.jpeg)  

FilterCHOP用于平滑或锐化输入通道，通过对相邻样本的组合来进行过滤，以设置样本的新值。  
Type（类型）：选择不同类型的过滤器。。  
Effect（效果）：过滤器影响通道的程度。  
FilterWidth（缓动时间）：变量完成一次平滑或锐化效果的时间。  
FilterperSample（每个样本过滤）：将过滤器应用于通道的每个样本，而不是整个通道。用于处理多样本通道。  

如图 4-1-35，激活'null4'，将其中的'chan1'通道拖动到'transform2'参数面板的Uniform Scale 参数上，可以看到自动弹出一个列表，选择CHOPReference。  

![images/d9c06e10de04ea6e96d1c5a60bd81c982fda4d52dd0fe786322e1ce0407ee687.jpg](https://i.imgur.com/I26vq1K.jpeg)  
图4-1-35引|用通道数据  

此时转动旋钮，可以看到整体造型的缩放变化，如图4-1-36。  

![images/296bed9d1c8900d765d498041b66d9b3e59b45385e2734d1d0e27839d58e36d1.jpg](https://i.imgur.com/F52vBJY.jpeg)  
图 4-1-36缩放效果  

最后，用按钮的数值控制视觉效果的配色切换，此时，需要修改的目标参数是'switch1'的Index。在'datto2后添加FilterCHOPfilter2，让数据变化有过渡；添加NullCHOP'null5'作为功能模块完成标记，如图4-1-37。  

![images/98869afb659d13b5f63acf47d35cce7871060080e87c1bad35c365d1d032d6b3.jpg](https://i.imgur.com/FVVxe0K.jpeg)  
图 4-1-37数据平缓变化  

![images/add8e2e1a4eec5daf0ba9657fcdbcc231f3994a9cf63034e91bbf3fc76db0f12.jpg](https://i.imgur.com/V6iC9u3.jpeg)  
图4-1-38 引用通道数据  

![images/9e2bd981c1347725bc39b6a94a855a8c2006104de587a5a761fbd89590498299.jpg](https://i.imgur.com/xf2Kb6G.jpeg)  
图 4-1-39配色效果  

激活'null5'，如 图4-1-38，将其中的'chanl'通道拖动到'switch1'的Index 参数上，选择 CHOPReference。  

此时，如图 4-1-39,我们就能通过按钮控制视觉的配色变化了。  

![images/18064011f3b7fdcf0698c6b753935d6d79ca9fa673d665d65bc76cb46433f25a.jpg](https://i.imgur.com/HKKk9pX.jpeg)  
图 4-1-40添加背景色  

最后，在'renderl'的后面添加一个TransformTOP'transform3'，如图4-1-40，打开 Comp OverBackground Color 选项,将 Background Color（背景颜色）设置为（0.9679,1,0.627,1）；最后，连接一个 Null TOP，将其命名为'bg。  

![images/da878bb91c53073bcc65edb171353f4b3f5f64408c0d2fc79c6ad40a43723d67.jpg](https://i.imgur.com/ODdLqVw.jpeg)  
图 4-1-41最终工程  

至此，我们完成了整个案例工程的制作。如图4-1-41，可以按功能分区对元件进行整理，根据图片内容添加注释框。  

### 实战案例: 用Firmata通讯制作虚拟手电筒  

Firmata 协议是一种类似于MIDi协议的通讯协议，它可以将微控制器（如Arduino）变成“客户端”，通过串口通讯，Arduino引l脚可以直接被主机电脑访问和控制。在TouchDesigner中预置了‘firmata'插件，通过这个插件，我们可以直接使用Arduino 自带的 Firmata 示例文件，不需要在ArduinoIDE 编译环境中写任何代码，就可以通过TouchDesigner直接访问或控制Arduino开发板的所有引脚，十分方便。  

本案例中，我们将使用 Firmata 协议将 Arduino 信息传输给 TouchDesigner。在 Arduino UNO 开发板上连接一个摇杆模块（本案例使用的是Joystick Module DFR0061，以下简称“摇杆”），使用摇杆模拟手电筒的移动和亮暗状态，通过控制电脑中光点的移动来查看图像，如图4-1-42。  

![images/42bf4a17bf705d17afa2d4dcf84c4f76bc4dcdc5dd4e32c1cd865841b89cd3a5.jpg](https://i.imgur.com/MRuv7jD.jpeg)  
图 4-1-42在编辑区的最终效果预览  

$\rightarrow$ 首先，将摇杆与Arduino 开发板相连接，如图 4-1-43。摇杆的VCC 与开发板5V电源相连，GND 与开发板GND 相连；黄色表示信号线；分别将摇杆的×轴接入开发板A3，Y轴接入A4，Z轴接入A5引脚。  

![images/bfecccfd492eaf2837dce02515d2301c7f0ce3d10dc5594d5ca65e405be0224b.jpg](https://i.imgur.com/ViKkA2a.jpeg)  
图4-1-43硬件连接示意图  

接下来，打开ArduinoIDE，为开发板上传Firmata相关代码。如果是第一次使用Frimata 功能，需要为Arduino安装Firmata库。如图4-1-44，点击编译界面左侧LIBRARYMANAGER图标，在搜索栏输入“firmata”，安装搜索结果中的第一个库 Firmata byfirmatao  

![images/b85601c52dd040a123ff561a937d302e262a5fb42dd703c23a4895c617b07749.jpg](https://i.imgur.com/LfRioWc.jpeg)  
File Edit Sketch Tools Help   
图 4-1-44安装 Firmata 库文件  

将Arduino板连接至电脑，选择好对应的端口，点击左上角“”检查编译，点击 $^{66}\rightarrow^{5}$ 向Arduino开发板上传代码。如图 4-1-46，上传成功后会显示 Done uploading（上传成功)。  

##### TIPS  

向开发板上传代码时，TouchDesigner中的Serial DAT元件或'Firmata'插件若处于激活状态，会导致代码上传失败，建议此时关闭TouchDesigner。  

![images/38b82f10bd3b2274e0eab434f11169964e266328cdc4144e8cbf300d2c179896.jpg](https://i.imgur.com/Jyp2pnG.jpeg)  
图4-1-46上传示例代码  

Firmata 库文件安装完成后，如图 4-1-45，在顶部菜单栏选择File（文件)，然后在下拉列表点击 Examples（示例)，在其中找到 Firmata，选择StandardFirmata。  

![images/c9903cfa0ba8809f292e122e329a81169444eae9e97bc1f11bf445de9a3cb3be.jpg](https://i.imgur.com/us2uGK6.jpeg)  
图 4-1-45打开示例工程  

打开 TouchDesigner，如图 4-1-47，将左侧插件区Tools 下拉列表中的'firmata'插件拖动到右侧编辑区。  

![images/e60b41dc0b948d15c655e1a5a4d1ccec398d0e58c46d59dadeea39f928261fbc.jpg](https://i.imgur.com/zvYV1Lh.jpeg)  
图 4-1-47TouchDesigner 中的'firmata'插件  

点击'firmata'参数面板Firmata页的Active开关，打开Firmata通讯；如图4-1-48，将Port（端口）设置为com3（不同电脑的端口号不一样，请使用对应的端口号，参见上一案例图4-1-08、图4-1-27)，等待片刻后，即可在'firmata'中看到Arduino各引引脚信息，这说明 TouchDesigner 与Arduino成功建立了Firmata通讯。  

![images/1fc0f3bbbc8ef7c5e6e4ece149c048dd1da443f7368090f22603b396e66b4bc8.jpg](https://i.imgur.com/lJj9PHc.jpeg)  
图 4-1-48设置端口  

在'firmata'参数面板的 Pin Values页，如图 4-1-49，打开 Pin17-AnalogPin18-Analog、Pin19-Analog 中 的 EnableReporting选项，此时摇动传感器的摇杆，可以看到这三个通道的数据发生变化;在‘firmata'后新建Null CHOP'null1'用于查看数据。  

![images/af85285d6e52f1a290dfaaf1749a910252ed4bdcc4f8c46f8558f412a7c71cbc.jpg](https://i.imgur.com/Quy69Mr.jpeg)  
图4-1-49设置引脚  

![images/b8086340beba4ea373c22e74f1892338df0067dbe06fd9c51aa75efb7913cd0e.jpg](https://i.imgur.com/4r82nbF.jpeg)  

![images/ed046d2ab4f13b1a3712a9791d5a0d7f951cfca3665a6213a2292e1b330eb026.jpg](https://i.imgur.com/sPhlrGd.jpeg)  
firmata(Palette 插件)  

（注意：当没有Arduino板插在主机端口时，Firmata将不显示PinModes和PinValues参数页面。当Arduino板插在主机端口且上传了Firmata类型代码，并在TouchDesigner中正确设置参数后，Firmata的参数面板会自动识别Version、Firmata Type、Firmata Version 且会出现 Pin Modes 和 Pin Values的参数页面）  

Help（帮助）：点击可打开帮助文档。  
Active（激活）：打开串口连接。  
Port（端口号）：输入和Arduino板相同的端口号。  
Baud Rate（波特率）：选择和Arduino上传串口数据相同的波特率。例如，Arduino上传的是StandardFrimata项目文件，则波特率设置为 $57600_{\circ}$   
Query Version（查询版本）：查询当前Arduino 安装的 Firmata 类型。  
Query Board Capabilities（查询 Arduino板的功能）：查询Arduino板上每个引脚的功能。  
Query Pin States（查询引脚状态）：查询引脚写入的值。  
Query Analog Mapping(查询模拟引脚）：查询哪些引脚提供模拟通道信息。  
ReportAnalogPins（打开模拟引i脚）：读取模拟引脚的信号。  
ReportDigitalPins（打开数字引脚）：读取数字引脚的信号。  

##### firmata(Palette 插件)

在 PinValues 参数面板中，显示着所有引脚的数据。通过On/Off 或者滑块，可选择引脚的输出数据。例如，当在 Pin Mods参数面板下设置 Pin9 模式为 PWM 时，在Pin Mods 参数面板下就可调节 Pin9 的输出数据（注意：数据为黄色时，表示这个引脚的状态为Input，数据不可以调整)。  

![images/c4e427ede8f485d609252506ecd77c56f48ffed964f67d1859ab6c16fda8aab0.jpg](https://i.imgur.com/I2lqzBO.jpeg)  

Pin Modes页中，Pin2\~Pin13对应Arduino开发板的2\~13数字引|脚，Pin14\~P19对应开发板A0\~A5模拟引|脚。我们可以根据连接传感器的类型，调整对应引脚的相关参数。  

![images/2c23f92218c9cf3fe754ad27d457539ce7420d92640ede586eda6e8ddd44f39d.jpg](https://i.imgur.com/ynqnXPw.jpeg)  

在Pin Modes页改变引脚类型时，PinValues页对应引脚的参数样式也会发生变化。此时，需要打开对应引脚的EnableReporting选项，才能实时获取开发板引l脚数据。  

在'null1'后新建Select CHOP'selectl'、'select2'和'select3'，通过修改 Channel Names 参数，将'null1'中的 valuePin17、valuePin18 和 valuePin19 通道分别选出来；并使用 Rename to 参数更改对应通道名称为X、Y、Push。此外，在每个 Select CHOP 后新建Null CHOP。如图 4-1-50，在'selectl'与'null2'之间添加'math1',在'select2'与'null3'之间添加'math2'，方便后续步骤的数据映射。接下来，制作手电筒开关的视觉部分。  

首先，新建元件 Circle TOP'circlel、'circle2’，做出两个除颜色外一模一样的圆。如图 4-1-51，将'circlel'填充颜色改为黄色，circle2'填充颜色改为黑色；设置Softness 参数为 0.2，使圆的边缘柔和，使其看起来像是发散的光。  

在编辑区空白处新建一个 Switch TOP'switch1',将'circlel'与'circle2'连接至'switch1'的输入端，用摇杆按下的状态控制'switch1'的切换。  

![images/a9f6a984ee96b4cee2a356560878fc3f6e8dda8b3965656ba5646db7d8d1a1cf.jpg](https://i.imgur.com/jyX5j3a.jpeg)  
图 4-1-50选取数据  

![images/3f94aca99f3ceac68bca949f7a2bea73433bc559294f54b23c0dc196392ca989.jpg](https://i.imgur.com/YVQeMMr.jpeg)  
图 4-1-51制作切换效果  

如图4-1-52，新建MovieFile InTOP'moviefilein1，并导入一张图（这里使用PieterBruegel de Oude1560年的作品Children's Games)。鼠标中键点击'moviefilein1'，可以看到图片大小是 $1280^{\star}930$ （1.37:1）像素。我们希望圆成为图片的蒙版，所以新建CompositeTOP'compl'，在'switch1'后新建FitTOPfit1'用于更改圆的整体画布的尺寸。为了使叠加后的圆不变形，修改参数 Resolution 为(137,100)，还可以适当调整圆的大小。  

![images/77f7b9e4988a17bcb7a1c15fc398afb527b9333724a4037e8044bf29f2d1cddf.jpg](https://i.imgur.com/q6hoxGd.jpeg)  
图 4-1-52叠加动态蒙版  

新建ConstantTOP'constantl'，将颜色调为黑色，和手电筒关闭时的颜色一致。  

新建 Over TOP'overl'并将 Fixed Layer 选择为 Input1，将'compl'和'constant1'连入'overl’,如图 4-1-53。  

![images/5dc831ee3bb7cdf875fabc718eb6ffaa454999b7e140fa11d2ea99087fc2e709.jpg](https://i.imgur.com/hw0InUX.jpeg)  
图4-1-53叠加黑色不透明背景  

当按下传感器时，我们希望有手电筒打开的效果，即有黄色的光出现且可以看见物体。所以，需要用元件'null4'的Push通道控制元件'switch1'的Index参数。新建CHOPExecuteDAT'chopexecl'，如图4-1-54，激活元件，添加如下所示的表达式：  

def onOffToOn(channel, samplelndex, val, prev): op('switch1').par.index=0 return   
def onOnToOff(channel, samplelndex, val, prev): op('switch1').par.index=1 return  

指令解释：'null4'的通道参数等于1时，元件'switch1'的参数Index为0；'null4'的通道参数等于0时，元件'switch1'的参数Index为 1。对应在'chopexecl'参数面板中,打开 Off to On和 On to Off 两个开关，并将CHOP参数设置为 null4。  

![images/5f77426e788fbc80ea843b23616b0cb8458dad3d6ae39e156cc8d00ca177c970.jpg](https://i.imgur.com/sjxFjco.jpeg)  
图 4-1-54输入表达式  

接下来，使用传感器摇杆的 XY 位置参数控制光在画面上的移动。调节fit1'的 Translate 参数，观察圆上下左右的运动范围，可以得出圆的× 轴和 y 轴移动范围应该在-0.5 至 0.5 之间；因此，将'math1\`、'math2'参数面板 Range 页的To Range 参数改为 (-0.5, 0.5), 并在 Math CHOP 后分别新建 Null CHOP 'null2' 和 'null3'， 如图 4-1-55。  

![](images/dd7f45b27426fbec58836c6ca1e25542d5173536d2a54b1c07b3dfc1b430bfa0.jpg)  
图 4-1-55修改范围  

将修改好的范围元件'null2\`、'null3′ 的通道数据分别映射在'fit1'中 Translate 的 tx、ty 上，如图 4-1-56。  

![images/40249dd9d926a9aaebb34cb95282d97f0cf74e204c23d747d4e6b6e35cf9c0c2.jpg](https://i.imgur.com/cxlkSiq.jpeg)  
图 4-1-56　映射通道  

最后对项目进行全屏播放设置(全屏播放详细步骤，参见第48页)，如图4-1-57。  

![images/46a5d1995fdafd344fa4ddff40151c898f3b26c08bb43e68339cb4d0c01848ff.jpg](https://i.imgur.com/KWOkkfQ.jpeg)  
图4-1-57全屏效果下最终互动的效果  

##### 更多学习资源：TouchDesigner与开源互动装置设计

由 TouchDesigner 官方中文社区一TEA Community 开发的《TouchDesigner与开源互动装置设计》线上课程，在本节的教学基础上，更加深入Arduino开源套件的应用，如Arduino开发板、ESP32开发板等。课程以互动艺术装置为主题，包括互动影像、创作感知环境和行为的创意视觉，循序渐进地讲解各类传感器和电机，从而搭建机械装置原型、自制VJ界面及DIY控制器、小型互动灯光装置等。此外，随课附赠针对课程研发的开源套件工具包，满足多种艺术装置创作需求。  

![images/016df81d6d7acd33456d4780b38d492bea936f779010375d5c071b461e6ba305.jpg](https://i.imgur.com/GN2Ww4b.jpeg)  
图4-1-58课程部分效果实拍及部分工程文件展示  

## 4.2 Kinect 体感外设

在众多硬件外设中，Kinect 无疑是一个里程碑式的存在。2010 年，第一代Kinect 360（以下简称“Kinect v1”)上市之后，以 Xbox 为首的一系列体感游戏、交互体验项目就遍布世界。2012 年，微软正式发布基于 Windows 平台的Kinect One for Windows 系列外设，可以配套 SDK 驱动在 Windows 平台上开发使用。当前，Kinect 已经在互动体感游戏界占据一席之地，无论博物馆、展览会、各项发布会，抑或是各个高校实验室，都有它的身影。今天，我们依然能在生活中看到众多基于Kinect开发的互动项目。  

2019 年2月，微软推出 Azure Kinect，在第二代Kinect（以下简称“Kinect v2”）的基础上进一步发展，提供更强大的传感器和更全面的功能，面向更广泛的工业、科研和创意领域，适合更复杂和精细的应用。  

![images/570549c11d3c127f75197081e1d0a1e260dcfd4c6bb4de8a3ab8a910ee8131b9.jpg](https://i.imgur.com/ZjpZsD5.jpeg)  
图 4-2-01Kinect v1 和 Kinect v2  

![images/ec4fe829174e8756b44588c76fafcea6677f94b9d02c515d91f01363f8f5c28e.jpg](https://i.imgur.com/PeyC3G0.jpeg)  
图4-2-02 Azure Kinect  

Kinect 也是TouchDesigner 经常搭配使用的体感硬件，可以实现丰富的图形处理，抓取人体的图像和关节点的位置信息。在 TouchDesigner 中，我们可以通过 Kinect TOP、Kinect Azure TOP 和 Kinect CHOP 等元件获取 Kinect 的数据。在接下来的两个案例中，我们将分别使用 Kinect v2 和 Azure Kinect 进行演示。  

#### 实战案例：用Kinectv2制作“融球感应”体感互动效果

$\rightarrow$ 本案例中，我们使用 Kinect v2 进行制作。开始前，需要将 Kinect v2 与电脑连接好，并在微软官网下载Kinect v2的应用驱动软件Kinect forWindows $\mathsf{S D K2.O_{\circ}}$ 下载安装后，在 TouchDesigner 中新建 Kinect TOP 'kinectl′及 KinectCHOP'kinect2'，如图 4-2-04，即可获得Kinect 设备采集到的信息。  

![images/70d4ede2f4fc41417b7fe2aa0183e5234c35531f6482cff823799d088746e647.jpg](https://i.imgur.com/0X9LXYH.jpeg)  
图 4-2-03Kinect v2驱动安装  

![images/6f109bc764fe18a2dc71babd26487bafcbc0adfd1118a36d8a32b945d7b81df5.jpg](https://i.imgur.com/YkGv1ry.jpeg)  
图4-2-04Kinect TOP 和Kinect CHOP  

##### TIPS  

使用 Kinect v2 时，我们只能在 Windows 系统中直接获取其在 TouchDesigner 中的节点，Mac 系统下无法使用 Kinect TOP与 Kinect CHOP；且每台 PC 至多只能连接一台 Kinect v2，而每台 PC 可以连接多台 Kinect Azure。  

Kinect TOP 提供了若干Image 参数的选项，其中包括 Color (全彩图像)、Depth(景深)、Raw Depth(原始景深)、Infrared (红外成像)、Player Index(最大用户人数)、Color Point Cloud (彩色点云)、Depth Point Cloud (景深点云)，用户可以根据需求选择不同的画面输入。下面我们来看几个常用的图像输入，如图 $4\mathrm{-}2\mathrm{-}05_{\circ}$  

![images/f76defe3950394877b9f423997bdf8471d6c7d797fdc1d033ee64df0e09e9cd9.jpg](https://i.imgur.com/13phs8t.jpeg)  
图 4-2-05 Image 参数的选项  

如图4-2-06，Color模式也就是我们熟悉的全彩图像，此时Kinect和普通网络摄像头功能相似。KinectV2配备了1080P的高清摄像头。  

![images/77fcbf544ec9e4732c87746e07bb9b282cd23500ef3606a45de3da87daa5f108.jpg](https://i.imgur.com/BvMXeQ4.jpeg)  
图 4-2-06Color模式  

![images/ff385e1c9c2846ef396721f581d4456e5a5bd2f7c75ba76d63653754cfb70acd.jpg](https://i.imgur.com/wZCTLMW.jpeg)  

如图4-2-07，PlayerIndex是KinectTOP中提供的简单抠像功能，它可以粗略地绘制出用户的身体轮廓。在此模式下，Kinect提供 $512^{\star}424$ 的像素分辨率。  

![images/07c167954994d1afed1b9039b23f857ef93a2cdf7bdb61eafdb88d83fdeae0fe.jpg](https://i.imgur.com/n9o4y93.jpeg)  
图4-2-07 Player Index 模式  

##### Kinect TOP

Active（激活）：打开或者关闭运行状态。  
HardwareVersion（硬件版本）：选择使用Kinect的V1或V2传感器。  

Sensor（传感器）：选择要使用的传感器ID，仅在使用KinectV1时可用。  

Image（图片）：Color模式使用RGB相机呈现图像；Depth图像的像素范围是0\~1，其中像素值为1表示该像素距离相机8.191米；Infrared模式使用红外线相机呈现图像；Player Index对用户轮廓粗略绘制；ColorPointCloud生成32位的浮点纹理图，其中RGB像素值相当于彩色相机的XYZ像素值，以米为单位。  

CameraResolution（摄像头分辨率）：选择摄像机的分辨率，仅在使用KinectV1时可用。  

Skeleton（骨骼）：指定跟踪完整骨架还是固定骨架。NearDepthMode（近深度模式）：为深度摄像头启用近距离模式，该模式下允许深度摄像头看到距离摄像头近 $40\mathrm{cm}$ (默认是 $80c m$ ）的对象。  

MirrorImage（镜像图片）：以y轴为对称轴翻转图像。Camera Remap（相机）：启用后，图像将重新映射为彩色相机的空间和分辨率。  

如图 4-2-08，Infrared图像通过Kinect自身发出的红外线“照亮”物体，图像不受可见光的干扰。  

![images/fc45f80771a587db8966be2483851f80d25cd9bc121190960fdb069298920f7d.jpg](https://i.imgur.com/oGk1WUa.jpeg)  
图 4-2-08Infrared 模式  

![images/4cc7e9376d60105a8a15d6245a24425c96ebbcdc500fe7df7aaeb30f07800adf.jpg](https://i.imgur.com/QAWFYpb.jpeg)  
图 4-2-09Depth 模式  

如图 4-2-09，Depth 图像提供了画面的景深信息，景深信息是Kinect最有用的功能之一。Kinect可以通过景深信息过滤掉特定范围内的图像，离Kinect越近颜色越深，越远颜色越淡（全黑区域代表物体已经超出了可测范围)。  

##### TIPS  

红外光线是不可见光。KinectV2的红外摄像头拥有红外滤镜，会过滤掉所有可见光，只接收红外光线。Kinect本身拥有红外灯，所以在全暗环境下Kinect的红外摄像头依然能捕捉到物体移动的画面。  

##### 使用 Player Index 模式和 Instance 实例化功能制作融球互动效果

Kinect 提供的丰富的图像信息可以应用于不同的交互体验场景。接下来，我们将把 Player Index功能生成的图像与Instance功能结合，完成一个小的体感互动效果。  

![images/9e3861ddb7e6e0dbccc0cc5f9c47704624016642bffa83ddde40dc0c57908460.jpg](https://i.imgur.com/ImAEfYY.jpeg)  
图 4-2-10在编辑区的最终流程预览  

我们先看看这个案例的制作原理，如图 4-2-11。  

![images/feeb438888fa7ad5c2f9c741390ac82e2ce396d62c4246666f1c9f1208b772ed.jpg](https://i.imgur.com/E3Qhti9.jpeg)  
图4-2-11基本原理图  

如图 4-2-12，新建 Kinect TOP'kinectl'，使用 Kinect TOP 的用户轮廓抠像功能。将'kinectl'参数面板的 Image（图像类型)选择为PlayerIndex模式，然后连接Threshold TOP'threshl'建立阀值，‘threshl'参数面板的Threshold(阈值)默认为0.5，我们根据实际情况调整，使画面图像像素值低于阈值的区域为0，高于阈值的像素为1，从而增强画面对比度。然后使用 Feedback Loop 处理Kinect TOP 中的 Player Index 图像（搭建Feedback Loop 的具体流程，参见第 52页)，就获得了一个带有简单拖尾效果的人物剪影。  

![images/a78e63c94b8eb74dd39a437f7ae6cc92cf91885239676c6469ae3c663bf8a7dd.jpg](https://i.imgur.com/OoqwWV0.jpeg)  
图4-2-12用 Feedback Loop 处理图像  

![images/be9418eff3d2a55b7bcbfab574e1056673274d27c2c669d158779945a448d0c4.jpg](https://i.imgur.com/ncReAK4.jpeg)  

Comparator（比较）：选择比较國值的方法。  
RGB：选择图像的某一通道，用于计算阈值。  
Threshold（阈值）：低于当前数值视为全暗，高于当前数值视为全亮。  
Alpha（透明通道）：确定 Alpha 通道的输出。Same as RGB指将 Alpha 通道设置为与RGB通道相同，One将Alpha通道设置为1。  
Soften（缓和渐变）：下降到阀值的速率，缓和渐变。  

从图4-2-11的基本原理图我们可以看到，每个像素对应一个Instance原型，所以实际需要的像素 $60^{\star}45$ 数量远小于当前输入端的分辨率，我们可以使用鼠标中键查看当前图像的像素，如图4-2-13。  

![images/beacc825c1fd36f474b35cc7b9fe0cc8552758025813145afd09ad8e1097e6d7.jpg](https://i.imgur.com/GOxGlJT.jpeg)  
图4-2-13左为输入端分辨率，右为实际需要的像素分布  

如图4-2-14，我们可以在'compl'后添加 Resolution TOP'resl'，将分辨率设置为 $60^{\star}45$ （案例最后的输出端将是 $60^{\star}45$ 个模型的三维空间阵列)，在'resl'后连接Null TOP'null1'备用。  

##### TIPS  

在ResolutionTOP中自定义分辨率时，需要根据需求设置Common参数页面的Output Resolution 参数。如果设置为 Custom Resolution，则可以完全自定义长宽分辨率。  

![images/eaceedd2fc06174962dd5f2c523be002e896c2dd2893180b538c1ac5f740b3a4.jpg](https://i.imgur.com/Hsio9Bt.jpeg)  
图 4-2-14添加 Resolution TOP  

![images/44a7f9eb65ba2053aff2af3f0fc0c10f8398c780f2d647e5f306abcb7bd5ce9d.jpg](https://i.imgur.com/N1AyXn4.jpeg)  
图4-2-15添加 TOPto CHOP  

如图 4-2-15，鼠标右键点击'null1'右侧输出口添加 TOP to CHOP'toptol'，将像素信息转换成CHOP 通道中的数据。对于黑白图像，R、G、B三个通道的数值是相同的，因此在'toptol'参数面板中删除多余通道，只保留R通道信息即可；同时在Crop 页将 Crop 参数选择为 Full Image，以读取每一个像素点的信息。  

![images/dd3a71306867aa5b0a694f27e3f92319ac6e4053ab50e5bc456f3152babd19af.jpg](https://i.imgur.com/PsN8f3b.jpeg)  
图4-2-16采样点  

![images/3f159b1dbab0d127c2763f2b1bdb4f40ca332b7157a6b6078c92d6bea7501155.jpg](https://i.imgur.com/4yEXmc3.jpeg)  
图 4-2-17添加 Shuffle CHOP  

此时的'topto1′中包含了45个通道，每个通道上有 60 个采样点，如图 4-2-$16‰$ 这 $45^{\star}60$ 个采样点对应了TOP图像中$45^{\star}60$ 个像素的 R 通道数值。  

如图 4-2-17，在'toptol'后添加Shuffle CHOP 'shuffle1' (Topto CHOP 与Shuffle CHOP 的用法参 见 第 85 页),将'shufflel'参数面板的 Method 设置为Sequence All Channels，即以首尾相接的方式将这 45个通道合成一根通道曲线。这样，我们就准备好了一组用于影响Instance 的数据。  

接下来，制作用于 Instance 实例化参考的点位图 (Instance 功能用法参见第 69 页)。如图 4-2-18，新建 Grid SOPgrid1'，根据 TOP 图像的分辨率设置'grid1'参数面板的 Size ×(长)为 op('null1').width/10, SizeY (宽）为 op(null1).height/10，使'grid1'和'null1'的长宽比例一致。  

Rows (行数) 为 op('null).height, Columns (列数) 为 op("null).width, 使'grid1' 上的点与'null1 上的像素一一对应。此外，给'grid1' 添加 Null SOP 'null2' 备用。  

![images/2ae5837a81cf5ced622838f122fa9ad19b9efa7d625e532d151568e4979dbb58.jpg](https://i.imgur.com/jb4OT2l.jpeg)  
图 4-2-18设置 Grid SOP 大小  

##### TIPS  

用'null1'的水平分辨率和纵向分辨率除以10，作为新建Grid SOP的Size尺寸，是为了不让顶点之间的间隔太大。  

如图4-2-19，鼠标右键点击'null2'右侧输出口并添加SOPto CHOP'soptol，获取'null2'上每个点的位置数据。将其与此前'shufflel'中的数据通过Merge CHOP'mergel' 组合，并在'merge1′后添加 Null CHOP 'null3。  

![images/f73e9145c2523e3297ee1bcfe97f7c06c4fa2ca97a27a901c85a0280404a099b.jpg](https://i.imgur.com/eX0FPXd.jpeg)  
图 4-2-19组合数据  

如图 4-2-20，新建Sphere SOP'sphere1′用作Instance 的基本图形，调整Radius（半径)为0.1。鼠标右键点击其右侧输出口，并新建Geometry COMP'geol′与其连接。  

![images/94e877f9c1ba7f7fd82b73a2e7d18b4ce5d2152ee59ab5b88bbdd5aff6803772.jpg](https://i.imgur.com/A4QRSZz.jpeg)  
图 4-2-20新建Geometry COMP  

![images/af663182399f7a55a101612955a9f1365fd0613888691605851c9c74908f5526.jpg](https://i.imgur.com/kYRumFk.jpeg)  

为了给小球添加一种光效材质，如图 4-2-21。新建Phong MAT'phongl'并选择喜欢的颜色，将其直接拖动到\`geol'上，在自动弹出的窗口选择第一行Parm:Material。添加Camera COMP、Light COMP和RenderTOP，渲染图像。  

![images/605dcb1832cac2e50fe5bab66f5f5d1927597f227df14678f13dda30820fd166.jpg](https://i.imgur.com/Lpuj3F2.jpeg)  
图 4-2-21渲染图像  

![images/72b3701874d440b30bbbf429af1179ab588d708f815346b7d7fc605b11db85c9.jpg](https://i.imgur.com/VIciEyv.jpeg)  
图 4-2-22映射小球位置  

接下来，打开'geol'参数面板 Instance 页 的 Instancing 实 例化开关，将'null3'设为Instance的Default Instance OP（默认参考元件)，并对实例化的 TranslateX、Y、Z 和 Scale X、Y、Z 进 行 设 置。如图 4-2-22，此时 SOP 里点的位置(null3'中 tx、ty、tz三个通道）决定了 Instance 中图形的位置，TOP 图形中像素的亮度（'null3'中 RO 通道）决定了每个小球的大小。  

![images/04ba88b6024560ef6387083615c0ad259cf16bb6d00bf53e67da0405325e64de.jpg](https://i.imgur.com/s58tVBP.jpeg)  
图4-2-23实际效果图  

在调整摄像机位置及角度后，我们就可以看到最终效果了。如图 4-2-23，当用户移动位置时，每一个小球的大小都会随之发生变化。  

#### 实战案例：用Azure Kinect制作“舞动烟雾”体感互动效果

下面将利用 Azure Kinect获取基于图像色彩分析得出的人体手部位置数据，来控制屏幕上的两个彩色小球移动，从而制作不断移动的烟雾扩散效果，如图4-2-24。烟雾会随着人的动作，实时地发生变化，如图 4-2-25。  

![images/d8fda48feea9a411027235406d1752e23113b97dd3f31dcca4d9d2b57265cefb.jpg](https://i.imgur.com/AIB2lOm.jpeg)  
图 4-2-24在编辑区的最终效果预览  

![images/1850e6387c1aac261dff4f3cea4bf43b016241c7770c9f8f27c89135aaa356aa.jpg](https://i.imgur.com/CvsaPFJ.jpeg)  
图 4-2-25最终效果预览  

##### TIPS  

AzureKinect 需要配合 2018年4月10日后更新的Windows 操作系统使用，且电脑显卡性能至少为NVIDIA GEFORCEGTX1070或更高配置，才能从相机中获取有效的人体跟踪数据。  

##### TIPS  

不同于Kinectv2需要下载安装相应的SDK软件开发工具包，AzureKinect可以实现“即插即用”—使用信号线及电源线将AzureKinect与电脑连接后，无须手动下载安装相应的工具包，即可建立二者的通讯。  

$\rightarrow$ 连接好 Azure Kinect 后，如图 4-2-26，在 TouchDesigner 中新建 Kinect Azure TOP'kinectazurel’，将其参数面板的Image（图像模式）设置为Color，获取Kinect的彩色相机画面。  

![images/9bfd136c976e395ef3ba91fe9f97818a97c9b68b7cb5eebdece3623db51a3d79.jpg](https://i.imgur.com/1XjeCWs.jpeg)  
图4-2-26KinectAzureTOP参数界面  

##### TIPS  

Azure Kinect有多种图像模式，如需同时使用多种图像模式，需要先在空白处建立数个Kinect Azure Select TOP。先将Kinect AzureTOP 分别拖动到每个 Kinect Azure Select TOP 上，再调整 Kinect Azure Select TOP 参数面板的Image（图像模式）参数来选择不同图像类型。  

![images/faa985273914109998c71e22049ba75511bd0c7d9bf50dff3679ef7893d15d75.jpg](https://i.imgur.com/t85DN1g.jpeg)  

##### 获取手部移动数据

首先新建一个 Kinect Azure CHOP'kinectazure2',如图 4-2-27，将'kinectazure1′拖动到‘kinectazure2'上，‘kinectazure2'开始实时读取用户的骨骼点数据，为后续制作手部交互做准备。  

在'kinectazure2'参数面板将 Color Image Positions选项打开，如图4-2-28，获取基于彩色图像分析得出的人体骨骼位置的UV坐标通道（图像UV坐标图详解参见第84页)。  

![images/3adccd6229385c29c58a4de9f411fd1d38d6b13409251a7edea36dbe31d84224.jpg](https://i.imgur.com/bRyTTYz.jpeg)  
图4-2-27Kinect的TOP与 CHOP链接  

![images/49cebe7e2748f480fb8e10e9bee348f3e23091b0da22880d012b452d7cd96d73.jpg](https://i.imgur.com/DgnSUYK.jpeg)  
图 4-2-28开启彩色图像位置分析  

##### Kinect Azure TOP

![images/49cd22a0ad235a9e6247e858e9724769ed63f41bed1657bec4bec4887479759f.jpg](https://i.imgur.com/6AngJSP.jpeg)  

SyncImagetoBodyTracking（与身体追踪同步）：启用后，图像将会有一定延迟，以便它与KinectAzureCHOP中的实时数据相对应。  

Mirror Image（镜像）：水平翻转图像。  

Active（激活）：启用和关闭摄像头。  

Sensor（序列号）：选择所连AzureKinect相机的序列号。一台电脑可以连接多台AzureKinect，但是每台AzureKinect只能连接一个KinectAzureTOP。  
CameraFPS（相机帧速率）：控制彩色、深度相机的帧速率。以30FPS运行时，不支持部分彩色相机高分辨率。较低的帧率可以在弱光条件下产生更清晰的彩色图像。  
ColorResolution（彩色相机分辨率）：彩色相机拍摄的图像的分辨率。不同的分辨率可能有不同的纵横比。注意：30FPS不支持4096×3072。  
DepthMode（深度模式）：选择呈现深度图像所使用的相机模式。  
BodyTrackingProcessingModel(身体追踪数据处理模式）：选择不同的身体追踪处理模式。默认状态下为GPUDefault;若选择CPU会让数据处理速度变慢，但不需要高性能显卡即可运行。  
Image（图像模式）：选择呈现的图像模式。  
Align ImagetoOtherCamera（图像对齐）：启用后，当前图像将自动与其他图像画面尺寸对齐。  

##### Kinect Azure CHOP

![images/e248cfd5806ecf0e94e278d31eb98d90f0d6164965c2d3fc2acd016ac6a3d837.jpg](https://i.imgur.com/DHRSmIT.jpeg)  

![images/17bd13179faf2ff17991e000c4606f0ffab3b155355c81f6de7a709d49686cd8.jpg](https://i.imgur.com/B6I5ZoS.jpeg)  

Active（激活）：启用和关闭身体追踪。  

Kinect Azure TOP（Kinect图像元件）：进行身体追踪的KinectAzureTOP元件名称。  
MaxPlayers（最大玩家数量）：限制跟踪的玩家数量。  
RelativeBoneRotations（相对骨骼旋转）：返回每个骨骼的rx、ry 和rz 的相对旋转通道。旋转相对于上一个关节而言。AbsoluteBoneRotations（绝对骨骼旋转）：返回每个骨骼的rx、ry和rz绝对旋转通道。  
Bone Lengths（骨骼长度）：返回每个骨骼长度的通道。WorldSpacePositions（世界坐标）：返回骨骼在世界坐标中的位置，输出tx、ty和tz三个信息通道。  
Color Image Positions（彩色相机位置）：通过彩色图像模式，计算人体骨骼的位置数据。输出u和v两个信息通道。Aspect Correct UVs（纵横比矫正）：缩放图像，使其与相应相机的纵横比相匹配。  
IMUChannels（IMU传感器）：返回AzureKinect相机中IMU传感器的温度、加速度和旋转数据。  

在"kinectazure2'后面新建并连接 Select CHOP'selectl'，在其参数面板的 Channel Names 中选择 pl/hand_l:u、pl/hand_l:v、pl/hand_r:u、pl/hand_r:v，如图 4-2-29，即可获取左、右手的 UV 坐标数据，其取值范围均为 0到1 之间。  

##### TIPS  

KinectAzureCHOP中每个通道的名称都是由不同属性的词组合而成的。在本案例使用的通道中，p代表玩家序号，|和r分别代表左右手，u和v分别代表坐标轴。因此，pl/hand_l:u 通道的数据表示 1号玩家左手在水平方向上的位置信息。  

![images/9289b39cf3c9c8bdd0a64e7c7a318e20999cf8bb7b72d56bfde54129f264c2ee.jpg](https://i.imgur.com/yi0KhKs.jpeg)  
图4-2-29选取手部数据通道  

在'selectl'后新建并连接一个MathCHOP'math1'，用于后续调整映射范围。如图4-2-30，在'math1′后连接一个NullCHOP，并将其命名为'hand'，至此，就完成了对Kinect特定通道的选取。  

![images/478a4d9b3e09c1a806456c64a05626230ebc4cccc8fc2a11b1626827a7c35c57.jpg](https://i.imgur.com/1kWZ75R.jpeg)  
图 4-2-30完成通道选取  

接下来，我们用手势数据控制两个小球的位移。如图 4-2-31，新建 CircleTOP'circlel'，将'circlel′参数面板的Radius（半径）设置为（0.02,0.02)，在Common页将Resolution（分辨率）调整为(1280,720)。复制'circle1'得到'circle2'，用左手数据控制'circlel'的中心位置，用右手数据控制'circle2'的中心位置。  

![images/a1ba178b21ee3dc098e160532599b9ee65dcecc9ca97a9466ec53d67a89114d0.jpg](https://i.imgur.com/U1gPPHb.jpeg)  
图 4-2-31设置小球形状和画面大小  

通过调整'circlel'参数面板Center的值可以得出，其取值范围应在-0.5至0.5 之间。如图 4-2-32,在'math1′参数面板的 Range 页中将 To Range参数设置为(-0.5, 0.5)，From Range 参数保留默认设置。  

![images/b9f39561bc547a65823f5da70b3ac80e9c47699f00693ee0569ce4c03a202cb2.jpg](https://i.imgur.com/QbA6vO3.jpeg)  
图4-2-32 调整映射范围  

点击'hand'右下角加号激活元件，如图 4-2-33，将通道 p1/hand_l:u、pl/hand_l:v分别拖动赋值给'circlel'参数面板 Circle 页的 centerx、centery 参数上，在弹出窗口都选择 Export CHOP 绑定模式。同理，将通道 pl/hand_r:u、pl/hand_r:v分别拖动赋值给circle2"的 centerx、centery参数，此时，站在Kinect前挥动双手会发现圆形正在追随手的位置移动。  

![images/7bfa6c98d0be01e416366b45a77a6e8c6a8cce36978f41746d88c6c622675b60.jpg](https://i.imgur.com/dxzhKmC.jpeg)  
图 4-2-33数据映射  

新建OverTOP'overl'，分别连接'circle1'和'circle2'到'overl'的两个输入端，将图像合并。快捷键shift $+\mathsf{A}$ 添加注释，至此，就完成了Kinect手部位移信息的提取。  

![images/980e116d579750a8011d989e813f403969ec9ff253e93d6aba8b3bd75b480c7b.jpg](https://i.imgur.com/VER7bcd.jpeg)  
图4-2-34将两个小球画面合成到一起  

##### 烟雾视觉效果

接下来，制作烟雾视觉效果部分。为了让这两个小球能散发出更多绚烂的色彩，在空白处新建 Ramp TOP'rampl'，如图 4-2-35，在参数面板的Common 页将分辨率调整为（1280,720)，然后在 Ramp 页将默认的黑白渐变设置成自己喜欢的颜色。  

![images/81edb3a0ea7de4c84c2b65293d6090c8b8caf82fea722a663a9c68d5dfa521a5.jpg](https://i.imgur.com/RqogSLo.jpeg)  
图4-2-35 分辨率设置  

在'rampl'后新建并连接 HSV Adjust TOP'hsvadj1(HSVAdjustTOP详解参见第76页)，其参数面板的Hue Offset（色相偏移量）可以使颜色不断变化。拖动参数可以观察到其数值变化范围在-360至360 之间，如图4-2-36。  

![images/26f172ac9698c1507d2a3ac98a12530b180df945f9792877bf1477872d06d649.jpg](https://i.imgur.com/dole5zh.jpeg)  
图4-2-36·连接 HSV Adjust TOP  

新建LFO CHOP'Ifo1'，将参数面板的 Amplitude（振幅）调整为 360，并将Frequency（频率）设置为0.01,现在我们得到了一个在-360至360之间波动的数据，如图4-2-37。  

![images/20eb1ceaeef0a94ef0e5e825d79c588a55b8436c6ff723998d9c58ba39b8f234.jpg](https://i.imgur.com/CILqST8.jpeg)  
图 4-2-37LFO 参数设置  

在"fo1′后连接 Null CHOP 并将其命名为'hue'，点击'hue'右下角加号激活元件，拖动通道chanl到'hsvadj1'参数面板的Hue Offset 参数上，选择 ExportCHOP绑定模式，如图4-2-38。  

![images/70b1a8a90f6197b79d173177575d69940117a03a710bae205acb7e0c7f29ed19.jpg](https://i.imgur.com/31hCfzG.jpeg)  
图 4-2-38渐变颜色效果  

如图4-2-39，新建一个 CompositeTOP'compl'，然后将'overl'和'hsvadj1'一起连接到'compl'的输入端，可以看到两个小球的颜色开始不断变化；之后,在'compl'后新建并连接一个 Null TOP'null'。  

![images/6e3bf8697bd67315f5b908fc2e1f03d87a1f693a11be28ff70626966795f08b5.jpg](https://i.imgur.com/SKv1rg5.jpeg)  
图 4-2-39调整映射范围  

为了让小球的色彩不断向外扩散,需要建立 Feedback 反馈循环，并使用Displace TOP 加入置换效果(DisplaceTOP 详解参见第 54 页)。因此在'null1'后连接 Feedback TOP"feedbackl'，在其输出口点击鼠标右键新建 Displace TOP'displacel'，可以看到'feedbackl'已经连接到'displacel'的第一个输入端，并作为被置换图像。如图 4-2-40，在空白处新建 Noise TOP'noisel'，将'noisel'连接到'displacel'的第二个输入端作为置换参考，'displacel'参数面板的 DisplaceWeight(扭曲程度)设置为(0.01,0.01)。  

![images/62dffdc8a8f868757a012c0401f3aa7b8c52f6142d7783965f0d8b2bc974bf33.jpg](https://i.imgur.com/6rOEo2k.jpeg)  
图 4-2-40调整扭曲程度  

在空白处新建 Over TOP'over2',将'null1'连接到'over2'的第一个输入端，'displacel'连接到'over2'的第二个输入端。然后将'over2'拖动到'feedback1'上，形成一个扭曲置换反馈循环，如图4-2-41。  

![images/9617b7f6036cfb97734ec8d1f91fc2e90093831399d03dce2168ae75f6b099f0.jpg](https://i.imgur.com/dadxc9T.jpeg)  
图 4-2-41完成 Feedback 流程  

为了让输入 Displace TOP 的两个元件分辨率保持一致，在'noisel'参数面板的Common 页将分辨率修改为 $1280^{\star}720_{\circ}$ 在 Transform 页，点击 Translate 参数,在tz的参数框输入表达式absTime.seconds\*0.1，使噪波图像随时间不断变化，如图 4-2-42，可以看到'displacel'将输入的画面沿对角线方向置换。  

![images/7bff5fb45dd853deb3f8a6dc8b76cb5ae6a0f8ff242c21af6c7cd918135ba2be.jpg](https://i.imgur.com/7g94ewC.jpeg)  
图 4-2-42调整Noise TOP 参数  

将'noisel'参数面板Noise页的Monochrome（单色)选项关闭，调为彩色模式，可以看到烟雾向四周飘散。将Harmonics（谐波）设置为10，谐波越大扩散的烟雾细节越丰富，反之则烟雾越柔和；将Amplitude（幅度）设置为0.1，幅度越大则烟雾扩散的速度越快，反之则速度越慢，如图 4-2-43。  

![images/3ddc7564b5dff84e63b7949739658230b05e1cc1502180f791735d3d5de4ef3e.jpg](https://i.imgur.com/XFjw9s8.jpeg)  
图4-2-43 调整Noise TOP 参数  

##### TIPS  

DisplaceTOP在默认情况下，水平轴和纵向轴的扭曲参考分别是红色通道和蓝色通道。关闭Monochrome（单色）前，每个像素的红蓝通道数值都是相等的，因此会导致输入图像向对角线方向扭曲；关闭Monochrome（单色）后，由于红蓝通道数值不同，会朝着不同方向扭曲。  

![images/00924647d92c5a5eb01c00982f10a4c75461df5d6ab6e2627b1d3835036bae4a.jpg](https://i.imgur.com/MwJHzhu.jpeg)  

快捷键 shif+A 添加注释，至此，就完成了烟雾效果视觉制作。最后，我们进行摄像头画面视觉合成处理。  

![images/82d8bd23b6cff1553b75e42429a02a8f5be047be81c243e092fc0584c73d4481.jpg](https://i.imgur.com/PDI0AXt.jpeg)  
图4-2-44 最终效果视觉  

##### 摄像头画面合成

新建Over TOP'over3’，如图4-2-45所示，将'over2'连接到'over3'的第一个输入端，将'kinectazurel'连接到'over3'的第二个输入端，可以看到烟雾效果被合成到摄像头画面上。  

![images/01aca5560efea134d769896a0789409c594103a6bf795faeb0baac44df5396e3.jpg](https://i.imgur.com/b5y1SjO.jpeg)  
图4-2-45 合成摄像头画面  

在'over3'后新建并连接Flip TOP'flip1'，如图 4-2-46，开启参数面板的Flip×（水平镜像)，在"flip1'后新建并连接NullTOP并将其命名为bg，作为最后一个结尾元件。至此，就完成了烟雾追随手部位移的体感互动效果。  

![images/9a60ed085abdd54284b68e1ccddbd6f1c5ad519732f6270e5008bac0b0c9e70d.jpg](https://i.imgur.com/uYXZfDT.jpeg)  
图 4-2-46水平镜像设置  

##### TIPS  

本案例中，我们默认观众是面朝 Azure Kinect 设备的，如下图所示。由于摄像机的成像原理，Kinect 拍摄的画面投射到屏幕上时是镜像的，所以需要在此处镜像画面。  

![images/ea8ee945d01820125e3b517ad28f33f3a0a0ad0d9876a6795fb0c65083e8b8b5.jpg](https://i.imgur.com/1w1uhM7.jpeg)  

为了让观众沉浸地参与作品交互，在空白处新建一个 Window COMP'window1'，将'bg'拖动到'windowl'参数面板的 Window Operator 参数上，开启全屏播放（全屏播放功能参考第 49 页)。灵活地运用本案例所学到的技能，可以为你的作品增添更多的交互性和体验感。  

##### 更多学习资源：TouchDesigner 与体感交互设计

由 TouchDesigner 官方中文社区一TEA Community 开发的《TouchDesigner 与体感互动设计》线上课程，在本节的教学基础上，更加深入体感技术应用与交互设计。以Kinect全身人体骨骼捕捉案例为主题进行教学，从身体的三维空间坐标数据、摄像机跟踪等视觉特效、表情和动作识别，逐步深入体感互动游戏系统的搭建，案例视觉效果涵盖 GPU 粒子、自然山水、赛博朋克等多种风格。此外,还有针对课程开发的独家Kinect 模拟插件和数据包，即使没有Kinect硬件也可以直接学习。  

![images/7693f8a03d77ceecfc11158d3f7bfffaedd09292a1ec80b46c6f5594746fb3b2.jpg](https://i.imgur.com/ZDrpyEY.jpeg)  
扫码查看详情  

![images/1f5868795ec561a0fa266cf8201ad97d1f1c5e9cf3a653ef15d767164848c30f.jpg](https://i.imgur.com/Z4nNPwX.jpeg)  
图4-2-46 课程部分效果实拍及工程截图展示  

## 4.3 Leap Motion手势交互外设

Leap Motion 是一种基于手势识别技术的输入设备，它由高精度的红外摄像头和红外LED组成，能够在空中准确地捕捉手指、手掌和手腕的运动轨迹。  

Leap Motion 控制器可追踪十指的每个关节，精度高达10微米。通过对手指在三维空间中的运动进行跟踪和分析，可以精确地识别用户的手势和动作，包括点击、滑动、捏住、握拳、展开等多种手势。它捕捉的数据能与TouchDesigner的其他节点进行通讯，从而完成对创作内容的精准控制。  

由于其高精度的手势识别和低延迟的反应时间，LeapMotion在多个领域得到了广泛应用，包括虚拟现实（VR)、增强现实（AR)、游戏、3D建模、医疗康复、人机交互等。用户可以通过自然的手势操作来与电脑进行交互，而不需要通过键盘或鼠标等传统输入设备，大大提升了交互的直观性和自然性。  

![images/452f41871a22854adf53bb539e0972bb13d581a25d5cb187f00a47f266d08df4.jpg](https://i.imgur.com/rNc4twQ.jpeg)  
图 4-3-01 Leap Motion 设备官方图  

##### Leap Motion 驱动下载安装

与Kinect v2 相似，我们首先需要安装Leap Motion 硬件对应的驱动软件。以 Windows 系统用户为例，访问 LeapMotion 官网 https://developer.leapmotion.com/tracking-software-download，如图 4-3-02，直接点击“DowNLOADCEMINIFORWINDOWS”即可下载驱动应用程序（你可以从官网下载，或下载本节工程文件获取安装包，下载链接参见第41页)。如图4-3-03，双击Ultraleap应用程序图标进行安装。  

##### TIPS  

Ultraleap应用程序建议直接安装至其默认路径，否则会影响下一步建立LeapMotion与TouchDesigner的通讯。  

![images/8dc0ec589566ebd481cba5179bf409828a0f4d26dd3ea8c3f56163127d0c7d9c.jpg](https://i.imgur.com/53Lg9Zw.jpeg)  
图4-3-02官网驱动软件  

![images/13297bb9b976005acaa47a79d5c885bd78a6e676c0830b992a6a201e14609739.jpg](https://i.imgur.com/1eHgZ7A.jpeg)  
图 4-3-03下载到本地的Ultraleap 应用程序  

安装完成后，如图 4-3-04，打开 Ultraleap Tracking 应用，可以看到启动了 UltraleapControlPanel控制面板，如图 $4\cdot3\cdot06_{\circ}$ 如果没有自动打开控制面板，可以在电脑右下角小图标中启动 Ultraleap Control Panel，如图 4-3-05。  

![images/6d20fa13b3101747c0fe5c5eae21583dc3ac49ec651aed3b7065c303747979aa.jpg](https://i.imgur.com/8tKQZKI.jpeg)  
图 4-3-04 Ultraleap Tracking 应用  

![images/e0c592b4bf5e822c5a7880c9b9030eec04747502a0320ef997882a0793b2c28d.jpg](https://i.imgur.com/xxaU9RD.jpeg)  
图4-3-05电脑右下角小图标  

##### TIPS  

Mac用户请先查明自己的电脑属于Intel芯片还是M系列芯片，再选择对应安装包下载。  

![images/c822a93b05b4713d851223c5ac50f475a832f419cbd1843e0d255b69f4e632b7.jpg](https://i.imgur.com/plWpSCm.jpeg)  
图 4-3-06Ultraleap Control Panel 控制面板  

将 Leap Motion 设备平放在桌面上，并通过 USB 数据线连接至电脑。如图 4-3-07,此时控制界面软件已成功识别LeapMotiono  

![images/c510cf1f8797464259c9f36a958ac58ce241a557d8f9731c674e8f360237de3e.jpg](https://i.imgur.com/TGcpT3m.jpeg)  
图4-3-07识别成功  

##### 建立 Leap Motion 与 TouchDesigner 的通讯

完成上述步骤后，不要关闭 Ultraleap Control Panel驱动界面；打开 TouchDesigner，新建Leap Motion TOP与Leap Motion CHOP。此时，Leap Motion 依旧无法在TouchDesigner 中连接，如图 4-3-08，提示需要安装LeapMotion库文件。  

![images/706f29d5692c3c5409250c1f62f2c6b1d178d804ce6be929777fd7c2f06a9116.jpg](https://i.imgur.com/hWaY18s.jpeg)  
图 4-3-08LeapMotion元件缺失库文件  

此时，需要手动添加库文件。默认情况下，在安装UltraleapTracking应用时如果保持了默认路径，我们可以从以下路径中找到所需要的库文件：C:\Program Files\Ultraleap\LeapSDK\lib\x64，如图 4-3-09。  

![images/430086c95c8a50d474bccc9ec4c0a1fce178f592523307d35c7673094a27d8a7.jpg](https://i.imgur.com/xEKT09x.jpeg)  
图 4-3-09LeapC.lib 库文件获取路径  

##### TIPS  

此处为Windows电脑的库文件安装方法，Mac电脑的库文件安装方法请扫码查看书籍补充文档。  

复制LeapC.dll 文件，将其粘贴至 TouchDesigner 安装目录的bin文件夹中，默认路径为C:\Program Files\Derivative\TouchDesigner\bin，如图 $4-3-100$  

![images/248d73060fb721c73005e4f8ce5b1a2677e395c423a1120bb04727ef76fedf54.jpg](https://i.imgur.com/UcbzG12.jpeg)  
图 4-3-10LeapC.lib 库文件粘贴路径  

重新启动TouchDesigner后，新建LeapMotionTOPleapmotionl′和 Leap Motion CHOPleapmotion2。如图4-3-11,可以看到此时我们已经成功新建TouchDesigner与 Leap Motion 的通讯。在 TouchDesigner 中，通常使用LeapMotion CHOP 获取手势数据，使用 LeapMotion TOP查看摄像头画面。  

![images/4f50b11bf837901e54f2e45c8697c80373cd5f96a6649817f5f6c7f943c608c1.jpg](https://i.imgur.com/sFPtHCi.jpeg)  
图 4-3-11建立 LeapMotion 通讯  

![images/0d278505454827f327f4928f99c5ecb8ab098b8b3705becfede18f63f9c69a69.jpg](https://i.imgur.com/d2JIgK4.jpeg)  

Active（激活）：开始读取手势数据。  
Hands（手的数量）：限制要追踪的手的数量。  
HandVelocity（手的速度）：返回手的速度数据。  
Pinch Strength（捏住强度）：返回拇指与食指之间的距离数据。  
GrabStrength（握拳强度）：返回握拳的强度数据。  
Fingers per Hand(手指数量）：限制要追踪的手指数量。FingerExtended（伸直手指）：返回检测到伸直的手指的数量。  
Finger Joints（手指关节）：开启每个手指关节的追踪,返回其空间坐标。  

### 实战案例: 用Leap Motion 制作“掌中星尘”手势互动效果  

本案例中，我们将从 Leap Motion 与 TouchDesigner 的通讯开始，依次通过 Leap Motion 数据导入及处理、Instance 实例化星系视觉效果制作、数据映射和添加渲染细节几个步骤，实现通过手势控制星系运动的互动效果，如图 4-3-12。  

![images/c009a061b51e24ae5f7c30306781992d64975f07af2e27feda9359d3fa182199.jpg](https://i.imgur.com/2gohs5s.jpeg)  
图 4-3-12案例最终呈现效果  

##### Leap Motion 数据处理

如图 4-3-13，导入Leap Motion 摄像头信息，将手掌抓握姿势、手掌位移、手掌旋转角度的数据提取出来，并进行缓动处理，方便后续的数据映射。  

![images/cb4642954bcae3c2494a2a0275651f780825292f7291a1d5e585576bd5a931d7.jpg](https://i.imgur.com/dAlOkvT.jpeg)  
图 4-3-13数据处理部分工程预览  

>如图4-3-14，新建一个元件LeapMotionCHOP'leapmotionl'，打开其参数面板的Grab Strength 开关。  

![images/723d3a2b7df1296faf0c9763ece2a2b6d00a7b100c82fdf14b1a5f9f68d68288.jpg](https://i.imgur.com/ymBoemQ.jpeg)  
图 4-3-14开启握拳强度通道  

在其后连接三个SelectCHOP，如图4-3-15，‘select1'的参数面板 Channel Names 选取 handO:grab 通道，用于获取用户握拳状态；用'select2'选取出hand0/palm:tx通道，即用户手掌的x轴移动距离(单位为毫米)，用'select3选 取 出 hand0/palm:rx、hand0/palm:ry、hand0/palm:rz三个通道，即用户手掌三轴旋转的角度数据。  

![images/1ac888d0f1a8dcf78813e5126ef91160b8a7dcd2aab3149f9070c72878ce78fc.jpg](https://i.imgur.com/TqmdlWf.jpeg)  
图 4-3-15选取数据通道  

在'selectl'后面新建并连接Filter CHOP，默认名为filterl。如图4-3-16，Filter元件会将输入数值的变化变得平稳，再新建并连接Spring CHOP'springl，为数据的变化添加灵动的弹簧效果。将'springl'参数面板的DampingConstant（阻尼常量）调整为3，更高的阻尼常量会导致振动更快地消失。  

![images/9af95e3b28fca171f897c45637a2ee1be6aaba4b5232c878e926fa039a62deb1.jpg](https://i.imgur.com/UbTJiMv.jpeg)  
图 4-3-16握拳数据处理  

![images/d9410c5a2406dc0a2d951cfd6498ad6f13bf45ad692aef28a4c02ce9a7df7157.jpg](https://i.imgur.com/VfkBzKC.jpeg)  

Springconstant（弹簧刚度）：该参数控制弹簧的刚度。较大的值会导致弹簧更难被拉伸或压缩，从而产生更快的振动。  

Mass（弹簧末端的质量）：较大的质量值会导致振动频率降低。  

DampingConstant（弹簧的阻尼）：阻尼参数控制弹簧的阻尼，即阻止弹簧在振动中持续摆动的能力。较大的阻尼值会导致振动减缓。  

如图 4-3-17，在'springl'后新建并连接 Math CHOP'math1'，在其参数面板 Range 页将 To Range 参数调整为(20,110)。在'math1′后连接一个 Null CHOP，并将其命名为'noise_amp'备用。  

![images/2697b78ad2560c13ba3fd9cce3abd4e840bebc98f6227b1df38f4795424efa56.jpg](https://i.imgur.com/r2Zellr.jpeg)  
图 4-3-17握拳数据映射  

如图 4-3-18， 在'select2' 后连接 Lag CHOP "lag1'，新建 Null CHOP 并将其命名为'twist_strength' 备用。  

![images/5b9d143c5ac9421fdad26d9bb9478f541d1c8df041ac545b595cf59478209708.jpg](https://i.imgur.com/8mZYa3w.jpeg)  
图 4-3-18手掌旋转数据缓动处理  

如图 4-3-19,在'select3′后新建并连接 Lag CHOP lag2'，将参数面板的 Lag 参数调整为 $(1,1)$ ，即将数据的上升和下降变化时长都拉长到 1秒钟，这样就增加了缓动效果；再连接 Null CHOP 并将其命名为'geo_rotate 备用。  

![images/5dbe4245299a1bc0ebbab20be2719efda7b02dc9fd3c36153004a4400688e726.jpg](https://i.imgur.com/IPZWzyT.jpeg)  
图 4-3-19手掌旋转数据处理  

##### 用 Instance 功能制作星系视觉效果

接下来，使用 Instance 实例化功能制作星系的视觉效果（Instance 用法参见第 69 页)。首先将 Instance 实例化三维模型渲染出来，如图4-3-20。  

![images/ee38528245012561a6c08af513032e0f5a20d5a44db5c316718518c7396386f2.jpg](https://i.imgur.com/8Hbdm7Y.jpeg)  
图 4-3-20视觉效果制作部分工程预览  

点击 TouchDesigner 界面左上角 Open Palette 按钮打开 Palette 插件库，如图 4-3-21，在Generators 栏的下拉列表中找到'mesh'插件，拖拽到右侧编辑区中。  

![images/efd6584fd337cc40a6ef1dc72799ed6738b02b2ce371216d6ef82aae101e523c.jpg](https://i.imgur.com/lMSTm9k.jpeg)  
图 4-3-21插件面板中的 Mesh 插件  

'mesh'参数面板中的 Shape（形态）选择AstroidalEllipsoid，如图 4-3-22。这样，就创建好了一个星体三维模型。  

![images/18a0245570da6388cba7d5c8f7c04bdfa5173e831c7d68ac587e881147a5b3e0.jpg](https://i.imgur.com/gW41azu.jpeg)  
图 4-3-22Mesh 插件形状设置  

在'mesh'的输出口点击鼠标右键添加GeometryCOMP'geol'，再新建Camera COMP'cam1'和RenderTOP'renderl'，搭建渲染框架。如图4-3-23，把'cam1'参数面板的Translate调整为（0,0,250)，这会让摄像机离中心点位置远一些，从而渲染出更多星系的空间画面。  

![images/f9660ec94817368eaef48d1250287409cbe9d53d6fd2ffb7a1da1935ee0d7b60.jpg](https://i.imgur.com/0P4ts1M.jpeg)  
图4-3-23相机位置设置  

新建Constant MAT'constantl'，如图 4-3-24，将其拖动到'geol'上，在弹出窗口选择Parm:Material。这样，我们就将一个三维星体渲染出来了。  

![images/ca23efd65d831264b7b826beed196e9abfe5e27835294bebfa0c7e428afc813a.jpg](https://i.imgur.com/XeoXvSw.jpeg)  
图4-3-24材质赋予  

接下来，制作 Instance 实例化参考，如图 4-3-25,新建Sphere SOP'spherel’，在其后连接 Twist SOP'twistl'，用于扭曲输入的几何形体。调整参数面板的Primary Axis（主轴）为 Z Axis，这样扭曲效果将主要发生在 Z 轴。  

![images/1649d81771390ab55ed50cceaf48be1dde4d7a07b1d3a24922fb0d375634ab81.jpg](https://i.imgur.com/Zj7ZjZJ.jpeg)  
图4-3-25扭曲元件参数设置  

![images/735c788284f3a2c9ce815d70417911ccc84094bac26b204b9b545cb1787196ec.jpg](https://i.imgur.com/i9YcCgd.jpeg)  

Operation（操作类型）：可以选择不同的变形效果，如锥化、弯曲、扭曲等效果。  
PrimaryAxis（主轴）：变形效果应用的主轴。  
SecondaryAxis（辅助轴）：变形效果应用的辅助轴。  
Strength（强度）：所应用效果的强度。  

在'twistl'后新建并连接 Noise SOP'noisel'，如图 4-3-26，将 Type（噪波类型）设置为 Random，使点的分布更随机。然后在'noise1′后新建并连接 Null SOP，将其命名为'ins_position'，如图 4-3-27。  

![images/cb40b4132140ef77554453974089ecfcf55e7f27b55968892e80c359ab23b5ef.jpg](https://i.imgur.com/6vTFQY0.jpeg)  
图 4-3-26噪波元件参数设置  

![images/b3adc9a3cc9d85042ef59cad56ee08f367ec75bbce908f4caf83afc815c7118e.jpg](https://i.imgur.com/BRMtFm9.jpeg)  
图 4-3-27球体变形处理流程  

为了让 Instance 实例化多个参数的数据量保持一致(Instance 实例化功能参见第 69 页)，我们需要得到'spherel'的顶点数来创建其他 Instance 实例化参数组。因此，如图 4-3-28，新建 Info CHOP'info1'，将'sphere1'拖动到'info1'上，即可获取'spherel'中三维模型的相关信息。在'info1'参数面板 Scope 的下拉列表中选择'num_points'，即选择模型点数量的信息。  

![images/99a919ccd621b1e0f297ad55ca04aee39d14cee39c39899db8be306d2522c8e1.jpg](https://i.imgur.com/2zod1ht.jpeg)  
图 4-3-28Info CHOP 参数设置  

新建Noise CHOP'noise2'，用来控制Instance 实例化中每个星体的大小。如图 4-3-29，为了让随机数组不断变化，在其参数面板的 Transform 页将 Translate 参数的tz写为 absTime.seconds\*10，使参数组随时间而变化。  

![images/53927631850042c11843512c88b725a1e9c49b7f6d38714f277b75b2f350b4a9.jpg](https://i.imgur.com/Jiudt9r.jpeg)  
图 4-3-29Noise CHOP 参数设置  

在'noise2'参数面板的 Channel 页，将 Start 和 End 的单位设置为 Samples，将 Start 设置为 1。点击'info1′右下角加号激活元件，将num_points通道拖动到'noise2'参数面板的End上。如图4-3-30，复制'noise2'得到'noise3'，用它控制Instance实例化中每个星体的颜色。  

![images/b05ea8acb092f2c4e5161f6fef67e3d4cb97be2213b9dcb1b449934d9370dc81.jpg](https://i.imgur.com/E3E2qjk.jpeg)  
图 4-3-30Noise CHOP 运动参数设置  

##### TIPS  

以'noise2'中的通道为例，这里的每个通道都是由多个样本组成的，我们称之为序列通道（Sequence Channel)。序列通道的横坐标是样本的序号，纵坐标是样本的数值，Start和End就是这个样本组的起始序号和结束序号。Start 和End之间就是这个序列的区间，若 Start 和 End 的单位为 Samples，且 Start 设置为 1，End 设置为 2，那么这个序列里就有两个样本，序号分别为1和 2。  

![images/44a01ad669e16e0ee2ad8c16456010a9d1a71ec651ce2e2ca6b3f590bc9b3d12.jpg](https://i.imgur.com/ZHgY728.jpeg)  

如图 4-3-31，在'noise2'参数面板的 Channel 页将 Channel Names 修改为scale，将'noise3'的 Channel Names 修改为rotate，方便后续步骤区分不同序列通道的用途。  

由于'noise3'后续将被用于控制每个实例化星体的旋转参数，所以这里需要调大旋转范围。'noise3'参数面板的Amplitude（振幅）控制样本组的数值范围，因此，将Amplitude 的数值调整为180，从而得到一个波动范围在-180到180之间的序列通道，使星体的转动范围在 $\mathbf{-180}^{\circ}$ 至 $180^{\circ}$ 之间。如图4-3-32，在'noise3'后新建并连接一个NullCHOP，将其命名为'ins_rotate'备用;在'noise2'后新建并连接 Null CHOP，将其命名为'ins_scale'备用。  

![images/ae2b24d28bb37d2304a55a3444b994e1400547a7d8b40c22f568fba8e41f359a.jpg](https://i.imgur.com/HznLDgj.jpeg)  
图 4-3-31NoiseCHOP通道名称设置  

![images/19ca12f90d45e42c6ddfede34a845bd0c3354b2e4ad079d87940f34d6c39132f.jpg](https://i.imgur.com/0VpcFH5.jpeg)  
图 4-3-32功能模块的结尾标识  

接下来，在'geol'参数面板的Instance 页，打开 Instancing 开关,并将'ins_position'拖动到TranslateOP 上，使实例化的位移参考为'ins_position’。如图 4-3-33,将 Translate X、Translate Y、Translate Z 分别设为 P(O)、P(1)、P(2)。 将'ins_rotate'拖 到 RotateOP 上，将 Rotate X、Rotate Y、Rotate Z均设为 rotate；将'ins_scale'拖到 ScaleOP 上，将 Scale X、Scale Y、Scale Z均设置为scale。  

![images/2eeecb48b0cc8671cf9faa8e0abd4f4bee98d4902be99ffdeac92fa6ec75b4e4.jpg](https://i.imgur.com/BiXFaCU.jpeg)  
图4-3-33Instance 设置  

##### Leap Motion 数据映射

下面，我们将手势数据结合进来，用手势来控制粒子星系一通过握拳控制星系大小，手掌移动和旋转控制星系的运动，如图4-3-34。  

![images/5e441b51754683c4b4c01be2c43fc68ff240629ab09db43322bd8616f17c14ff.jpg](https://i.imgur.com/SIkPJkk.jpeg)  
图4-3-34数据映射部分工程预览  

首先，如图4-3-35，点击'noise_amp'右下角加号激活元件，将hand0:grab通道拖动到NoiseSOP'noisel'的Amplitude 参数上，即可通过握拳来控制粒子星系的聚拢与扩散。同理，将'twist_strength'的hand0/palm:tx 通道拖动到'twistl'的 Strength参数上，即可通过手的左右移动控制粒子星系的整体扭曲程度。  

![images/8d8d2817ad33645e5fc93e71ab294f232fcb7d2ecad41eef20d5a8ea4949680f.jpg](https://i.imgur.com/WLcGhB3.jpeg)  
图4-3-35引用交互数据  

接下来，如图 4-3-36，将'geo_rotate'的通道 hand0/palm:rx、hand0/palm:ry、hand0/palm:rz 分别拖动到geol'的Xform 参数页面中 Rotate 参数的变量rx、ry、rz 上，这样就可以通过手的旋转来控制粒子星系的变化。  

![images/0951c37353880f6aacdf88e6c8143f9c3b206fa8cfd40cb6395f24dcbb152f0f.jpg](https://i.imgur.com/fN1xwlr.jpeg)  
图4-3-36'geometry'设置  

##### 添加渲染细节

交互部分制作完成后，下面为这个作品的视觉效果添加一些光线晕染的细节。如图 4-3-37,在'renderl′后新建并连接 Feedback TOP'feedbackl'，然后在其后新建并连接 Level TOP"levell'，再在"level1′后新建并连接 BlurTOP‘blurl。新建Over TOP'overl'，分别将'blur1'和'renderl'连接到'overl′的第一个、第二个输入端，然后将元件'overl'拖动到'feedbackl'上，形成Feedback 循环（Feedback 反馈循环原理参见第 51 页)。  

![images/25481c398edc0104688ee16e22be10be35a8e4f7939c91602ccc24828273693d.jpg](https://i.imgur.com/7tshkhf.jpeg)  
图 4-3-37Feedback 反馈循环  

如图 4-3-38,在"level1'参数面板的 Post 页中将 Opacity 修改为 0.96，形成星体拖尾轨迹的效果。  

![images/213d5fbd466e9806f39a556b50e250301ddd40391d187b0f18eaf5345d0c60dd.jpg](https://i.imgur.com/rPSKf3e.jpeg)  
图 4-3-38拖尾轨迹  

![images/89a3aaf5af142594924f75207a6c7e5cb1ba6b3cd0fb9e4c9b80b5f17304cbab.jpg](https://i.imgur.com/59CrM2k.jpeg)  
如图4-3-39,将'blurl′参数面板FilterSize的数值调整为12，形成星星的辉光效果。  
图4-3-39辉光效果  

在'over1′后新建 Lookup TOP "lookup1'，如图 4-3-40,将'over1'连接到“lookup1′的第一个输入端；新建 RampTOP'rampl'，将'rampl'连接到“lookup1′的第二个输入端。在渐变滑块中间点击鼠标左键可以新建控制点，并根据自己的喜好调整颜色。  

![images/d03f72fdecd8f4aa32b3f6d8ab20040790cc9c9c3892dddf1d8c4d7b1f55e5da.jpg](https://i.imgur.com/amgyWyE.jpeg)  
图4-3-40添加颜色  

为了更好地展示作品，如图 4-3-41,在"lookupl'后连接一个 Null TOP 并将其命名为'bg。在空白处新建一个Window COMP'window1'，将"bg'拖动到'window1′上，点击 Parm：Window Operator，设置全屏播放（全屏播放设置参见第 49页)。这样，就完成了一个手势互动作品的制作。  

![images/e06c2911d203e7031c6205146b89f6dea354fad42983df7f6cc8e8d00fb1d21e.jpg](https://i.imgur.com/DxPY3SJ.jpeg)  
图4-3-41将'bg'拖动到'window1'上  

快捷键shift $+a$ 添加工程注释，整理工程界面；开启全屏预览，如图4-3-42，现在  

![images/fd93002b7170c388b584426ee0e138fecb58d83c2fb84efd76aa834c4d56aa34.jpg](https://i.imgur.com/ZGIKemm.jpeg)  
图4-3-42最终效果  

## 4.4 TOF 激光雷达

首先，本节将介绍TOF激光雷达的概念和原理，以便大家对其有更深入的了解；其次，还会分享本书写作团队在多种实际商业交互项目中应用TOF激光雷达的经验心得，为读者展现TOF激光雷达在沉浸式多人交互空间的强大应用能力。最后，讲解如何建立TouchDesigner与TOF激光雷达的数据通讯，用于深入学习雷达交互制作。  

##### TOF激光雷达简介

TOF 激光雷达是一种基于飞行时间 (Time of Flight) 原理的雷达技术。如图 4-4-01，它的工作原理是通过发射激光或LED光脉冲，测量激光从光源发出到目标物体反射回来的时间间隔，从而计算目标物体与光源之间的距离。  

![images/843311a945a8243730f26d005771c76d2b802ffdb844f815251657036f42bb79.jpg](https://i.imgur.com/ZzDQI2q.jpeg)  
图 4-4-01TOF激光雷达工作原理  

TOF激光雷达具有高精度、高分辨率、高速度等优点，可以广泛应用于机器人导航、自动驾驶、智能家居、安防监控等领域。如图 4-4-02，它还可以应用于三维建模、物体识别和跟踪、人脸识别等。由于其广泛的应用和良好的性能，TOF激光雷达已经成为近年来人工智能、机器学习和计算机视觉领域的研究热点之一。  

![images/beabbe59f0192eb7d218ee3e604e110f3852f929ba70eedd61b3f57875a5ff81.jpg](https://i.imgur.com/fzAH9hw.jpeg)  
图4-4-02TOF激光雷达的应用(图片来源Ledinside.com)  

##### TOF 激光雷达与 Kinect、Leap Motion 的区别

TOF 激光雷达、Kinect 传感器以及 Leap Motion 都是经常与 TouchDesigner 结合使用的互动传感设备。TOF 激光雷达通过测量光的往返时间来计算距离，Kinect 则以深度图像捕捉人体动作，Leap Motion 更专注于捕捉手势。这些传感器为 TouchDesigner 提供了丰富的数据源，有助于创造出动态、互动和多维的视觉效果。目前，这些传感器已广泛应用于艺术、娱乐和科技领域。  

TOF激光雷达：TOF激光雷达常被用于一些需要检测大空间中坐标位置的项目，如获取空间中正在移动的观众位置信息、观众触摸屏幕时的交互点坐标信息等。其优点是设备响应快，受环境因素的干扰较小，通过网络远距离信号传输也不成问题；但相较于Kinect体感外设和LeapMotion控制器，TOF激光雷达不具备体感识别功能，因此更适用于大空间、多人参与的互动项目。图4-4-03、图4-4-04、图4-4-05为几种不同品牌和型号的TOF激光雷达。  

Kinect体感外设：Kinect是一种基于结构光原理的三维人体姿态识别系统，由微软公司推出（Kinect详解参见第 197页)。其优点是能够捕捉观众的骨骼信息和外轮廓画面；配合TouchDesigner 的使用，可以快速制作与人体相关的交互类视觉效果。此外，如图 4-4-06、图4-4-07、图4-4-08所示，它搭载的深度摄像头可以获取深度信息，将空间扫描成点云数据。虽然Kinect 也能捕捉人体坐标位置，但相较于TOF激光雷达，其精度稍逊，检测距离有局限性，对于环境的光照条件也有一定要求。  

![images/49095d63ab0a8a0b5f8b128f6798312141e7d279910a6b17873bf2b0733b616a.jpg](https://i.imgur.com/sfgh72l.jpeg)  
图4-4-03北阳 Hokuyo UST-10L  

![images/6252237677d28c901b69d6f37b4fd77f15cd23f3030d9225149b2b80ec560364.jpg](https://i.imgur.com/Fq3Hepy.jpeg)  
图 4-4-06Kinect v2 及 Azure Kinect  

![images/8a7b1acb644fafd237577e95231cd9182781e5b3feee87eb4750e13d23548400.jpg](https://i.imgur.com/oZ1BGEm.jpeg)  
图4-4-04星秒SIMO-10H  

![images/19589f5faeaa09c3dcd05982ca0e9af91ef28d30d6a4eb1fa6247da19195672b.jpg](https://i.imgur.com/i4xpYak.jpeg)  
图 4-4-07Depth 模式、Point Cloud 模式  

![images/8f4dd83609a089d545e1d3f692c16355d59fd4f95339f8405f3eb02e0b9b6aee.jpg](https://i.imgur.com/raj52Ks.jpeg)  
图4-4-05 YDlidar G4  

![images/be9d267956be29756f194b86448f481450bc9ee17e6aaf75f702b0d92c5585fc.jpg](https://i.imgur.com/5V4i6oR.jpeg)  
图 4-4-08 Player Index 模式、Color 模式  

Leap Motion 控制器：Leap Motion 控制器使用红外摄像头和红外 LED 光源来跟踪用户的手部和手指运动，从而能够捕捉用户的手势和动作。如图4-4-09，相较于Kinect，其主要优势在于对手部指关节的识别会更加精准，但局限之处在于它仅能识别手部的骨骼信息，对于环境中的光照条件也有一定要求。  

![images/4dfbebc94cfbddbaedac7b8c6ee2096fe20c0bf45e51e02b0a90b6a370148d9b.jpg](https://i.imgur.com/n1IzwPV.jpeg)  
图 4-4-09Leap Motion 手势识别  

##### TOF激光雷达应用场景

本书写作团队 Digital FUN 在交互新媒体艺术领域有着丰富的项目经历，下面以团队为 Lululemon、一汽大众和UCCA尤伦斯当代艺术中心制作的三个雷达互动项目为例，介绍TOF激光雷达的三个适用场景一常设公共展厅、舞台演绎及沉浸式空间以及激光雷达交互项目的制作和安装搭建流程。  

##### 公共空间和常设展厅

如图 4-4-10，这是 Digital FUN 为 Lululemon The Party 成都站瑜伽活动制作的触摸交互墙。它以流水为概念，从Lululemon的LOGO和主题文字中衍生出其他液态图案元素，配合泉流鸟语等音效，旨在营造瑜伽活动前自然轻松的宁静氛围。  

![images/f91c2c5870d3d5a6a4d5f63b2a0d1c9fe0bc517fa8b691f121f1a20598ef817e.jpg](https://i.imgur.com/gWImGFo.jpeg)  
图 4-4-10泉流——Lululemon The Party 成都站现场  

![images/2433b2de9f8a4a2b6404ea0f1540a3892873c8bcf3ea991cd57246e51c2188c9.jpg](https://i.imgur.com/lboAEHS.jpeg)  
图 4-4-11人流量大的场景  

选择雷达的原因：如图 4-4-11，搭建交互墙的空间位于一个入场门厅之中，是进入Lululemon 活动的必经之路，人流量较大。使用雷达进行交互体验设计，既可以在技术上保证多人参与互动时效果的稳定性，又可以在品牌宣传上吸引足够多的关注。  

雷达安装：硬件安装过程简单，屏幕架起后就可以安装调通，从而将工作重心放在视觉效果的调试。  

交互过程：观众碰触屏幕时，会在手心生成Lululemon的 LOGO及品牌宣传信息，与此同时，液态水流的效果也从中心位置四散开来，让观众听到水流声和鸟叫声，感到心情平静，不知不觉进入瑜伽的轻松氛围中。  

##### 舞台演绎的交互利器

Digital FUN 与 OCT一起为全新一代大众速腾上市发布会提供创意与制作执行方案，在发布会的舞台演绎场景添加了动力灯光装置。此次发布会一改传统演出形式，创造性地将动力系统与观众的交互融为一体，如图 4-4-12，动力系统吊挂于观众头顶，让观众伸出双手，亲自点亮象征启程的一颗颗动力灯泡。  

![images/9aa7f852987dca2652f6f7e6fbf0ace4e711f2d2cdfeb41cee43e393ee947740.jpg](https://i.imgur.com/p6Bzw7N.jpeg)  
图4-4-12质承新境—全新—代大众速腾发布会现场  

选择雷达的原因：发布会为直播的形式，对稳定性要求尤为高，必须准确检测出观众对数控球的触摸点。舞台的可见光环境复杂，而使用雷达作为交互硬件、运用不可见激光，可以完美适配项目要求。  

雷达安装：舞台的两侧和观众区的两侧分别布置了两个雷达。通过对两个雷达捕捉的数据进行双重判定，可以更好地保证交互的准确性。  

交互过程：不同于传统的动力灯光装置，交互成了动力系统的一个创新。如图4-4-13，雷达的使用，让观众伸出双手，便能亲自点亮象征启程的一颗颗动力灯泡。沉浸感、交互性和趣味性首次被运用在一场演出中，让观众体验视觉灯光和交互所带来的震撼。  

![images/ce5ff6bba5ab43b0e1490297c8325c046aa3f6acc96f182c8a3866a0f6d04a64.jpg](https://i.imgur.com/uSiPlK2.jpeg)  
图4-4-13交互概念  

##### 公共空间和常设展厅

受 UCCA 尤伦斯当代艺术中心及国际顶级数字媒体艺术团队 MomentFactory委托，Digital FUN作为技术支持及项目执行团队，落地“唤醒万物”百度Al沉浸式互动艺术体验展。作为国内第一个大型TouchDesigner艺术体验项目，该项目融合了人工智能Al、抽象艺术、生成艺术、大数据及5G技术。  

![images/5f0371a40cd784b340bafb73bfd819136bb81ad144f503f1811cc701af743a7b.jpg](https://i.imgur.com/JEsgpNK.jpeg)  
图4-4-14唤醒万物—百度AI沉浸式互动体验展现场测试  

选择雷达的原因：雷达技术在捕捉位置信息和稳定性方面具有商用级别的技术水平，在人流大的环境中更加稳定；同时，多颗雷达可覆盖更大的交互区域。  

雷达安装：如图4-4-15，整个空间地面左右两侧共布置了四枚雷达，立面的两侧也各布置了两枚雷达。在对空间进行整体覆盖的同时，有很多交错的捕捉空间，增强了容错率。  

交互过程：用户的肢体动态通过雷达，让TouchDesigner生成水彩般的抽象效果，与AI大数据进行共同创作，生成一幅幅共创的艺术作品，彰显了百度AI强大的功能及其对艺术的关注。  

![images/4c7431b0ddad972e6a6427453a07d8907591ed4d5710341a4d9ea8efe2a7cf9e.jpg](https://i.imgur.com/o9mvg0G.jpeg)  
图 4-4-15雷达硬件安装点位  

##### TOF 激光雷达与 TouchDesigner

在 TOF激光雷达与TouchDesigner联动的项目中，二者各司其职，都发挥着重要作用。雷达可以快速获得交互点的位置信息，这些信息本质上是数据;而TouchDesigner节点式编程的方式能快速制作视觉效果。因此，雷达的数据和TouchDesigner 的视觉效果可以通过参数映射相互转换，从而巧妙制作沉浸式体验中的实时交互效果。  

##### 硬件通讯

在多媒体交互项目中，我们普遍使用带有网口数据传输功能的雷达型号，如图4-4-5，通过局域网使这些雷达与媒体服务器产生通讯。  

![images/e991a0507a3cfa9be5a96d2ba93d4901920d8370c6ea65e6f0bca0574eeb5620.jpg](https://i.imgur.com/4FKzbUd.jpeg)  
图 4-4-16雷达与媒体服务器的通讯  

##### TUIO

TUlO（Tangible User Interface Object）是一种用于多点触摸、手势识别和其他基于触摸的互动界面的通讯协议。它定义了一系列规则和格式，将多点触摸和手势事件转换为数字信息，以便软件应用程序可以利用这些数据来创建丰富的交互体验。TUIO通常用于交互式表演、艺术和设计应用程序等领域，这些应用程序需要跟踪用户的手势和动作。在 TouchDesigner 与雷达软件的通讯中，我们同样使用 TUIO作为基础的传输协议。TUIOInDAT作为TUIO元件，用于接收从雷达软件所发送的数据信息。  

![images/d224c63ab433ea23108b265f71a159a6fbc3146decbeeaa0febb743cf2ae5328.jpg](https://i.imgur.com/PXb6Xu4.jpeg)  
TUIO In DAT  

TUIOInDAT元件负责接收和解析通过网络收到的TUIO消息，并将其转换成表格中的列。目前，这个元件使用的是TUIO 1.1 协议，不支持TUIO 2.0协议。  

Active（激活）：当设为On 时，TUIO DAT接收TUIO 数据；设为 Off 时,TUIODAT停止接收数据。Protocol（协定）：用于指定 TUIO数据的传输方式。Port(端口）：指定TUIO数据传输所使用的端口。这里设置的端口应与数据源端口一致。  

##### 雷达 SDK

SDK（SoftwareDevelopmentKit，软件开发工具包）是一组软件应用程序所需的开发工具和资源的集合。目前，市面上大部分雷达都有其配套的原生SDK，如图44-4-17。这些SDK可以帮助我们进行雷达与服务器连通情况的测试、硬件IP及端口配置及一些硬件性能的调试，但无法帮助与TouchDesigner等交互软件直接建立通讯。因此，需要使用第三方软件协助我们将雷达的原始数据通过TUIO协议传输给交互软件，并对原始点云数据进行优化处理。  

![images/0b73cf25885a1dbb87782c4aefe99ec6f8ef4286922732bc5e0f07415c3f2bae.jpg](https://i.imgur.com/pMtXNIB.jpeg)  
图 4-4-17北阳 Hokuyo 雷达 SDK 界面  

##### 凌影雷达交互引擎

“凌影雷达交互引擎”由TouchDesigner官方中文社区一TEACommunity与DigitalFUN工作室联合研发，用于协助制作团队完成TOF激光雷达的艺术交互项目。该应用可以将SDK收到的雷达原始信号转为软件通用的交互协议TUIO。通过TUIO协议，实现 TOF 激光雷达与 TouchDesigner 等交互软件（TouchDesigner、Unity、wwvv、UnrealEngine等）之间的数据通讯，并借助自身算法将原本分散的点云数据信息融合成“区块”，以此获得更加精准的坐标位置。  

##### TIPS  

凡通过TEA官方渠道购买本书的读者，将购书订单截图发送给TEA客服，可以获取“凌影雷达引擎－基础版”下载链接及48小时体验授权码。  

![images/7c49168c1b7df0bace82f4d08974c80c3744ebf3b12fb533a3479d2d0a863a85.jpg](https://i.imgur.com/qE9bDgC.jpeg)  
图 4-4-17凌影雷达交互引擎界面  

##### 更多学习资源：TouchDesigner 与雷达触控交互设计

雷达硬件设备与 TouchDesigner 等交互软件进行通讯的环境配置和流程较为复杂，因篇幅有限,本节以原理介绍为主；实际操作步骤学习及更多如图 4-4-18、4-4-19 所示的雷达触控交互设计案例跟练，可以参考由 TouchDesigner 官方中文社区一TEA Community 开发的《TouchDesigner 与雷达触控交互设计》线上课程。在本节的教学基础上，更加深入雷达应用融合视觉艺术，将实际商业案例转化为软硬件结合的课程教学。课程不仅从可视化触摸数据、二维及三维交互检测多角度讲解触摸数据的提取分析，提供扩散反应、群簇流水等多种视觉系统的制作教学；还剖析不同雷达型号之间的区别,分享在多媒体互动项目中的雷达安装和调试技巧。  

![images/2dd4cc28a19f645b6b45dda17c19e5bd2d74da4c59255598e8a590f83938ca96.jpg](https://i.imgur.com/q0D32TB.jpeg)  
图 4-4-18课程真实效果  

![images/a8d47d8cf9eeccc355d79fcc3a0b26ff0442caf1a72a39947cabe88c773bf64a.jpg](https://i.imgur.com/gn4gGG9.jpeg)  

课程免费提供模拟软件及团队独家研发的“凌影雷达交互引擎”，学习者即使没有雷达硬件，也可以进行学习。  

![images/4bdffd852529eda3e8b6e4975dd0f790b23749daf01f06f1f08c0c9c777322f7.jpg](https://i.imgur.com/7lWlxHP.jpeg)  
图 4-4-19教学流程示例  

## 4.5 DMX 协议与DMX灯具

交互媒体艺术作品常常会应用多种多样的硬件以增强参与者的体验感，包括各种舞台灯具，如图4-5-01、图4-5-02、图4-5-03，以及数控电机、机械臂、激光投影等。其中，DMX是控制这些硬件的主流协议。  

DMX协议也称DMX512协议，最初是由USITT（美国剧院技术协会）拟定的灯光信号传输标准，是灯光控台与设备之间的标准传输协议；随着设备型号和种类的不断增加，DMX512协议逐渐在各类灯光机械装置及控制设备中被厂泛应用；在当下的舞台演出和展览展示领域，DMX512已经成为一个不可替代的通用协议。有了这个标准协议，硬件与软件之间可以实现无缝对接，交互模式也变得更加方便与简洁。利用集成的 DMX节点，TouchDesigner可以作为一个中枢协调多种硬件媒介进行演出和展示。  

![images/6a3769ece27a4193221b299db6e96de27740816861131f5d36839aa05c139d92.jpg](https://i.imgur.com/DGqbfXF.jpeg)  
图4-5-01舞台灯  

![images/35a363589cb09c90008f5e08ac6572cad735f3ca783c922af0fba23b149ce9a8.jpg](https://i.imgur.com/1Fpv2wG.jpeg)  
图4-5-03摇头灯  

![images/7b2d64f767ad7791a5e6627a85bdc028a82c123b451e3dddd21e8d2e0fdc6935.jpg](https://i.imgur.com/88wDiLU.jpeg)  
图4-5-02LED 灯带  

##### DMX512 协议和 Art-Net协议

DMX512协议定义了一个包含512个通道的信号集合，每个通道代表一个0\~255的数值。当我们将一个DMX512通道包发出时，接收端就接收到一个包含512个通道的数组，设备会从数组中选取相应通道的数值作为参数进行操作。  

DMX512协议每个通道包只支持512个通道，然而随着设备数量的增加，512个通道可能不足以满足需求，由此出现Art-Net协议。简单来说，Art-Net可以被视为多个DMX512通道包的集合体。在Art-Net中，使用名称Universe（域)来区分不同的 DMX512通道包。通过设置Universe 的值（如0、1、2.………N)，来分别对应第一个 DMX512通道包、第二个DMX512通道包、第三个DMX512通道包······第N个DMX512通道包。  

##### Art-Net控制器和卡侬连接线

有DMX512和Art-Net协议作为基础，我们需要Art-Net控制器和卡侬连接线作为硬件支持。  

Art-Net控制器（以下简称“控制器”）是一个“一进多出”的设备，在输入端通过标准以太网口与电脑相连，允许目定义IP地址；输出端为DMX卡侬连接口（一般有三芯和五芯两种规格，国内常使用三芯规格)。一个控制器通常配备4或8个输出接口，这些接口通过卡侬线连接到外部设备（如舞台灯）上，如图4-5-04。这样，控制器就可以将来自电脑的数字信号转换为适用于舞台设备的DMX信号，且可以控制超过512个通道，从而实现对灯光等设备的复杂控制。  

![images/104bdb047baf96dea9bd9487883a2968369f680d844d5d7a97062d5ead00e3d0.jpg](https://i.imgur.com/DkK1lNn.jpeg)  
图4-5-04设备连接方式  

### 实战案例: 点亮灯珠--用 CHOP 数据通道控制灯珠色彩变化  

本案例介绍如何将 4 条 LED 灯带通过串联的方式连接到控制器上，并使用 TouchDesigner 中 CHOP 生成的数据点亮灯带，如图 4-5-05。在本案例中的 DMX通讯逻辑同样适用于其他 DMX 协议硬件。  

![images/787fe93d80f932e3672b44ef033b39c85673d8cfe2353bca698e17991ee0cb07.jpg](https://i.imgur.com/QqMDYY7.jpeg)  
图4-5-05用CHOP数据通道控制灯珠色彩  

##### 设备接线及控制器通讯

如图 4-5-06，我们使用的控制器有 8个 DMX 输出接口，最多可以对应8个独立的 Universe。每个Universe 输出包含 512 个 DMX 通道，每个通道的数值范围是0\~255。  

![images/695cc32632ca2a22b25bf01ff3fd573dd44e46e8da2646b59483428ce888d2a8.jpg](https://i.imgur.com/0dNLGsY.jpeg)  
图 4-5-06Art-Net 转 DMX控制器  

本案例中的每根LED 灯条有 30 个灯珠，每个灯珠由r、g、b 三个通道控制颜色。也就是说，每根灯条会占用 $3^{\star}30=90$ 个 DMX 通道。数据通道的对应关系是：第 1、2、3 通道分别对应第 1 个灯珠的 r、g、b 通道，第 4、5、6 通道分别对应第 2 个灯珠的r、g、b 通道，以此类推（不同型号灯条的通道对应关系可能有差异)。当两根灯条串联，通道顺序也依次顺延，例如，第 91、92、93个通道分别对应第二根灯条第1个灯珠的 r、g、b 通道。  

首先，按示意图完成灯条的串联组装和设备接线，如图4-5-07、4-5-08。此时，灯条并没有亮，因为我们还未通过控制器输出控制信号。  

![images/a57e45fd61af82f9b279c5a6009f2cbcec0109a936269d9df7739e04100acd59.jpg](https://i.imgur.com/XOJMnVr.jpeg)  
图4-5-07接线示意图  

![images/9b38ebf22afaaee5546eff408a7bb442875d601b2738ee26099a1620c7991951.jpg](https://i.imgur.com/bAaFt5t.jpeg)  
图4-5-08接线完成的LED灯条  

##### TIPS  

RGB是色彩混合和生成的基本原理之一，因此，灯光设备通常使用R、G、B（红、绿、蓝)三种颜色的光来生成不同的色彩效果。通过控制不同强度的红、绿、蓝光的组合，可以创造出丰富的颜色和色彩效果，这种原理被称为加法混色。该显色原理在各种灯光设备中得到了广泛应用，包括LED灯、舞台灯光、电视、显示器、投影仪等。下图以下为灯带中一颗灯珠的显色原理图。  

![images/d307c636b8a644b1a9b86dc92cbc32dd4525bbb4eff273ac1b7bf382757ba3f5.jpg](https://i.imgur.com/win6ZLE.jpeg)  

在RGB模式下，当红、绿、蓝光同时发光时，它们会叠加在一起，形成各种颜色。通过调整每个颜色通道的亮度，可以混合出几乎所有的可见光颜色。  

>新建 Container COMP，将其命名为'container_DMX_Light，如图 4-5-09。在这个容器中，我们将通过建立TouchDesigner 与控制器的通讯、生成灯珠色彩映射通道、批量创建通道等步骤，控制多个灯珠的色彩变化。  

![images/6c4207828685f65abe8fa5dfa3a188d9dbd4d6bb0183628721d1c59d0dc457a0.jpg](https://i.imgur.com/wH9U6Qs.jpeg)  
图 4-5-09 新建'container_DMX_Light  

双击 进入'container_DMX_Light’，新 建 ConstantCHOP'constantl'，如图 4-5-10，作为简单的信号输入，连接一个 DMX Out CHOP'dmxoutl。将其参数面板的Interface 参数设置为 Art-Net，Universe 参数的默认值是0，此时，通过 DMX Out CHOP 的数据将传送到控制器的第一个DMX输出接口。  

![images/b9f2c8115109e824defc5e31e0ef96effe2041215de919e1f689e5d934b2d0bf.jpg](https://i.imgur.com/EOTORnq.jpeg)  
图4-5-10 新建Constant CHOP'constant1'  

##### DMX Out CHOP

![images/5ddb0cd65e3c0b24240ed42f55a7363db7b0b46359c85a3af1a928a8b817adf7.jpg](https://i.imgur.com/0vyI8YB.jpeg)  

Active（激活状态）：在打开时启动当前元件。  
Interface（接口）：EnttecGenericSerial通用串口，使用操作系统的串口写入数据；Art-Net将接口设置为此协议；SACN将接口设置为此协议。  
Format（格式）：选择每个采样包或者每个通道包。Routing Table（路由表）：DMXOut CHOP支持通过一个 DAT表格来对各类不同的参数进行设置。  
Device（设备）：从菜单中选择DMX设备。  
Rate（速率）：数据发送到设备每秒的频率。通常DMX512设备的最大刷新率为44Hz，建议速率小于等于44，这样更稳定。  
Net(0-127）（网络）：当Interface接口设置为Art-Net时，这里设置一级子网络编号。  
Subnet(0-15)（子网）：当 Interface 接口设置为 Art-Net时，这里设置二级子网络编号。  
Universe (0-15):当 Interface 接口设置为 Art-Net 时,这将设置Universe地址。  

##### TIPS  

控制器的输出口与DMX Out CHOP 参数面板的Universe数值的对应关系，可以参照硬件说明书设置。在默认出厂设置中第一个卡侬输出接口通常对应 Universe0、第二个卡侬输出接口对应UniverseI....以此类推。  

接下来需要设置控制器的IP地址，如图 4-5-11，设置当前设备IP地址为192.168.1.48（地址可以设置为任何网段，本章节我们选取了一个192 网段的 IP 地址)。  

![images/98df8c9e235ae3f96746c25e6cd46598920bbddc448021fe26c29bf3456ec0e8.jpg](https://i.imgur.com/pT6L7Td.jpeg)  
图4-5-11 指定控制器的网络地址  

下一步，我们将本机地址设置成与Art-Net同个网段，本案例中，我们设置本机地址为192.168.1.100（如果是第一次操作，具体设置本机地址方法参见第265页)。  

##### 给单个灯珠的色彩通道赋值

如图4-5-12，在'dmxoutl'参数面板的Network参数页，设置NetworkAddress为192.168.1.48，以指定数据的接收方为局域网内的控制器；设置LocalAddress为192.168.1.100，在电脑同时加入多个局域网的情况下，这样设定可以确定数据是通过哪个局域网发送的。设置完成后，TouchDesigner就和当前的控制器建立起通讯了。  

![images/4dc390f609168b7340b8e3ec1d1ba2fb452e5909b37d5131669e649883560dab.jpg](https://i.imgur.com/UPlNn7g.jpeg)  
图4-5-12‘dmxoutl'参数面板  

将'constantl'的第一个通道数值设为255，如图4-5-13，可以观察到第一根灯条第1个灯珠亮起红光，这是因为该通道对应第一颗灯珠的红色通道。  

![images/93cd8562cee8dca47b5c25bc9c3b82a6e4bc82e6411eea877f5a26bbc18213f5.jpg](https://i.imgur.com/kiWzAen.jpeg)  
图4-5-13第一颗灯珠的红色通道  

尝试设置'constantl'的前三个通道数值，可以验证通道与灯珠的r、g、b 通道的对应关系。在DMX协议中，通道顺序是不受通道名称影响的。  

![images/1fb75831f738327cffc1cd06457f1fd6b840fd5611b59413e91f7a5d0d0fc36a.jpg](https://i.imgur.com/e9xAxHF.jpeg)  
图4-5-14第一颗灯珠的绿色通道  

观察图 4-5-14以及 4-5-15 可以发现，我们将元件'constant1'中对应r、g、b 通道赋值，第一个LED灯珠相应亮起绿色与蓝色灯光。  

![images/86e9528c96ce1bd2597b03216a80161b8b677e4d3a3878e728cdb83f3b0fb3d2.jpg](https://i.imgur.com/AoVhx21.jpeg)  
图4-5-15第一颗灯珠的蓝色通道  

如图 4-5-16，当我们将第一颗灯珠的r、g、b三个通道同时点亮时，得到一颗亮白光的灯珠(红、绿、蓝三色叠加为白色)。  

![images/1c73212445308ffac009f09c68316d52111f3f8b6a5a8f1b1a733ecf443503e3.jpg](https://i.imgur.com/rBPZKAp.jpeg)  
图4-5-16第一颗灯珠发出亮白色  

如图 4-5-17，在 Constant 参数页 Name 0 处输入 chan[1-45],即将 45 个通道均设置为 255，这样可以点亮半根灯条的15颗灯珠，如图4-5-18；同理，如果生成90个通道，且通道值全部设置为255，可以点亮整根灯条，如图 4-5-19；如果将 360个通道全部设置为255，可以将4 根灯条一起点亮，如图4-5-20。  

![images/1cc5c0a650ab3fa79962fb227a661fe5d00d0d7396316e365a37210785fca544.jpg](https://i.imgur.com/u6Ki5IX.jpeg)  
图 4-5-17Constant参数页 Name 0  

![images/1f1f2c77e0da6777d23246c25fbb083baa7448a8bab414dd70195f9edc61c9cd.jpg](https://i.imgur.com/ljBTLkx.jpeg)  
图 4-5-18点亮半根灯条  

![images/bf06effb9cf38fc56f0a9157179b74129cf7ed10d68f0f67b8d280a25b95066c.jpg](https://i.imgur.com/NJ9MTP7.jpeg)  

![images/c57875755b8540114011001b713f4fcc4dd0394328147b686217ce98c4bef889.jpg](https://i.imgur.com/VIFuu3v.jpeg)  
图4-5-19点亮1根灯条  

![images/48e4a3372b3309091c8f25e4fec5613544d5cc7c1afadba568a109dcfcb08b6a.jpg](https://i.imgur.com/kCS8YfJ.jpeg)  
图4-5-20点亮4根灯条  

##### TIPS  

在 Constant CHOP参数面板中，我们可以用 Name[0-N] 的形式将多通道一起命名和赋值。在上述案例中，我们采用chan[1-180] 进行命名,意为创建180个同一数值的通道，命名从 chanl到 chan180。  

接下来，让我们尝试一个淡入淡出的效果。新建LFOCHOPlfo1，将其参数面板的Frequency（频率）调整为0.1，降低数值变化的速度，同时设置ChannelName参数，生成360 个通道,如图 4-5-21。  

![images/af7461a86d859c023d8b0fe098d874df6f8d7efb2e2e89fc4c79f009f4c50265.jpg](https://i.imgur.com/ypx6IND.jpeg)  
图 4-5-21设置通道名称和数量  

接着，添加元件 Math CHOP'math1'，在参数面板 Range 页将 From Range 设为（-1,1)，ToRange 设置为（0,255)，使'fo1'产生的所有通道数值都在0至255 之间，实现灯珠在全暗与全亮之间的过渡变化。用'math1′替代'constantl’，并连接到'dmxoutl'上。这样，4根LED灯条的亮度便随着lof1'的数值变化而同时变化，如图4-5-22、4-5-23。  

![images/d9d5fe778e2cd0bbf88225f50be50bcb152dc843c01e24150db87798f1f3a285.jpg](https://i.imgur.com/byE61Ez.jpeg)  
图4-5-22将数值重新映射  

![images/88e8acba1e7700202c46d0c085c9e5ff6957123cf0df495c3f6253752e518f03.jpg](https://i.imgur.com/wLXZvSY.jpeg)  
图4-5-23所有灯珠亮度一同变化  

#### 实战案例：控制灯光阵列—用 TOP 中的图像控制多条灯带变化  

上一个案例中，我们通过CHOP 生成的数据简单控制了灯光效果。接下来，学习如何使用 TOP 中的图像控制 LED 灯光效果，如图 4-5-24。  

![images/6f3e2ed7d3f20c1e1e715cf1cd264c86c900097ef4da1cece80794d973c9f7b5.jpg](https://i.imgur.com/PEMJ02T.jpeg)  

图 4-5-24最终效果  

##### 将TOP中的图像信息转为CHOP中的通道数据

>首先用图像点亮第一根灯条。在上一案例工程文件的基础上，新建 Ramp TOP'rampl，如图 4-5-25,因为我们需要控制 30 颗灯珠，在 Common 页将 Resolution（分辨率）设置为 $30^{\star}1$ ，之后连接 Null TOP'nulli。  

![images/1d6363199e89dab3954106c33a31110c1f101e18476f9ff68cf36eb218e30981.jpg](https://i.imgur.com/a9ocUOv.jpeg)  
图 4-5-25新建 Ramp TOP  

鼠标右键点击'null1'输出口，新建 TOP to CHOP'toptol'，获取图像的 RGBA 信息。在本案例中，我们不需要使用透明通道，也可以删除 Alpha 参数栏中的内容。如图 4-5-26，由于 DMX 协议每个通道的数值范围都是0 至 255，因此将'topto1′参数面板的 RBGA Units 设置为 0 to 255。  

![images/3eae714b616622026c09bf8bfc6bba2caa06268cdf38568038063be2155f3900.jpg](https://i.imgur.com/N2NmLJo.jpeg)  
图 4-5-26获取图像RGBA信息  

为了将'topto1'中的三根曲线上的采样点分别拆分到独立的通道，在'toptol'后连接 Shuffle CHOP'shufflel'，如图 4-5-27，将参数面板的 Method 设置为 Split AllSampleso  

![images/c63f7e600f78ecb8f1f32e52632b612c403c5fa6fe0718148540414544b82bd4.jpg](https://i.imgur.com/1LQEFYi.jpeg)  
图 4-5-27Shuffle CHOP.拆分通道  

##### 通道排序及数据映射

此时，观察'shufflel'中的通道顺序，会发现所有像素的红色（r）通道排列在最前，之后分别是所有像素的绿色（g）通道、蓝色（b）通道，即排序为r0、rl、r2.…gO、gl、g2..b0、b1、b2，如图 4-5-28o  

![images/1f17291d10d9fc63d1ce2e7683f8ae35cacc225251dc24c28de718cd2e2004a5.jpg](https://i.imgur.com/CzpiRfT.jpeg)  
图4-5-28默认的r、g、b通道排序  

![images/d2e96cbe79f6478fb71ab6cb75903fb31b85a0d19222a5acef65fa07ce0d3dda.jpg](https://i.imgur.com/ecKdT90.jpeg)  
图 4-5-29Reorder CHOP 重新排列RBG 通道  

根据此前对通道顺序的实验操作可以得知，我们需要让每颗灯珠的r、gb 通道相邻，即调整排序为rO、g0、b0,rl、gl、bl....·可在'shufflel'后 新 建Reorder CHOP'reorderl'，将其参数面板的 Channel Reorder Method 选择为 MergeN Groups，N Value 设置为 3。如图 4-5-$29\circ$  

![images/ebf33f31968bcff51d901875f8e14401a2d905002e295be91e3beb1884df2e80.jpg](https://i.imgur.com/O90mkho.jpeg)  
图 4-5-30排列前的通道顺序  

![images/09804feecb65fc336b852c2590ca416db8d6730eb6502806a6b8711472de2fe6.jpg](https://i.imgur.com/4f8y2og.jpeg)  
图4-5-31重新排列后的通道顺序  

此时，‘reorderl'中的通道已经按照我们的需求重新排列，如图 4-5-30、4-5-31。  

![images/9c57d7beeb71a64823292c9261b4224ebf8aeeeefb7b2a1c37105b19b3defdbe.jpg](https://i.imgur.com/QbsttnK.jpeg)  
图4-5-32第一根灯带中由暗到亮的渐变灯珠  

用'reorder1'代替'math1'，然后连接到'dmxout1'输入端。如图 4-5-32，可以看到第一根灯条显示为'rampl'中的渐变图像。  

![images/fb947fd61614758e53395ff8e9e5d32a904b2e4c1bf3dbc537f7306ac91781fd.jpg](https://i.imgur.com/o8VAUSc.jpeg)  
图4-5-33同时输出四根灯条的通道数据  

同理，想要同时点亮4根灯条，可以先复制出三组'rampl'到'reoderl'的组合，然后新建 Merge CHOP'mergel'，将4 个 Reorder CHOP 连接到'merge1′上,最后，用'mergel'代替'reorderl'并连接到'dmxout1' 上，如图 4-5-33。  

![images/8feebf4c6c87035b6098ac8c16131943723251614382b6a9dc114a77f5a966fa.jpg](https://i.imgur.com/t38NSWJ.jpeg)  
图4-5-34第二、四根灯条显示反向  

此时，由于第二、四根灯条的连接方向相反，因此显示的渐变图像也是反向的，如图 4-5-34。  

![images/b208250a4eb2802ae3578f2c0130bf770b8b48d2080575efe6bb096f14827ebf.jpg](https://i.imgur.com/30NMPp5.jpeg)  
图4-5-35水平翻转第二、四根灯条图像  

![images/edce46184f1322b9bb6172986561033fc2d6e561758150f6eba96bf751a5809d.jpg](https://i.imgur.com/TyWW4JC.jpeg)  
图 4-5-36所有灯条的显示方向均一致  

![images/6599b2319d6904a6495d22f47f75133eede9523445448e3b649a6c07ddbef7d7.jpg](https://i.imgur.com/BC5DwtN.jpeg)  
图4-5-37分辨率与灯珠数量对应  

![images/4cd214676d23450ed5856a5798cffc1861ee51575390fc5d5291b473a173d3da.jpg](https://i.imgur.com/mp9P8hg.jpeg)  
图4-5-38裁切出第一行像素  

在'ramp2、'ramp4'后分别插入一个FlipTOP，如图4-5-35,打开其参数面板的Flip×参数，实现图像水平翻转。  

这样，所有灯条的显示方向均一致，如图 4-5-36。  

可以看出，这4根灯条组成了一个$30^{\star}4$ 的低分辨率屏幕，我们可以用它显示任意完整画面。如图4-5-37，在编辑区空白处新建 Movie File In TOP'moviefileinl',导入任意图片或视频，连接FitTOPfit1，将fit1'参数面板的Fit设置为Fill（填充模式)，并在Common页将Resolution（分辨率)设置为 $30^{\star}4_{\circ}$  

接着，逐行切割图像。如图 4-5-38,在'fitl'后连接 Crop TOP'cropl'，将 CropBottom、CropTOP右侧的单位设置为Pixel (按像素裁切)，然后将 Crop Bottom设置为0，Crop Top 设置为 1，由此，获得底部第一行像素。  

同理，如图 4-5-39，复制出另外 3 个 Crop TOP,将'crop2'的 Crop Bottom 设置为 1,Crop Top 设置为 2; 将'crop3"的 Crop Bottom 设置为 2，Crop Top 设置为 3;'crop4'的 Crop Bottom 设置为 3,Crop Top 设置为 4。用 4 个 CropTOP 分别替换 4 个 Ramp TOP，可以看到导入图像显示在6 根 LED 灯条上，如图 4-5-40。  

![images/fc545e3308d2ecd4ba480098aafe1b2c9e2b02bfa0fa7c1682928461635824af.jpg](https://i.imgur.com/oQ5HEKK.jpeg)  
图4-5-39逐行裁切图像  

![images/491fa7a37a3a18a8a5536701aa2ab269193ce12e554073c2d7d562d9f3c61caf.jpg](https://i.imgur.com/sgZKeVM.jpeg)  
图 4-5-40灯条显示的图像  

由于灯条自上而下排列，而 TouchDesigner 中的行数是自下而上，因此，我们要在"fit1'后添加 Flip TOP'flip3"。打开flip3′参数面板的 FlipY开关，使图像上下翻转，如图 4-5-41。这样，灯光与图像内容就能完全一致了。  

![images/5857e834142e3b3bf739ba47d85a0912a12d00bef903329c3ab772dff9e977fd.jpg](https://i.imgur.com/cC4n3Nh.jpeg)  
图 4-5-41垂直翻转图像  

如图 4-5-42、4-5-43，可以尝试替换'fit1'输入端连接的任意图像，将'fit1'的 Fit 参数根据显示需求自行调整为其他模式。  

![images/55b19d630ebd68d872778a978541501a50c8e725ed65f45259afa5f396f6761b.jpg](https://i.imgur.com/qjIDMBV.jpeg)  
图 4-5-42灯条显示效果  

![images/12caeaf22c3c33eee36b08d73e5295d1054f318e59ff867f95066829763f5f4b.jpg](https://i.imgur.com/yc6ab3z.jpeg)  
图4-5-43灯条显示效果  

##### TIPS  

在实际情况中，我们可能需要使用多个灯带来组成一个更大规模的灯阵，以创造更为宏大的视觉效果。不管是小规模的艺术展示还是大型的舞台演出，使用多个灯带组合成灯阵是一种常见的手法，而其控制原理与上文所述基本相同，只是在配置和操作上需要稍作调整。以下是详细步骤和注意事项。  

1.规划灯阵：首先，要明确创建的灯阵的规模和形状，即确定需要多少根灯带，以及它们在灯阵中的排列方式。这有助于预先规划每个灯带的通道分配和信号传输。  

2.控制器和Universe设置：如果灯带数量超过一个Universe（512个通道）的容量，就需要将它们分配到多个Universe中。要确保控制器支持多个Universe，并将每个Universe的参数进行正确设置。  

3.信号分发：如果灯阵跨越多个物理位置，就需要考虑如何有效地分发DMX信号。这可能涉及多个控制器的使用，以确保每根灯带都能接收到正确的信号。同时，要注意信号传输的长度限制和信号衰减等问题。  

![images/12acc5db0558f20ef615819f5dbbcda323bfd884739228558a28e76b239facd3.jpg](https://i.imgur.com/UFOkPQa.jpeg)  

总的来说，无论是控制一个小型的LED艺术装置，还是创建一个大型的舞台灯光秀，灯带、摇头灯等DMX可编程灯具组成的灯阵，都可以通过类似原理在TouchDesigner 中进行控制。重要的是合理规划通道分配、信号传输和编程结构，以实现想要的视觉效果。通过灵活的编程和创意思维，可以将这些基本原理扩展到更大规模和更复杂的灯阵中，创造出令人惊叹的艺术和表演效果。  

## 4.6 Flipdot 磁力翻转片模组

Flipdot是一种创新的磁力片模组（以下简称“模组”），能够随意拼接成多种造型，展现别具一格的机械运动，因此广泛应用于舞台展演、互动艺术装置以及公共空间展示等领域，如图 4-6-01。Flipdot 巧妙地融合了机械与磁力技术，通过先进的MCU（微控制单元）精准操控磁力片的翻转运动，使得多个磁力片可以展现整齐一致的动作。  

![images/6a6691dad881bee4fec3305cb48bec666a942012c803fdcea422691f793350e6.jpg](https://i.imgur.com/P182cKq.jpeg)  
图 4-6-01用 Flipdot制作的交互作品  

Flipdot 采用了标准的DMX512 通讯协议（DMX512 协议讲解见第 234 页)，极大方便了模组控制，使设计更具灵活性，因此，我们可以使用 TouchDesigner 和 Art-Net 控制器对 Flipdot 进行编程控制，制作有趣的交互作品。  

### 实战案例: 翻转磁力片--用CHOP 中的数据通道翻转一个磁力片  

在本案例中，我们将首先通过 CHOP 中的数据精准控制单个磁力片的翻转，然后尝试在 TouchDesigner中将 TOP 图像信息转换成 CHOP 数据，从而使磁力片可以呈现我们想要的图像，如图 4-6-02。  

![images/56748f535abc8843282656af1986dbd0e87b4aa32d11d7ff455e197e8c2f9316.jpg](https://i.imgur.com/4Pp3qIc.jpeg)  
图 4-6-02在编辑区的最终效果预览  

在本案例中，我们使用的主要硬件为一个Art-Net控制器和一个 Flipdot 模组。  

这里我们选择有2个DMX输出接口的控制器，如图4-6-03。该控制器最多可以对应2个独立的Universe，每个Universe可以输出最多包含512个DMX通道的通道包（Art-Net控制器讲解见第234页)。  

##### TIPS  

2口ArtNet控制器可扫描下方二维码进入TEA商城购买。  

![images/e2dc921255188d3e5d7ab3ab534f02e3e293002acd78d708cebf7e56b242b73c.jpg](https://i.imgur.com/gCfhvdG.jpeg)  

![images/34b1264018c14f0cf3ce5d5e45214faacac3d48b8b876323b4045e505afcb07e.jpg](https://i.imgur.com/yS4ooQ9.jpeg)  
图4-6-032个DMX输出接口的Art-Net控制器  

案例中用到的Flipdot模组，有5列7行，共35个翻转磁力片，如图4-6-04。每个磁力片占用一个DMX通道，则一块翻转屏由35个DMX通道控制。翻转屏的通道读取顺序从左下向右依次为1、2·33、34、35，直到右上角的 $35_{\circ}$ 当输入的通道数值在0至120之间时，磁力片翻转至黑色面；数值在121至255之间时，磁力片翻转至彩色面。  

##### TIPS  

Flipdot模组可扫描下方二维码进入TEA 商城购买。  

<html><body><table><tr><td>DMX通道表</td><td colspan="3">35通道 （以通道1为例）</td></tr><tr><td>通道</td><td>通道值</td><td>功能描述</td><td rowspan="3">（断电拨码）</td></tr><tr><td rowspan="2">CH1</td><td>0-120</td><td>黑色面</td></tr><tr><td>121-255</td><td>彩色面</td></tr></table></body></html>  

![images/2267d366e97da885c776fd5035235b9a667043c452e675756ff630342f4c0117.jpg](https://i.imgur.com/DPZFlzn.jpeg)  

![images/147b1ebac300f64119fab97431793cd2af0b26b7846579ae2f9f3bcfc2605599.jpg](https://i.imgur.com/VusLbXX.jpeg)  
图 4-6-04Flipdot 通道排序  

##### 建立 TouchDesigner 与 Art-Net 控制器的通讯

>首先，按照如图 4-6-05 所示，完成 Flipdot 模组与 Art-Net 控制器的电源及信号接线。将 Art-Net 控制器的 DMXPort 1 输出接口通过卡侬线连接到 Flipdot 的 DMX In 接口，使我们可以通过服务器向控制器发送信号，从而控制模组;然后设置本机IP地址(设置本机地址方法参见第265页)，本案例将其设置为192.168.1.210。  

![images/0f2440fdd3eb2ec9c2ff3c187f0b8cf64130b100ea04c34e6f9af4c7ff78376b.jpg](https://i.imgur.com/obJhz2R.jpeg)  
图 4-6-05Flipdot 与控制器接线  

接下来，需要将控制器的IP地址设置为与本机地址同一网段。本案例使用的 2 口 Art-Net 控制器需要使用 IP配置工具来设置IP地址。打开IP配置工具ArtNet_Config应用，在 Network Interface（网口）栏选择与控制器相连接的电脑网口IP地址，如图 4-6-06，此处选192.168.1.210。  

![images/1bc9c3cdfb5920384785d237e5db77315cb1e10c9147fe40319bb5a8ba86f0ab.jpg](https://i.imgur.com/uD5bIZA.jpeg)  
图 4-6-06设置本机地址  

点击 Search device(查找控制器)，可以看到 DeviceList（控制器设备列表）自动出现已连接的 Art-Net 控制器硬件设备，如图4-6-07，选择该设备，可以看到右侧Device information（控制器信息）栏显示该控制器的相应信息。  

![images/096c53fc8f4a421b7b25e432d742c6734e0abd0f65459ac2a3170e51e4769051.jpg](https://i.imgur.com/xnNqL5C.jpeg)  

![images/05336a1f4b62b5de5b8aa494a9fd3ee96a982bb630e63d05058a665c692a91d1.jpg](https://i.imgur.com/cC0ztbS.jpeg)  
图 4-6-07在 Search device 选择设备  

接下来，在右侧 Configuration 栏将当前控制器的 IP 地址设置为与本机地址同一网段，这里设置为 192.168.1.131,点击下方 Save 保存设置。设置好控制器的 ip 地址后，需要检查电脑与控制器是否成功建立通讯。打开命令提示符面板，在命令提示符面板输入“ping”及控制器的 ip 地址，中间用空格隔开，如 ping 192.168.1.131，然后按回车确认。等待片刻，若出现如图4-6-08所示的反馈信息，则代表成功建立电脑与控制器的通讯。  

![images/fead8c52c2e58fb684c9ecfcd1e9a3c9a2a0396164b0fbf8f3c02c371ef18633.jpg](https://i.imgur.com/rbsHqT8.jpeg)  
图4-6-08 命令提示符  

##### TIPS  

mac用户在搜索栏中搜索terminal（终端)，执行相同操作，即可检测主机与控制器是否成功建立通讯。  

![images/e8d42efa7fbc0560890e316eede829663e5bfd2865f7b5ca0afd3b401a49a87a.jpg](https://i.imgur.com/JHzIjkk.jpeg)  

##### 翻转一个磁力片

设置好硬件间的通讯后，在TouchDesigner 编辑区新建Constant CHOP'constantl'，在“constantl’后添加 DMXOut CHOP'dmxout1',并将其参数面板的 Interface 参数设置为 Art-Net，如图 4-6-09。此时 Universe 参数默认为 0，对应第一个DMXOut卡侬输出口；在Network参数页的NetworkAddress中输入设置好的控制器IP地址。  

![images/c545635937596df6d0125eb3d3d8b1a1265c695525cdaebd1f6dc3cc23cf75c1.jpg](https://i.imgur.com/FKbFobD.jpeg)  
图4-6-09DMX地址配置  

此时如果将'constant1'的Name0改为 255（每个通道数值范围为0\~255)，就会看到Flipdot左下角第一个磁力片翻转至彩色面，如图4-6-10。  

![images/acc61353aa2aa55f2915d4977bf8258042094c05f81ef79b6e43632fe91b7170.jpg](https://i.imgur.com/Hqm70am.jpeg)  
图4-6-10翻转第—个磁力片  

给'constant1'增加一个通道，同样将其数值改为 255，会发现第二个磁力片翻转至彩色面，如图 4-6-11。以此类推，如果新建35个通道，每个磁力片将会根据它所对应的通道数值，做出对应的翻转变化。  

![images/9d48515ea8149610e0466c116b460a91ef72cc3a93cccf9c5275b54455b31406.jpg](https://i.imgur.com/P0fL6ZA.jpeg)  
图 4-6-11翻转第二个磁力片  

##### 将像素信息转换为通道数据

如果我们将 Flipdot 拼成矩阵，设计多个磁力片翻转，用 Constant CHOP 逐一增加通道的方法显然效率太低，也不够直观、便捷；因此，下面将介绍如何用 TOP 中的图像控制多个磁力片翻转,如图 4-6-12。  

![images/8ee1d8a73b454afbe1f1862b50ad88ae0ad2cc605d54e058b7d177dd15c6e7cd.jpg](https://i.imgur.com/4CeL4wi.jpeg)  
图 4-6-12工程预览  

如图 4-6-13，新建 Constant TOP'constant2'，由于一个模组有 5 列7 行，因此在其参数面板的 Common 页将Resolution (分辨率)设置为(5,7)。将 Viewer Smoothness (平滑模式)改为 Nearest pixel(邻近像素)显示模式，这样就能清晰地看到每个像素对应的格子。之后，在'constant2'后添加 NullTOP 'null'，并将其命名为"'image。  

![images/af080a198813f0c7349e38db3610a2335474617e7b83e494cb5b9d6bbfaa4b14.jpg](https://i.imgur.com/AYzA8zk.jpeg)  
图 4-6-13Constant2 参数页  

由于'dmxoutl'需要CHOP类型的输入，因此鼠标右键点击'image′输出口，新建并连接TOP toCHOP‘topto1。由于纯白色图片的r、g、b 通道数值是一样的，且每个磁力片只取一个通道信息，我们只需要保留一个颜色通道产生的样本组，因此在'toptol'参数面板中删除 Green、Blue、Alpha 通道参数的信息，只保留 Red 通道，如图 4-6-14。  

![images/01b505ff0aae3e7a978ae37735e7aaa7b880f37b5967b497e856618edec6389c.jpg](https://i.imgur.com/ztklIyf.jpeg)  
图4-6-14提取r通道  

在'topto1'参数面板的 Crop 页将 crop（裁切模式）改为 FullImage，这样整张图片的像素信息就被转换为 CHOP 类型的数据,如图 4-6-15。鼠标右键点击'topto1' 输出口，新建并连接 Shuffle CHOP'shuffle1'，在其参数面板将 Method(排列方式）改为Split All Samples(拆分所有样本)，将'topto1’上的每个点都拆分为一个通道。  

![images/b2a3c4a563872c121ae99d8ad0277f4ed42ee76dd731a0398e5bad8c090c8efb.jpg](https://i.imgur.com/JCAxcYD.jpeg)  
图4-6-15样本拆分排序  

由于r通道的数值在0至1之间，而 DMX通道所需的值在0至 255 之间，因此，我们在'shuffle1'后添加 MathCHOP'math1'，在其参数面板的Multi-Add 页将 Multiply（乘数）改为 255，这样就将通道由0至1映射到0至 255，如图 $4\cdot6\cdot16\circ$  

![images/dbbbdb0e4ffd59c94f0f4194f98c63c0a3100545a1fa344f60533be18b9cb0a2.jpg](https://i.imgur.com/pO83MFj.jpeg)  
图4-6-16数据映射  

最后，将'math1'连接至'dmxoutl'的输入口，这样就可以看到所有磁力片都翻转至彩色面，如图 4-6-17。  

![images/84d008e3942b57c49c04845fefc6d1a5f63fd7189aa41d1ad22aa0d39a1de9be.jpg](https://i.imgur.com/aw1QkGo.jpeg)  
图 4-6-17根据图像翻转  

保存后关闭工程文件，将其命名为“TD_DMX_Flipdot.toe"，方便后续实战案例使用。  

### 实战案例: 数字时钟—用 TOP 中的图像控制 Flipdot 模组  

每个模组都由多个小磁力片构成，如果将每个磁力片都看作一个像素，那么一个模组就是一块低分辨率的屏幕。接下来，我们尝试将 Flipdot 用作可以显示图像的屏幕，显示从0 到9这十个数字，如图 4-6-18。  

![images/ee237ddc6ab6043942df77657c33e6b636a643f5efcd5705944a20bed00b42d9.jpg](https://i.imgur.com/Gzy8T1s.jpeg)  
图4-6-18在编辑区的最终效果预览  

![images/d3b462c27af85bb27fbf83eb4901f5796b81fa6631818d602788a7679079d49e.jpg](https://i.imgur.com/U9QeJLd.jpeg)  
图4-6-19新建Text TOP  

>打开上一实战案例制作完成的“TD_DMX_Flipdot.toe”工程文件，进入编辑界面。在空白区域新建TextTOPtextl，在其参数面板中将Text参数改为2，使其显示数字2；并在Common参数页将Resolution（分辨率）设置为(5,7),对应 Flipdot 的 5 列7 行。将 ViewerSmoothness（平滑模式）设置为NearestPixel (邻近像素)，如图 4-6-19。  

![images/b4edc8f93242fd16adb91811be366c02f378af8b2e664140e875901bfc8169e8.jpg](https://i.imgur.com/62p5FRc.jpeg)  
图4-6-20修改文件尺寸  

由于文字尺寸过大，在低分辨率图像中显示不完整，因此在其Font参数页将Font Size×（文字尺寸）改为7，将自己喜欢的字体文件拖动到Font File，或更改Font参数，如图 $4\cdot6\cdot20_{\circ}$ 这样，我们就得到一个比较饱满的字体。  

由上文讲解可知，磁力片只有黑色和彩色两个面，对应的DMX通道范围分别为0至120和121至255。为了操作方便，我们仅使用0和 255这两个数值对应黑色和彩色面。在TOP中纯白像素的r通道值为1，透明像素的r通道值为0，因此，我们删除灰度处于纯白和透明之间的像素，鼠标右键点击'textl'的输出口，新建并连接ThresholdTOP'thresh1"(Threshold TOP讲解见第200页)，在其参数面板的Common页将ViewerSmoothness（平滑模式）改为Nearest pixel(邻近像素）显示模式，如图4-6-21。这样，我们就过滤掉灰色像素，将图片色彩通道数值统一成0和1。  

![images/0bec1b146b1a106921d9247ac4351cbe98389913cbc0b482d281e5eac6dae961.jpg](https://i.imgur.com/xp87A1v.jpeg)  
图4-6-21新建Threshold TOP  

由于图像转成 CHOP 类型数据的操作都是一样的，因此我们不需要重新搭建。复制上一个案例的"image’‘'topto1''shuffle1'和'math1'四个元件，然后将'thresh1'连接到'imagel′的输入口，将'math2'连接到'dmxout1l'中，这样Flipdot 就会显示与'image1 图像一致的数字 2,如图 4-6-22。  

![images/4c530c8d827b96c8b70472d7e0ea097492500d5e0911cfa207c85a887fe2a9b5.jpg](https://i.imgur.com/jjPYP2J.jpeg)  
图 4-6-22效果及工程最终预览  

##### 循环计数和自动切换

接下来，我们制作从0 到9 这十个数字的自动切换功能。新建 Timer CHOP'timer1'计时器元件，在 Timer 参数页将 Length (长度)改为 1，单位保持 Seconds (秒) 不变，On Done (当完成时) 选择为 Re-Start without Initializing 模式,依次点击 Init(初始化)按钮和 Start(开始)按钮，这样'timer1 就会以 1秒为单位循环计时。  

##### Timer CHOP

![images/f0435fd2b2956be5ef71365cd687e859f6d0f763a4c6089d0a183d154ada0b22.jpg](https://i.imgur.com/NWqT3aV.jpeg)  
图 4-6-23 设置计数频率  

Initalize（初始化):让定时器准备就绪，将计数器设置为零(延迟、定时器、周期、段)。通过打开 ready 通道来提示已准备好，等待启动脉冲。  
Start(开始计时):让定时器开始计数。Length (计时长度):设置计时器时长以及计时器的时间单位。  
On Done(当完成时):设置计时结束时计时器的下一步动作。  

![images/88e09fd3a1d6034ea70074cada5059a0fff7bfc778affb080af696624f1d6839.jpg](https://i.imgur.com/YSXwMQ7.jpeg)  

##### ICount CHOP

鼠标右键点击'timerl'输出口，添加 Select CHOP'selectl'，将其参数面板的 Channel Names 设置为 done。这样，每过 1 秒，done 通道值将会从0 变为1。  

接着，鼠标右键点击'selectl'的输出口，并添加 Count CHOPcountl'用于计数，它会累计输入端数值的增长次数，如图 4-6-24。由于我们要使'countl'输出的数字在0到9 之间循环变化，因此，我们在'countl'参数面板的 Count 页把 Limit(限制模式)改为 Loop Min/Max(在最小和最大值之间循环计数)，并把Limit Maximum（最大值）改为9。这样，每当 done 通道值由0变为1时，'countl'的值就增加1，并在0 到9之间循环。  

Limit(限制)：用于选择计数范围的限制方式，如循环、裁切。  
LimitMinimum（最小值）：设置计数器的计数下限。一旦计数达到这个下限,将停止递减。  
LimitMaximum（最大值)：设置计数器的上限。一旦计数达到这个上限，将停止递增。  
Reset(重置)：重置计数器的值。可以通过触发器或信号来操控此参数，以在特定条件下重置计数。  

![images/aa3a7cc09995a7981bb0d1c50da5c5bcbb3cb2771e7595768b3d8bd4129e5a80.jpg](https://i.imgur.com/tVcR3X0.jpeg)  
图 4-6-24设置循环计数的区间  

接下来，我们把CHOP类型的数据转换为TOP类型的图像。鼠标右键点击'cOuntl'的输出口，新建并连接CHOP to DAT'choptol'，这样就将CHOP 类型的数据转换成 DAT 形式；将'choptol'拖动到'text1'参数面板的DAT参数中，并删除Text参数中的预设文字，如图4-6-25，这样，就将'countl'生成的DAT类型数据转为TOP类型的图像。  

![images/5a54f712b26f03fa38199e7e21310b2b15465640dfe5515bcf583cd490059703.jpg](https://i.imgur.com/EeRpv7k.jpeg)  
图4-6-25用'countl'生成数字  

### 实战案例: 大型Flipdot阵列的规划及控制  

基于Flipdot模块化的特性，我们可以将多个模组连接在一起，构成任意形状的大型磁力翻转片阵列。本案例中，我们将制作一个5行6列，共30个模组构成的阵列，如图4-6-26。我们将通过规划多个Flipdot模组的排序、控制器和Universe 的设置、多模组阵列的信号分发、TouchDesigner中的TOP图像处理和数据映射，使一个蝴蝶图像呈现在这个大型磁力翻转片阵列上。  

![images/006568bbaa8aa42296b50832b49cb25eac2d6475f24071d8bb0f96441614d9ba.jpg](https://i.imgur.com/bABqqIa.jpeg)  
图4-6-26在编辑区的最终效果预览  

![images/964e072a19c0e42d01c1322bee83cd0a1d685a31e637efccab1eb763d3f639f6.jpg](https://i.imgur.com/q6ecOoy.jpeg)  
图 4-6-27将阵列划分三个部分  

这个大型 Flipdot阵列由横向 30、纵向35，共1050个磁力片构成；而在DMX512通讯协议中，每个通道包最多支持512个通道，不足以控制这1050个磁力片。因此，最优方案是将整个阵列划分为如图 4-6-27所示的三个部分，每部分连接Art-Net 控制器的一个 Universe，通过一个DMX512通道包进行控制。接下来，以第一部分，即红色标注的12个模组为例，讲解每个区域中模组的连接和排序方式。  

![images/a197502c4f46178b14bea384848723098b5235d26beb3b603a8006119c8fca57.jpg](https://i.imgur.com/Nsdtgot.jpeg)  
图 4-6-28将12个模组进行排序  

这 12个模组的所有磁力片共占用420个通道，其中，每个模组内的35个磁力片通道排序是固定的。为了使后续TOP 图像的裁切及数据映射操作更方便，我们按照从左至右、从下至上的顺序将这 12 个模组进行排序，420个磁力片对应的DMX通道顺序如图4-6-28所示。  

![images/a33b0361a012dec6791e89980068b87c035fb8c60ff62af1aa2bb6b57d5bcc74.jpg](https://i.imgur.com/zvrJ2Ro.jpeg)  
图 4-6-29拨码开关  

规划好12个模组的通道顺序后，我们需要在模组硬件上进行手动拨码。如图4-6-29，可以看到每个Flipdot背后有两个用于各模组间进行信号传输的白色信号口，这两个信号口均可作为信号的发送和接收端；旁边红色区域标有数字的开关，就是拨码开关。  

##### 根据Flipdot阵列裁切图像

![images/6ae1ca676b180b7c5bc21ea78e3163c301b7060c22ba2feb9ae3cdccadfcd3c2.jpg](https://i.imgur.com/0SxAcmp.jpeg)  
图 4-6-30导入相应尺寸的图片  

>为了使所有磁力片显示出一个蝴蝶形状，需要先准备一个分辨率为 $30^{\star}35$ 像素的白色蝴蝶图片（你可以自己制作，或下载本节工程文件，在其中的Image 文件夹获取，下载链接参见第41页)，使图片的像素位置及数量与Flipdot阵列中各磁力片一一对应。将图片拖入TouchDesigner 编辑区，如图4-6-30，可以看到自动生成了一个 Movie File In TOP。  

由于我们将Flipdot阵列划分成了三部分进行信号分发，因此也要将TOP中的图像裁切成三部分，进行相应的DMX通道排序和数据映射。如图4-6-31，我们以红色标注的两行共12个模组为例，首先将模组在蝴蝶图像中对应的像素区域裁切出来。  

![images/fb1593f62ed9d25a410c5c39de8bf1fca2b484f164ae36419dc049179b313050.jpg](https://i.imgur.com/w12sfAW.jpeg)  
图 4-6-31将图像裁切成三部分  

由磁力片分布及数量可知，红色部分的12个 Flipdot模组对应图像分辨率为$30^{\star}14$ 像素。因此，我们在 Movie File InTOP后面添加CropTOP'cropl，在其参数面板将所有参数单位改为Pixels（以像素为单位)，将 Crop Top 设置为 14，如图4-6-32。  

![images/0ee19ec7ba243cae3a41483bb3a229c164c0e6bc78670e4d78660d2068faeec6.jpg](https://i.imgur.com/FIHNXuO.jpeg)  
图4-6-32裁切12个模组对应的图像区域  

鼠标右键点击'cropl'输出口并添加Crop TOP'crop2'，如图4-6-33，同样将其参数面板的参数单位改为Pixels，将 CropTop改为7，这样就可以把 Flipdot阵列中最下面一行6个模组对应的图像区域裁切出来。  

![images/11ad269ac3b258e9ff2e401c33caa0b5dea3c539b4a01aba68d8be78da5e5b02.jpg](https://i.imgur.com/tZnalMp.jpeg)  
图4-6-33裁切最下面一行模组对应的图像区域  

接着，把这一行中每块模组对应的图像区域单独裁切出来。如图4-6-34，鼠标右键点击'crop2'输出口并添加CropTOP'crop3’，将其参数面板所有参数的单位改为Pixels，由于每个模块一行有5个翻转片，因此将CropRight参数设置为5。  

![images/75f71bef4cdeeb4e622bc839471d480b5bf8bd25211e83f80efd23b270de13cf.jpg](https://i.imgur.com/4MbJzl8.jpeg)  
图4-6-34裁切每块模组对应的区域  

同理，将'crop3'复制多次，可以得到'crop4′'crop5''crop6''crop7′'crop8',如图 4-6-35，将这些 Crop TOP 参数面板的Crop Left和Crop Right 分别设置为5和10、10和15、15和20、20和25、25和30。这样，就将Flipdot阵列最下面一行6个模组各自对应的图像区域裁切出来。接下来，要将这些图像重组，按照6个模组中所有翻转片的通道顺序进行排列。  

![images/20238fbeae27a367fa7a73dbd700481a8f4a7f42ca5928f5be2c75eec75cc2a1.jpg](https://i.imgur.com/3K9D93c.jpeg)  
图 4-6-35按通道顺序排序  

##### 通道排序及数据映射

在编辑区空白处新建 Layout TOP“layout1’，将'crop3′‘crop4′‘crop5′‘crop6′‘crop7′‘crop8'连入“layout1'输出口，将“layout1'参数面板的 Align (排列方式)设置为 Bottom to Top (从下至上排序)，如图 4-6-36。这样，输入的第一个图像就会被排到最下面，其余依次向上排列。打开 Scale Resolution（使用输入分辨率）开关，将输入分辨率相加，就得到一张分辨率为 $5^{\star}42$ 的图像。  

![images/1689e5b5b7af1bd0fd16a7831d02192cfa1a0081eac03a02bad1abd3dddc91bd.jpg](https://i.imgur.com/Mwn6aCe.jpeg)  
图 4-6-36重新排列像素信息  

![images/22f30f846c5ae0bfcfdd3be607146e0ca17942ec5c3359427edbbb3a3775a7ba.jpg](https://i.imgur.com/QTj8Cev.jpeg)  
图4-6-37将像素信息转化为通道数据  

鼠标右键点击“layoutl'输出口，添加TOP to CHOP'topto3'，删除其参数面板的 Green、Blue、Alpha 通道信息，只保留Red 通道信息，如图 4-6-37，并在 Crop 参数页将 Crop 参数设置为 Full Image。  

![images/75995f6a1d052f1e676c605bc4b90854d46709275dbebac580167b16e54a80cd.jpg](https://i.imgur.com/uxHbuFU.jpeg)  
图4-6-38将通道重新排序  

鼠标右键点击'topto3'输出口，并添加 Shuffle CHOP 'shuffle3'， 如图 4-6-38,在其参数面板将 Method 参数设置为 SplitAll Samples (拆分所有样本)。  

这样，就得到与 Flipdot阵列最下面一行6 个模组中的所有磁力片通道排序一致的通道数据包，如图 4-6-39。使用DMXOutCHOP进行输出，可以看到最下面一行模组显示了被裁切出的图像。  

![images/c6f8329f9e54dc6dd6241e4bec2136f2d60280857f7b0d48231ecec8939d343b.jpg](https://i.imgur.com/CwHk1Du.jpeg)  
图4-6-39裁切图像与模组相对应的效果  

选中从'crop2'到'shuffle3′的所有元件，复制一份，用于另一半图像的裁切重组和通道排序，如图4-6-40。此时，只需要将'crop9'参数面板的 Crop Buttom 改为 7，将 Crop Top 改为 14，即可得到与 Flipdot 阵列另一行6 个模组中的所有磁力片通道排序一致的通道数据包。  

![images/5ca37e0007a269d79e9222f815c480c162d3221f5de2eaedb48637cefc5a39b6.jpg](https://i.imgur.com/RIn4TgC.jpeg)  
图 4-6-40在编辑区的最终效果预览  

在编辑区空白处新建 Merge CHOP'merge1'，如图 4-6-41，将'shuffle3′和'shuffle4'连接到'merge1′的输入端;鼠标右键点击'mergel′输出口，添加 Math CHOP'math3'，在其参数面板的 Mult-Add 页，将 Multiply 设置为 255,通道值就由图像 Red 通道 0至 1 的数值范围映射到 0 至 255。这样，第一个 DMX 通道包的通道排序及数据映射就全部完成了。将'math3'连接至 DMX Out CHOP，设置对应的 Universe，可以看到 Flipdot 阵列显示出下半部分蝴蝶。  

![images/83eaf908b5355c8da94b7ba1167f82c74b0a5f60033312f9f32acdaef60c60d1.jpg](https://i.imgur.com/ie2fqOt.jpeg)  
图 4-6-41将通道排列到一起  

如图 4-6-42，对其余两部分 Flipdot 阵列的控制，复制两份从 cropl 到 math1 的流程，修改每组流程第一个 Crop TOP 参数面板的 Crop Bottom 和 Crop Top 即可。最后，设置DMXOutCHOP的UniverSe 参数，使之与Art-Net控制器输出接口对应，即可以向Flipdot阵列中对应模组传输DMX通道包。  

最终阵列效果如图 4-6-43 所示。  

![images/6ccbacf03a6938e04bfe3a8ddc207f1803265af62c09f4a4e92d151b576460fb.jpg](https://i.imgur.com/sCcMZ2k.jpeg)  
图 4-6-43Flipdot 阵列效果  

![images/5b1c3f73af542fd6713814c0414f01956798916e7080fb5dbe3c5a2684d359a0.jpg](https://i.imgur.com/zXiwUk7.jpeg)  
图4-6-42向对应的模组传输DMX通道包  

## 4.7 Touch In & Touch Out

商业项目中，我们常常需要将TouchDesigner中正在实时运行的画面数据和信息传给另一台电脑，如果这些电脑在同一个局域网中，我们就可以通过 Touch In 和 Touch Out 在两个 TouchDesigner 工程之间创建连接。  

### 实战案例: Touch In 与 Touch Out在 TouchDesigner程序内部的通讯  

我们先来尝试同一台电脑的TouchDesigner 内部通讯。首先，设置两个分别负责发送和接收的容器，待制作好发送和接收的内容文件后，可以通过导出.tox类型文件，轻松完成跨设备的传输，如图4-7-01。  

![images/4c4d856593c911614e3e63f4d53347e179cef287a0d27493ee1cff514ab4afda.jpg](https://i.imgur.com/65mF8fg.jpeg)  
图4-7-01在编辑区的最终流程预览  

$\rightarrow$ 新建两个BaseCOMP容器元件，并分别命名为'send'和'receive。其中，send'用于发送信息，‘receive'用于接收信息，如图 $4-7-02_{\circ}$  

![images/0ff13aa75131fbbcd51b85473c92cb33d114191215faf5886fc5d00a19487751.jpg](https://i.imgur.com/Flm7GzR.jpeg)  
图4-7-02在编辑区的最终流程预览  

![images/d56aa6cd2cdfc3c33b5bad29ddc49d5a3dddec6598e9a7a4a7393107029040f0.jpg](https://i.imgur.com/EGw3AV6.jpeg)  
图 4-7-03新建接收和发送端  

![images/3124332f2cf4753884f9f27d27132b7e6afdd19fb9791080886f8326af316938.jpg](https://i.imgur.com/93yClJf.jpeg)  
图 4-7-04设置Network Port  

![images/91a12124d562b671fe0ad87a553fc69de8786cf5a816b2f79795b54b38e22aa3.jpg](https://i.imgur.com/0MEzD8A.jpeg)  
图 4-7-05接收到图像数据  

![images/1bb66895dd45da8c44e7e76aadbf104fdc7c0e8077e3b482dd5f99c477ef0bd0.jpg](https://i.imgur.com/IaMKF0S.jpeg)  
图 4-7-06制作通道数据  

我们先来尝试 TOP类型的 TouchOut和Touch In。将操作界面分屏，左屏为'send’，右屏为'receive'。双击进入这两个 Base COMP,在左屏 /projectl/send层级新建Touch Out TOP'touchoutl'，在右屏 /projectl/receive 层级新建 Touch InTOP'touchin1', 如图 4-7-03。  

如图 4-7-04，分别打开'touchout1'和'touchin1'的参数页面，因为此次是本机内的通讯，所以应将接收端'touchin1'的Computer Name／IP（本机地址）填写为localhost。发送'touchoutl'和接收'touchinl'的 Network Port 一定要统一，这里初始数值为 9000，统一后才能通讯。此时'touchoutl'有报错提示，这是因为我们未指定需要传输的画面。  

如图 4-7-05，新建一个 Circle TOPcirclel'，并在其后连接'touchoutl'。稍候片刻，即可看到图像已经被传到'touchin1'里。  

接下来，我们尝试CHOP类型的Touch Out 和 Touch In。仍然在 /projectl/send 层级制作我们发送的内容。如图 4-7-06，新建元件 Noise CHOP'noisel'，打开其参数面板 Common 页的 Time Slice 参数，并在 Channel 页的 Channel Names 处输入 chan[1-5]，生成 5 个随机数据通道。  

##### TIPS  

Touch In TOP 和 Touch In CHOP的 Computer Name / IP 参数都默认为localhost，即默认输入的是本机IP地址。  

在元件'noisel′后新建Touch Out CHOP'touchout2’，在/projectl/receive 层级新建Touch In CHOP'touchin2'，可以看到'touchin2'已经接收到'touchout2'传来的数据了。  

此时，我们可以尝试将NetworkPort改成其他数字，如123，只要保持'touchout2'和'touchin2'的NetworkPort一致（且不和其他元件的NetworkPort重复），在本机上它们就可以正常通讯，如图4-7-07。  

![images/19a17004e02fcd868a1631b1f3e4030ed601a537be85e8de0e88c7c3ec55b3de.jpg](https://i.imgur.com/BE4eapi.jpeg)  
图4-7-07CHOP类型的发送端与接收端  

现在尝试DAT类型的TouchOut和TouchIn。同样地，我们先制作一组简单的数据用于传输。新建 Sphere SOP'spherel'，然后连接 Noise SOP'noise2'；新建SOP to'soptol'，再将'noise2'拖动到'soptol′上，这样就获得了'noise2'的顶点数据，如图4-7-08。  

![images/d477601d99b0742eb926a1f895d381f017193eab2b681f63be6ec6f0b8a13d7f.jpg](https://i.imgur.com/mp6Vo66.jpeg)  
图 4-7-08创建三维数据  

在'soptol′后新建Touch Out DAT'touchout3，同时，在/projectl/receive层级新建Touch In DAT'touchin3'，可以看到'touchin3'已经接收到'touchout3'传来的数据了，如图 4-7-09。  

![images/a7e2976f846318e7050f511ff6e8140393af2a7f69a9d694321d7950f0f75ff4.jpg](https://i.imgur.com/42EVr1M.jpeg)  
图 4-7-09DAT类型的发送端与接收端  

### 实战案例: 不同电脑间 TouchDesigner 的数据通讯  

尝试完三种 Touch In 和 Touch Out 的本机传输，接下来我们尝试跨机器传输。需要注意的是，跨机器传输必须保证两台电脑在一个局域网内。如何建立局域网呢？  

>第一种方法是将电脑都连接在同一个路由器上，采用自动分配地址的方式；第二种方法是将电脑都连在同一个交换机上，并手动配置IP地址。在项目实践中，我们通常需要手动设置IP 地址，从而避免在工程文件里对 Touch In 和 Touch Out 元件参数进行重复更改。如图 4-7-10 至4-7-15，介绍了PC电脑配置IP地址的方法。  

![images/61a34e9fd931f5e9cbea62ea659ed1e84b64b9f83b3ac8ddc2397bd23263d0a0.jpg](https://i.imgur.com/etiOTdZ.jpeg)  
图 4-7-10打开“控制面板”选择“查看网络状态和任务”  

![images/7ce3b46ea558c28ad211503c36f15da17742dcbbb9f8472de90e2ca5f7622a52.jpg](https://i.imgur.com/pQXo8T2.jpeg)  
图4-7-12在WLAN状态页面，点击“属性”  

![images/2f88cccd44ec63e413465661e03a9ef6b718e8c1c9a138077c33212575fa9fca.jpg](https://i.imgur.com/KUjXf6v.jpeg)  
图 4-7-11 在网络和共享中心页面选择“以太网”  

##### TIPS  

Mac电脑设置IP地址的方法与PC电脑设置的方法大同小异，具体方式可以自行上网搜索。  

![images/4318c8ed6e42cd0afeb9c1b4997c2627a52d9a352a95962f8bdf3e607fe9be63.jpg](https://i.imgur.com/aeJKWyC.jpeg)  

![images/77b6a8dd7e21fe4aa678a6678a9656bd9a6d63c244ef656f674323b85742ea0c.jpg](https://i.imgur.com/7HeZ6OK.jpeg)  
图4-7-13在WLAN属性面板选择  

“Internet 协议版本4（TCP/IPv4)”，并点击“属性”  

![images/d794ecbad2895f0437ff9a3bcda0a13e33c37f72d71079b24adfbba228e524aa.jpg](https://i.imgur.com/3ttLgA8.jpeg)  
图4-7-14填写第一台电脑的IP地址  

![images/bcbb3548189dd6544508d4c02100423e4b7c4708ce5de1ad4ab21986b81cfd03.jpg](https://i.imgur.com/4fy4SvM.jpeg)  
图4-7-15填写第二台电脑的IP地址  

我们在IP地址栏输入192.168.0.125（可以是由任意4个0\~255的数字组成的），子网掩码输入255.255.255.0，默认网关输入192.168.0.1（前三个数字和IP地址相同，最后一位数为1)，如图4-7-14。  

其他连接在交换机的电脑用同样的方法进行设置，IP地址最后一个数字可以按需填写，但是不能和其他电脑重复。需要注意的是，子网掩码和默认网关在各台电脑上必须相同。如图4-7-15，我们把第二台电脑的IP地址设置为$192.168.0.20\circ$ 这样就将两台电脑配置在一个局域网内了。  

在/projectl 层级单独保存'receive'为.tox文件，然后删除此项目里的'receive’，如图 4-7-16。  

![images/fddb45c92fcd45db6a7e3cabe9e02188176150bc9fb9ecddd93d0d20e3c6410a.jpg](https://i.imgur.com/K7utJHn.jpeg)  
图 4-7-16单独保存BaseCOMP  

用另一台电脑打开TouchDesigner，删掉里面默认的元件后，将receive.tox文件直接拖入操作界面，并进入‘receive'容器中，如图 4-7-17，可以看到此时它们并没有接收到任何信息，虽然NetworkPort已经设置好，但是Computer Name / IP 选择的还是localhost，所以尚未通过局域网建立通讯。  

![images/530003b0dca8fc5189244036da29251a835aea1a12a9a9957cfaf0b2938c213d.jpg](https://i.imgur.com/1Sq813A.jpeg)  
图 4-7-17 导入.tox文件  

因此，我们需要填入发送信息的电脑的IP 地址，在三个接收元件的 Computer Name / IP 后输入我们已经设置好的第一台电脑的IP地址，即192.168.0.125。  

如图 4-7-18，在输入正确的IP地址后，三个元件都接收到了信息。  

![images/7658223a1804a34e3fd537550074851b536c333927c99bfd32df196ac7e8fbb0.jpg](https://i.imgur.com/n3ZYICB.jpeg)  
图4-7-18填入目标电脑IP地址  

##### TIPS  

##### TIPS  

如果我们的两台电脑已经连接在一个路由器上并且配置好网络了，可以不用重复配置局域网，只需要查找发送信息的电脑的IP地址，然后将IP地址输入在对应TouchIn元件的ComputerName/IP后即可。查找电脑IP地址的方法步骤如下：  

(1)以PC为例，使用快捷键Win $+\textsf{R}$ 打开运行窗口，输入‘cmd'打开命令提示符窗口，再输入"ipconfig’;(2) IPv4 地址后的数字序列，即为本机的IP 地址。  

![images/020c488ea3e4bc3b66f49674135d7f7d063cd24f2c1a08f7f16b7f9b94e8f54a.jpg](https://i.imgur.com/iu9wk1i.jpeg)  

如果遇到连接问题，请确保已禁用Windows 防火墙。关闭方法如下：  

![images/323c789b6e8f18e086721e838b5703abff473ca3dab679d4f96994513d89f921.jpg](https://i.imgur.com/TnuPdDQ.jpeg)  

![images/cdaf7f8f21c66fb03a228321c98136d43e830fffba26b41cadee64b581bc364c.jpg](https://i.imgur.com/ODSg5JY.jpeg)  

打开“WindowsDefender防火墙”页面，点击“启用或关闭 Windows Defender防火墙”。  

![images/978b950a9b44c57b078f99a3f0e69d0b6729f22005a164553470bc1b10caded7.jpg](https://i.imgur.com/lcgrEcm.jpeg)  

在自定义设置页面，分别选择“专用网络设置”和“公用网络设置”的“关闭WindowsDefender防火墙（不推荐）”  

## 4.8 网络通讯 OSC 与 TouchOSC

OSC 全称为 Open Sound Control，是用于计算机、声音合成器和其他多媒体设备之间通信的协议。我们可以使用OSC信号完成TouchDesigner程序内部的简单信息传输。也可以很方便地和可以使用OSC协议的其它应用程序做连接。比较常用的是TouchOSCAPP，它内置许多完全模块化的控制界面，可以轻松自定义需要的UI 界面。我们可以通过使用 TouchOSC APP为 TouchDesigner程序做一个移动端的控制界面。  

![images/6450832c8a59f11a8a2dc0d33dbfe675c9509199d6ddc972378741ed7f3baeae.jpg](https://i.imgur.com/o7izzKP.jpeg)  
#### 实战案例：OSC协议在TouchDesigner程序内部的通讯  
图4-8-01在编辑区的最终流程预览  

在TouchDesigner工程文件中，我们在不同层级和路径之间会有各种元件的参数取值和赋值的操作，下面我们来尝试一下用OSC协议在不同层级之间进行数据的传输。  

>新建两个BaseCOMP元件分别命名为'send'和'receive。其中，'send'用于发送信息，‘receive'用于接收信息，如图 $4-8-0.2<$  

![images/27b099b68b12a9001c77aa6f610303095594893cf7770d97d47c506423acf220.jpg](https://i.imgur.com/2DYFHV6.jpeg)  
图4-8-02新建两个Base COMP  

元件 OSC In/Out CHOP 的通信方法与 Touch In/Out CHOP 的通信方法是类似的，不同的是 OSC 的接收端地址由发送端决定。因此将发送端和接收端 Port 端口号保持一致，设置 OSC Out CHOP 参数面板的 Network Address 网络地址为 localhost，即可完成本地传输。保持不同设备处在同一局域网中，Windows 系统下关闭防火墙，在 OSC Out CHOP的 Network Address 网络地址里填写接收数据的电脑的 IP地址，即可完成跨电脑传输。  

![images/eec545093d983f8664b31a9a4cd013030b17d69e58f6c2a028a9ddb366258bff.jpg](https://i.imgur.com/8K3LgqI.jpeg)  
图 4-8-03 OSC In/Out CHOP 的通信设置  

##### TIPS  

由于 OSC 是基于 UDP 协议，在默认的 Windows 系统设置中，防火墙可能会屏蔽部分未知的UDP 信号协议；因此很多时候出现传输问题，是由于开启了防火墙。可以关闭系统防火墙重试。  

CHOP 和 DAT 在 OSC 的传输过程中能互相转换格式，现在我们来尝试 OSC In DAT 和 OSC Out CHOP 的通信。如图4-8-04,在 /project1/receive 层级新建 OSC In DAT'oscin2'，设置 Port 串口号为 10000,使'oscin2'可以接收到'oscout1'的信息。由于传输的数据共有五组，因此将 Maximum Lines 设置为 5，并打开 Split BuNDIe into Messages 开关，使数据与捆绑的信息分离。  

![images/f5b6194b2633820019ffb7b0b404ca5c9af4454c86aae34aa8279275b1a285e9.jpg](https://i.imgur.com/jVLEx0G.jpeg)  
图 4-8-04 OSC In DAT 和 OSC Out CHOP 的通信  

##### TIPS  

与 OSC In CHOP 不 同,OSC In DAT接收到的数据会转化为一个个的字符串(str 类型)，如果在后续的使用中我们要接入 DAT类型的元件，OSC In DAT就可以很方便地将元件类型进行转换。  

我们尝试 OSC In/Out DAT 的通信，在 /projectl/send 层级新建 OSC Out DAT 'oscout3’，在 /projectl/receive 层级新建 OSC In DAT'oscin3'。为了和其他的 OSC In DAT 做区分，在操作界面按下键盘快捷键 C，左下角会出现一个颜色表，可以自定义元件框的颜色。  

##### TIPS  

![images/763b3517a42ed28087ea21cb652c14efc03ea01eecc5906bc0f8d774a8963998.jpg](https://i.imgur.com/BVZhjaH.jpeg)  
图 4-8-05更改元件框颜色  

只有在英文输入法的状态下，键盘快捷键才会有反应。  

新建Test DAT‘textl’，点击右下角的小加号，在‘textl’内输入一些信息，如图4-8-06所示，我们会发现‘osCout3”元件没有输入端。  

![images/30874a6afa7fcb7cbed18f1e5f939c715dce53e278b3988e49c2bd93c70833ca.jpg](https://i.imgur.com/7yfjKSA.jpeg)  
图4-8-06输入信息  

这是因为OSC OutDAT的用法比较特殊，需要特定的表达式才能传输信息，根据图4-8-04，可以看出'oscin2'接收的数据类型由一个固定的通道名称和数据信息构成。  

删除'textl'元件内的信息，在'textl'内输入以下代码msg $=$ ['TouchDesigner', 2024]op('oscout3').sendOSC(/Digital FUN', msg)  

指令解释：msg 后的中括号内就是我们需要的传输信息，字符串用引号标记，数字则不需要引号。‘oscout3'是数据发送器，sendOSC后的括号里是发送内容（第一个参数为发送数据名，第二个参数为对象数值）。  

##### TIPS  

和 OSC Out CHOP不同，OSCOutDAT 可以以字符串的形式发送（如：在上文中我们使用的'msg'作为变量名)和接收。对于 OSC 的命名规范，我们通常采用′/name'的形式。这也是不同设备之间通讯协议的规范。  

![images/e1eb8df99011d4523ec1ecea2c2d2cd5e16dfa6825683c6a4f4c85073b2b2b5d.jpg](https://i.imgur.com/VcxxCYG.jpeg)  
图4-8-07发送信息输入代码  

因为使用Text DAT通过代码发送信息，所以这里的元件 TextDAT和 OSC Out DAT 不需要连接起来。  

写好命令之后，如图 4-8-08，在元件'text1'的元件窗口上右键选择 Run Script 运行代码。如图 4-8-09，可以看到此时'oscin3'接收到了信息，其内容为：/Digital FUN"TouchDesigner"2024。  

![images/d5700942ee61292aaedd6854bf33cc4e6e17e0a9f2995df4c5095113e18249be.jpg](https://i.imgur.com/308geh0.jpeg)  
图4-8-08运行代码  

![images/41429f8440e03f0155b11c6cea2d5ef34c3c2be7729cff6d6284330bf1a0928d.jpg](https://i.imgur.com/ImrmTaQ.jpeg)  
图4-8-09'oscin3'接收到信息  

#### 实战案例: 使用 TouchOSC 和 TouchDesigner 通讯  

在尝试完成TouchDesigner程序的内部传输之后,我们可以开始试着使用OSC传输协议的其他应用程序与TouchDesigner通讯，比如移动端应用TouchOSC。  

![images/141b8431c8e3939a0cfc16602016f806eaee6814387b572b7daea45249bc66f5.jpg](https://i.imgur.com/Y4rdZA1.jpeg)  
图 4-8-10TouchOSC 图标  

我们可以在手机或者iPad上下载这个应用程序。首先保证应用程序所在移动端和电脑处在一个局域网当中(局域网的设置，参见第213页)，然后在应用里输入电脑的IP地址。如图4-8-11，点击页面第一行“OSC:Receiving only”进入OSC 设置页面；在 Host 后手动输入设置好的电脑IP地址，如图4-8-12。  

![images/7dba8b4921541b2448bdd607b4a08501b09a19722a41bbfdd17986e1d8045b04.jpg](https://i.imgur.com/ni1vMYx.jpeg)  
图4-8-11 TouchOSC 页面  

![images/3b47705742aa7628401b59d94829078a5cc0d3ef3ee23fdb482dcbc5a270c4e0.jpg](https://i.imgur.com/kGtDyBz.jpeg)  
图 4-8-12TouchOSC设置Host的IP地址  

##### TIPS  

TouchOSC是目前最常用的远程控制程序之一,其自定义的UI设计界面以及便捷的信号传输协议让移动设备和服务器之间的通讯变得极为简单。依托TouchDesigner现成的OSC接口元件，装有TouchOSC的iPad也成为众多VJ的首选控制器。下载地址:https://hexler.net/products/touchosc  

>新建Base COMP 并命名为'touchosc'，用于接收和发送TouchOSC 移动端应用的数据。  

我们先来尝试使用TouchOSC APP传输数据给TouchDesigner，在'touchosc'内，新建 OSC In CHOP'oscin1'，再更改 Network Port 为 8000，与 TouchOSCAPP 的Port(outgoing)保持一致。  

返回 APP 主页面，点击右上角的Done，我们就进入了UI界面，如图4-8-13，尝试拖动或点击界面中的模块，我们会发现数据发送到'oscin1'，如图 4-8-14。  

![images/f936a85fcf94cb3df2c651dafab55a01db3465f914c5c3c7f734cd4e0cd18595.jpg](https://i.imgur.com/TaSSkXc.jpeg)  
图 4-8-13TouchOSC 界面  

![images/db678a9211274d0cc7abae06914ff94933242e2908fee2dddb33c534a773f861.jpg](https://i.imgur.com/3FJG9yi.jpeg)  
图4-8-14电脑端接收到数据271  

如上页图4-8-14，我们发现在TouchOSC中每个模块都有自己的名称，我们可以在TouchDesigner中建立以模块名字命名的通道从而控制TouchOSC中的模块，使得TouchDesigner可以将数据反向发送给TouchOSC。尝试控制TouchOSC中最右边的模块1/fader4和1/toggle4，新建 Constant CHOP'constantl'，并输入新通道名称 1/fader4和 1/toggle4，如图 4-8-15。  

![images/faeb7549b43812031d2de18dc6a69f9e24974e180b27b8a0a67cb16abe112591.jpg](https://i.imgur.com/BsXsa7t.jpeg)  
图4-8-15设置数据通道名称  

如图4-8-16，在'constant1′后新建OSC OutCHOP'oscoutl’,在NetworkAddress参数内输入移动端的IP地址，以及输入对应的NetworkPort。如上页图4-8-12，我们可以看到移动端的LocalIPaddress为 192.168.0.155,Port (incoming) 为 $9000_{\circ}$  

![images/02ef7a6a5d253b4cb8a4a6a218daf66f6b2cc1cf1bf00bec00993aa202efc3dd.jpg](https://i.imgur.com/VhxoBgC.jpeg)  
图4-8-16新建OSC Out CHOP  

如图 4-8-17，此时拖动'constantl'的1/fader4或者 1/toggle4通道，从而控制移动端的1/fader4模块或者1/toggle4。  

![images/1511055ea14ccd8754b273aac4e1a30b1beabe1cfef3a5d4ebcd4fd0d8331b71.jpg](https://i.imgur.com/7AGey7o.jpeg)  
图 4-8-17拖动滑块发送信息  

![images/cd73883ee4952b230b82fbd4fa00e3b7ada8f2c01929c4a363b5cf2cff7b065b.jpg](https://i.imgur.com/lEK377J.jpeg)  
图4-8-18TouchOSC接收  

##### TIPS  

在TouchOSC中的每个组件都有自己的名称，这是因为在制作UI的时候可以自定义进行设置。在下一个案例中，我们会继续介绍TouchOSCEditor的使用，及其中的命名规则。  

#### 实战案例：为 TouchDesigner 中的图像制作移动端交互界面  

在熟悉以上操作后，我们将使用 TouchOSC 软件来控制在 2.5 章节实战案例（参见第 69 页）中制作的“小太阳”的配色、位置和大小。  

![images/44768c212a9d997bb6ff82d52799443dd4f735a5fa30eefceed137892aef82e4.jpg](https://i.imgur.com/8ZHP4yX.jpeg)  
图 4-8-19在编辑区的最终效果预览  

>首先打开2.5章节实战案例中制作好的“小太阳”工程文件（你可以自己制作，或下载2.5章节工程文件获取，下载链接参见第41页),我们先来制作图形的不同颜色。在原文件 的 Ramp TOP'ramp1'下,新建 4个 Ramp TOP 元件分别命名为'ramp2'\~'ramp5′，用以调整配色。新建Switch TOP'switch1'，将 5个Ramp TOP连入'switch1’，并打开Blend between Inputs，使切换变得柔和。并连接到原来的“lookupl'上,通过拖动Index可以切换图像的配色方案，如图4-8-20。  

![images/b6686343145ccb7f1bb032d8326fe2484285a6adced6f9408a60112b4f722cef.jpg](https://i.imgur.com/BrPXJHT.jpeg)  
图 4-8-20建立不同的配色方案作为输入端  

我们需要用移动端的触控位置信息来控制图形的移动，因此在'render1'和'null5'之间增加Transform TOP 'transform3'，如 图4-8-21。  

![images/9608828e89297a128a02d8264121a1fd2987f8f542d67885a8e0473f6a78da41.jpg](https://i.imgur.com/T6KZQms.jpeg)  
图 4-8-21新建 Transform TOP  

![images/b1b6b4f90231685113e805241a28386e3b5682c3d59549a9fdd67fb9be7c4485.jpg](https://i.imgur.com/AvruOg4.jpeg)  
图4-8-22选择设备类型  

在开始操作之前，我们来设计一个自定义的TouchOSC 界面。在TouchOSC 软件的官网下载TouchOSCEditor软件后，我们可以在电脑上设计模块的排布，然后上传到移动端的TouchOSC。  

打开编辑器页面，如图4-8-22，首先在Size下选择设备，它将按照设备的尺寸呈现画布。也可以选择Custom自定义尺寸。然后在Orientation 参数下选择界面是横向还是纵向。  

TouchOSCEditor自带许多不同功能的按钮。如图4-8-23，在画布上点击右键，分别选出XY pad、Rotary H、FaderV三种按钮，对应控制'POSITION、'SIZE、'STYLE’，更改它们的位置大小和颜色。右键新建LabelV为每个按钮添加名称标签，在编辑器左侧设置标签属性，不勾选Outline边框和Background 背景，在Text输入我们需要呈现的文字，在Size更改文字大小，如图4-8-24。  

![images/0009cfd2d639137480a911f152cf94e5f21c18d292b07dd58a1eb6dd34d26e57.jpg](https://i.imgur.com/sBS4sJ7.jpeg)  
图4-8-23按钮类型  

![images/27af3bcc9e9234de94a636602c01bc8609d9d3e597c0d610a7b4b06bffa48750.jpg](https://i.imgur.com/woOQIk9.jpeg)  
图 4-8-24Label 文字设置  

设置三个按钮的数据通道名称，分别选中三个按钮，取消勾选OSC：口auto，输入对应的通道名称/size、/position、/style，如图 4-8-25。  

##### TIPS  

Label按钮不携带数据通道，一般用作各个按钮的标签提示，除了Label，其他按钮类型都至少携带一个数据通道。选中某个带有通道的按钮后，我们可以通过左边的编辑栏更改按钮的属性，Name指更改按钮的名字；Color指更换按钮颜色；勾选OSC： $\sqsubset$ auto按钮，名字会自动生成，这个名字就是数据通道的名字，如果取消勾选auto，我们可以自定义命名通道名称；ValueRange是数据通道发送数值的范围，默认为0到1。  

![images/3b21a34ecbf7daed477c27c02ec9eabc689acf85fff1375077f0dfa1d626e52d.jpg](https://i.imgur.com/D0REJbN.jpeg)  
图4-8-25输入名称  

在制作好排布后，如图 4-8-26，点击上方工具栏左侧 Save保存文件并命名为'Control，然后点击工具栏右侧的绿色箭头 Sync 将界面上传到移动设备端(确保电脑与 iPad 保持在同一个局域网内，即在同一个 Wi-Fi环境下)。  

![images/6cf5bfc21ee975dc136b82cba44a0bc203f39825e340ca3d62648cba153e8f3b.jpg](https://i.imgur.com/1iL5dnV.jpeg)  
图 4-8-26上传自定义界面至移动端  

打开移动端的TouchOSC，输入电脑端IP地址。在首页进入到LAYOUT界面，点击最上方的Add添加新界面，在FOUNDHOSTS下点击要接收的设备。这样在电脑上设计的界面就被添加到了LAYOUT列表里，如图4-8-27。  

![images/6cb62c560d7448d5e172d89fa8d39e8f11733f42ebb346aa41c703c4dd84b386.jpg](https://i.imgur.com/fadNfpL.jpeg)  
图 4-8-27自定义的移动端UI  

新建 OSC In CHOP'oscinl'，更改 Network Port 为 8000，滑动移动端的界面，可以发现数据已经被接收。在'oscin1'后连接4个SelectCHOP元件，并命名为'selectl′‘select2′“select3"'select4'；选择Channel Names里的不同通道将4组数据分别取出，如图4-8-28，Renameto 参数中将新名字更改为更简洁的通道名字便于我们使用。  

![images/8bf5e35b14ac0ffb3a953912322562d2980ae9348c9f2b14822f9c74d44d7d14.jpg](https://i.imgur.com/MpuKqxU.jpeg)  
图 4-8-28用 Select CHOP 选取数据  

分别在每个SelectCHOP后新建一个MathCHOP，如图4-8-29，用于调整数据的范围。观察每组数据适合的范围，使用'math1' 的 'size'通道控制图像大小， To Range 更改为 (0.4, 1.4); 'math2' 通道数据'Py 控制图像的上下移动,To Range 更改为 (-0.5, 0.5); 'math3' 通道数据 ${}^{1}P x^{1}$ 控制图像的左右移动，To Range 更改为 (-0.5, 0.5);'math4' 通道数据'style'控制图像的配色方案的切换，To Range更改为 $(0,4)_{\circ}$  

![images/f953463e30d25dae89401b43e4fbbe06ceeeb2a4d57743aa4f9ca2e65c7cd659.jpg](https://i.imgur.com/E6aEDno.jpeg)  
图 4-8-29数据范围转换  

如图 4-8-30，将'math1'的'size'通道拖动到'geo1'的 Scale 参数上控制图像大小变化。  

![images/143479d8fd171866e17fdb0e74ccdaa524824e036db4e54f6046feeb65bb9819.jpg](https://i.imgur.com/vZNlq7G.jpeg)  
图 4-8-30对'geol'的 Scale 的变量进行赋值  

如图 4-8-31，将'math2'的通道'Py拖动到'transform3'的变量 Translate-ty上，这样就可以控制图像的上下移动;将'math3'的通道'Px'拖动到'transform3"的变量Translate-tx上，可以控制图像的左右移动。  

![images/03c0344095acb59599192f677604cc37824f6c0e7e6ad455dfeaff2fd387c9b5.jpg](https://i.imgur.com/ymrwspk.jpeg)  
图4-8-31对'transform3'的Translate变量进行赋值  

如图 4-8-32，将'math4'数据拖动到'switch1'的Index参数上，控制不同输入端的切换。  

![images/d690ae8da78d3c4dba367e63e3501b0cb2fb6a398585996f4fd8895b7a3812a6.jpg](https://i.imgur.com/IrHOJvc.jpeg)  
图 4-8-32对'switch1'的Index变量进行赋值  

至此，所有的数据映射已经完成。我们添加 Window COMP元件，并进行全屏播放(全屏播放方法，参见第 49 页)。全屏播放效果见图 4-8-33、图 4-8-34。  

![images/8f7ead6be6e091721be2726f79b3730d2fead9909b4088e187bd0cfeb01d772d.jpg](https://i.imgur.com/ckNr2T3.jpeg)  
图4-8-33 效果实景测试图  

![images/668996e2f0850facb2818c977ac888edbeab27a5dc7c21dfefd016d03e7323ef.jpg](https://i.imgur.com/JbTP8kz.jpeg)  

![images/8e61064ebb642faacf63b4c85d627033d92f332ba0ed68e7baf822a4a16322bc.jpg](https://i.imgur.com/BoBEj3g.jpeg)  
图4-8-34利用移动端远程端切换不同效果  

# 第5章 TouchDesigner 社区与资源  

TouchDesigner之所以能成为国际上首屈一指的视觉交互软件，与其广泛的商业基础和独具一格的社区发展密不可分。  

TouchDesigner的全球社区成员，充分利用TouchDesigner的强劲实力，用一件件作品征服着一座座视觉创意的高山，给大家带来全新震撼的体验；与此同时，分布在全球的各类社区活动和资源也在不断促进整个社区的进步与传播。  

如今，全球各地多个正在蓬勃发展的TouchDesigner社区，引l领着整个新媒体创意界的脚步。  

CHAPTER 5  

![images/11fd3ea2ae44d42ae12c6148c2aad24e2dbcb91074d23b53041295d54193c117.jpg](https://i.imgur.com/hOD2ICj.jpeg)  

## 5.1 新媒体艺术工作室  

##### Moment Factory

MomentFactory是一家多媒体工作室，掌握全方位的多媒体专业知识。团队利用视频、灯光、建筑、声音和特效等专业技能，为用户创造卓越的感官体验，恍如身临其境。其总部设在加拿大蒙特利尔，在洛杉矶、纽约、东京、伦敦和巴黎也分别设有办事处。自2001年成立以来，Moment Factory已经完成了超过400个独具一格的新媒体项目。  

![images/922114e41e1f61ca8339811f25f0167a9b3fb0be62d2c6803f514f8cca8913fa.jpg](https://i.imgur.com/DEyQAWB.jpeg)  
图5-1-01 Moment Factory 工作室  

##### 项目介绍

NINEINCHNAILS,TENSIONTOURINARENAS一—舞台巡演  

![images/50ee2b374830f54886c36044c5878a33312f30e6aed607f4ac6cd179e53f156f.jpg](https://i.imgur.com/CdfZwlM.jpeg)  
图5-1-O2NINEINCHNAILS，TENSIONTOURINARENAS现场  

2013年，NineInchNails（九寸钉乐队）委托MomentFactory用当时最前沿的视觉技术和互动特效来打造一个前所未有的巡演计划。项目使用TouchDesigner将音乐与观众的反应及现场氛围相结合，并进行数字可视化制作，利用冰屏将空间里的空气像素化，配合乐队工业感的音乐风格，打造出全方位的视听盛宴，书写了沉浸式音乐体验的全新篇章。  

![images/26b4ee9b7c6892325149a6730df7dfda916d47a45e41d023f04edfacb926ffc2.jpg](https://i.imgur.com/wRQn9Bl.jpeg)  
图5-1-03NINEINCHNAILS,TENSIONTOURINARENAS内容制作  

此项目是 Moment Factory 为韩国仁川的高级度假村天堂城打造的室内家庭主题乐园，充满了复古嘉年华的魔力和神秘感。乐园场景主要由灯光装置、互动影像以及创意视频构成，塑造了一个让游客身临其境的多媒体世界，为他们制造了一个奇妙的室内狂欢节。  

![images/2f967c74d4136ccb268bdc9b8be71cde832a778eda872c82740063914a6d4f84.jpg](https://i.imgur.com/IRCmdzD.jpeg)  
图 5-1-04 WONDERBOX AT PARADISE CITY KOREA 现场  

乐园内许多有趣的小型互动项目都是使用 TouchDesigner完成的，例如，利用 TouchDesigner 调用摄像头对现场进行实时改变的哈哈镜，可以用手势控制的魔法球，以及在占卜魔法中对人像的奇妙呈现，等等，如图5-1-05。  

![images/1a40ff199c174f042ff6b38fd28f9a66d1e9b55aa13ec2377750f127a1bb5e6c.jpg](https://i.imgur.com/LeSduLp.jpeg)  
图 5-1-05WONDERBOXATPARADISE CITYKOREA内容制作  

除了在商业项目上的运用，Moment Factory 也经常使用TouchDesigner来开发和实验各种交互体验项目，或者使用它来探索数字视觉艺术。作品 Painterly Light Sabre 将荧光棒做成彩色滴管，用户可以从色标中吸取一种颜色进行数字绘画，如图 5-1-06。作品 Under the microscope 展现了显微镜的微观镜头下人和模拟细胞的互动，如图 5-1-07。作品 Generative Typography in 30min 和作品 Generative void 是对生成艺术的探索，如图 5-1-08、5-1-09。 而作品 Facepointcloud 和作品 3D Face 通过深度图像处理，将人像处理为 3D 动画，并与舞台实时结合，展现了 TouchDesigner 强大的实时图像处理功能，如图 5-1-10、5-1-11。  

![images/70bfa4e98f3e24111fad6c835cd216a708ec21ca76edabc479491c9ddb706f03.jpg](https://i.imgur.com/xelRDGu.jpeg)  
图 5-1-06 Painterly Light Sabre  

![images/9460560d1e88ad5a76cd7f97bd0a3a5756cc2e77a2cab290c5a6596e01059f98.jpg](https://i.imgur.com/nxs7MYN.jpeg)  
图 5-1-08  Generative Typography in 30min  

![images/29f240cd39e3daee3ae27d69cf9d18565314ecb6fd4e9abd1363a3b979f15e02.jpg](https://i.imgur.com/tmJRPMg.jpeg)  
图 5-1-07 Under the microscope  

![images/25bd689ca25961d06b0cc2e86d24896e82016b63ab4661ec4a809e589c04725a.jpg](https://i.imgur.com/XTM7Nys.jpeg)  
图 5-1-10 Face pointcloud  

![images/87245616b4ff0e267e5a6b123f52ed168b18515aa8b4f6c08f8b0fbfc3d1ca2d.jpg](https://i.imgur.com/QEsYfcz.jpeg)  
图 5-1-09Generative void  

![images/e290e2e2dcaa5d423e12c93b3a92a4aa8769bd385ea4c54fd3df3925b30efeea.jpg](https://i.imgur.com/egVVJ4y.jpeg)  
图5-1-11 3D Face  

$\star$ 本部分作品信息及图片均来自 Moment Factory 官方网站:momentfactory.com/home，并已获 Moment Factory 授权。  

Digital FUN 创意交互新媒体工作室位于上海，专注于多元化的视觉创意设计，以及互动技术的应用研发，是一支不断在艺术设计与技术之间创造独特感官体验的团队。在各类演出和活动中，他们将概念灵感以交互投影、光影特效和装置艺术等形式呈现给观众。  

不同于常规的设计工作室，Digital FUN 更关注内容深度及大众的情感需求，所有的设计和演绎都旨在触动每一个参与者。2018 年创立至今，已为奥迪、宝马、大众、阿里巴巴、爱彼手表等众多品牌发布会、品牌活动、演唱会等定制了包括视觉特效设计、交互技术支持、音乐制作、导演执行在内的各类新媒体解决方案。  

![images/eef85c78eae221ed3bb1f742a52644f068140df8842d98e829c366331a9450be.jpg](https://i.imgur.com/pwD1zdg.jpeg)  
图 5-1-12Digital FUN 创意交互新媒体工作室  

##### 项目介绍

IT'S TIME- -一汽丰田 2023 发布会  

Digital FUN 工作室受邀为一汽丰田智能电混技术发布暨新卡罗拉上市发布会制作裸眼 3D 舞台展演，以裸眼 3D 屏幕为载体，结合数控灯光和真人实时面部捕捉等技术，在暖场倒计时、开场视觉、Logo 展示、车型技术展演以及出车CG 环节，整合 TouchDesigner、Notch、Unreal Engine、C4D、AE、D3 等全流程软件设计制作，同时借助 10K 分辨率的裸眼3D 屏和数百根数控灯管的硬件，完美演绎了科技艺术在舞台演出中带给观众的视听震撼。  

![images/1fd83888fcb1e9a4f0070bfe4effd8264fff9256bb1fedff4ce8a72963f94d45.jpg](https://i.imgur.com/me7Dfrq.jpeg)  
图5-1-13IT'STIME- 一汽丰田 2023发布会现场  


##### 《愿寄长风》一《长风渡》交互投影装置

2023年7月，Digital FUN 在 BilibiliWorld 盛会为广播剧《长风渡》打造交互投影装置。游客可以领取孔明灯纸样,在其上尽情用彩色蜡笔绘制；完成后，将灯笼纸样交由工作人员扫描，承载着游客们美好祝愿的孔明灯即被投影至万家灯火的场景中。本项目中，Digital FUN 承担全方位的互动方案设计，内研自主协同程序，以及高清扫描仪、激光雷达与工业级投影仪的通讯联动开发。  

![images/6c6cdebb11010f2d45b9d5a09689dac3fffcb041994a9d858d265baa2ce85d03.jpg](https://i.imgur.com/VfIjkIG.jpeg)  
图 5-1-14 游客领取孔明灯纸样  

![images/fcc0b45fa501915c686a8be2be04f8afeaae11e743c2abc3d9e8bfc5aeb2b3ac.jpg](https://i.imgur.com/vOIAsLv.jpeg)  
图5-1-15 在孔明灯上绘制图案  

![images/0577dd454e15952864e3f04369e594461a06396c9e89d8abd43b2490a18c09ca.jpg](https://i.imgur.com/3uXb03E.jpeg)  
图5-1-16 对绘画纸样进行扫描、处理、上传  

![images/802fa4b9c6eaf28e9bca3418430ce452521cf6fccf82102be6e632f0f14be42d.jpg](https://i.imgur.com/6mSJFhb.jpeg)  
图5-1-17 触摸交互，放飞孔明灯  

此作品旨在与观众共同创造艺术实验场所。这种充满趣味且极具互动性的模式，可以根据任何特定主题变化玩法，并开发各类形式的互动模式。如果在水族馆、动物园、城市交通、购物中心、科技展馆、时尚快闪等多种应用场景，还可以为其增加交流属性及话题性。  

![images/30a70958fa181aa2a8f9c7a723ae6fa7c75fa490c9a64362eece0b5098d336b5.jpg](https://i.imgur.com/GVak8Uc.jpeg)  
图5-1-18 《愿寄长风》 —《长风渡》交互投影装置  

##### 《光怪陆离》 一电影《盛夏未来》光影及视效设计

电影《盛夏未来》是导演陈正道的作品，2021 年七夕在各大院线上映。受华谊兄弟旗下美术组的邀请，Digital FUN参与了电影中电子音乐节和室内电音演出两个场景的动态视效设计。其中，音乐节环节结合了激光追踪的元素，将赛博宇宙、海洋漫游等场景用艺术化的手法表达出来，在三亚海滩边演绎了一场奇幻精彩的音乐节演出。  

![images/efbb3925408d0481dc231dba3f86148fc0e30ac568655b71666dfa6d7b35758e.jpg](https://i.imgur.com/SQ1UFqF.jpeg)  
图5-1-19电影《盛夏未来》中的音乐节现场  

室内场景部分，设计团队将长廊、门厅和酒吧演出空间作为新媒体视觉艺术的载体，把抽象元素、太空宇宙和符号化的构成组织成连续的视觉语言，将电影表达的人物情感和关系进行了隐喻的表达。  

![images/17b60c35a423df27b4a7679bf23d7caa8085c3e88f9155976154e38f69d62714.jpg](https://i.imgur.com/1eTr3FF.jpeg)  
图 5-1-20电影《盛夏未来》中的室内场景  

##### 《灵光一闪》 小米智能灯光秀

2020 年10月，DigitalFUN 受小米公司委托，研发打造了基于小爱同学的智能交互灯泡墙，落地于中国科学技术馆及梅赛德斯－奔驰文化中心。作为小米公司为数不多的智能艺术作品，工作室从视觉设计和技术研发角度出发，利用小爱同学开发平台，将系统植入云端，使小米手机和小爱系列音响可以直接成为和灯泡墙交互的工具，将照明灯泡转换为一件艺术作品。灯泡墙由近 2000 盏LED 灯泡组成，用户询问交互时，灯泡墙通过语音和像素视觉动画来回答问题。  

![images/55c21bc8cd585842817f2a0bd5afe783ba986eef5afd0729e79daf10ee6960c5.jpg](https://i.imgur.com/WDNit1e.jpeg)  
图 5-1-21《灵光一闪》—小米智能灯光秀现场  

Front Pictures 是一个由数字艺术家、创意技术专家和软件开发人员组成的团队，专注于舞台图形制作、互动装置制作、现场表演控制、软件开发和 AV工程制作。自成立以来，Front Pictures 创造了许多令人印象深刻的作品，代表作品有RainDance表演及韩国第一个球形投影剧院Space360的投影系统构建。  

自 2007 年起，Front Pictures 根据项目制作需求着手开发了多媒体通用制作工具一Screenberry 媒体服务器,于 2017 年将其作为独立产品推出。它集成了包括 TouchDesigner 在内的多个主流视觉制作平台，在投影融合、多设备输出、高分辨率视频播放处理等领域表现卓越，成为世界各地视觉艺术家和创意技术人员制作大型多媒体交互项目的工具。  

##### 项目介绍

Renaissance: the Age of Genius ——— 沉浸式展览  

Front Pictures 对一个 1400 平方米的购物空间进行改造，并设计了一个名为 Renaissance: the Age of Genius 的多媒体沉浸式展览。它用一台媒体服务器控制52台投影机同时进行图像投射。为实现控制器最优的性能和流畅的视频播放,Front Pictures 优化了软件和硬件设置。此外，他们还重新设计了 TouchDesigner 中的输出模块，并使用 Python 模块编写了一个校准程序。这场49 分钟的展览在推出后立即成为全城热议的话题。  

![images/494c2bba1b10c98b4ca6b71d17704415fd2887193f2dbdcdd59e7b79e111f0af.jpg](https://i.imgur.com/VpARWUd.jpeg)  
图 5-1-22 Renaissance: the Age of Genius 沉浸式展览  

##### Screenberry 媒体服务器

Front Pictures 根据项目规模不断扩增、需求日益复杂的现状而开发的 Screenberry 媒体服务器，具有丰富的自动化和媒体管理功能，其核心是一个高效的视频处理引擎。从永久性媒体设备安装到现场表演控制，Screenberry的应用十分广泛。此外，Front Pictures 将 TouchEngine 大规模集成到 Screenberry，使服务器可以很方便地搭配TouchDesigner共同使用。  

![images/daa2d87debfb941b32668b23c71aaaf54e2b1a554c40f59826ee8c8ddf388399.jpg](https://i.imgur.com/aZxblrl.jpeg)  
图 5-1-23Screenberry 界面及控制系统  

Screenberry 还拥有丰富的手动和自动投影校准工具，允许操作人员将图像扭曲以投射到各种复杂的物体表面,并在投影机的数量和位置发生变化时快速实现再次校准，为所有创作者开辟了新的可能性。  

![images/09f5693ed26e911e59df16a57a5606cfd8e8a5b108b18303a57f1dd379375bc6.jpg](https://i.imgur.com/y3WwXos.jpeg)  
图5-1-24360球幕的投影校准和项目搭建  

![images/b93d6b12d6c887130122809950c5b05942b69c86fe1e519e16e12173bb8864fd.jpg](https://i.imgur.com/rHV6mqE.jpeg)  
图 5-1-25球幕投影校准功能在TouchEngine 节点的实时输出  

![images/238f28311958c30969d8d9db2a79fcb73ce8b237ddc4d9a406e7fb633803f4b0.jpg](https://i.imgur.com/JnT6pfs.jpeg)  
图 5-1-26利用TouchDesigner进行球幕投影实验  

##### TUNDRA

TUNDRA 成立于 2013 年，是由 Alexandr Sinitsa、Klim Sukhanov 和 Semyon Perevoshchikov 组成的跨学科新媒体艺术工作室。TUNDRA 的艺术创作涵盖视听表演、音画互动装置、生成艺术等领域。  

##### 项目介绍

Nomad———激光与音画互动投影演出  

##### ROW—全息显示装置

Nomad的创作灵感来自 21世纪的数字游牧民族概念。TUNDRA 融合曾在巡演中使用的视听装置和算法，创作出独特的激光与声音交互效果。现场表演的声音会随机触发视觉主题和呈现模式，为观众带来丰富的视觉体验。  

![images/d7415b100b917ae32edea2a0795933722c33bc4eb86e9d7cf54af5f649336eda.jpg](https://i.imgur.com/UsLzAkN.jpeg)  
图5-1-27 Nomad现场  

装置由 10个排成一列的LED 全息显示器构成，可以通过三维影像，直观地展示声音的变化。TUNDRA 旨在通过 ROW探索信息、语言和对话三者的关系。数据就像可以随意组合的单词或符号，构成我们感知世界的语言。ROW将传递到装置中的数据处理为图像和音乐，以可视化的方式展示了声音、图像与空间的联系。  

![images/da7cdef936994f91bf252c42342e8943aa36c45461c767d719c4fa2b0261fed7.jpg](https://i.imgur.com/vEH2BPR.jpeg)  
图5-1-28ROW现场  

##### Radugadesign

Radugadesign 是由多位跨领域专家组建的新媒体艺术工作室，致力于通过多媒体、CG 和 Al 等领域的最新应用模式，构建高科技的表达方式。Radugadesign 已经完成了 500 多个项目，并有丰富的同国际品牌合作的经验，其创作领域包括视听演出、沉浸式空间、互动装置、生成艺术等。  

##### 项目介绍

##### 7—激光与音画互动投影演出

7由 Radugadesign 和音乐家 Alexander Zaripov 共同设计制作。项目成员认为 7是一个神奇的数字，于是为此设计了沉浸式的音画互动演出。7的主体部分由 7个 12 米长的LED 柱子、光束灯、激光和一个沉浸式音响系统组成，创造出 360 度环绕的声音效果。利用 TouchDesginer，Radugadesign 一方面通过提取音频特征信息来生成独特的视觉效果;另一方面统一控制所有激光的运动，实现灯光与画面输出的完全同步。  

![images/fd4df2ffe7251dbd3d8ba093137b6d6dbcc68631f3f692c30daa0b928bb283a4.jpg](https://i.imgur.com/e4sjE3R.jpeg)  
图5-1-297演出  

SPHERE3 视听装置作品  

Radugadesign 在 2022 年 Intervals 艺术节上展示了与音乐家 Alexander Zaripov 共同合作的装置作品 SPHERE3。$S P H E R E^{3}$ 由一个透明的LED立方体及其内部的镜面球体共同组成。  

在多国文化中，圆象征着无限和完整，方形象征着人造与技术；二者的结合形成了独特的文化符号，象征着身体与灵魂，物质与精神的和谐。内部球体通过反射，将 Radugadesign 为此装置量身定做的 CG 内容投射到外层正方形表面。  

![images/9ce8abd03529dafd35481ebeca48872b68bf7c5eca8092adbee58e3cf7cccc2f.jpg](https://i.imgur.com/Qt5UsOQ.jpeg)  
图5-1-30SPHERE3装置作品  

$\star$ 本部分作品信息及图片均来自 Radugadesign 官方网站：radugadesign.com，并已获 Radugadesign 授权。  

THINK AND SENSE 来自日本，是一家创意科技工作室。该工作室试图通过使用多种技术手段，从绘制框架到开发解决方案，在日益多样化的社会中展现自己的独特理念。  

##### 项目介绍

##### Stillness 2022——沉浸式展厅

THINK AND SENSE 以禅的概念为主题，通过禅寺内外高精度的三维扫描数据和声场录音，以粒子形式重构禅寺，让参观者可以一警禅宗世界的玄妙。其中，以白色为主题的视觉效果灵感来自云层，消除了参与者与影像的距离感；另一个以黑色为主题的视觉效果，模糊了参与者对物质存在与否的感知。作品通过两种视觉效果的切换，创造灵活的视觉体验。Stillness 以音画互动的形式将禅宗哲学中的思想升华为一场参与者可沉浸体验的可视化旅程。  

![images/bf16262375e921c8416a1efeca32f6a0c9c477738225554409e4c5c7ad405787.jpg](https://i.imgur.com/YwPaVXH.jpeg)  
图 5-1-31 Stillness 2022 现场  

Ryosokuin Multiverse Exhibition 2022通过使用丰富的通讯技术，实现现实世界和虚拟世界的同步，营造新的体验视角。其中，花艺作品TransienceofLife用特殊的3D相机定期拍摄花朵和树枝位置的微小运动，以触发其展示空间的视觉表达形式的变化，将具有时间性的插花作品进行了时空层面的再叙述，如图 5-1-32。Point-scape 装置艺术作品的整体场景是由在三维空间中的噪音算法创造的，展览以数字影像的方式再现了Ryosokuin的景观和声场，创造了新颖的视听体验，如图 5-1-33。  

![images/96e3065d28e26a0ac976ab52d7a28409a4e71523b50b717cd03406569129050e.jpg](https://i.imgur.com/oA45Ysw.jpeg)  
图5-1-32RyosokuinMultiverseExhibition2022展览作品TransienceofLife  

![images/d77824e775e750a7e76ec6cbd069b20ced180e2996e5b3dbafdf42b666d6a43f.jpg](https://i.imgur.com/kMrMkW8.jpeg)  
图 5-1-33Ryosokuin Multiverse Exhibition 2022 展览作品Point-scape  

$^\star$ 本部分作品信息及图片均来自THINK AND SENSE 官方网站：thinkandsense.com，并已获 THINK AND SENSE 授权。  

## 5.2 全球社区与活动

##### TouchDesigner 全球峰会

从 2018 年开始，Derivative 公司每年都会举办一次全球性的 TouchDesigner 开发者峰会。继 2018 年的柏林峰会后，2019 年8月，Derivative 与著名的新媒体科技音乐节 Mutek一起，在加拿大蒙特利尔市举办了第二届 TouchDesigner 全球峰会。作为国际新媒体界一年一度的盛会，TouchDesigner 全球峰会，旨在将全球TouchDesigner 社区以及开发者们聚集起来，为大家提供知识分享、交流合作的平台。  

参加峰会的有来自全球各地的 350 多位 TouchDesigner 独立开发者以及新媒体艺术团队，为与会者提供了超过21 场的顶级学术及技术演讲、45 场不同内容的专业工作坊，参与演讲和授课的嘉宾和教师超过 70人，其中包括来自WHITEvoid、Moment Factory、Leviathan、404.zero、University of Quebec at Montreal 等众多的艺术家、设计师、工程师及教育学者。在为期3天的活动中，200人的大型会议室每小时都会举行一场 45分钟的演讲；同时，工作坊为初级、中级和高级学员开放不同等级的课程培训。  

![images/5939f86b6881e1cd180cf981161eb7c52ae0da20e904984df97ab97be8bb6cb7.jpg](https://i.imgur.com/bFGc8ye.jpeg)  
图 5-2-01 蒙特利尔 TouchDesigner 全球峰会讲座现场 (图片来源: Sebastien Roy)  

晚上的节目更加丰富多彩。在颇受欢迎的“Open Beamers”活动中，任何参与者都可以连接现场的5个投影仪播放自己的交互作品，并和当晚的 DJ或VJ 合作进行演出，每个人都可以在这里了解彼此并获得放松。最后一晚的“Night Mode”更是将活动推向了最高潮，来自 Elemaun、Woulg、PRCDRL 和 404.zero 的顶级视觉艺术家们的新媒体表演，让所有人在蒙特利尔的夜晚享受到了一场视觉的饕餮盛宴。  

![images/1fb5a86393137f9f7ca2e3e3428549a3f8ea874a981de10e98aad1e8e3720e62.jpg](https://i.imgur.com/LWw4pNE.jpeg)  
图 5-2-02夜间交流与分享活动 (图片来源:Sebastien Roy)  
 

此外，与会者也有机会与Derivative 工作人员会面，分享创意想法、提出问题以及讨论近即将进行或正在进行的项目。在友好的环境中，大家能更好地进行讨论与研究，对于每一个与会者和工作人员而言，都是一次难得的相互学习与提升的机会。社区中的许多成员已经在论坛上相识多年，甚至远程合作过，但在峰会之前并未见面。第一次面对面的交流是一次难忘而有意义的经历，这也成为许多人有趣而宝贵的记忆。  

![images/8c592a3940e4dde601d5cdfe7552caaf712827fdc95687cfd2c15d79de81a21f.jpg](https://i.imgur.com/xG9xmhz.jpeg)  
图 5-2-03峰会期间举办的工作坊(图片来源：Sebastien Roy)  

最后，此次峰会还重点介绍了大量与TouchDesigner有关的现代工作流程和先进技术，这是每年最重要的技术分析与研究环节，也是让TouchDesigner能够一直紧跟国际新媒体技术脚步的原因。作为TouchDesigner的开发公司，Derivative 的相关负责人说道：“这次峰会最重要的是所有与会者、社群一如既往地展现着友善与慷慨的精神，在数字艺术中展现出的魔力不断感染着我们持续前进。”  

\*本部分内容来自活动主办方Derivative官方，并已获Derivative授权。  

##### TDSW

TDSW（Tokyo Developers Study Weekend）是日本最大的 TouchDesigner 社区，也是活动最为丰富的新媒体组织之一。自 2018 年4月以来，TDSW 每月举行两次线下见面会，迄今为止，已为超过700 名的爱好者提供了 13个专业工作坊，两次黑客马拉松（Hackathon）和两次大型新媒体爱好者沙龙聚会。TDSW 提供从初学者到高级应用人员的不同难度的工作坊，并涵盖一系列主题，包括音画互动表演、传感器、Arduino、同步直播、GLSL 以及其他与软件相关的介绍（包括 Houdini和 Substance Designer 等)。TDSW 讲师通常是 TouchDesigner 专业人士或日本艺术家。  

![images/c2038b41dfab6659b419089a0c051d59af4e6d6d70d909c9e17dd12303d5d875.jpg](https://i.imgur.com/n1iyW1D.jpeg)  
图5-2-04TDSW工作坊与社区活动  

作为最活跃的新媒体组织之一，TDSW已经受到许多日本公司的关注，赞助商包括日本互动机构DentsuIsobar，东京软银集团SoftBank，以及娱乐游戏集团 SEGA SAMMYHOLDINGINC.。赞助商从场地、资金、资源等方面为TDSW提供各类支持，让TDSW逐渐成为日本最有影响力的新媒体组织。目前，TDSW正在计划几个项目，包括一项实验性视频竞赛，获奖者的作品将在SEGASAMMY的巨大LED显示屏TUNNELTOKYO上展出。  

TDSW 不仅是工作坊的组织者，他们也一直在计划用最新的科学技术去创作新的艺术项目。TDSW 的总负责人Yuki Narumi 女士说道：“我们期待与使用 TouchDesigner 的艺术家和设计师合作，希望本书的读者去日本时可以联系 TDSW，一起交流学习 TouchDesigner。  

![images/f7bfff0f1fb3c62fec323e07d1e8e3350eca7b64af41f56852779d2c245132d1.jpg](https://i.imgur.com/D5VqRsO.jpeg)  
图 5-2-05TDSW 活动聚会  

$\star$ 本部分内容及图片来自TDSW 官方，网站：tdsW.cO，并已获TDSW授权。  

##### MUTEK.JP

MUTEK.JP 是 MUTEK Japan 的缩写，是一个享誉国际,旨在发展数字创意、电子音乐、视听艺术创意并传播文化和组织艺术活动的组织。作为顶级新媒体 IP MUTEK 的子品牌,MUTEK.JP成立于 2016 年，是MUTEKGlobal 在亚洲的唯一分支机构。起源地在加拿大蒙特利尔的 MUTEK Global，大力支持探索和开发与文化和艺术相关的人才，并致力于不断向世界传播相关知识。MUTEK.JP 作为分支机构，也是一个向世界展示本地和国际艺术家的平台，其任务是为艺术家提供交流和进步的环境。此外，MUTEK的所有成员都希望能帮助激发艺术家的灵感，创造无限可能性，为艺术家与观众之间建立对话的桥梁。  

MUTEK.JP 经常 举 办 TouchDesigner 工 作 坊，同Derivative 官方讲师以及来自 TDSW 和 backspacetokyo 等团队合作，举办基础课程，基础课程涵盖音频可视化和视觉交互。另外，在中级和高级的课程中，工作坊还引入了更多实用的内容，如可以扩展函数的会话反馈功能以及其他更复杂的TouchDesigner使用方法。  

考虑到语言差异，工作坊还提供英语、日语翻译。参与者可以从 Derivative 和日本客座讲师那里直接接受指导,这样的交流机会在全球任何一个社区中都非常宝贵，而MUTEK.JP完善的后勤体系也让日本的教学成为全球最有价值的 TouchDesigner 培训之一。  

![images/e8abb116dee04a3cf669ba112698819cbff578d844a77c4fc121a0af49d4ba87.jpg](https://i.imgur.com/LmRPUrJ.jpeg)  

图5-2-06MUTEK.JP 工作坊现场  

“TEA”是Technology科技、Education 教育、Art艺术的缩写，TEA社区旨在以普惠和开源的态度，自发性地创建新媒体艺术交流学习平台。  

TEACommunity新媒体艺术社区成立于2019年，前身是2015年成立的TouchDesigner中文社区。直至今日，TEACommunity仍是亚洲最大的TouchDesigner用户社区。各个平台常驻用户基数在十万人以上。并且在 Notch 和Unreal等领域持续进行看中文社区建设和内容输出。  

![images/89417072f2b9dc099184b2717d7b05c8dc541efc67c1a227945c9b92cfd32d1f.jpg](https://i.imgur.com/JmDxJpV.jpeg)  
图5-2-07TEA新媒体艺术社区LOGO  

##### 网络社群教育

TEA Community作为 TouchDesigner官方指定的全球教育合作伙伴，从 2015 年起就开始运营TouchDesigner中文社区。自 2016 年正式建站以来，TouchDesigner 中国官网（www.touchdesigner.co）是儿乎所有 TouchDesigner 华语区用户登录的第一个学习网站。网站发布了从初级至各类实战级别的视频教程，多达百余个。从最开始由社区成员的无私提供相关学习内容，到与 Digital FUN 交互工作室的紧密合作，再到与各国TouchDesigner 专业开发者合作和进行教程译制·..TEA Community 坚持为社区用户打造一个开源、分享、互助和非营利的全公益性交流平台。  

同时，TouchDesigner 中国官网还包含了 TouchDesginer 中文书籍、海外书籍翻译和相关外网资源链接，以及每年的TouchDesigner亚洲大会视频和工作坊录像资源等。  

![images/a73efe3bc1609bf1f85c120c6c8f2069689a92b9109feb9e1205f6cef20a7d89.jpg](https://i.imgur.com/AwS8Jye.jpeg)  
图 5-2-08TouchDesigner中文教程封面图片  

此外，为了让更多的中文使用者突破语言的壁垒，随时随地高效学习TouchDesigner，TEA Community自主开发了线上《TouchDesigner中文元件查询手册》，可以理解为TouchDesigner中文版本的百科全书，其中出现的检索词条，均来自本书中的元件注释以及TEACommunity成员的严谨翻译。  

《TouchDesigner中文元件查询手册》登录方式包括搜索网址和扫描二维码两种方式，其中网址为：https://userguide.tea-community.com。  

![images/a7c689fd227a89fba69b00482ca1cedfc20a9a76b82ff3d430bc75a7167a75af.jpg](https://i.imgur.com/yVojMM6.jpeg)  
图 5-2-09《TouchDesigner 中文元件查询手册》二维码  

为了让更多人通过不同的社交媒体了解到 TouchDesigner，TEA Community 除官方网站外，还开通了微信公众号、B站、微信视频号、微博、抖音、小红书、知乎、小鹅通等多个网络平台账号。  

TEA Community 为新媒体艺术行业打造了一个综合性社区，建立了包含求职、接项目、找人才、软件学习在内的网络社区平台。用户使用微信扫描二维码后进入社群，在其中可以交流、提问、共创团队等。  

![images/f82d9301261c4d4590c30b1fd9ca69239deecca444d4a5461299cfd058f5b82d.jpg](https://i.imgur.com/lx7TpkE.jpeg)  
图5-2-10Q&A问答圈子  

![images/5b34611f4079edf3ca34d12c28f64de0d2708c22d7874cbb2e7fb394cc36ac81.jpg](https://i.imgur.com/KF5TVSA.jpeg)  
图5-2-11求职、招聘、合作圈子  

此外，该社区关于 TouchDesigner 的微信技术讨论群已有将近 2 万粉丝。社区成员不仅能在各个网络平台获得学习资源，同时还能展示自己的作品，更重要的是在 TEA Community 的圈子里有机会找到志同道合的学习伙伴、合作商以及供应商伙伴。TEA Community 正同 TouchDesigner 中文社区一道，成长为亚洲最大的交互新媒体专业用户社区之一。  

##### 助力行业交流及企业业务拓展

为推广新媒体艺术教育，TEA Community 一贯坚持与教育、商业领域中的引领者进行深度合作。 TEACommunity 作为 TouchDesigner 官方指定教育合作伙伴，与国家艺术基金会、深圳光美术馆、王小慧美术馆、爱普生等多个艺术机构、企业及文化组织进行了广泛的艺术科技领域的授课和交流，并受邀在阿里巴巴U设计周、小红书设计周、751 北京国际艺术节、abC 艺术书展等文化活动中为艺术设计爱好者开设工作坊。  

![images/5f05d87481fd3494cb9c86f537f1006b69eda372de36d7a379cd05e13b3f59c0.jpg](https://i.imgur.com/vTXCi9m.jpeg)  
图 5-2-12国家艺术基金2023 年度艺术人才培训  

![images/b816073c8d621e9aa26beba5252fe19119eb841543d5ff0bea709b5cc810a724.jpg](https://i.imgur.com/XsIQaBD.jpeg)  
图5-2-13阿里巴巴U设计周  

![images/e12bd58f6515320d1c2f717808ea2af42ef7738e5d854f513d32a77b89c4a1bc.jpg](https://i.imgur.com/GPiCG8x.jpeg)  
图5-2-14小红书设计周  

![images/e2a258fa7204e917547b0ad90a5bc328cecd4832866f1626557ad8ac3534eedf.jpg](https://i.imgur.com/6Ndy07v.jpeg)  
图5-2-15751北京国际艺术节  

##### 高校教学合作及实验室搭建

为了促进新媒体艺术的产、学、研融合，帮助高校培养以 TouchDesiner 为主要工具的多场景、多功能、多应用的专业人才，目前，TEA Community 在学术上与国内外各大高校紧密合作，已在华东理工大学建立产学研培训基地;并在哈佛大学、清华大学、中央美术学院、复旦大学、同济大学、厦门大学、香港科技大学、广州美术学院、西安美术学院、上海科技大学、武汉理工大学、澳门科技大学等高校开展新媒体艺术系列讲座和 TouchDesigner 教学。  

![images/76aeb83e84f989820dab1938d68024efa390e34c570e9d64acf3276fe869fb9b.jpg](https://i.imgur.com/ZXIq9YE.jpeg)  
图5-2-16厦门大学·暑期联合工作坊  

![images/bc4266fbc0585d6503e375829df6f32f3846fd114bf327babd00fbaddf557a16.jpg](https://i.imgur.com/U7Q8T0X.jpeg)  
图5-2-17澳门科技大学·艺术大讲堂  

在为高校举办讲座和短期工作坊教学的同时，TEA 也提供基于 TouchDesigner 的课程及实验室解决方案。通过理论讲授、案例演示和课堂实操练习等多种途径，提高学生利用 TouchDesigner 进行音画互动、交互影像、移动端控制、体感互动、灯光互动、雷达触控、互动装置、三维投影等主题学习和创作的能力，从而让学生掌握实时交互的专业开发技能，适应虚拟与现实相互融合、人工智能技术蓬勃发展的社会现实。目前，深圳大学、北京电影学院、厦门大学等高校已实施本课程方案。  

![images/9102ba3e7de34202e1217b3c990ac175c8aa3efccadc2046cfcfd55f3e972d67.jpg](https://i.imgur.com/cY3t1BZ.jpeg)  
图 5-2-18教学安排及实验室搭建服务  

##### 集学习、实战、交流、资源整合为一体的 TouchDesigner 线下创作营

随着 TouchDesigner 学习者的不断增加，及其软件影响力的增长，越来越多新加入的伙伴希望拥有更专业和系统化的训练机会。在 2019 年末，TEA Community 正式推出了线下的创作营活动，将交互技术、视觉设计、平台交流和行业实践相结合，帮助新媒体爱好者更深一步探索完整的数字艺术产业以及技术应用模式。  

![images/c716d76975d240ec91d0142efb5ce34b75c1445485a647ee3a5a7b4fe8b8f49b.jpg](https://i.imgur.com/Wp1UuvS.jpeg)  
图 5-2-19  TouchDesigner 线下创作营  

围绕学以致用、实践出真知、让创意和商业从业者更加紧密合作的诉求，创作营课程的及教学大纲从零基础教学入手，以实战案例和商用工业级互动设备为载体，在一周的时间内为每位学员打造一个融专业技能、商业、艺术为一体的知识体系。  

![images/8c7c0e1da1893410b61b55e49edc2603a8cdaceb937020e6fa36acbba47e8265.jpg](https://i.imgur.com/OF8TtCf.jpeg)  
图 5-2-20光点梦想夏令营课程现场  

参加课程的学员有大学教师、设备供应商、舞台设计从业者、建筑设计师、音乐人、学生、VJ师、策展人·…….在这里，大家不仅可以系统学习商业项目搭建的技能知识，而且可以从创作和参观的过程中得到灵感，还可以结识拥有同一个梦想的伙伴。  

![images/6045b20e61727d4cea0691941cf182f5598f52e47827bbcf9bd74bf5b714b0bb.jpg](https://i.imgur.com/ze6b8cp.jpeg)  
图5-2-21光点梦想夏令营合影  

在创作营活动中，TEA Community会不定期举办《环状有机》音画互动演出。主办方邀请行业内知名音乐人与创作营成员一起创造一场交互新媒体演出。在见证自己学习成果的同时，享受科技与艺术带来的乐趣和启发。  

![images/1349cff90bcea856ebe941d5354928d1d6a4f774bbce7fd9bd719f3475d19326.jpg](https://i.imgur.com/Vy9XPyq.jpeg)  
图5-2-22《环状有机》演出现场  

在 TEA Community 官方网站的“教育服务”中可查看更多TouchDesigner 线下创作营的相关内容。课程网址:http://www.tea-community.com/edu  

![images/851653fae4e181b8caed91f10f8ba2b8f827570b824ec8826f14fd1c3a71273f.jpg](https://i.imgur.com/G5KcQ4M.jpeg)  
图5-2-23TEACommunity官方网站  

$\star$ 本部分内容及图片来自活动主办方TEACommunity，并已获TEACommunity授权。  

##### 光点国际新媒体艺术节

光点国际新媒体艺术节是由 TEA Community 打造的新媒体艺术IP，旨在利用国际学术资源和专业领域的积累，与全球各地的新媒体艺术家及团体协同合作，进发出时下先锋的创意理念。  

![images/9bc6cf71343f4c555371f9dc9ebedc1e2699edfe07487f1ef0ef3c5c969cf5e0.jpg](https://i.imgur.com/ttk12TD.jpeg)  
图5-2-24光点国际新媒体艺术节历年海报  

![images/66b7b1f17089e910860495ff30cf69c98c749f15117e5ac25083b3768dd69d71.jpg](https://i.imgur.com/ooN8K5g.jpeg)  

光点国际新媒体艺术节始于 2018 年，在 TouchDesigner中国社区成立三周年之际正式启动。每年的艺术节都会吸引海内外的大量爱好者，从第一年的数百人到第四年的数万人，光点国际新媒体艺术节用专业的态度和坚定的信念吸引着一批批人加入科技艺术的领域中来。  

每年的光点国际新媒体艺术节都包括 TouchDesigner亚洲峰会、TouchDesigner 工作坊、沉浸式音画互动视觉秀、新媒体线上和线下展览等四大板块。其中，TouchDesigner 亚洲峰会由中国 TouchDesigner 社区主持，每年邀请全球具有代表性的艺术家、设计师、工程师和加拿大总部Derivative 的官方人员参与讨论。话题涉及创意、技术、未来发展等，和新媒体爱好者从不同角度一起探讨交互新媒体的无限可能性。  

![images/a9c459f5c8a2eb9ee210fd9fbf8b3a320d2a46314891e2a8d7b17923f179a8a2.jpg](https://i.imgur.com/Ut6jXYQ.jpeg)  
图 5-2-25 光点国际新媒体艺术节 TouchDesigner 线下论坛  

![images/956cd7021c795c4a2d153c6c9c60a84769fa235fe97830ba42c971a1a604d6d0.jpg](https://i.imgur.com/GWBzoVi.jpeg)  
图5-2-26光点国际新媒体艺术节TouchDesigner线上论坛  

TouchDesigner 工作坊是TEA Community每年为普及新媒体交互应用的公益活动之一。工作坊一般田Derivative或者TEACommunity的专业讲师进行指导教学，与大家现场讨论。自2020年初至今，工作坊转由在中文社区官方线上平台进行，通过TEACommunity的线上直播渠道和所有爱好者们进行交流。  

![images/9710a23debf0fd3c91a5fa900d9e34b5c6e073f025a7e60f8432ebadbeb49f75.jpg](https://i.imgur.com/Nf6lN1d.jpeg)  
图5-2-27光点国际新媒体艺术节TouchDesigner线上工作坊  

沉浸式音画互动视觉秀《FLARE》是每届艺术节进入最高潮的一个标志。作为主办方，TEA Community每年都会成立专职导演组进行艺术节的演出设计和落地执行。同时，社区里来自不同领域的伙伴都会给予艺术节在硬件、软件、专业场地等各方面的支持，更有代表业内最高水准的电子音乐乐队加入演出。每年的演出活动不仅仅是新媒体行业内的一次盛大聚会，更反映着社区互助与协作共创精神在这片土地上不断生根发芽。  

新媒体线上和线下展览是与光点艺术节演出相伴的活动。新媒体艺术家将展览作品通过线上或者线下的方式展示给观众。从线下的机械臂、大型装置投影，到线上的全球艺术家大展和 NFT艺术作品，TEA Community 从不同方面向大众展现新媒体作品带来的震撼。  

![images/1a02b04092b39db947be5c704f0e84f47708d75456533dd5e246252d4c989c16.jpg](https://i.imgur.com/8DeTrAO.jpeg)  
图5-2-28光点国际新媒体艺术节线下展厅  

![images/ff084d26494e3eabc316da7791848c3c7f18a75f65b07adeaa275d72f63bbf97.jpg](https://i.imgur.com/8IVvi3a.jpeg)  
图5-2-29光点国际新媒体艺术节沉浸式剧场《AlMedusa》  

![images/32d15c19e23b86278e5da082b2ce0ba032113ecf33ae347883aea12630f6bd98.jpg](https://i.imgur.com/aDRJ70V.jpeg)  
图5-2-30光点国际新媒体艺术节线上展厅  

![images/906e1de02f5828eac3b979c1afe11ff014b093c76756aabde8c2155e044069f9.jpg](https://i.imgur.com/wmLNN5z.jpeg)  
图5-2-31光点国际新媒体艺术节“元宇宙”艺术展厅  

## 5.3 学习资源

一款优秀的软件和它的社区支持一定是分不开的。TouchDesigner 依托其全球化的社区组织体系，以及上下游供应商体系的支持，让学习者有一个极好的入门环境和自主学习渠道。无论是线上的社交媒体、网站、教学视频，还是线下的峰会活动、沙龙和培训教育，在学习 TouchDesigner 的过程中总有无数的人相伴左右。  

本节将列举目前全球范围内的 TouchDesigner 学习资源，涵盖视频、书籍、网站等。所有资源都可以通过扫码或者输入网址来浏览，大家可以按照自己的进度寻找相对应的教程进行学习。由于很多资源都在不停地更新和变化，未来有可能出现资源更新导致实际操作与书中内容不同的情况，请大家谅解。  

##### TouchDesigner官方网站

TouchDesigner的官方网站除了包含有各个版本的下载信息、商用购买协议外，还有丰富的教育信息和论坛讨论。其中，教育板块包括即将开始的工作坊预告、教程资源推荐链接、教育版软件信息、开设TouchDesigner 课程的学校、工作坊视频以及曾经举办的工作坊信息，在论坛板块还有许多关于TouchDesigner的话题讨论以及资源的分享。  

网址:derivative.cao  

![images/11b4961a50912eada7fab6d7526052cd8ff1412180b56ce80e161979b5c8c8ee.jpg](https://i.imgur.com/AFYXVt0.jpeg)  
图 5-3-01 TouchDesigner 官网主页  

![images/31e5a0bf4c32ab7b4e3dec71316d506a1e6d43a8f68180f75c42164feda1eb7a.jpg](https://i.imgur.com/6FklWfG.jpeg)  
图 5-3-02 TouchDesigner 官网学习板块中的教程  

allTD 是一个非营利的第三方TouchDesigner视频教程综合网站，网站内有几百位来自世界各地的作者贡献的视频教程。这些视频教程大多都以案例为主，涵盖 TouchDesigner 大部分内容。网站对视频教程进行了分类，这让我们可以根据难度以及标签挑选适合自己的教程，同时让检索教程变得更加方便。  

![images/f3cb2332d4a242c9c5ce1a3d23eff644e44315c7624c8ad80a30e9a0a58789f0.jpg](https://i.imgur.com/qObxMfz.jpeg)  
网址: https://altd.org/。  
图5-3-03alITD官网学习板块中的教程  

##### MatthewRagan的学习资源分享网站

Matthew Ragan 网站是由知名 TouchDesigner 教育家 Matthew Ragan 建立的 TouchDesigner 免费学习资源分享网站，在里面可以找到 TouchDesigner 各板块的教程，以及 Matthew Ragan 个人使用的TouchDesigner 工作示例。Matthew Ragan 还在网站内分享了一些优质的项目作品、工作室、个人艺术家的主页供我们查阅和学习。  

![images/b6162d542084b93764c435691c0ebc3b2bc30b0fb90418bb6485816c0b9ff7da.jpg](https://i.imgur.com/QUHFKoY.jpeg)  
网址: https://matthewragan.com/teaching-resources/touchdesigner/。   
图 5-3-04Matthew Ragan 网站主页  

Bileam Tschepe 是一名来自柏林的艺术家和教育家。2019 年起，Bileam Tschepe 开始使用TouchDesigner，并制作了许多数字艺术作品，后来又把这些作品作为教学案例分享出来供大家学习。他的教程大多都以案例为主，这些案例都拥有很好的视觉效果。Bileam Tschepe 也是与 TEA 合作的艺术家之一。  

![images/ea7a413f79ca97df184c14806f6b3b3afb85349ee6f40e63c7556bffa115b21a.jpg](https://i.imgur.com/eG5KmS7.jpeg)  
网址: https://www.patreon.com/elekktronaut/postso   
图 5-3-05 Bileam Tschepe 的 TouchDesigner 教程网站主页  

paketa12 是一名来自罗马尼亚的艺术家，本名 Aurelian lonus。因为害怕编程，此前他一直在平面设计、品牌识别、3D 等领域工作。在接触可视化编程之后，逐渐对 TouchDesigner 产生兴趣。在熟练掌握 TouchDesigner 之后便开始制作教程，他制作的关于生成设计的教程非常受欢迎。paketa12 也是与 TEA合作的艺术家之一。  

![images/fa290c90a8114e16a7a967f207161a6c942f2fb21927a6f3b99a26671c4b6a32.jpg](https://i.imgur.com/zhriPDN.jpeg)  
网址:https://www.patreon.com/paketa12/posts.   
图 5-3-06paketa12 的 TouchDesigner 教程网站主页  


TDSW （Tokyo Developers Study Weekend）是一个组织学习活动和研讨会的教育社区。 TDSW 主要使用 TouchDesigner 软件，专注于可视化编程、实时渲染和 2D 计算机图形。TDSW 经常举办研讨会，并发布免费的YouTube教程供大家学习参考。  

网址: https://tdsw.jp/。  

![images/fa7c5d6bccf6828d891d4ac1133231a32e4bb303ed4769414114517d5d012f1e.jpg](https://i.imgur.com/BBnOtDq.jpeg)  
图5-3-07TDSW线上教学网站主页  

##### StefanKraus的学习资源分享

TheNODEInstitute是由DavidBruell和StefanKraus创办和运营的创意编程线上课程平台。除了在德国柏林和网上组织社区交流会外，The NODE Institute还会挑选专业人士为学生提供优质的教学内容，以一种对双方都有利的方式将学生和教育工作者联系到一起。这样，教育工作者可以花更多的时间制作学习材料，学生也由此获得更好的学习体验。  

![images/68d5ea4d8d3edc29920e86c1c08755c0762634e708f2064bff30c6e63f9fdae1.jpg](https://i.imgur.com/nPD6Xif.jpeg)  

![images/339d911e8711324495f3403d6706217f31167a3728179493c8e3d2062127539d.jpg](https://i.imgur.com/0NTh3vZ.jpeg)  
网址: https://thenodeinstitute.org/。  
图5-3-08TheNODEInstitute线上课程平台网站  

##### The Interactive & Immersive HQ 的学习资源分享

The Interactive & Immersive HQ 是一个汇聚沉浸式设计师、互动设计师和创意技术专业人士的社区，他们与来自世界各地的顶级工作室、大学和组织合作。其博客上有数百篇深度文章，涵盖了互动技术和沉浸式媒体行业的多品类内容；同时，在YouTube 频道上创建了大量学习视频，从重要技术概念的演示到对行业专家的访谈，主题广泛。The Interactive & Immersive HQ PRO 是沉浸式媒体行业最大的在线专业培训社区之一，已帮助数百名艺术家和开发者实现了他们的梦想。  

网址: https://interactiveimmersive.io/。  

![images/8c37bc643e97b454904c8600c3dd412edbfeb952b25c45fa73359d82005e6b1e.jpg](https://i.imgur.com/YGDsJ6l.jpeg)  
图 5-3-09The Interactive & Immersive HQ 教程网站主页  

##### DotSimulate 的 TouchDesigner Al 工具箱

Lyell，以 DotSimulate 为人所知，是一位具有戏剧导演和设计背景的创意技术总监，擅长使用 Houdini和 TouchDesigner 制作程序化媒体及工具。他开发的 SDapi 插件，使用户能在TouchDesigner 内直接运行并控制 Stable Diffusion。 SDapi 使用 AUTOMATIC1111 的 API， 为艺术家和开发者提供了一个用来探索生成视觉和实时控制可能性的实用工具，让 TouchDesigner 更易于与Stable Diffusion 等人工智能工具进行交互。  

网址: http://patreon.com/dotsimulate。  

![images/65d6f7168fc22868c5d7bfeaac31d7e8f3c91f984e3a74227247303052f777e8.jpg](https://i.imgur.com/tiZGBAZ.jpeg)  
图 5-3-10SDapi插件的使用场景及DotSimulate 用其制作的作品  

# 元件索引  

扫码打开TouchDesigner 中文元件查询手册  

##### Camera COMP p56

相机元件：其作用类似于真实世界的相机，可以查看场景并改变角度进行渲染。  

##### Container COMP p67

容器元件：可以组合按钮元件、图像等，并设计其排列效果，从而制作为一个界面。常用于编辑程序交互逻辑、用户界面排布等。  

##### Environment CoMP p98

环境光元件：控制场景中环境光的颜色与强度，与普通灯光不同，环境光的照射作用不受物体空间位置影响。  

##### Geometry COMPp56p73

几何元件：所有三维几何形态（SOP元件）都需要在此元件中进行渲染。  

##### Light COMP p57

灯光元件：可更改三维场景中灯光的颜色、亮度、角度等。  

Window COMP p49  

窗口元件：用来指定最后的播放素材，设置全屏播放、调节最终输出窗口大小等。  

##### Blur TOP p53

模糊元件：可以对图像进行模糊处理。  

##### Cache TOP p160

缓存元件：用于缓存TOP图像，将其记录在内存中。  

CHOP to TOP p87  

数据转换图像元件：将CHOP类型数据元件转为TOP类型图像元件。  

##### Chroma Key TOP p48

色度抠图元件：通过色相、饱和度、明度从图像中选择遮  

罩范围。  

##### Composite TOP p46

图层叠加元件：改变图像叠加方式，如差值、正片叠底等。  

##### Displace TOP p54

像素置换元件：将图像的 RGB 或 Alpha 通道作为参照进行区域像素拉伸，从而将另一张图制作出扭曲的效果。  

##### Edge TOP p45

描边元件：查找图像轮廓并进行描边。  

##### HSV Adjust TOP p76

HSV色彩调节元件：调整图像的色相、饱和度和明度。  

##### Kinect Azure TOP p206

KinectAzure图像元件：用于配置MicrosoftKinectAzure摄像头并获取图像。  

##### Kinect TOP p198

Kinect 图像元件：连接Kinect，可以获得带有深度图、红外图和人像追踪图等的数据。  

##### Level TOP p53

亮度元件：可以调整图像的对比度、亮度、伽马值、暗部、颜色范围和不透明度。  

##### Monochrome ToP p47

灰度元件：将图像改为灰度图像，可以选择 RGB 和 Alpha通道等方式，将图像转为灰度。  

##### Movie File In TOP p44

视频加载元件：可以读取视频、图像或者序列帧，并且支持.mp4、.mov、.HapQ、NotchLC 等主流和专业视频格式，以及常见无损及压缩图像格式。  

##### Movie File Out TOP p50

视频录制元件：录制指定元件的画面或者视频，也可以指  

定声音通道一起录制。  

##### Notch TOP p155

Notch 图像元件：用于读取 Notch Block 文件（仅限TouchDesigner 教育版、商业版、专业版可使用)。  

##### Ramp TOP p46

渐变元件：创建颜色渐变图像，如垂直、水平、径向和圆形的渐变模式。  

##### Render TOP p56

渲染元件：用于渲染三维场景，常配合摄像机元件(CameraCOMP)、灯光元件(Light COMP)与三维图形元件(GeometryCOMP)一同使用。  

##### Substance TOP p98

Substance 元件：用于加载以 .sbsar 为后缀的材质贴图,一般与PBR 材质一同使用。  

##### Switch TOP p45

图像元件选择器：可以连接多个输入，并通过调整Index参数选择其中一个输入作为输出图像。  

##### Threshold TOP p200

阈值元件：可以选择一个阈值将图片转换成 2-bit 的黑白模式，常用于抠像。  

##### Transform TOP p52

变换元件：可以对图像进行平移、缩放、旋转、多次重复平铺以及背景填充。  

##### abletonMapper (Palette 插件) p137

abletonMapper： 实现从 TouchDesigner 向 Live 动态传递参数的功能。  

##### abletonMIDI (Palette 插件) p130

abletonMIDI:通过 MIDI 协议获取在 Live 中每个音轨的实时触发事件。  

##### abletonLevel (Palette 插件 ) p133

几何元件：基于任意轨道，返送原始的音频流并对音频的频段进行分析。  

##### firmata (Palette 插件) p192 p193

firmata 插件：是一个 Arduino 草图，允许使用 MIDI 格式的信号对 Arduino 进行配置和控制。  

##### tdAbletonPackage (Palette 插件) p129

tdAbleton 内容包：用于 TDAbleton 相关文件的安装，以及 TouchDesigner 与 Live 之间通讯的建立。  

##### Audio Device Out CHOP p80

音频输出元件：使用系统内置或者第三方驱动在不同设备上播放声音。  

##### Audio File In CHOP p80

音频加载元件：可以读取类型为.mp3、.aif、.aiff、.au和.wav等格式的音频文件。  

##### Audio Spectrum CHOP p81

音频频谱计算元件：强调较高和较低的频率，将声音通道以可视化方式显示。  

Constant CHOP p152  

创建数据通道元件：通过输入名称，创建自定义数据通道。  

##### Count CHOP p255

计数器元件：记录输入信号的次数或累计数据，也可用于记录交互动作发生的时间间隔。  

DMX Out CHOP p237  

DMX 数据通道发送元件：可以发送与 DMX 协议相关的数据通道信息至外部设备。  

##### Filter CHOP p188

滤波元件：用于平滑或锐化输入通道变化值，有不同的滤波模式可供设置和选择。  

Kinect Azure CHOP p206  

Kinect Azure 数据获取元件：用于配置 Microsoft KinectAzure 摄像头并获取人体的关节数据。  

##### Lag CHOP p112

缓动元件：可以为数据通道添加缓动效果。  

LeapMotion CHOP p214  

LeapMotion 数据获取元件：用于配置 LeapMotion 控制器并获取手指关节相关数据。  

##### Noise CHOP p111

数据噪波元件：产生一个不规则波形数据或随机数组，可以选择不同波形，调整其周期、幅度、谐波等。  

##### Replace CHOP P86

替换通道：通常用于快速替换输出通道。  

##### Resample CHOP p81

重新采样元件：选择不同的采样方法来更改通道采样率。  

##### Shuffle CHOP p85

重组样本元件：可以通过不同规则的排列方式，切割、排列和重组通道模式。  

##### Timer CHOP p255

计时器元件：计时器，用于计时并获取相关数据。  

TOP to CHOP p85  

图像转数据通道元件：将 TOP 图像转为 CHOP 通道来表示，将图像每行像素的 RGBA 值各排列为一个通道。  

##### Spring CHOP p216

弹簧元件：使输入数据产生震动，类似弹簧的作用力效果。  

##### Cap SOP p70

封盖元件：在平坦或圆形的面封闭模型的开放区域。  

##### Noise SOP p63

三维噪波元件：可以对三维模型添加各种噪波，从而产生随机扭曲形变的效果。  

##### ParticleSOPp64

粒子系统元件：创建粒子系统，并通过添加风力、外力等控制粒子运动。  

##### Sphere SOP p70

球体元件：生成不同几何类型的球形对象，可以增加或者减少球体的细节。  

##### Twist S0P p104 p218

扭曲元件：使物体产生非线性的形变，如弯曲、挤压、拉伸等。  

##### Constant MAT p58

固定材质元件：在材质上呈现固定的颜色，无任何的深度、纹理和反射效果。  

PBR MAT p98  

PBR材质元件：基于物理学渲染的材质，能够基于光线与物体表面的计算，模拟出较为真实的材质。  

##### Phong MAT p59

Phong 材质元件：最常见的冯氏模型材质，它支持添加纹理、反射、凹凸、锥光、边缘光和 Alpha 贴图等。  

##### Wireframe MAT p59

线框材质元件：将模型渲染为线框材质。  

##### TUIO InDAT p231

TUIO数据获取元件：用于将TUIO数据解析到列表中。  

# 后记

作为 TouchDesigner 发布 20 年来第一部中文著作，本书可以视为国内新媒体界的一个里程碑。我们希望用一部倾注着汗水的原创书籍给予读者一些切实的帮助。  

本书由 Digital FUN 工作室著。其中，TouchDesigner 中国社区的创始人陈若琨作为本书的主要著作权人，主持并参与了从拟定书稿章节、编撰内容到审阅统筹的全部工作。他带领创作组、编辑组、设计组与测试组等成员，一同完成了这部新媒体创意工具书的创作工作。  

在书籍审阅过程中，TEA 社区作为 TouchDesigner 母公司 Derivative 的全球教育合作伙伴，全程监制和审阅，为本书提供了大量技术支持，进一步确保了书籍的学术严谨性。本书添加了更多的交互技术实现手段，以及人工智能所带来的变革体验，从内容到版式都进行了更新。在修订过程中，张骏、江珊作为 Digital FUN 和 TEA 新媒体教育社区的联合创始人，主持了书籍内容的编写及审阅工作，同时创作了全新的案例和视觉内容；朱伟华、丛浩天、冯逸飞、欧阳梓豪、刘世杰将最新的技术转化为实操案例，以言简意的文字叙述提供给读者；褚然作为新书的编辑和设计，从语言规范、视觉效果、装帧设计等细节入手，将多主题的内容统一呈现，让学习者能够将不同知识点与工程项目融会贯通;苏郁晴、吴建伟、隆嘉、尹兆辉、陈亭羽、张艺凡也在本书的撰写过程中提供了各类支持和帮助；在书籍的校对审阅工作中，郭晶珺、袁若涵、滕丽竹对本书初稿进行了校对、分析和测试工作，张紫萱、赵思媛、邓芷萦、阮艺红、李凯文、柏诺喆、陈芝露、侯昱辰、张睿涵、魏子涵、江松臻、江舒阳、夏海轩、陈果、侯铭博、温钰桐、严羽杰协助确保每个案例操作的完整与准确。除了上述提到的参与者之外，还离不开张滦博、洪畅、任润楠、罗、张佳音、郭丹婷、纪乐平、欧阳娇的帮助。当然，还有非常多在本书撰写过程中提供帮助的朋友，在此一并表示感谢。  

感谢所有人对TouchDesigner 中文社区多年来的支持与陪伴，让我们继续前进，希望未来可以为大家提供更好的帮助和支持！  